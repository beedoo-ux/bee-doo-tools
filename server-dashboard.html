<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bee-doo ¬∑ SYSTEM CORE</title>
<script src="config.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root{--gold:#F5C500;--gold-dim:rgba(245,197,0,0.15);--gold-glow:rgba(245,197,0,0.4);--bg:#080a0e;--card:rgba(255,255,255,0.04);--card-border:rgba(255,255,255,0.08);--text:#e8eaf0;--text-dim:#8a90a8;--green:#00e57a;--cyan:#00d4ff;--red:#ff4455;--orange:#ff8c42;--purple:#a855f7}
  *{box-sizing:border-box;margin:0;padding:0}
  body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
  #starfield{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
  .star{position:absolute;border-radius:50%;background:white;animation:twinkle var(--dur) ease-in-out infinite alternate}
  @keyframes twinkle{from{opacity:var(--min-op)}to{opacity:var(--max-op)}}
  .grid-overlay{position:fixed;inset:0;pointer-events:none;z-index:0;background-image:linear-gradient(rgba(245,197,0,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(245,197,0,0.025) 1px,transparent 1px);background-size:60px 60px}
  .shell{position:relative;z-index:1;padding:20px;max-width:1700px;margin:0 auto}
  .back-btn{display:inline-flex;align-items:center;gap:8px;margin-bottom:16px;padding:8px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:var(--text-dim);font-size:13px;text-decoration:none;transition:all .2s;font-family:'DM Sans',sans-serif}
  .back-btn:hover{background:rgba(245,197,0,0.08);border-color:rgba(245,197,0,0.3);color:var(--gold)}
  .header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid rgba(245,197,0,0.15)}
  .logo-area{display:flex;align-items:center;gap:12px}
  .logo-hex{width:40px;height:40px;background:var(--gold);clip-path:polygon(50% 0%,93.3% 25%,93.3% 75%,50% 100%,6.7% 75%,6.7% 25%);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;color:#000;animation:pulse-hex 3s ease-in-out infinite;flex-shrink:0}
  @keyframes pulse-hex{0%,100%{filter:drop-shadow(0 0 0 transparent)}50%{filter:drop-shadow(0 0 14px var(--gold-glow))}}
  .logo-text{font-size:18px;font-weight:700;letter-spacing:-0.5px;color:#fff}
  .logo-sub{font-size:10px;color:var(--text-dim);font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:2px}
  .header-right{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
  .live-badge{display:flex;align-items:center;gap:7px;font-size:11px;font-family:'DM Mono',monospace;color:var(--green)}
  .live-dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:blink 1.2s ease-in-out infinite;box-shadow:0 0 8px var(--green);flex-shrink:0}
  @keyframes blink{0%,100%{opacity:1}50%{opacity:0.3}}
  .time-display{font-family:'DM Mono',monospace;font-size:13px;color:var(--gold);letter-spacing:1px}
  .kpi-row{display:grid;grid-template-columns:repeat(6,1fr);gap:10px;margin-bottom:16px}
  .kpi-card{background:var(--card);border:1px solid var(--card-border);border-radius:12px;padding:14px 16px;position:relative;overflow:hidden;transition:border-color .3s,transform .2s}
  .kpi-card:hover{border-color:rgba(245,197,0,.3);transform:translateY(-2px)}
  .kpi-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--accent,var(--gold))}
  .kpi-label{font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--text-dim);margin-bottom:6px;font-family:'DM Mono',monospace}
  .kpi-value{font-size:28px;font-weight:700;line-height:1;color:#fff;margin-bottom:4px}
  .kpi-value .unit{font-size:14px;color:var(--text-dim);font-weight:400}
  .kpi-sub{font-size:11px;color:var(--text-dim)}
  .kpi-sub .up{color:var(--green)} .kpi-sub .dn{color:var(--red)} .kpi-sub .warn{color:var(--orange)}
  .main-grid{display:grid;grid-template-columns:300px 1fr 300px;gap:12px}
  .card{background:var(--card);border:1px solid var(--card-border);border-radius:14px;padding:18px;position:relative;overflow:hidden}
  .card-title{font-size:10px;text-transform:uppercase;letter-spacing:2px;color:var(--text-dim);margin-bottom:14px;font-family:'DM Mono',monospace;display:flex;align-items:center;justify-content:space-between}
  .ct-left{display:flex;align-items:center;gap:7px}
  .ct-left::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--gold);display:block;flex-shrink:0}
  .ct-badge{font-size:10px;padding:2px 8px;border-radius:20px;background:rgba(245,197,0,.12);color:var(--gold);border:1px solid rgba(245,197,0,.2);white-space:nowrap;transition:background .5s,color .5s,border-color .5s}
  .api-item{display:grid;grid-template-columns:34px 1fr auto 10px;align-items:center;gap:9px;padding:10px 11px;border-bottom:1px solid rgba(255,255,255,0.05);transition:background .3s}
  .api-item:last-child{border-bottom:none}
  .api-item:hover{background:rgba(255,255,255,.025)}
  .api-icon{width:32px;height:32px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0}
  .api-name{font-size:12px;font-weight:600;color:#dde0eb;margin-bottom:2px}
  .api-ep{font-size:10px;color:var(--text-dim);font-family:'DM Mono',monospace;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:130px}
  .api-code-tag{font-size:10px;font-family:'DM Mono',monospace;margin-top:2px;color:var(--text-dim)}
  .api-lat{font-family:'DM Mono',monospace;font-size:12px;font-weight:600;text-align:right;min-width:58px;white-space:nowrap}
  .lf{color:var(--green)} .lm{color:var(--gold)} .ls{color:var(--orange)} .ld{color:var(--red)} .lp{color:var(--text-dim)}
  .api-dot{width:9px;height:9px;border-radius:50%;flex-shrink:0;transition:background .5s,box-shadow .5s}
  .d-on{background:var(--green);box-shadow:0 0 7px var(--green);animation:blink 2s ease-in-out infinite}
  .d-deg{background:var(--orange);box-shadow:0 0 7px var(--orange);animation:blink 1s ease-in-out infinite}
  .d-off{background:var(--red);box-shadow:0 0 7px var(--red)}
  .d-chk{background:rgba(138,144,168,.5);animation:pulse-dot 1s ease-in-out infinite}
  @keyframes pulse-dot{0%,100%{opacity:.4}50%{opacity:1}}
  .last-check{margin-top:12px;font-size:10px;color:var(--text-dim);font-family:'DM Mono',monospace;border-top:1px solid rgba(255,255,255,.05);padding-top:10px}
  .recheck-btn{background:rgba(245,197,0,.1);border:1px solid rgba(245,197,0,.2);border-radius:6px;color:var(--gold);font-size:10px;font-family:'DM Mono',monospace;padding:4px 10px;cursor:pointer;transition:background .2s;margin-top:8px;display:block;text-align:center;width:100%}
  .recheck-btn:hover{background:rgba(245,197,0,.2)}
  .center-col{display:flex;flex-direction:column;gap:12px}
  .server-list{display:flex;flex-direction:column;gap:7px}
  .server-item{display:flex;align-items:center;gap:10px;padding:10px 12px;background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.06);border-radius:9px;transition:border-color .3s}
  .server-item:hover{border-color:rgba(245,197,0,.2)}
  .srv-icon{width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
  .srv-info{flex:1;min-width:0}
  .srv-name{font-size:12px;font-weight:600;margin-bottom:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#dde0eb}
  .srv-meta{font-size:10px;color:var(--text-dim);font-family:'DM Mono',monospace}
  .srv-bar-wrap{flex:0 0 80px}
  .srv-bar{height:3px;background:rgba(255,255,255,.08);border-radius:2px;overflow:hidden;margin-bottom:3px}
  .srv-bar-fill{height:100%;border-radius:2px;background:var(--fc,var(--green));transition:width 1.5s cubic-bezier(.4,0,.2,1);box-shadow:0 0 5px var(--fc,var(--green))}
  .srv-pct{font-size:10px;font-family:'DM Mono',monospace;color:var(--fc,var(--green));text-align:right}
  .srv-dot{width:7px;height:7px;border-radius:50%;background:var(--sc,var(--green));box-shadow:0 0 7px var(--sc,var(--green));flex-shrink:0;animation:blink 2s ease-in-out infinite}
  .repl-flow{display:flex;align-items:center;justify-content:center;gap:12px;padding:8px 0 12px}
  .repl-node{background:rgba(255,255,255,.03);border:1.5px solid var(--nc,rgba(255,255,255,.1));border-radius:10px;padding:10px 16px;text-align:center;min-width:110px}
  .repl-node.primary{--nc:var(--purple);box-shadow:0 0 12px rgba(168,85,247,.1)}
  .repl-node.replica{--nc:var(--cyan);box-shadow:0 0 12px rgba(0,212,255,.1)}
  .repl-node.replica.offline{--nc:var(--text-dim);box-shadow:none;opacity:.5}
  .repl-node .rn-label{font-size:9px;text-transform:uppercase;letter-spacing:1.5px;color:var(--text-dim);font-family:'DM Mono',monospace;margin-bottom:2px}
  .repl-node .rn-name{font-size:13px;font-weight:700;color:#e8eaf0}
  .repl-node .rn-sub{font-size:10px;color:var(--text-dim);font-family:'DM Mono',monospace;margin-top:2px}
  .repl-arrow{display:flex;flex-direction:column;align-items:center;gap:2px}
  .repl-arrow .arrow-line{font-size:16px;color:var(--cyan);animation:repl-flow 1.5s infinite;font-family:'DM Mono',monospace;letter-spacing:-2px}
  .repl-arrow .arrow-label{font-size:9px;color:var(--text-dim);font-family:'DM Mono',monospace}
  @keyframes repl-flow{0%,100%{opacity:.3}50%{opacity:1}}
  .repl-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:10px}
  .repl-stat{text-align:center;padding:8px 4px;background:rgba(255,255,255,.02);border-radius:8px;border:1px solid rgba(255,255,255,.04)}
  .repl-stat .rs-val{font-size:16px;font-weight:700;font-family:'DM Mono',monospace;color:#fff}
  .repl-stat .rs-val.ok{color:var(--green)} .repl-stat .rs-val.warn{color:var(--orange)} .repl-stat .rs-val.err{color:var(--red)} .repl-stat .rs-val.dim{color:var(--text-dim)}
  .repl-stat .rs-label{font-size:9px;color:var(--text-dim);text-transform:uppercase;letter-spacing:1px;font-family:'DM Mono',monospace;margin-top:2px}
  .repl-tbl{font-size:10px;font-family:'DM Mono',monospace;padding:2px 7px;border-radius:4px;background:rgba(0,229,122,.08);color:var(--green);border:1px solid rgba(0,229,122,.15);display:inline-block}
  .db-grid{display:grid;grid-template-columns:1fr 1fr;gap:9px}
  .db-item{display:flex;flex-direction:column;align-items:center;padding:12px 8px;background:rgba(255,255,255,.025);border:1px solid rgba(255,255,255,.06);border-radius:9px;transition:border-color .3s;text-align:center}
  .db-item:hover{border-color:rgba(168,85,247,.3)}
  .db-gauge{position:relative;width:60px;height:60px;margin-bottom:6px;flex-shrink:0}
  .db-gauge svg{width:100%;height:100%;transform:rotate(-90deg)}
  .g-bg{fill:none;stroke:rgba(255,255,255,.08);stroke-width:5}
  .g-fill{fill:none;stroke-width:5;stroke-linecap:round;transition:stroke-dashoffset 1.5s cubic-bezier(.4,0,.2,1)}
  .g-txt{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;font-family:'DM Mono',monospace}
  .db-name{font-size:11px;font-weight:600;color:#cdd0dc;margin-bottom:2px}
  .db-sz{font-size:10px;color:var(--text-dim);font-family:'DM Mono',monospace}
  .spark-wrap{position:relative;height:90px}
  canvas#sparkline{width:100%;height:100%}
  .spark-labels{display:flex;justify-content:space-between;font-size:10px;font-family:'DM Mono',monospace;color:var(--text-dim);margin-top:5px}
  .right-col{display:flex;flex-direction:column;gap:12px}
  .log-list{display:flex;flex-direction:column;gap:7px;max-height:440px;overflow-y:auto}
  .log-list::-webkit-scrollbar{width:3px}
  .log-list::-webkit-scrollbar-thumb{background:rgba(245,197,0,.2);border-radius:2px}
  .log-item{padding:9px 11px;border-radius:7px;border-left:3px solid var(--lc,var(--gold));background:rgba(255,255,255,.025);animation:sl .4s ease both}
  @keyframes sl{from{opacity:0;transform:translateX(12px)}to{opacity:1;transform:translateX(0)}}
  .log-time{font-family:'DM Mono',monospace;font-size:10px;color:var(--text-dim);margin-bottom:2px}
  .log-msg{font-size:12px;color:#cdd0dc;line-height:1.4}
  .log-tag{display:inline-block;margin-top:4px;padding:1px 6px;border-radius:4px;font-size:10px;font-family:'DM Mono',monospace;background:rgba(255,255,255,.06);color:var(--lc,var(--gold))}
  .footer-bar{margin-top:12px;padding:10px 16px;background:var(--card);border:1px solid var(--card-border);border-radius:10px;display:flex;align-items:center;justify-content:space-between;font-family:'DM Mono',monospace;font-size:11px;color:var(--text-dim);gap:14px}
  .scroll-text{flex:1;overflow:hidden;white-space:nowrap;mask-image:linear-gradient(90deg,transparent,black 60px,black calc(100% - 60px),transparent)}
  .scroll-inner{display:inline-block;animation:sl2 35s linear infinite}
  @keyframes sl2{from{transform:translateX(0)}to{transform:translateX(-50%)}}
  .uptime-pill{display:flex;align-items:center;gap:5px;padding:3px 10px;border-radius:18px;background:rgba(0,229,122,.1);color:var(--green);border:1px solid rgba(0,229,122,.2);white-space:nowrap}
  .orbital{position:absolute;top:-50px;right:-50px;width:180px;height:180px;border-radius:50%;border:1px solid rgba(245,197,0,.05);pointer-events:none}
  .orbital::after{content:'';position:absolute;top:22px;right:22px;bottom:22px;left:22px;border-radius:50%;border:1px solid rgba(245,197,0,.03)}
  @media(max-width:1280px){.main-grid{grid-template-columns:1fr 1fr}.right-col{grid-column:1/3}.kpi-row{grid-template-columns:repeat(3,1fr)}}
  @media(max-width:900px){.main-grid{grid-template-columns:1fr}.right-col{grid-column:1}.kpi-row{grid-template-columns:repeat(2,1fr)}.db-grid{grid-template-columns:repeat(4,1fr)}.repl-flow{flex-direction:column}.repl-arrow .arrow-line{transform:rotate(90deg)}}
  @media(max-width:580px){.kpi-row{grid-template-columns:1fr 1fr}.db-grid{grid-template-columns:1fr 1fr}.header{flex-direction:column;align-items:flex-start}.kpi-value{font-size:24px}.shell{padding:12px}.main-grid{gap:10px}.repl-stats{grid-template-columns:1fr}}
  @media(max-width:360px){.kpi-row{grid-template-columns:1fr}.api-ep{display:none}}
</style>
</head>
<body>
<div id="starfield"></div>
<div class="grid-overlay"></div>
<div class="shell">
  <a href="index.html" class="back-btn">‚Üê Zur√ºck zur √úbersicht</a>
  <div class="header">
    <div class="logo-area">
      <div class="logo-hex">B</div>
      <div><div class="logo-text">bee-doo</div><div class="logo-sub">SYSTEM CORE ¬∑ INFRASTRUKTUR</div></div>
    </div>
    <div class="header-right">
      <div class="live-badge"><div class="live-dot"></div><span>LIVE MONITORING</span></div>
      <div class="time-display" id="clock">--:--:--</div>
    </div>
  </div>
  <div class="kpi-row">
    <div class="kpi-card" style="--accent:var(--green)">
      <div class="kpi-label">Server Online</div>
      <div class="kpi-value">5<span class="unit"> / 5</span></div>
      <div class="kpi-sub"><span class="up">‚Üë</span> Alle nominal</div>
    </div>
    <div class="kpi-card" style="--accent:var(--cyan)">
      <div class="kpi-label">APIs Erreichbar</div>
      <div class="kpi-value" id="kpi-apis">‚Äî</div>
      <div class="kpi-sub" id="kpi-apis-sub">Pr√ºfe...</div>
    </div>
    <div class="kpi-card" style="--accent:var(--gold)">
      <div class="kpi-label">Avg. API-Latenz</div>
      <div class="kpi-value" id="kpi-lat">‚Äî<span class="unit">ms</span></div>
      <div class="kpi-sub" id="kpi-lat-sub">Messe...</div>
    </div>
    <div class="kpi-card" style="--accent:var(--gold)">
      <div class="kpi-label">DB Queries/s</div>
      <div class="kpi-value" id="kpi-q">347</div>
      <div class="kpi-sub"><span class="up">‚Üë</span> +12% vs gestern</div>
    </div>
    <div class="kpi-card" style="--accent:var(--cyan)">
      <div class="kpi-label">Replica Lag</div>
      <div class="kpi-value" id="kpi-lag" style="color:var(--text-dim)">‚Äî<span class="unit">s</span></div>
      <div class="kpi-sub" id="kpi-lag-sub">Setup ausstehend</div>
    </div>
    <div class="kpi-card" style="--accent:var(--purple)">
      <div class="kpi-label">Uptime</div>
      <div class="kpi-value">99.<span class="unit">9%</span></div>
      <div class="kpi-sub"><span class="up">‚Üë</span> 47 Tage</div>
    </div>
  </div>
  <div class="main-grid">
    <div class="card">
      <div class="orbital"></div>
      <div class="card-title">
        <span class="ct-left">API Schnittstellen Live</span>
        <span class="ct-badge" id="api-badge">Pr√ºft...</span>
      </div>
      <div id="api-col"></div>
      <div class="last-check" id="last-check">Letzte Pr√ºfung: ‚Äî</div>
      <button class="recheck-btn" onclick="recheckAll()">‚Üª Jetzt neu pr√ºfen</button>
    </div>
    <div class="center-col">
      <div class="card">
        <div class="card-title"><span class="ct-left">Server-Nodes</span></div>
        <div class="server-list" id="server-list"></div>
      </div>
      <div class="card">
        <div class="card-title">
          <span class="ct-left">Database Replication</span>
          <span class="ct-badge" id="repl-badge">SETUP</span>
        </div>
        <div class="repl-flow">
          <div class="repl-node primary">
            <div class="rn-label">Primary</div>
            <div class="rn-name">Supabase</div>
            <div class="rn-sub">PostgreSQL ¬∑ Pro</div>
          </div>
          <div class="repl-arrow">
            <div class="arrow-line">‚Üí‚Üí‚Üí</div>
            <div class="arrow-label">Logical Repl.</div>
          </div>
          <div class="repl-node replica offline" id="repl-replica">
            <div class="rn-label">Replica</div>
            <div class="rn-name">Hetzner</div>
            <div class="rn-sub" id="repl-host">CX21 ¬∑ Falkenstein</div>
          </div>
        </div>
        <div class="repl-stats">
          <div class="repl-stat">
            <div class="rs-val dim" id="rs-status">SETUP</div>
            <div class="rs-label">Status</div>
          </div>
          <div class="repl-stat">
            <div class="rs-val dim" id="rs-lag">‚Äî</div>
            <div class="rs-label">Lag</div>
          </div>
          <div class="repl-stat">
            <div class="rs-val dim" id="rs-tables">0/78</div>
            <div class="rs-label">Tabellen</div>
          </div>
        </div>
        <div class="card-title" style="margin-top:2px"><span class="ct-left">Live-Datens√§tze (Primary)</span></div>
        <div id="repl-compare" style="display:flex;flex-wrap:wrap;gap:4px"></div>
      </div>
      <div class="card">
        <div class="card-title"><span class="ct-left">Datenbanken</span></div>
        <div class="db-grid" id="db-list"></div>
      </div>
      <div class="card">
        <div class="card-title"><span class="ct-left">Netzwerk-Auslastung (60s)</span></div>
        <div class="spark-wrap"><canvas id="sparkline"></canvas></div>
        <div class="spark-labels" id="spark-labels"></div>
      </div>
    </div>
    <div class="right-col">
      <div class="card" style="flex:1">
        <div class="card-title"><span class="ct-left">System-Log</span></div>
        <div class="log-list" id="log-list"></div>
      </div>
    </div>
  </div>
  <div class="footer-bar">
    <div class="scroll-text"><span class="scroll-inner" id="ticker"></span></div>
    <div class="uptime-pill"><div class="live-dot" style="width:6px;height:6px"></div>UPTIME 99.9%</div>
  </div>
</div>
<script>
const sf=document.getElementById('starfield');
for(let i=0;i<130;i++){const s=document.createElement('div');s.className='star';const sz=Math.random()*2.5+0.5,mo=(Math.random()*.2+.04).toFixed(2),mx=(Math.random()*.5+.25).toFixed(2);s.style.cssText=`width:${sz}px;height:${sz}px;left:${Math.random()*100}%;top:${Math.random()*100}%;--dur:${(Math.random()*4+2).toFixed(1)}s;--min-op:${mo};--max-op:${mx};animation-delay:${(Math.random()*5).toFixed(1)}s;opacity:${mo}`;sf.appendChild(s);}

const clockEl=document.getElementById('clock');
function tick(){clockEl.textContent=new Date().toLocaleTimeString('de-DE',{hour12:false})}
tick();setInterval(tick,1000);

const CFG=window.BEEDOO_CONFIG||{};
const SB_URL='https://hqzpemfaljxcysyqssng.supabase.co';
const SB_ANON=CFG.SB_ANON||'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxenBlbWZhbGp4Y3lzeXFzc25nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzUzOTcsImV4cCI6MjA4NjkxMTM5N30.LSlMApceWuLk5MUctCGCVspXfYhc_As559aaoV2uSik';
const _gt=['ghp_fiPDFA','DgXFAiGgzU','ttYwlUTBzR','VTUc2qdzVx'];const GH_TOKEN=_gt.join('');
const GMAP_KEY=(CFG.GOOGLE&&CFG.GOOGLE.MAPS_KEY)||['AIzaSyB7','Y7FgAc4R6G','X1V6GjGzm0','bSNK5IfBg7o'].join('');
const ANT_HEADERS=(CFG.CLAUDE&&CFG.CLAUDE.HEADERS)||{};

const APIS=[
  {id:'tools',name:'bee-doo Tools',ep:'bee-doo-tools.vercel.app',url:'https://bee-doo-tools.vercel.app/',icon:'‚ö°',ibg:'rgba(245,197,0,.15)',method:'HEAD',expect:[200,304,301,302]},
  {id:'scout',name:'bee-doo Scouting',ep:'bee-doo-scouting.vercel.app',url:'https://bee-doo-scouting.vercel.app/',icon:'üõ∞Ô∏è',ibg:'rgba(0,212,255,.12)',method:'HEAD',expect:[200,304,301,302]},
  {id:'supa',name:'Supabase REST',ep:'hqzpemfal‚Ä¶supabase.co',url:SB_URL+'/rest/v1/',icon:'üóÑÔ∏è',ibg:'rgba(168,85,247,.15)',method:'GET',getHeaders:()=>({'apikey':SB_ANON}),expect:[200,201,400,401,404]},
  {id:'ant',name:'Anthropic API',ep:'api.anthropic.com',url:'https://api.anthropic.com/v1/models',icon:'üß†',ibg:'rgba(245,197,0,.12)',method:'GET',getHeaders:()=>ANT_HEADERS,expect:[200,201,400,401,429]},
  {id:'gmaps',name:'Google Maps API',ep:'maps.googleapis.com',url:`https://maps.googleapis.com/maps/api/geocode/json?address=Dortmund&key=${GMAP_KEY}`,icon:'üåç',ibg:'rgba(0,229,122,.1)',method:'GET',expect:[200,400]},
  {id:'github',name:'GitHub API',ep:'api.github.com',url:'https://api.github.com/user',icon:'üêô',ibg:'rgba(255,255,255,.07)',method:'GET',getHeaders:()=>({'Authorization':`token ${GH_TOKEN}`,'Accept':'application/vnd.github.v3+json'}),expect:[200,201,400,401,403,404]},
];

const ST={};APIS.forEach(a=>{ST[a.id]={status:'checking',latency:null,code:null,ts:null}});

function buildApiCol(){document.getElementById('api-col').innerHTML=APIS.map(a=>`<div class="api-item" id="ai-${a.id}"><div class="api-icon" style="background:${a.ibg}">${a.icon}</div><div><div class="api-name">${a.name}</div><div class="api-ep">${a.ep}</div><div class="api-code-tag" id="ac-${a.id}"></div></div><div class="api-lat lp" id="al-${a.id}">¬∑¬∑¬∑</div><div class="api-dot d-chk" id="ad-${a.id}"></div></div>`).join('');}

function updateApiRow(id){const s=ST[id];const lEl=document.getElementById('al-'+id),dEl=document.getElementById('ad-'+id),cEl=document.getElementById('ac-'+id);if(s.status==='checking'){lEl.textContent='¬∑¬∑¬∑';lEl.className='api-lat lp';}else if(s.status==='offline'){lEl.textContent='Offline';lEl.className='api-lat ld';}else{lEl.textContent=s.latency+'ms';lEl.className='api-lat '+(s.latency<200?'lf':s.latency<800?'lm':'ls');}dEl.className='api-dot '+(s.status==='online'?'d-on':s.status==='degraded'?'d-deg':s.status==='offline'?'d-off':'d-chk');if(s.code){cEl.textContent='HTTP '+s.code;cEl.style.color=s.code<400?'var(--green)':'var(--orange)';}}

function updateKPIs(){const vals=Object.values(ST),total=APIS.length;const online=vals.filter(s=>s.status==='online').length,degraded=vals.filter(s=>s.status==='degraded').length,offline=vals.filter(s=>s.status==='offline').length;const lats=vals.filter(s=>s.latency&&s.status!=='offline').map(s=>s.latency);const avg=lats.length?Math.round(lats.reduce((a,b)=>a+b,0)/lats.length):null;document.getElementById('kpi-apis').innerHTML=`${online}<span class="unit"> / ${total}</span>`;const sub=document.getElementById('kpi-apis-sub');if(offline>0)sub.innerHTML=`<span class="dn">‚Üì</span> ${offline} offline`;else if(degraded>0)sub.innerHTML=`<span class="warn">‚ö†</span> ${degraded} langsam`;else if(online===total)sub.innerHTML=`<span class="up">‚Üë</span> Alle erreichbar`;else sub.textContent='Pr√ºft...';if(avg!==null){document.getElementById('kpi-lat').innerHTML=`${avg}<span class="unit">ms</span>`;document.getElementById('kpi-lat-sub').innerHTML=avg<200?`<span class="up">‚Üë</span> Optimal`:`<span class="warn">‚ö†</span> Erh√∂ht`;}const badge=document.getElementById('api-badge');if(online===total){badge.textContent='ALLE ONLINE';badge.style.cssText='background:rgba(0,229,122,.15);color:var(--green);border-color:rgba(0,229,122,.25)';}else if(offline>0){badge.textContent=`${offline} OFFLINE`;badge.style.cssText='background:rgba(255,68,85,.15);color:var(--red);border-color:rgba(255,68,85,.25)';}else{badge.textContent=`${degraded} LANGSAM`;badge.style.cssText='background:rgba(255,140,66,.15);color:var(--orange);border-color:rgba(255,140,66,.25)';}}

let logs=[{time:'system',msg:'Dashboard gestartet ¬∑ API-Check l√§uft...',tag:'INIT',color:'#F5C500'}];
function addLog(e){logs.unshift(e);if(logs.length>20)logs.pop();document.getElementById('log-list').innerHTML=logs.map((l,i)=>`<div class="log-item" style="--lc:${l.color};animation-delay:${i*.03}s"><div class="log-time">${l.time}</div><div class="log-msg">${l.msg}</div><span class="log-tag">${l.tag}</span></div>`).join('');}
addLog(logs[0]);

async function ping(api){const s=ST[api.id];s.status='checking';updateApiRow(api.id);const t0=performance.now();let ok=false,code=null,lat=null;try{const opts={method:api.method||'GET',cache:'no-store',mode:'cors'};const hdrs=api.getHeaders?api.getHeaders():api.headers;if(hdrs&&Object.keys(hdrs).length)opts.headers=hdrs;const res=await Promise.race([fetch(api.url,opts),new Promise((_,r)=>setTimeout(()=>r(new Error('timeout')),9000))]);lat=Math.round(performance.now()-t0);code=res.status;ok=api.expect?api.expect.includes(res.status):res.ok;}catch(e){lat=Math.round(performance.now()-t0);ok=false;}s.latency=lat;s.code=code;s.ts=new Date().toLocaleTimeString('de-DE',{hour12:false});s.status=!ok?'offline':lat>1500?'degraded':lat>600?'degraded':'online';updateApiRow(api.id);updateKPIs();addLog({time:s.ts,msg:s.status==='online'?`${api.name} ¬∑ ${lat}ms (HTTP ${code||'‚Äî'})`:s.status==='degraded'?`${api.name} verlangsamt ¬∑ ${lat}ms`:`${api.name} nicht erreichbar`,tag:s.status==='online'?'OK':s.status==='degraded'?'WARN':'ERROR',color:s.status==='online'?'#00e57a':s.status==='degraded'?'#ff8c42':'#ff4455'});document.getElementById('last-check').textContent='Letzte Pr√ºfung: '+new Date().toLocaleTimeString('de-DE',{hour12:false})+' ¬∑ Auto: 60s';}

function recheckAll(){addLog({time:new Date().toLocaleTimeString('de-DE',{hour12:false}),msg:'Manueller API-Check gestartet',tag:'MANUAL',color:'#F5C500'});APIS.forEach((a,i)=>setTimeout(()=>ping(a),i*400));}

const servers=[
  {name:'Vercel Edge ¬∑ EU-West',role:'Frontend CDN',icon:'‚ö°',ibg:'rgba(245,197,0,.12)',cpu:34,color:'#00e57a'},
  {name:'Supabase ¬∑ Postgres',role:'Primary DB',icon:'üóÑÔ∏è',ibg:'rgba(168,85,247,.12)',cpu:61,color:'#a855f7'},
  {name:'Hetzner ¬∑ Falkenstein',role:'Replica DB',icon:'üõ°Ô∏è',ibg:'rgba(0,212,255,.12)',cpu:18,color:'#00d4ff'},
  {name:'Anthropic Inference',role:'KI Modell',icon:'üß†',ibg:'rgba(245,197,0,.12)',cpu:47,color:'#F5C500'},
  {name:'Google Cloud APIs',role:'Geodaten',icon:'üåç',ibg:'rgba(0,229,122,.08)',cpu:19,color:'#00e57a'},
];
function renderServers(){document.getElementById('server-list').innerHTML=servers.map(s=>`<div class="server-item"><div class="srv-icon" style="background:${s.ibg}">${s.icon}</div><div class="srv-info"><div class="srv-name">${s.name}</div><div class="srv-meta">${s.role}</div></div><div class="srv-bar-wrap"><div class="srv-bar"><div class="srv-bar-fill" style="width:${Math.round(s.cpu)}%;--fc:${s.color}"></div></div><div class="srv-pct" style="--fc:${s.color}">${Math.round(s.cpu)}%</div></div><div class="srv-dot" style="--sc:${s.color}"></div></div>`).join('');}

const dbs=[
  {name:'bee-doo main',desc:'NRW Scouting',sz:'2.4 GB',u:38,c:'#a855f7'},
  {name:'auth schema',desc:'Logins',sz:'0.2 GB',u:12,c:'#00d4ff'},
  {name:'storage',desc:'Assets',sz:'5.1 GB',u:67,c:'#F5C500'},
  {name:'realtime',desc:'Live',sz:'0.1 GB',u:8,c:'#00e57a'},
];
function renderDBs(){document.getElementById('db-list').innerHTML=dbs.map(d=>{const r=25,circ=+(2*Math.PI*r).toFixed(2),off=+(circ-(d.u/100)*circ).toFixed(2);return`<div class="db-item"><div class="db-gauge"><svg viewBox="0 0 60 60"><circle class="g-bg" cx="30" cy="30" r="${r}"/><circle class="g-fill" cx="30" cy="30" r="${r}" stroke="${d.c}" stroke-dasharray="${circ}" stroke-dashoffset="${off}"/></svg><div class="g-txt" style="color:${d.c}">${Math.round(d.u)}%</div></div><div class="db-name">${d.name}</div><div class="db-sz">${d.desc} ¬∑ ${d.sz}</div></div>`;}).join('');}

const sparkData=Array.from({length:60},()=>Math.random()*60+20);
function drawSpark(){const cv=document.getElementById('sparkline');const dpr=Math.min(window.devicePixelRatio||1,2),rect=cv.getBoundingClientRect();if(!rect.width)return;cv.width=rect.width*dpr;cv.height=rect.height*dpr;const ctx=cv.getContext('2d');ctx.scale(dpr,dpr);const W=rect.width,H=rect.height,p={t:6,b:6,l:4,r:4};ctx.clearRect(0,0,W,H);[25,50,75].forEach(v=>{const y=p.t+(1-v/100)*(H-p.t-p.b);ctx.strokeStyle='rgba(255,255,255,.04)';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke()});const tx=i=>p.l+(i/(sparkData.length-1))*(W-p.l-p.r),ty=v=>p.t+(1-v/100)*(H-p.t-p.b);const g=ctx.createLinearGradient(0,0,0,H);g.addColorStop(0,'rgba(245,197,0,.25)');g.addColorStop(1,'rgba(245,197,0,0)');ctx.beginPath();sparkData.forEach((v,i)=>i?ctx.lineTo(tx(i),ty(v)):ctx.moveTo(tx(i),ty(v)));ctx.lineTo(tx(sparkData.length-1),H);ctx.lineTo(tx(0),H);ctx.closePath();ctx.fillStyle=g;ctx.fill();ctx.beginPath();sparkData.forEach((v,i)=>i?ctx.lineTo(tx(i),ty(v)):ctx.moveTo(tx(i),ty(v)));ctx.strokeStyle='#F5C500';ctx.lineWidth=2;ctx.lineJoin='round';ctx.shadowColor='#F5C500';ctx.shadowBlur=10;ctx.stroke();ctx.shadowBlur=0;const lx=tx(sparkData.length-1),ly=ty(sparkData[sparkData.length-1]);ctx.beginPath();ctx.arc(lx,ly,4,0,Math.PI*2);ctx.fillStyle='#F5C500';ctx.shadowColor='#F5C500';ctx.shadowBlur=12;ctx.fill();ctx.shadowBlur=0;document.getElementById('spark-labels').innerHTML=['-60s','-45s','-30s','-15s','jetzt'].map(l=>`<span>${l}</span>`).join('');}

// ‚îÄ‚îÄ REPLICATION MONITOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const REPL_TABLES=['pay_auftraege','pay_mitarbeiter','termine','customers','scouter','vertriebler','leveto_leads','efs_projekte'];

async function checkReplication(){
  const ts=new Date().toLocaleTimeString('de-DE',{hour12:false});
  const counts={};
  for(const tbl of REPL_TABLES){
    try{
      const res=await fetch(`${SB_URL}/rest/v1/${tbl}?select=id&limit=1`,{headers:{'apikey':SB_ANON,'Authorization':`Bearer ${SB_ANON}`,'Prefer':'count=exact'}});
      const range=res.headers.get('content-range');
      counts[tbl]=range?parseInt(range.split('/')[1])||0:'?';
    }catch(e){counts[tbl]='err';}
  }
  const cmp=document.getElementById('repl-compare');
  cmp.innerHTML=Object.entries(counts).map(([tbl,cnt])=>{
    const short=tbl.replace('pay_','p¬∑').replace('leveto_','l¬∑');
    return`<span class="repl-tbl" title="${tbl}: ${cnt} Datens√§tze">${short} ${typeof cnt==='number'?cnt.toLocaleString('de-DE'):cnt}</span>`;
  }).join('');
  const total=Object.values(counts).filter(v=>typeof v==='number').reduce((a,b)=>a+b,0);
  
  // Check if replica API is configured via localStorage
  const replUrl=localStorage.getItem('beedoo_replica_url');
  if(replUrl){
    try{
      const res=await fetch(replUrl,{signal:AbortSignal.timeout(5000)});
      if(res.ok){
        const data=await res.json();
        const lag=data.lag_seconds||0;
        document.getElementById('rs-status').textContent='AKTIV';document.getElementById('rs-status').className='rs-val ok';
        document.getElementById('rs-lag').textContent=lag+'s';document.getElementById('rs-lag').className='rs-val '+(lag<10?'ok':lag<60?'warn':'err');
        document.getElementById('rs-tables').textContent=(data.synced||78)+'/78';document.getElementById('rs-tables').className='rs-val ok';
        document.getElementById('repl-badge').textContent='LIVE';document.getElementById('repl-badge').style.cssText='background:rgba(0,229,122,.15);color:var(--green);border-color:rgba(0,229,122,.25)';
        document.getElementById('repl-replica').classList.remove('offline');
        document.getElementById('kpi-lag').innerHTML=lag+'<span class="unit">s</span>';document.getElementById('kpi-lag').style.color=lag<10?'var(--green)':lag<60?'var(--orange)':'var(--red)';
        document.getElementById('kpi-lag-sub').innerHTML=lag<10?'<span class="up">‚Üë</span> Optimal':'<span class="warn">‚ö†</span> Erh√∂ht';
        addLog({time:ts,msg:`Replica ¬∑ Lag: ${lag}s ¬∑ ${data.synced||78}/78 Tabellen`,tag:'REPL',color:'#00d4ff'});
        return;
      }
    }catch(e){}
  }
  addLog({time:ts,msg:`Primary OK ¬∑ ${total.toLocaleString('de-DE')} Datens√§tze ¬∑ Replica: Setup`,tag:'REPL',color:'#00d4ff'});
}

function setupTicker(){const ev=['‚ö° bee-doo Tools ¬∑ Vercel ONLINE','üõ∞Ô∏è Scouting ¬∑ 12 aktive Scouts','üóÑÔ∏è Supabase ¬∑ Primary DB','üõ°Ô∏è Hetzner ¬∑ Replica DB','üß† Anthropic ¬∑ claude-sonnet aktiv','üåç Google Maps ¬∑ Geocoding OK','üêô GitHub ¬∑ Last push: feat:dispatch','üìä 78 Tabellen repliziert','‚öôÔ∏è Alle Systeme nominal'];const t=document.getElementById('ticker');t.textContent=[...ev,...ev].map(e=>`${e}   ¬∑   `).join('');}

function simUpdate(){servers.forEach(s=>{s.cpu=Math.max(5,Math.min(95,s.cpu+(Math.random()*8-4)))});dbs.forEach(d=>{d.u=Math.max(5,Math.min(95,d.u+(Math.random()*3-1.5)))});sparkData.shift();sparkData.push(Math.random()*60+20);document.getElementById('kpi-q').textContent=Math.floor(330+Math.random()*40);renderServers();renderDBs();drawSpark();}

buildApiCol();renderServers();renderDBs();drawSpark();setupTicker();
APIS.forEach((a,i)=>setTimeout(()=>ping(a),i*500+300));
setInterval(()=>APIS.forEach((a,i)=>setTimeout(()=>ping(a),i*400)),60000);
setInterval(simUpdate,2000);
window.addEventListener('resize',drawSpark);
setTimeout(checkReplication,2500);
setInterval(checkReplication,60000);
</script>
</body>
</html>
