<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>bee-doo ¬∑ Enpal Partner-Reporting</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<script src="config.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.2/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.7/Recharts.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans',system-ui,sans-serif;background:#06080F;color:#E6EDF3;min-height:100vh}
button,select,input{font-family:inherit;color:inherit}
::-webkit-scrollbar{width:4px;height:4px}
::-webkit-scrollbar-thumb{background:#1B2332;border-radius:3px}
</style>

<style>

/* ‚ïê‚ïê‚ïê bee-doo Responsive + Lesbarkeit Fix ‚ïê‚ïê‚ïê */

/* === LESBARKEIT: Schriften aufhellen === */
/* Zu dunkle Graut√∂ne auf Dark Theme aufhellen */
body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }

/* === TABLET (768px) === */
@media (max-width: 768px) {
  /* Grid ‚Üí weniger Spalten */
  [style*="grid-template-columns"][style*="repeat"] { 
    grid-template-columns: repeat(2, 1fr) !important; 
  }
  [style*="gridTemplateColumns"] {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  /* Flex-Container wrappen */
  [style*="display:flex"], [style*="display: flex"],
  [style*='display:"flex"'], [style*="display:'flex'"] {
    flex-wrap: wrap !important;
  }
  /* Ausnahme: Nav-Items und kleine Icon-Rows nicht wrappen */
  [style*="align-items:center"][style*="gap:4px"],
  [style*="alignItems:"center""][style*="gap:"4px""] {
    flex-wrap: nowrap !important;
  }
  
  /* Sidebar verkleinern */
  [style*="width:240px"], [style*="width: 240px"],
  [style*="width:260px"], [style*="width: 260px"],
  [style*="width:280px"], [style*="width: 280px"],
  [style*='width:"240px"'], [style*='width:"260px"'], [style*='width:"280px"'] {
    width: 200px !important;
    min-width: 200px !important;
  }
  
  /* Modals nicht breiter als Screen */
  .modal, [style*="width:480px"], [style*="width:520px"], [style*="width:560px"],
  [style*="width:600px"], [style*="width:640px"], [style*="width:700px"] {
    width: 95vw !important;
    max-width: 95vw !important;
  }
  
  /* Padding reduzieren */
  [style*="padding:40px"], [style*="padding:48px"], [style*="padding:32px"] {
    padding: 20px !important;
  }
  [style*="padding: 40px"], [style*="padding: 48px"], [style*="padding: 32px"] {
    padding: 20px !important;
  }
  
  /* Tabellen scrollbar */
  table { display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
  
  /* Font-Size Minimum */
  * { min-height: 0; }
}

/* === MOBILE (480px) === */
@media (max-width: 480px) {
  /* Grid ‚Üí 1 Spalte */
  [style*="grid-template-columns"], [style*="gridTemplateColumns"] { 
    grid-template-columns: 1fr !important; 
  }
  .grid { grid-template-columns: 1fr !important; }
  
  /* Sidebar ausblenden oder collapsieren */
  [style*="width:240px"], [style*="width: 240px"],
  [style*="width:260px"], [style*="width: 260px"],
  [style*="width:280px"], [style*="width: 280px"],
  [style*="width:200px"], [style*="width: 200px"],
  [style*='width:"240px"'], [style*='width:"260px"'], [style*='width:"280px"'],
  [style*='width:"200px"'] {
    position: fixed !important;
    left: -300px !important;
    z-index: 999 !important;
    transition: left 0.3s ease !important;
    width: 260px !important;
    height: 100vh !important;
    top: 0 !important;
  }
  
  /* Alle Flex-Container stacken */
  [style*="display:flex"], [style*="display: flex"],
  [style*='display:"flex"'] {
    flex-wrap: wrap !important;
  }
  [style*="flex-direction:row"], [style*="flexDirection:"row""],
  [style*="flex-direction: row"] {
    flex-direction: column !important;
  }
  
  /* Form-Elemente full width */
  input, select, textarea, .input-field {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    font-size: 16px !important; /* Prevents iOS zoom */
  }
  
  /* Buttons touch-friendly */
  button, .btn-primary, .btn-secondary, [role="button"] {
    min-height: 44px !important;
    min-width: 44px !important;
    font-size: 14px !important;
  }
  
  /* Padding stark reduzieren */
  [style*="padding:40px"], [style*="padding:48px"], [style*="padding:32px"],
  [style*="padding:28px"], [style*="padding:24px"],
  [style*="padding: 40px"], [style*="padding: 48px"], [style*="padding: 32px"],
  [style*="padding: 28px"], [style*="padding: 24px"] {
    padding: 12px !important;
  }
  
  /* Gap reduzieren */
  [style*="gap:24px"], [style*="gap:20px"], [style*="gap:28px"],
  [style*="gap: 24px"], [style*="gap: 20px"], [style*="gap: 28px"] {
    gap: 12px !important;
  }
  
  /* Font sizes - minimum 12px */
  [style*="font-size:8px"], [style*="font-size:9px"], [style*="font-size:10px"],
  [style*="font-size: 8px"], [style*="font-size: 9px"], [style*="font-size: 10px"],
  [style*="fontSize:8px"], [style*="fontSize:9px"], [style*="fontSize:10px"],
  [style*='fontSize:"8px"'], [style*='fontSize:"9px"'], [style*='fontSize:"10px"'] {
    font-size: 12px !important;
  }
  
  /* Bilder responsive */
  img { max-width: 100% !important; height: auto !important; }
  
  /* Fixed elements repositionieren */
  [style*="position:fixed"][style*="top:12px"][style*="left:12px"],
  [style*="position: fixed"][style*="top: 12px"][style*="left: 12px"] {
    top: 6px !important;
    left: 6px !important;
    font-size: 11px !important;
    padding: 4px 8px !important;
  }
  
  /* Logo kleiner */
  .logo { font-size: 32px !important; }
  
  /* Text wrap erzwingen */
  * { word-wrap: break-word !important; overflow-wrap: break-word !important; }
  [style*="white-space:nowrap"], [style*="white-space: nowrap"],
  [style*='whiteSpace:"nowrap"'] {
    white-space: normal !important;
  }
  
  /* Modals full width */
  .modal, [class*="modal"], [style*="width:480px"], [style*="width:520px"],
  [style*="width:560px"], [style*="width:600px"] {
    width: 96vw !important;
    max-width: 96vw !important;
    padding: 16px !important;
    margin: 8px !important;
  }
  
  /* Map containers */
  #map, .leaflet-container, [style*="height:100vh"] {
    height: calc(100vh - 60px) !important;
  }
  .map-toolbar {
    flex-direction: column !important;
    top: 6px !important;
    left: 6px !important;
    right: 6px !important;
  }
  .map-tool-btn {
    font-size: 11px !important;
    padding: 5px 10px !important;
  }
}

/* ‚ïê‚ïê‚ïê Lesbarkeit: Zu dunkle Farben aufhellen ‚ïê‚ïê‚ïê */
/* #0c1222 backgrounds ‚Üí Schrift mindestens #8b95a5 */
[style*="color:#0c1222"], [style*="color: #0c1222"] { color: #8b95a5 !important; }
[style*="color:#151d30"], [style*="color: #151d30"] { color: #8b95a5 !important; }
[style*="color:#263354"], [style*="color: #263354"] { color: #7a8baa !important; }
[style*="color:#1c2640"], [style*="color: #1c2640"] { color: #8b95a5 !important; }
[style*="color:#334155"], [style*="color: #334155"] { color: #8b95a5 !important; }
[style*="color:#252530"], [style*="color: #252530"] { color: #8b95a5 !important; }
[style*='color:"#0c1222"'] { color: #8b95a5 !important; }
[style*='color:"#151d30"'] { color: #8b95a5 !important; }
[style*='color:"#263354"'] { color: #7a8baa !important; }
[style*='color:"#1c2640"'] { color: #8b95a5 !important; }
[style*='color:"#334155"'] { color: #8b95a5 !important; }
[style*='color:"#252530"'] { color: #8b95a5 !important; }

/* Gr√ºnt√∂ne auf Dark besser lesbar machen */
[style*="color:#166534"], [style*="color: #166534"] { color: #34d399 !important; }
[style*='color:"#166534"'] { color: #34d399 !important; }

/* Generell: Alle font-sizes unter 10px auf mindestens 11px */
</style>
</head>
<body>
<a href="index.html" style="position:fixed;top:10px;left:10px;z-index:9999;background:#111827;border:1px solid #333;color:#9ca3af;padding:6px 13px;border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;font-family:inherit;transition:all .15s" onmouseover="this.style.color='#F5C500';this.style.borderColor='#F5C500'" onmouseout="this.style.color='#9ca3af';this.style.borderColor='#333'">‚Üê Launcher</a>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useMemo } = React;
const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, Legend, LineChart, Line } = Recharts;

const SB_URL = window.BEEDOO_CONFIG?.SB_URL || 'https://hqzpemfaljxcysyqssng.supabase.co';
const SB_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxenBlbWZhbGp4Y3lzeXFzc25nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzUzOTcsImV4cCI6MjA4NjkxMTM5N30.LSlMApceWuLk5MUctCGCVspXfYhc_As559aaoV2uSik';
const PW = 'Enpal2026!';
const SK = 'enpal_ext_v5';

const C = {
  bg:'#06080F', card:'#0D1117', border:'#1B2332',
  text:'#E6EDF3', sec:'#8B949E', dim:'#484F58',
  orange:'#F97316', green:'#3FB950', red:'#F85149',
  blue:'#58A6FF', amber:'#F0A030', cyan:'#56D4DD',
};

const fmt  = n => n == null ? '‚Äî' : Number(n).toLocaleString('de-DE');
const fmtP = n => n == null ? '‚Äî' : Number(n).toFixed(1) + ' %';
const eur  = n => n == null ? '‚Äî' : Math.round(n).toLocaleString('de-DE') + ' ‚Ç¨';

async function loadData() {
  const res = await fetch(
    SB_URL + '/rest/v1/enpal_leads?import_label=like.REPORTING*&select=import_label,row_data&order=id.asc&limit=1000',
    { headers: { 'apikey': SB_ANON, 'Authorization': 'Bearer ' + SB_ANON } }
  );
  if (!res.ok) throw new Error(await res.text());
  return await res.json();
}

function KPI({ label, value, sub, color }) {
  const c = color || C.orange;
  return (
    <div style={{ background: C.card, border: '1px solid ' + C.border, borderRadius: 10, padding: '18px 22px', minWidth: 140 }}>
      <div style={{ fontSize: 26, fontWeight: 800, color: c }}>{value}</div>
      <div style={{ fontSize: 13, fontWeight: 600, color: C.text, marginTop: 2 }}>{label}</div>
      {sub && <div style={{ fontSize: 11, color: C.sec, marginTop: 2 }}>{sub}</div>}
    </div>
  );
}

function TT() {
  return { contentStyle: { background: C.card, border: '1px solid ' + C.border, borderRadius: 8, fontSize: 12 } };
}

function Board({ rows, importLabel, onLogout }) {
  const [tab, setTab] = useState('uebersicht');

  // Parse rows by type
  const kpi       = rows.find(r => r.type === 'kpi') || {};
  const dailyImp  = rows.filter(r => r.type === 'daily_import');
  const dailyEr   = rows.filter(r => r.type === 'daily_erstellt');
  const dailyTer  = rows.filter(r => r.type === 'daily_termine');
  const berater   = rows.filter(r => r.type === 'berater');
  const ccAgents  = rows.filter(r => r.type === 'cc_agent');
  const abschluss = rows.filter(r => r.type === 'abschluss');
  const speedBuck = rows.filter(r => r.type === 'speed_bucket');
  const speedSum  = rows.find(r => r.type === 'speed_summary') || {};

  const termRate = kpi.leads_feb > 0 ? (kpi.terminiert / kpi.leads_feb * 100) : 0;
  const afRate   = (kpi.stattgefunden + kpi.ausgefallen) > 0 ? (kpi.ausgefallen / (kpi.stattgefunden + kpi.ausgefallen) * 100) : 0;
  const wasteRate = kpi.leads_feb > 0 ? ((kpi.reklamation + (kpi.ne5||0)) / kpi.leads_feb * 100) : 0;

  const TABS = [
    { k:'uebersicht', l:'üìä √úbersicht' },
    { k:'termine',    l:'üìÜ Termine'   },
    { k:'berater',    l:'üë§ Berater'   },
    { k:'pipeline',   l:'üîÑ Pipeline'  },
  ];

  return (
    <div style={{ minHeight:'100vh', background: C.bg }}>
      {/* Header */}
      <div style={{ background: C.card, borderBottom: '1px solid ' + C.border, padding: '0 24px' }}>
        <div style={{ maxWidth: 1200, margin: '0 auto', display:'flex', alignItems:'center', justifyContent:'space-between', height: 56 }}>
          <div style={{ display:'flex', alignItems:'center', gap:12 }}>
            <span style={{ fontWeight:800, fontSize:18 }}>bee<span style={{ color: C.orange }}>¬∑</span>doo</span>
            <span style={{ background:'rgba(249,115,22,.15)', color: C.orange, fontSize:11, fontWeight:700, padding:'3px 10px', borderRadius:20 }}>ENPAL PARTNER BOARD</span>
            {importLabel && <span style={{ fontSize:11, color: C.sec }}>Stand: {importLabel.replace('REPORTING::','')}</span>}
          </div>
          <button onClick={onLogout} style={{ background:'transparent', border:'1px solid '+C.border, borderRadius:8, color:C.sec, padding:'5px 12px', fontSize:12, cursor:'pointer' }}>Abmelden</button>
        </div>
      </div>

      <div style={{ maxWidth:1200, margin:'0 auto', padding:24 }}>
        {/* Tabs */}
        <div style={{ display:'flex', gap:4, marginBottom:20, flexWrap:'wrap' }}>
          {TABS.map(t => {
            const active = tab === t.k;
            return (
              <button key={t.k} onClick={() => setTab(t.k)} style={{ padding:'8px 16px', borderRadius:8, border:'none', cursor:'pointer', fontSize:13, fontWeight:600, background: active ? C.orange : C.card, color: active ? '#fff' : C.sec }}>
                {t.l}
              </button>
            );
          })}
        </div>

        {/* √úBERSICHT */}
        {tab === 'uebersicht' && (
          <div style={{ display:'flex', flexDirection:'column', gap:18 }}>
            <div style={{ display:'flex', gap:12, flexWrap:'wrap' }}>
              <KPI label="Enpal Leads Feb" value={fmt(kpi.leads_feb)} sub={'WP: '+fmt(kpi.wp_leads)+' ¬∑ Klassisch: '+fmt(kpi.klassisch_leads)} />
              <KPI label="Terminierungsquote" value={fmtP(termRate)} sub={fmt(kpi.terminiert)+' terminiert'} color={termRate>=15?C.green:C.amber} />
              <KPI label="Termine erstellt" value={fmt(kpi.termine_erstellt)} sub={'Stattgef.: '+fmt(kpi.stattgefunden)+' ¬∑ Ausgef.: '+fmt(kpi.ausgefallen)} color={C.cyan} />
              <KPI label="Abschl√ºsse" value={fmt(kpi.sales)} sub={kpi.sales_netto ? eur(kpi.sales_netto) : '‚Äî'} color={kpi.sales > 0 ? C.green : C.red} />
              <KPI label="Waste-Quote" value={fmtP(wasteRate)} sub={fmt(kpi.reklamation)+' Rekl. + '+fmt(kpi.ne5||0)+' NE5'} color={wasteRate < 40 ? C.amber : C.red} />
            </div>

            {/* Daily Lead Import */}
            {dailyImp.length > 0 && (
              <div style={{ background: C.card, border: '1px solid '+C.border, borderRadius:12, padding:20 }}>
                <div style={{ fontSize:14, fontWeight:700, marginBottom:16 }}>üì• T√§glicher Enpal Lead-Import</div>
                <ResponsiveContainer width="100%" height={240}>
                  <BarChart data={dailyImp}>
                    <CartesianGrid strokeDasharray="3 3" stroke={C.border} />
                    <XAxis dataKey="datum" tick={{ fill: C.sec, fontSize:11 }} />
                    <YAxis tick={{ fill: C.sec, fontSize:11 }} />
                    <Tooltip {...TT()} />
                    <Legend wrapperStyle={{ fontSize:10 }} />
                    <Bar dataKey="wp"  stackId="a" fill={C.orange} name="WP" />
                    <Bar dataKey="kl"  stackId="a" fill={C.amber}  name="Klassisch" radius={[4,4,0,0]} />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            )}
          </div>
        )}

        {/* TERMINE */}
        {tab === 'termine' && (
          <div style={{ display:'flex', flexDirection:'column', gap:16 }}>
            {dailyEr.length > 0 && (
              <div style={{ background: C.card, border: '1px solid '+C.border, borderRadius:12, padding:20 }}>
                <div style={{ fontSize:14, fontWeight:700, marginBottom:16 }}>üìÜ Termine erstellt pro Tag</div>
                <ResponsiveContainer width="100%" height={220}>
                  <BarChart data={dailyEr}>
                    <CartesianGrid strokeDasharray="3 3" stroke={C.border} />
                    <XAxis dataKey="datum" tick={{ fill:C.sec, fontSize:11 }} />
                    <YAxis tick={{ fill:C.sec, fontSize:11 }} />
                    <Tooltip {...TT()} />
                    <Legend wrapperStyle={{ fontSize:10 }} />
                    <Bar dataKey="wp" stackId="a" fill={C.orange} name="WP" />
                    <Bar dataKey="kl" stackId="a" fill={C.amber} name="Klassisch" radius={[4,4,0,0]} />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            )}
            {dailyTer.length > 0 && (
              <div style={{ background: C.card, border: '1px solid '+C.border, borderRadius:12, padding:20 }}>
                <div style={{ fontSize:14, fontWeight:700, marginBottom:16 }}>üìä Termine Stattgef. / Ausgef. / Offen</div>
                <ResponsiveContainer width="100%" height={260}>
                  <BarChart data={dailyTer}>
                    <CartesianGrid strokeDasharray="3 3" stroke={C.border} />
                    <XAxis dataKey="datum" tick={{ fill:C.sec, fontSize:10 }} angle={-45} textAnchor="end" height={50} />
                    <YAxis tick={{ fill:C.sec, fontSize:11 }} />
                    <Tooltip {...TT()} />
                    <Legend wrapperStyle={{ fontSize:10 }} />
                    <Bar dataKey="stattgef" stackId="a" fill={C.green} name="Stattgefunden" />
                    <Bar dataKey="ausgef"   stackId="a" fill={C.red}   name="Ausgefallen" />
                    <Bar dataKey="offen"    stackId="a" fill={C.blue}  name="Offen" radius={[4,4,0,0]} />
                  </BarChart>
                </ResponsiveContainer>
                <div style={{ fontSize:11, color:C.sec, marginTop:8 }}>
                  Ausgefallen-Quote: <strong style={{ color: afRate > 40 ? C.red : C.amber }}>{fmtP(afRate)}</strong> ¬∑ {fmt(kpi.offen)} offene Termine ausstehend
                </div>
              </div>
            )}
            {abschluss.length > 0 && (
              <div style={{ background: C.card, border: '1px solid '+C.border, borderRadius:12, padding:20 }}>
                <div style={{ fontSize:14, fontWeight:700, marginBottom:16 }}>üèÅ Abschluss-Ergebnisse (stattgef. Termine)</div>
                {abschluss.map((a, i) => (
                  <div key={i} style={{ display:'flex', justifyContent:'space-between', padding:'6px 0', borderBottom:'1px solid '+C.border }}>
                    <span style={{ fontSize:13 }}>{a.name}</span>
                    <span style={{ fontSize:13, fontWeight:700, color: a.name==='Sale' ? C.green : C.sec }}>{a.count}</span>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}

        {/* BERATER */}
        {tab === 'berater' && (
          <div style={{ display:'flex', flexDirection:'column', gap:16 }}>
            {berater.length > 0 && (
              <div style={{ background: C.card, border: '1px solid '+C.border, borderRadius:12, padding:20 }}>
                <div style={{ fontSize:14, fontWeight:700, marginBottom:16 }}>üë§ Berater ‚Äî Termine erstellt</div>
                <ResponsiveContainer width="100%" height={Math.max(200, berater.length * 34)}>
                  <BarChart data={berater} layout="vertical" margin={{ left:10 }}>
                    <XAxis type="number" tick={{ fill:C.sec, fontSize:11 }} />
                    <YAxis type="category" dataKey="name" tick={{ fill:C.text, fontSize:12 }} width={150} />
                    <Tooltip {...TT()} />
                    <Bar dataKey="termine" fill={C.orange} name="Termine" radius={[0,4,4,0]} />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            )}
            {ccAgents.length > 0 && (
              <div style={{ background: C.card, border: '1px solid '+C.border, borderRadius:12, padding:20 }}>
                <div style={{ fontSize:14, fontWeight:700, marginBottom:16 }}>üìû CC Agenten ‚Äî Enpal Conversion</div>
                <div style={{ overflowX:'auto' }}>
                  <table style={{ width:'100%', borderCollapse:'collapse', fontSize:13 }}>
                    <thead>
                      <tr>
                        {['Agentin','Leads','Terminiert','Rate','Reklamation'].map(h => (
                          <th key={h} style={{ padding:'10px 12px', textAlign: h==='Agentin' ? 'left' : 'right', color:C.sec, fontWeight:600, borderBottom:'2px solid '+C.border }}>{h}</th>
                        ))}
                      </tr>
                    </thead>
                    <tbody>
                      {ccAgents.sort((a,b) => b.rate - a.rate).map((a, i) => (
                        <tr key={i} style={{ background: i%2===1 ? C.card : 'transparent', borderBottom:'1px solid '+C.border }}>
                          <td style={{ padding:'9px 12px', fontWeight:600 }}>{a.name}</td>
                          <td style={{ padding:'9px 12px', textAlign:'right' }}>{fmt(a.leads)}</td>
                          <td style={{ padding:'9px 12px', textAlign:'right', color:C.green, fontWeight:700 }}>{fmt(a.terminiert)}</td>
                          <td style={{ padding:'9px 12px', textAlign:'right', color: a.rate >= 15 ? C.green : C.amber, fontWeight:700 }}>{fmtP(a.rate)}</td>
                          <td style={{ padding:'9px 12px', textAlign:'right', color:C.red }}>{fmt(a.rekl)}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}
          </div>
        )}

        {/* PIPELINE */}
        {tab === 'pipeline' && (
          <div style={{ display:'flex', flexDirection:'column', gap:16 }}>
            <div style={{ display:'flex', gap:12, flexWrap:'wrap' }}>
              <KPI label="Nicht erreicht (NE)" value={fmt(kpi.ne)} sub={(kpi.ne5||0)+' √ó NE5'} color={C.amber} />
              <KPI label="Wiedervorlage" value={fmt(kpi.wvl)} color={C.blue} />
              <KPI label="Reklamation" value={fmt(kpi.reklamation)} color={C.red} />
            </div>
            {speedBuck.length > 0 && (
              <div style={{ background: C.card, border: '1px solid '+C.border, borderRadius:12, padding:20 }}>
                <div style={{ fontSize:14, fontWeight:700, marginBottom:4 }}>‚ö° Lead ‚Üí Termin Reaktionszeit</div>
                {speedSum.median && (
                  <div style={{ fontSize:12, color:C.sec, marginBottom:16 }}>
                    Median: <strong style={{ color:C.orange }}>{speedSum.median}h</strong> ¬∑ √ò {speedSum.avg}h ¬∑ {speedSum.unter24h_pct}% unter 24h
                  </div>
                )}
                <ResponsiveContainer width="100%" height={200}>
                  <BarChart data={speedBuck}>
                    <CartesianGrid strokeDasharray="3 3" stroke={C.border} />
                    <XAxis dataKey="name" tick={{ fill:C.sec, fontSize:11 }} />
                    <YAxis tick={{ fill:C.sec, fontSize:11 }} />
                    <Tooltip {...TT()} />
                    <Bar dataKey="count" fill={C.cyan} name="Termine" radius={[4,4,0,0]} />
                  </BarChart>
                </ResponsiveContainer>
              </div>
            )}
            <div style={{ background: C.card, border: '1px solid '+C.border, borderRadius:12, padding:20 }}>
              <div style={{ fontSize:14, fontWeight:700, marginBottom:8 }}>üìã Handlungsempfehlungen</div>
              <div style={{ display:'flex', flexDirection:'column', gap:8 }}>
                {termRate < 15 && (
                  <div style={{ background:'rgba(240,160,48,.08)', border:'1px solid rgba(240,160,48,.25)', borderRadius:8, padding:'10px 14px', fontSize:13 }}>
                    üü° <strong>Terminierungsquote {fmtP(termRate)}</strong> ‚Äî Ziel: &gt;15% ¬∑ {fmt(kpi.leads_feb - kpi.terminiert)} Leads bisher nicht terminiert
                  </div>
                )}
                {afRate > 40 && (
                  <div style={{ background:'rgba(248,81,73,.08)', border:'1px solid rgba(248,81,73,.25)', borderRadius:8, padding:'10px 14px', fontSize:13 }}>
                    üî¥ <strong>Ausfallquote {fmtP(afRate)}</strong> ‚Äî H√∂her als Benchmark ¬∑ Best√§tigungsanrufe optimieren
                  </div>
                )}
                {kpi.offen > 0 && (
                  <div style={{ background:'rgba(88,166,255,.08)', border:'1px solid rgba(88,166,255,.25)', borderRadius:8, padding:'10px 14px', fontSize:13 }}>
                    üîµ <strong>{fmt(kpi.offen)} offene Termine</strong> stehen noch aus ‚Äî Ergebnisse folgen
                  </div>
                )}
                {(kpi.wvl||0) > 0 && (
                  <div style={{ background:'rgba(63,185,80,.08)', border:'1px solid rgba(63,185,80,.25)', borderRadius:8, padding:'10px 14px', fontSize:13 }}>
                    üü¢ <strong>{fmt(kpi.wvl)} Wiedervorlagen</strong> nachfassen ‚Äî potenzielle Abschl√ºsse
                  </div>
                )}
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

function Login({ onLogin }) {
  const [pw, setPw] = useState('');
  const [err, setErr] = useState(false);
  const submit = () => {
    if (pw === PW) { sessionStorage.setItem(SK, '1'); onLogin(); }
    else { setErr(true); setTimeout(() => setErr(false), 3000); }
  };
  return (
    <div style={{ minHeight:'100vh', display:'flex', alignItems:'center', justifyContent:'center', background: C.bg }}>
      <div style={{ background: C.card, border: '1px solid '+C.border, borderRadius:16, padding:'48px 40px', width:'100%', maxWidth:380, textAlign:'center' }}>
        <div style={{ fontSize:36, fontWeight:800, marginBottom:4 }}>bee<span style={{ color: C.orange }}>¬∑</span>doo</div>
        <div style={{ background:'rgba(249,115,22,.15)', color: C.orange, display:'inline-block', padding:'3px 14px', borderRadius:20, fontSize:11, fontWeight:700, marginBottom:32 }}>ENPAL PARTNER BOARD</div>
        <div style={{ fontSize:15, color: C.sec, marginBottom:20 }}>Bitte Passwort eingeben</div>
        <input
          type="password" value={pw} onChange={e => setPw(e.target.value)}
          onKeyDown={e => e.key==='Enter' && submit()}
          placeholder="Passwort" autoFocus
          style={{ width:'100%', padding:'12px 16px', borderRadius:10, fontSize:15, border:'2px solid '+(err ? C.red : C.border), background:'#0D1117', color: C.text, outline:'none', marginBottom:8, display:'block' }}
        />
        {err && <div style={{ color: C.red, fontSize:12, marginBottom:8 }}>Falsches Passwort</div>}
        <button onClick={submit} style={{ width:'100%', padding:12, borderRadius:10, border:'none', cursor:'pointer', background: C.orange, color:'#fff', fontWeight:800, fontSize:15, marginTop:8 }}>
          Anmelden ‚Üí
        </button>
        <div style={{ marginTop:24, fontSize:12, color: C.sec }}>bee-doo GmbH ¬∑ Enpal Partner Analytics</div>
      </div>
    </div>
  );
}

function Main() {
  const [auth, setAuth]     = useState(() => sessionStorage.getItem(SK) === '1');
  const [loading, setLoading] = useState(false);
  const [rows, setRows]     = useState([]);
  const [importLabel, setImportLabel] = useState(null);
  const [error, setError]   = useState(null);

  useEffect(() => {
    if (!auth) return;
    setLoading(true);
    loadData().then(data => {
      if (data.length) {
        setImportLabel(data[0].import_label);
        setRows(data.map(d => d.row_data));
      }
      setLoading(false);
    }).catch(e => { setError(e.message); setLoading(false); });
  }, [auth]);

  if (!auth) return <Login onLogin={() => setAuth(true)} />;

  if (loading) return (
    <div style={{ display:'flex', alignItems:'center', justifyContent:'center', height:'100vh', flexDirection:'column', gap:16, color: C.sec }}>
      <div style={{ fontSize:32 }}>‚è≥</div>
      <div style={{ fontSize:16 }}>Lade Daten...</div>
    </div>
  );
  if (error) return (
    <div style={{ display:'flex', alignItems:'center', justifyContent:'center', height:'100vh' }}>
      <div style={{ background:'rgba(248,81,73,.1)', border:'1px solid rgba(248,81,73,.4)', borderRadius:12, padding:32, textAlign:'center', color: C.red, maxWidth:400 }}>
        <div style={{ fontSize:20, marginBottom:8 }}>‚ö†Ô∏è Fehler</div>
        <div style={{ fontSize:13 }}>{error}</div>
      </div>
    </div>
  );
  if (!rows.length) return (
    <div style={{ display:'flex', alignItems:'center', justifyContent:'center', height:'100vh', flexDirection:'column', gap:12, color: C.sec }}>
      <div style={{ fontSize:48 }}>üì≠</div>
      <div style={{ fontSize:18, fontWeight:700, color: C.text }}>Noch keine Daten</div>
      <div style={{ fontSize:14 }}>bee-doo aktualisiert das Board t√§glich.</div>
    </div>
  );

  return <Board rows={rows} importLabel={importLabel} onLogout={() => { sessionStorage.removeItem(SK); setAuth(false); }} />;
}

ReactDOM.createRoot(document.getElementById('root')).render(<Main />);
</script>
</body>
</html>
