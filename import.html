<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>bee-doo Â· Daten-Import Hub</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.2/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body,#root{height:100%;min-height:100%}
body{background:#0A0A0B;color:#F0F0F4;font-family:'DM Sans',sans-serif}
button,select,input,textarea{color:inherit;font-family:inherit}
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:#111113}::-webkit-scrollbar-thumb{background:#2A2A33;border-radius:4px}
.back{position:fixed;top:9px;left:10px;z-index:999;background:#16161A;border:1px solid #2A2A33;color:#8A8A9A;padding:5px 12px;border-radius:7px;font-size:11px;cursor:pointer;text-decoration:none;transition:all .15s}.back:hover{border-color:#F5C500;color:#F5C500}
.inp{width:100%;background:#111113;border:1px solid #2A2A33;border-radius:6px;padding:7px 10px;font-size:12px;outline:none;transition:border-color .15s;color:#F0F0F4}.inp:focus{border-color:#F5C50060}.inp::placeholder{color:#4A4A5A}
select.inp{cursor:pointer}select.inp option{background:#111113;color:#F0F0F4}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
@keyframes spin{to{transform:rotate(360deg)}}
.fade{animation:fadeIn .25s ease}.spin{animation:spin .7s linear infinite;display:inline-block}
.dz{border:2px dashed #2A2A33;border-radius:12px;padding:40px 20px;text-align:center;transition:all .2s;cursor:pointer}
.dz:hover{border-color:#F5C50060;background:#F5C50008}.dz.over{border-color:#F5C500;background:#F5C50012}.dz.ok{border-color:#34D39960;background:#34D39908}
@media(max-width:768px){.g2{grid-template-columns:1fr!important}.g4{grid-template-columns:1fr 1fr!important}.sk{flex-direction:column!important}}
@media(max-width:480px){.g4{grid-template-columns:1fr!important}}
</style>
</head>
<body>
<a href="index.html" class="back">â† Launcher</a>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef,useMemo,useCallback}=React;
const SB="https://hqzpemfaljxcysyqssng.supabase.co";
const AK="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxenBlbWZhbGp4Y3lzeXFzc25nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzUzOTcsImV4cCI6MjA4NjkxMTM5N30.LSlMApceWuLk5MUctCGCVspXfYhc_As559aaoV2uSik";
const HD={"apikey":AK,"Authorization":"Bearer "+AK,"Content-Type":"application/json","Prefer":"return=representation"};
const C={bg:"#0A0A0B",s:"#111113",cd:"#16161A",bl:"#2A2A33",Y:"#F5C500",YD:"#F5C50015",tx:"#F0F0F4",ts:"#8A8A9A",tm:"#4A4A5A",G:"#34D399",GD:"#34D39915",R:"#F87171",RD:"#F8717115",O:"#FBBF24",OD:"#FBBF2415",B:"#60A5FA",BD:"#60A5FA15",P:"#A78BFA",T:"#2DD4BF"};
const fN=n=>new Intl.NumberFormat("de-DE").format(+n||0);
const fD=d=>d?new Date(d).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}):"â€“";
const fT=d=>d?new Date(d).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"}):"â€“";

const sb={
  get:async(t,p="")=>{const r=await fetch(SB+"/rest/v1/"+t+(p?"?"+p:""),{headers:HD});if(!r.ok)throw new Error(await r.text());return r.json()},
  post:async(t,b)=>{const r=await fetch(SB+"/rest/v1/"+t,{method:"POST",headers:{...HD,"Prefer":"return=representation"},body:JSON.stringify(b)});if(!r.ok)throw new Error(await r.text());return r.json()},
  upsert:async(t,b)=>{const r=await fetch(SB+"/rest/v1/"+t,{method:"POST",headers:{...HD,"Prefer":"return=representation,resolution=merge-duplicates"},body:JSON.stringify(b)});if(!r.ok)throw new Error(await r.text());return r.json()},
  count:async t=>{try{const d=await sb.get(t,"select=id");return Array.isArray(d)?d.length:0}catch{return"?"}}
};

const TGT={
  vertriebler:{l:"Vertriebler",i:"ğŸ’¼",c:C.G,d:"Vertriebsmitarbeiter (Sales)",
    f:{id:{l:"KÃ¼rzel (ID)",t:"text",req:1,pk:1},name:{l:"Name",t:"text",req:1},farbe:{l:"Farbe",t:"text"},email:{l:"E-Mail",t:"text"},telefon:{l:"Telefon",t:"text"},aktiv:{l:"Aktiv",t:"bool",def:true}}},
  termine:{l:"Termine",i:"ğŸ“…",c:C.B,d:"Verkaufs-/Beratungstermine",
    f:{id:{l:"ID",t:"uuid",auto:1},vertrieb_id:{l:"Vertriebler KÃ¼rzel",t:"text",req:1},datum:{l:"Datum",t:"date",req:1},zeit_minuten:{l:"Uhrzeit (Min)",t:"num"},dauer_minuten:{l:"Dauer (Min)",t:"num",def:120},status:{l:"Status",t:"text",def:"offen"},kunde:{l:"Kunde",t:"text"},adresse:{l:"Adresse",t:"text"},plz:{l:"PLZ",t:"text"},ort:{l:"Ort",t:"text"},telefon:{l:"Telefon",t:"text"},notizen:{l:"Notizen",t:"text"},termin_nr:{l:"Termin Nr.",t:"text"}}},
  provisions_regeln:{l:"Provisionsregeln",i:"ğŸ’°",c:C.Y,d:"Globale Provisionsmodelle",
    f:{id:{l:"ID",t:"uuid",auto:1},modell_name:{l:"Modell",t:"text",req:1},mitarbeiter_typ:{l:"MA-Typ",t:"text",req:1},basis_betrag_sale:{l:"Basis â‚¬/Sale",t:"num",def:500},staffel_schwelle:{l:"Staffel ab",t:"num",def:8},staffel_betrag_sale:{l:"Staffel â‚¬/Sale",t:"num",def:700},rueckwirkend:{l:"RÃ¼ckwirkend",t:"bool",def:true},betrag_lead:{l:"â‚¬/Lead",t:"num"},betrag_termin_sf:{l:"â‚¬/Termin SF",t:"num"},betrag_eigenlead:{l:"â‚¬/Eigenlead",t:"num"},betrag_empfehlung:{l:"â‚¬/Empfehlung",t:"num"},betrag_speicher:{l:"â‚¬/Speicher",t:"num"},betrag_sondereinsatz:{l:"â‚¬/Sondereinsatz",t:"num"},zahlungsausloeser:{l:"AuslÃ¶ser",t:"text",def:"anzahlung_eingegangen"},aktiv:{l:"Aktiv",t:"bool",def:true}}},
  customers:{l:"Kunden",i:"ğŸ‘¤",c:C.T,d:"Kundendaten / CRM",
    f:{id:{l:"ID",t:"uuid",auto:1},name:{l:"Name",t:"text",req:1},vorname:{l:"Vorname",t:"text"},nachname:{l:"Nachname",t:"text"},email:{l:"E-Mail",t:"text"},telefon:{l:"Telefon",t:"text"},adresse:{l:"Adresse",t:"text"},plz:{l:"PLZ",t:"text"},ort:{l:"Ort",t:"text"},vertriebler_id:{l:"Vertriebler",t:"text"},status:{l:"Status",t:"text",def:"lead"},quelle:{l:"Quelle",t:"text"},notizen:{l:"Notizen",t:"text"}}},
  projects:{l:"Projekte / AuftrÃ¤ge",i:"âš¡",c:C.O,d:"Solar-Projekte, Montage, Zahlungen",
    f:{id:{l:"ID",t:"uuid",auto:1},auftrag_nr:{l:"Auftrags-Nr.",t:"text"},kunde_name:{l:"Kunde",t:"text"},vertriebler_id:{l:"Vertriebler",t:"text"},scouter_id:{l:"Scouter",t:"text"},auftrags_datum:{l:"Auftragsdatum",t:"date"},kwp:{l:"kWp",t:"num"},speicher_kwh:{l:"Speicher kWh",t:"num"},module_anzahl:{l:"Module",t:"num"},auftragswert:{l:"Wert â‚¬",t:"num"},anzahlung:{l:"Anzahlung â‚¬",t:"num"},zahlungsstatus:{l:"Zahlungsstatus",t:"text",def:"offen"},montage_status:{l:"Montage",t:"text",def:"offen"},dc_datum:{l:"DC Datum",t:"date"},ac_datum:{l:"AC Datum",t:"date"},lead_quelle:{l:"Lead-Quelle",t:"text"},speichererweiterung:{l:"Speicher+",t:"bool",def:false},storniert:{l:"Storniert",t:"bool",def:false},storno_datum:{l:"Storno-Datum",t:"date"},notizen:{l:"Notizen",t:"text"}}},
  arbeitszeiten:{l:"Arbeitszeiten",i:"â±",c:C.P,d:"Zeiterfassung",
    f:{id:{l:"ID",t:"uuid",auto:1},mitarbeiter_id:{l:"Mitarbeiter",t:"text",req:1},datum:{l:"Datum",t:"date",req:1},start_zeit:{l:"Start",t:"text"},end_zeit:{l:"Ende",t:"text"},pause_minuten:{l:"Pause Min",t:"num",def:30},typ:{l:"Typ",t:"text",def:"arbeit"},notizen:{l:"Notizen",t:"text"}}}
};

const PK="beedoo_profiles",LK="beedoo_importlog";
const lP=()=>{try{return JSON.parse(localStorage.getItem(PK)||"[]")}catch{return[]}};
const sP=p=>localStorage.setItem(PK,JSON.stringify(p));
const lL=()=>{try{return JSON.parse(localStorage.getItem(LK)||"[]")}catch{return[]}};
const aL=e=>{const l=lL();l.unshift({...e,ts:new Date().toISOString()});if(l.length>100)l.length=100;localStorage.setItem(LK,JSON.stringify(l))};

function autoMap(hdrs,flds){
  const map={},cnf={},used=new Set();
  const n=s=>(s||"").toLowerCase().replace(/[^a-z0-9Ã¤Ã¶Ã¼ÃŸ]/g,"");
  const KW={name:["name","bezeichnung"],vorname:["vorname","first"],nachname:["nachname","last"],email:["email","mail"],telefon:["telefon","tel","phone","handy","mobil"],adresse:["adresse","strasse","str","address"],plz:["plz","postleitzahl","zip"],ort:["ort","stadt","city"],datum:["datum","date"],auftrags_datum:["auftragsdatum","bestelldatum"],auftrag_nr:["auftragnr","auftragsnr","auftragsnummer","ordernr","bestellnr"],kunde_name:["kunde","kundenname","customer"],kunde:["kunde","kundenname"],vertriebler_id:["vertriebler","vertrieb","vb","berater","sales"],vertrieb_id:["vertriebler","vertrieb","vb","berater"],scouter_id:["scouter","scout"],status:["status"],kwp:["kwp","kilowatt","leistung","kw"],speicher_kwh:["speicher","kwh","batterie"],module_anzahl:["module","panels"],auftragswert:["auftragswert","wert","preis","betrag","netto","brutto","umsatz","summe"],anzahlung:["anzahlung","deposit"],zahlungsstatus:["zahlungsstatus","payment","zahlung"],montage_status:["montage","installation"],dc_datum:["dc","dcdatum"],ac_datum:["ac","acdatum"],lead_quelle:["leadquelle","quelle","source","herkunft"],notizen:["notizen","notes","bemerkung","kommentar"],farbe:["farbe","color"],aktiv:["aktiv","active"],zeit_minuten:["zeit","uhrzeit","time"],dauer_minuten:["dauer","duration"],termin_nr:["terminnr"],mitarbeiter_id:["mitarbeiter"],start_zeit:["startzeit","beginn","von"],end_zeit:["endzeit","bis","ende"],pause_minuten:["pause"],typ:["typ","type","art"],modell_name:["modell","model"],mitarbeiter_typ:["mitarbeitertyp"],id:["id","kuerzel","kÃ¼rzel","code"],speichererweiterung:["speichererweiterung"],storniert:["storniert","storno"]};
  hdrs.forEach(h=>{const cn=n(h);let best=null,bs=0;
    Object.entries(flds).forEach(([fk,fd])=>{if(used.has(fk))return;const fn=n(fk),fl=n(fd.l);let s=0;
      if(cn===fn)s=100;else if(cn===fl)s=95;else if(cn.includes(fn)||fn.includes(cn))s=70;else if(cn.includes(fl)||fl.includes(cn))s=65;
      else{(KW[fk]||[]).forEach(kw=>{if(cn.includes(kw)||kw.includes(cn)){const x=Math.min(60,30+Math.round((kw.length/Math.max(cn.length,kw.length))*30));if(x>s)s=x}});}
      if(s>bs){bs=s;best=fk;}});
    if(best&&bs>=30){map[h]=best;cnf[h]=bs;used.add(best);}else cnf[h]=0;
  });return{mapping:map,confidence:cnf};
}

function xform(v,fd){
  if(v==null||v==="")return fd.def??null;const s=String(v).trim();if(!s)return fd.def??null;
  if(fd.t==="num")return parseFloat(s.replace(/\./g,"").replace(",","."))||null;
  if(fd.t==="bool")return["ja","yes","true","1","wahr","x","âœ“"].includes(s.toLowerCase());
  if(fd.t==="date"){if(s.includes(".")){const p=s.split(".");if(p.length===3){const y=p[2].length===2?"20"+p[2]:p[2];return`${y}-${p[1].padStart(2,"0")}-${p[0].padStart(2,"0")}`}}return s.match(/^\d{4}-\d{2}-\d{2}/)?s.slice(0,10):s;}
  if(fd.t==="uuid"&&fd.auto)return undefined;
  return s;
}

function Bdg({l,c}){return<span style={{background:c+"20",color:c,border:`1px solid ${c}40`,borderRadius:4,padding:"2px 8px",fontSize:10,fontWeight:700,whiteSpace:"nowrap"}}>{l}</span>}

function App(){
  const[view,setView]=useState("hub");
  const[toast,setToast]=useState(null);
  const[cnt,setCnt]=useState({});
  const ntf=(t,c=C.G)=>{setToast({t,c});setTimeout(()=>setToast(null),3500)};
  useEffect(()=>{rc()},[]);
  const rc=async()=>{const o={};for(const t of Object.keys(TGT))o[t]=await sb.count(t);setCnt(o)};

  return(<div style={{minHeight:"100vh",background:C.bg}}>
    {toast&&<div style={{position:"fixed",bottom:24,right:24,background:toast.c,color:"#000",padding:"10px 18px",borderRadius:8,fontWeight:700,fontSize:13,zIndex:9999,animation:"fadeIn .2s ease",maxWidth:400,boxShadow:"0 8px 32px rgba(0,0,0,.4)"}}>{toast.t}</div>}
    <div style={{background:C.s,borderBottom:`1px solid ${C.bl}`,padding:"52px 20px 0"}}><div style={{maxWidth:1200,margin:"0 auto"}}>
      <div style={{display:"flex",alignItems:"center",gap:12,paddingBottom:16}} className="sk">
        <div style={{background:"linear-gradient(135deg,#F5C500,#FF9F1C)",borderRadius:12,width:42,height:42,display:"flex",alignItems:"center",justifyContent:"center",fontSize:22,flexShrink:0}}>ğŸ“¦</div>
        <div style={{flex:1}}><div style={{fontWeight:900,fontSize:22}}>Daten-Import Hub</div><div style={{fontSize:12,color:C.ts}}>CSV â†’ Supabase Â· Wiederkehrende Imports mit gespeicherten Mappings</div></div>
        <button onClick={rc} style={{background:C.BD,color:C.B,border:`1px solid ${C.B}40`,borderRadius:7,padding:"6px 14px",fontSize:11,fontWeight:700,cursor:"pointer",flexShrink:0}}>ğŸ”„ Refresh</button>
      </div>
      <div style={{display:"flex",gap:4,overflowX:"auto"}}>
        {[{id:"hub",n:"ğŸ“Š Ãœbersicht"},{id:"import",n:"ğŸ“‚ Neuer Import"},{id:"log",n:"ğŸ“‹ Import-Log"},{id:"tables",n:"ğŸ—„ Tabellen"}].map(t=>(
          <button key={t.id} onClick={()=>setView(t.id)} style={{padding:"10px 18px",borderRadius:"8px 8px 0 0",fontSize:12,fontWeight:700,cursor:"pointer",border:`1px solid ${view===t.id?C.Y:C.bl}`,borderBottom:"none",whiteSpace:"nowrap",background:view===t.id?C.cd:C.s,color:view===t.id?C.Y:C.ts,transition:"all .15s"}}>{t.n}</button>
        ))}
      </div>
    </div></div>
    <div style={{maxWidth:1200,margin:"0 auto",padding:20}}>
      {view==="hub"&&<Hub cnt={cnt} go={setView}/>}
      {view==="import"&&<Imp ntf={ntf} rc={rc}/>}
      {view==="log"&&<Log/>}
      {view==="tables"&&<Tbl cnt={cnt} rc={rc} ntf={ntf}/>}
    </div>
  </div>);
}

function Hub({cnt,go}){
  const log=lL(),prof=lP();
  return(<div className="fade">
    <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(170px,1fr))",gap:12,marginBottom:24}} className="g4">
      {Object.entries(TGT).map(([k,t])=>(
        <div key={k} style={{background:C.cd,border:`1px solid ${C.bl}`,borderRadius:10,padding:"14px 16px",cursor:"pointer",transition:"all .15s"}} onClick={()=>go("tables")}
          onMouseEnter={e=>e.currentTarget.style.borderColor=t.c+"60"} onMouseLeave={e=>e.currentTarget.style.borderColor=C.bl}>
          <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:8}}><span style={{fontSize:18}}>{t.i}</span><span style={{fontSize:11,fontWeight:700,color:C.ts,textTransform:"uppercase",letterSpacing:.5}}>{t.l}</span></div>
          <div style={{fontSize:26,fontWeight:900,color:t.c}}>{cnt[k]??"â€¦"}</div>
          <div style={{fontSize:10,color:C.tm,marginTop:2}}>EintrÃ¤ge</div>
        </div>))}
    </div>
    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:24}} className="g2">
      <div style={{background:C.cd,border:`1px solid ${C.bl}`,borderRadius:12,padding:20}}>
        <div style={{fontWeight:800,fontSize:15,marginBottom:12}}>ğŸš€ Schnell-Import</div>
        <div style={{fontSize:12,color:C.ts,marginBottom:16}}>CSV hochladen, Spalten zuordnen, in Supabase importieren. Auto-Mapping erkennt Spalten.</div>
        <button onClick={()=>go("import")} style={{background:C.Y,color:"#000",border:"none",borderRadius:8,padding:"10px 24px",fontWeight:800,fontSize:13,cursor:"pointer"}}>ğŸ“‚ Import starten</button>
      </div>
      <div style={{background:C.cd,border:`1px solid ${C.bl}`,borderRadius:12,padding:20}}>
        <div style={{fontWeight:800,fontSize:15,marginBottom:12}}>ğŸ“‹ Letzte Imports</div>
        {!log.length&&<div style={{color:C.tm,fontSize:12,fontStyle:"italic"}}>Noch keine Imports</div>}
        {log.slice(0,4).map((l,i)=>(<div key={i} style={{display:"flex",gap:8,alignItems:"center",padding:"6px 0",borderBottom:`1px solid ${C.bl}`,fontSize:11}}>
          <span>{l.ok?"âœ…":"âŒ"}</span><span style={{fontWeight:700}}>{l.target}</span><span style={{color:C.ts}}>{l.rows} Zeilen</span><span style={{color:C.tm,marginLeft:"auto",fontSize:10}}>{fD(l.ts)}</span>
        </div>))}
        {log.length>4&&<button onClick={()=>go("log")} style={{marginTop:8,background:"none",border:"none",color:C.Y,fontSize:11,fontWeight:700,cursor:"pointer"}}>Alle â†’</button>}
      </div>
    </div>
    {prof.length>0&&<div style={{background:C.cd,border:`1px solid ${C.bl}`,borderRadius:12,padding:20,marginBottom:20}}>
      <div style={{fontWeight:800,fontSize:15,marginBottom:12}}>ğŸ’¾ Gespeicherte Mappings</div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(250px,1fr))",gap:12}}>
        {prof.map((p,i)=>(<div key={i} style={{background:C.s,border:`1px solid ${C.bl}`,borderRadius:8,padding:12}}>
          <div style={{fontWeight:700,fontSize:13}}>{p.name}</div>
          <div style={{fontSize:11,color:C.ts,marginTop:4}}>â†’ {TGT[p.target]?.l||p.target} Â· {Object.keys(p.mapping||{}).length} Spalten</div>
        </div>))}
      </div>
    </div>}
    <div style={{background:C.s,border:`1px solid ${C.bl}`,borderRadius:8,padding:"12px 16px",fontSize:11,color:C.ts}}>
      ğŸ’¡ <b style={{color:C.tx}}>Tipp:</b> Importierte Daten stehen sofort in allen bee-doo Apps zur VerfÃ¼gung â€“ Probeabrechnung, Dispatch, VerkÃ¤uferboard, Reporting.
    </div>
  </div>);
}

function Imp({ntf,rc}){
  const[step,setStep]=useState(0);
  const[file,setFile]=useState(null);
  const[csv,setCsv]=useState(null);
  const[hdrs,setHdrs]=useState([]);
  const[tgt,setTgt]=useState("");
  const[map,setMap]=useState({});
  const[cnf,setCnf]=useState({});
  const[pn,setPn]=useState("");
  const[imp,setImp]=useState(false);
  const[res,setRes]=useState(null);
  const[errs,setErrs]=useState([]);
  const[dup,setDup]=useState("skip");
  const fRef=useRef();
  const[drag,setDrag]=useState(false);

  const hFile=f=>{setFile(f);
    Papa.parse(f,{header:true,skipEmptyLines:true,encoding:"UTF-8",
      complete:r=>{setCsv(r.data);setHdrs(Object.keys(r.data[0]||{}));setStep(1);ntf(`${fN(r.data.length)} Zeilen aus ${f.name}`)},
      error:e=>ntf("Fehler: "+e.message,C.R)});};

  useEffect(()=>{if(tgt&&hdrs.length){const{mapping:m,confidence:c}=autoMap(hdrs,TGT[tgt]?.f||{});setMap(m);setCnf(c)}},[tgt]);

  const uMap=(col,fld)=>setMap(p=>{const n={...p};if(fld){Object.keys(n).forEach(k=>{if(n[k]===fld&&k!==col)delete n[k]});n[col]=fld;}else delete n[col];return n});
  const flds=TGT[tgt]?.f||{};
  const mN=Object.values(map).length;

  const validate=()=>{const e=[];if(!tgt)e.push("Kein Ziel");
    Object.entries(flds).filter(([,f])=>f.req&&!f.auto).forEach(([k,f])=>{if(!Object.values(map).includes(k))e.push(`"${f.l}" fehlt`)});
    if(!mN)e.push("Nichts zugeordnet");return e};

  const xAll=()=>(csv||[]).map((row,i)=>{const o={};
    Object.entries(map).forEach(([col,fk])=>{const f=flds[fk];if(f){const v=xform(row[col],f);if(v!==undefined)o[fk]=v}});
    Object.entries(flds).forEach(([k,f])=>{if(!(k in o)&&f.def!=null&&!f.auto)o[k]=f.def});
    o._r=i+1;return o}).filter(o=>Object.keys(o).length>1);

  const doImp=async()=>{setImp(true);setErrs([]);
    const rows=xAll().map(({_r,...r})=>r);let ins=0,sk=0,er=0;const es=[];
    try{const B=50;
      for(let i=0;i<rows.length;i+=B){const b=rows.slice(i,i+B);
        try{if(dup==="update")await sb.upsert(tgt,b);else await sb.post(tgt,b);ins+=b.length}
        catch{for(const r of b){try{if(dup==="update")await sb.upsert(tgt,[r]);else await sb.post(tgt,[r]);ins++}catch(e2){if(dup==="skip")sk++;else{er++;es.push(e2.message?.slice(0,120))}}}}}
      setRes({tot:rows.length,ins,sk,er});setErrs(es);setStep(5);
      aL({target:TGT[tgt]?.l||tgt,rows:ins,total:rows.length,sk,er,file:file?.name,ok:er===0});
      ntf(`âœ… ${fN(ins)} â†’ ${TGT[tgt]?.l}`);rc();
    }catch(e){ntf("Fehler: "+e.message,C.R);setRes({tot:rows.length,ins,sk,er:rows.length-ins});setErrs([e.message]);setStep(5);
      aL({target:TGT[tgt]?.l||tgt,rows:ins,total:rows.length,er:rows.length-ins,file:file?.name,ok:false})}
    setImp(false)};

  const savP=()=>{if(!pn.trim())return;const p=lP();const idx=p.findIndex(x=>x.name===pn.trim());
    const pr={name:pn.trim(),target:tgt,mapping:map,used:new Date().toISOString()};
    if(idx>=0)p[idx]=pr;else p.push(pr);sP(p);ntf("ğŸ’¾ Profil: "+pn)};

  const vE=validate();const prev=tgt&&mN?xAll().slice(0,5):[];
  const ST=["ğŸ“‚ Upload","ğŸ¯ Ziel","ğŸ”— Mapping","ğŸ‘ Vorschau","â³","âœ… Fertig"];

  return(<div className="fade">
    <div style={{display:"flex",gap:2,marginBottom:24,overflowX:"auto",paddingBottom:4}}>
      {ST.map((s,i)=>(<div key={i} style={{display:"flex",alignItems:"center",gap:2}}>
        <button onClick={()=>{if(i<=step&&i<4)setStep(i)}} style={{padding:"8px 14px",borderRadius:7,fontSize:11,fontWeight:700,cursor:i<=step?"pointer":"default",border:"none",whiteSpace:"nowrap",background:step===i?C.Y:i<step?C.GD:C.cd,color:step===i?"#000":i<step?C.G:C.tm}}>{s}</button>
        {i<5&&<span style={{color:C.tm,fontSize:10}}>â€º</span>}
      </div>))}
    </div>

    {step===0&&<div style={{maxWidth:600,margin:"0 auto"}}>
      <div className={`dz ${drag?"over":""} ${file?"ok":""}`}
        onDragOver={e=>{e.preventDefault();setDrag(true)}} onDragLeave={()=>setDrag(false)}
        onDrop={e=>{e.preventDefault();setDrag(false);if(e.dataTransfer.files[0])hFile(e.dataTransfer.files[0])}}
        onClick={()=>fRef.current?.click()}>
        <input ref={fRef} type="file" accept=".csv,.tsv,.txt" style={{display:"none"}} onChange={e=>{if(e.target.files[0])hFile(e.target.files[0])}}/>
        {file?<div><div style={{fontSize:24,marginBottom:8}}>ğŸ“„</div><div style={{fontWeight:700,color:C.G}}>{file.name}</div><div style={{fontSize:11,color:C.ts,marginTop:4}}>{fN(file.size)} Bytes</div></div>
        :<div><div style={{fontSize:32,marginBottom:8,opacity:.5}}>ğŸ“‚</div><div style={{color:C.ts,fontSize:13,fontWeight:600}}>CSV-Datei hierher ziehen</div><div style={{color:C.tm,fontSize:11,marginTop:4}}>oder klicken Â· UTF-8</div></div>}
      </div>
    </div>}

    {step===1&&<div className="fade">
      <div style={{fontWeight:800,fontSize:16,marginBottom:4}}>Zieltabelle wÃ¤hlen</div>
      <div style={{color:C.ts,fontSize:12,marginBottom:20}}>{fN(csv?.length||0)} Zeilen aus <b style={{color:C.tx}}>{file?.name}</b> â†’ wohin?</div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(240px,1fr))",gap:12}} className="g2">
        {Object.entries(TGT).map(([k,t])=>(<button key={k} onClick={()=>{setTgt(k);setStep(2)}}
          style={{background:tgt===k?t.c+"15":C.cd,border:`1px solid ${tgt===k?t.c+"60":C.bl}`,borderRadius:10,padding:16,textAlign:"left",cursor:"pointer",transition:"all .15s"}}
          onMouseEnter={e=>{if(tgt!==k)e.currentTarget.style.borderColor=t.c+"40"}} onMouseLeave={e=>{if(tgt!==k)e.currentTarget.style.borderColor=C.bl}}>
          <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:8}}>
            <span style={{fontSize:22}}>{t.i}</span><div><div style={{fontWeight:800,fontSize:14,color:tgt===k?t.c:C.tx}}>{t.l}</div><div style={{fontSize:10,color:C.ts,marginTop:1}}>{t.d}</div></div>
          </div>
          <div style={{fontSize:10,color:C.tm}}>{Object.keys(t.f).length} Felder Â· {Object.values(t.f).filter(f=>f.req).length} Pflicht</div>
        </button>))}
      </div>
      <button onClick={()=>setStep(0)} style={{marginTop:16,background:C.cd,color:C.ts,border:`1px solid ${C.bl}`,borderRadius:8,padding:"10px 20px",fontWeight:700,fontSize:12,cursor:"pointer"}}>â† ZurÃ¼ck</button>
    </div>}

    {step===2&&<div className="fade">
      <div style={{display:"flex",alignItems:"center",gap:12,marginBottom:16,flexWrap:"wrap"}}>
        <div><div style={{fontWeight:800,fontSize:16}}>Spalten-Mapping</div><div style={{color:C.ts,fontSize:12,marginTop:2}}>{file?.name} â†’ <b style={{color:TGT[tgt]?.c}}>{TGT[tgt]?.l}</b></div></div>
        <div style={{marginLeft:"auto"}}><Bdg l={`${mN}/${Object.keys(flds).length} zugeordnet`} c={mN?C.G:C.ts}/></div>
      </div>
      <div style={{background:C.s,border:`1px solid ${C.bl}`,borderRadius:8,padding:"10px 14px",marginBottom:16,display:"flex",gap:16,flexWrap:"wrap",fontSize:11}}>
        <span>ğŸ¤– <b style={{color:C.tx}}>Auto:</b></span>
        <span style={{color:C.G}}>âœ“ {Object.values(cnf).filter(c=>c>=80).length} sicher</span>
        <span style={{color:C.O}}>~ {Object.values(cnf).filter(c=>c>=40&&c<80).length} wahrsch.</span>
        <span style={{color:C.R}}>? {Object.values(cnf).filter(c=>c>0&&c<40).length} unsicher</span>
        <span style={{color:C.tm}}>â—‹ {Object.values(cnf).filter(c=>!c).length} unbekannt</span>
      </div>
      <div style={{background:C.cd,border:`1px solid ${C.bl}`,borderRadius:10,overflow:"hidden"}}>
        <div style={{display:"grid",gridTemplateColumns:"1fr 40px 1fr 50px",gap:8,padding:"8px 12px",background:C.s,fontSize:10,fontWeight:700,color:C.ts,textTransform:"uppercase",letterSpacing:.5}}>
          <div>CSV-Spalte</div><div></div><div>Ziel-Feld</div><div style={{textAlign:"center"}}>Match</div>
        </div>
        {hdrs.map(h=>(<div key={h} style={{display:"grid",gridTemplateColumns:"1fr 40px 1fr 50px",gap:8,alignItems:"center",padding:"8px 12px",borderBottom:`1px solid ${C.bl}`,fontSize:12}}>
          <div><div style={{fontWeight:700,color:C.tx}}>{h}</div><div style={{fontSize:10,color:C.tm,marginTop:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}} title={csv?.[0]?.[h]||""}>z.B. "{(csv?.[0]?.[h]||"").slice(0,40)}"</div></div>
          <div style={{textAlign:"center",color:C.tm,fontSize:16}}>â†’</div>
          <select className="inp" value={map[h]||""} onChange={e=>uMap(h,e.target.value)} style={{fontWeight:map[h]?700:400,borderColor:map[h]?C.G+"60":C.bl,color:map[h]?C.G:C.ts}}>
            <option value="">â€“ ignorieren â€“</option>
            {Object.entries(flds).map(([k,f])=>(<option key={k} value={k}>{f.l}{f.req?" *":""}</option>))}
          </select>
          <div style={{textAlign:"center"}}>{cnf[h]>=80&&<span style={{color:C.G,fontSize:11,fontWeight:700}}>âœ“</span>}{cnf[h]>=40&&cnf[h]<80&&<span style={{color:C.O,fontSize:11}}>~</span>}{cnf[h]>0&&cnf[h]<40&&<span style={{color:C.R,fontSize:11}}>?</span>}</div>
        </div>))}
      </div>
      <div style={{background:C.cd,border:`1px solid ${C.bl}`,borderRadius:10,padding:16,marginTop:16}}>
        <div style={{fontWeight:700,fontSize:12,marginBottom:10}}>ğŸ”„ Bei Duplikaten</div>
        <div style={{display:"flex",gap:8,flexWrap:"wrap"}}>
          {[{id:"skip",n:"â­ Ãœberspringen",d:"Existierende ignorieren"},{id:"update",n:"ğŸ”„ Aktualisieren",d:"Existierende Ã¼berschreiben"},{id:"append",n:"â• Immer einfÃ¼gen",d:"Auch Duplikate"}].map(s=>(
            <button key={s.id} onClick={()=>setDup(s.id)} style={{flex:"1 1 140px",background:dup===s.id?C.YD:C.s,border:`1px solid ${dup===s.id?C.Y+"60":C.bl}`,borderRadius:8,padding:"10px 12px",textAlign:"left",cursor:"pointer"}}>
              <div style={{fontWeight:700,fontSize:12,color:dup===s.id?C.Y:C.tx}}>{s.n}</div><div style={{fontSize:10,color:C.ts,marginTop:2}}>{s.d}</div>
            </button>))}
        </div>
      </div>
      <div style={{background:C.cd,border:`1px solid ${C.bl}`,borderRadius:10,padding:16,marginTop:16}}>
        <div style={{fontWeight:700,fontSize:12,marginBottom:10}}>ğŸ’¾ Mapping speichern (fÃ¼r wiederkehrende Imports)</div>
        <div style={{display:"flex",gap:8}}><input className="inp" placeholder="Profil-Name z.B. 'AuftrÃ¤ge Alt-System'" value={pn} onChange={e=>setPn(e.target.value)} style={{flex:1}}/>
          <button onClick={savP} disabled={!pn.trim()} style={{background:C.Y,color:"#000",border:"none",borderRadius:7,padding:"8px 18px",fontWeight:700,fontSize:12,cursor:"pointer",opacity:pn.trim()?1:.4}}>Speichern</button></div>
      </div>
      {vE.length>0&&<div style={{background:C.RD,border:`1px solid ${C.R}40`,borderRadius:8,padding:"10px 14px",marginTop:16}}>
        {vE.map((e,i)=>(<div key={i} style={{fontSize:11,color:C.R,marginBottom:4}}>âš  {e}</div>))}
      </div>}
      <div style={{display:"flex",gap:8,marginTop:20,justifyContent:"space-between",flexWrap:"wrap"}}>
        <button onClick={()=>setStep(1)} style={{background:C.cd,color:C.ts,border:`1px solid ${C.bl}`,borderRadius:8,padding:"10px 20px",fontWeight:700,fontSize:12,cursor:"pointer"}}>â† Ziel</button>
        <button onClick={()=>setStep(3)} disabled={vE.length>0} style={{background:vE.length?C.tm:C.Y,color:"#000",border:"none",borderRadius:8,padding:"10px 28px",fontWeight:800,fontSize:13,cursor:vE.length?"not-allowed":"pointer"}}>Vorschau â†’</button>
      </div>
    </div>}

    {step===3&&<div className="fade">
      <div style={{fontWeight:800,fontSize:16,marginBottom:16}}>Import-Vorschau â€“ {fN(csv?.length||0)} Zeilen â†’ <span style={{color:TGT[tgt]?.c}}>{TGT[tgt]?.l}</span></div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20}} className="g4">
        {[{i:"ğŸ“„",l:"Datei",v:file?.name?.slice(0,18),c:C.tx},{i:"ğŸ“Š",l:"Zeilen",v:fN(csv?.length||0),c:C.B},{i:"ğŸ”—",l:"Gemappt",v:`${mN}/${Object.keys(flds).length}`,c:C.G},{i:"ğŸ¯",l:"Ziel",v:TGT[tgt]?.l,c:TGT[tgt]?.c}].map(s=>(
          <div key={s.l} style={{background:C.cd,border:`1px solid ${C.bl}`,borderRadius:10,padding:"14px 16px"}}>
            <div style={{fontSize:10,color:C.ts,fontWeight:700,textTransform:"uppercase",letterSpacing:.5,marginBottom:4}}>{s.i} {s.l}</div>
            <div style={{fontSize:20,fontWeight:900,color:s.c,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{s.v}</div>
          </div>))}
      </div>
      {prev.length>0&&<div style={{overflowX:"auto",borderRadius:8,border:`1px solid ${C.bl}`,marginBottom:20}}>
        <table style={{width:"100%",borderCollapse:"collapse",fontSize:11,minWidth:500}}>
          <thead><tr style={{background:C.s}}>
            <th style={{padding:"6px 10px",color:C.ts,fontSize:9,fontWeight:700,textAlign:"left"}}>#</th>
            {Object.entries(flds).filter(([k])=>Object.values(map).includes(k)).map(([k,f])=>(
              <th key={k} style={{padding:"6px 10px",color:C.G,fontSize:9,fontWeight:700,textAlign:"left",whiteSpace:"nowrap"}}>{f.l}</th>))}
          </tr></thead>
          <tbody>{prev.map((r,i)=>(<tr key={i} style={{borderBottom:`1px solid ${C.bl}`}}>
            <td style={{padding:"5px 10px",color:C.tm}}>{r._r}</td>
            {Object.entries(flds).filter(([k])=>Object.values(map).includes(k)).map(([k])=>(
              <td key={k} style={{padding:"5px 10px",color:r[k]!=null?C.tx:C.tm,maxWidth:150,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{r[k]!=null?String(r[k]):<i>null</i>}</td>))}
          </tr>))}</tbody>
        </table>
      </div>}
      <div style={{display:"flex",gap:8,justifyContent:"space-between",flexWrap:"wrap"}}>
        <button onClick={()=>setStep(2)} style={{background:C.cd,color:C.ts,border:`1px solid ${C.bl}`,borderRadius:8,padding:"10px 20px",fontWeight:700,fontSize:12,cursor:"pointer"}}>â† Mapping</button>
        <button onClick={()=>{setStep(4);doImp()}} style={{background:"linear-gradient(135deg,#34D399,#10B981)",color:"#000",border:"none",borderRadius:8,padding:"12px 32px",fontWeight:900,fontSize:14,cursor:"pointer",boxShadow:"0 4px 20px rgba(52,211,153,.3)"}}>
          ğŸš€ {fN(csv?.length||0)} Zeilen importieren
        </button>
      </div>
    </div>}

    {step===4&&<div style={{textAlign:"center",padding:"80px 20px"}} className="fade">
      <div style={{fontSize:48,marginBottom:16}}><span style={{animation:"pulse 1.5s ease infinite",display:"inline-block"}}>âš¡</span></div>
      <div style={{fontWeight:900,fontSize:20,marginBottom:8}}>Import lÃ¤uftâ€¦</div>
      <div style={{color:C.ts,fontSize:13}}>{fN(csv?.length||0)} Zeilen â†’ <b style={{color:TGT[tgt]?.c}}>{TGT[tgt]?.l}</b></div>
    </div>}

    {step===5&&res&&<div className="fade">
      <div style={{textAlign:"center",padding:"40px 20px",marginBottom:24}}>
        <div style={{fontSize:48,marginBottom:12}}>{res.er===0?"ğŸ‰":"âš ï¸"}</div>
        <div style={{fontWeight:900,fontSize:22,marginBottom:8}}>{res.er===0?"Import erfolgreich!":"Import mit Warnungen"}</div>
      </div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:24}} className="g4">
        {[{i:"ğŸ“Š",l:"Gesamt",v:fN(res.tot),c:C.tx},{i:"âœ…",l:"Importiert",v:fN(res.ins),c:C.G},{i:"â­",l:"Ãœbersprungen",v:fN(res.sk),c:C.O},{i:"âŒ",l:"Fehler",v:fN(res.er),c:res.er?C.R:C.ts}].map(s=>(
          <div key={s.l} style={{background:C.cd,border:`1px solid ${C.bl}`,borderRadius:10,padding:"14px 16px"}}>
            <div style={{fontSize:10,color:C.ts,fontWeight:700,textTransform:"uppercase",letterSpacing:.5,marginBottom:4}}>{s.i} {s.l}</div>
            <div style={{fontSize:22,fontWeight:900,color:s.c}}>{s.v}</div>
          </div>))}
      </div>
      {errs.length>0&&<div style={{background:C.RD,border:`1px solid ${C.R}40`,borderRadius:10,padding:16,marginBottom:20,maxHeight:200,overflowY:"auto"}}>
        {errs.slice(0,10).map((e,i)=>(<div key={i} style={{fontSize:11,color:C.R,padding:"3px 0"}}>{e}</div>))}
      </div>}
      <div style={{display:"flex",gap:8,justifyContent:"center",flexWrap:"wrap"}}>
        <button onClick={()=>{setStep(0);setFile(null);setCsv(null);setHdrs([]);setTgt("");setMap({});setRes(null);setErrs([])}} style={{background:C.Y,color:"#000",border:"none",borderRadius:8,padding:"10px 24px",fontWeight:700,fontSize:13,cursor:"pointer"}}>ğŸ“‚ NÃ¤chster Import</button>
        <button onClick={()=>setStep(2)} style={{background:C.cd,color:C.ts,border:`1px solid ${C.bl}`,borderRadius:8,padding:"10px 24px",fontWeight:700,fontSize:13,cursor:"pointer"}}>ğŸ” Erneut</button>
      </div>
    </div>}
  </div>);
}

function Log(){
  const[log,setLog]=useState(lL());
  return(<div className="fade">
    <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16}}>
      <div style={{fontWeight:800,fontSize:16}}>Import-Protokoll</div>
      {log.length>0&&<button onClick={()=>{localStorage.removeItem(LK);setLog([])}} style={{background:C.RD,color:C.R,border:`1px solid ${C.R}40`,borderRadius:7,padding:"6px 14px",fontSize:11,fontWeight:700,cursor:"pointer"}}>ğŸ—‘ Leeren</button>}
    </div>
    {!log.length&&<div style={{textAlign:"center",padding:60,color:C.tm}}>Noch keine Imports.</div>}
    {log.map((l,i)=>(<div key={i} style={{background:C.cd,border:`1px solid ${C.bl}`,borderRadius:8,padding:"12px 16px",marginBottom:8,display:"flex",gap:12,alignItems:"center",flexWrap:"wrap",fontSize:12}}>
      <span style={{fontSize:18}}>{l.ok?"âœ…":"âŒ"}</span>
      <div style={{flex:1,minWidth:120}}><div style={{fontWeight:700}}>{l.target}</div><div style={{fontSize:10,color:C.ts}}>{l.file||"â€“"}</div></div>
      <Bdg l={`${fN(l.rows)} importiert`} c={C.G}/>
      {l.sk>0&&<Bdg l={`${l.sk} Ã¼bersprungen`} c={C.O}/>}
      {l.er>0&&<Bdg l={`${l.er} Fehler`} c={C.R}/>}
      <span style={{fontSize:10,color:C.tm}}>{fD(l.ts)} {fT(l.ts)}</span>
    </div>))}
  </div>);
}

function Tbl({cnt,rc,ntf}){
  const[exp,setExp]=useState(null);
  const[data,setData]=useState({});
  const[ldg,setLdg]=useState(null);
  const load=async t=>{if(exp===t){setExp(null);return}setExp(t);if(data[t])return;setLdg(t);
    try{const d=await sb.get(t,"select=*&limit=20&order=id");setData(p=>({...p,[t]:d}))}catch(e){ntf("Fehler: "+e.message,C.R)}setLdg(null)};

  return(<div className="fade">
    <div style={{fontWeight:800,fontSize:16,marginBottom:16}}>Datenbank-Tabellen</div>
    {Object.entries(TGT).map(([k,t])=>(<div key={k} style={{background:C.cd,border:`1px solid ${exp===k?t.c+"40":C.bl}`,borderRadius:10,marginBottom:12,overflow:"hidden",transition:"all .15s"}}>
      <button onClick={()=>load(k)} style={{display:"flex",alignItems:"center",gap:12,width:"100%",padding:"14px 16px",background:"transparent",border:"none",cursor:"pointer",textAlign:"left"}}
        onMouseEnter={e=>e.currentTarget.style.background=C.s} onMouseLeave={e=>e.currentTarget.style.background="transparent"}>
        <span style={{fontSize:20}}>{t.i}</span>
        <div style={{flex:1}}><div style={{fontWeight:800,fontSize:14,color:C.tx}}>{t.l}</div><div style={{fontSize:11,color:C.ts}}>{t.d}</div></div>
        <Bdg l={`${cnt[k]??"?"} EintrÃ¤ge`} c={t.c}/>
        <span style={{color:C.ts,fontSize:14,transition:"transform .15s",transform:exp===k?"rotate(180deg)":"rotate(0)"}}>â–¼</span>
      </button>
      {exp===k&&<div style={{padding:"0 16px 16px",animation:"fadeIn .15s ease"}}>
        <div style={{fontSize:10,fontWeight:700,color:C.ts,textTransform:"uppercase",letterSpacing:1,marginBottom:8}}>Schema</div>
        <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:16}}>
          {Object.entries(t.f).map(([fk,fd])=>(<span key={fk} style={{background:fd.req?t.c+"15":C.s,border:`1px solid ${fd.req?t.c+"30":C.bl}`,borderRadius:4,padding:"2px 8px",fontSize:10,color:fd.req?t.c:C.ts}}>{fd.l}{fd.req?" *":""}</span>))}
        </div>
        {ldg===k&&<div style={{padding:20,textAlign:"center",color:C.ts}}><span className="spin">âŸ³</span></div>}
        {data[k]?.length>0&&<div style={{overflowX:"auto",borderRadius:6,border:`1px solid ${C.bl}`}}>
          <table style={{width:"100%",borderCollapse:"collapse",fontSize:11,minWidth:500}}>
            <thead><tr style={{background:C.s}}>
              {Object.keys(data[k][0]).slice(0,8).map(h=>(<th key={h} style={{padding:"5px 8px",color:C.ts,fontWeight:700,fontSize:9,textAlign:"left",whiteSpace:"nowrap",textTransform:"uppercase"}}>{h}</th>))}
            </tr></thead>
            <tbody>{data[k].slice(0,10).map((r,i)=>(<tr key={i} style={{borderBottom:`1px solid ${C.bl}`}}>
              {Object.values(r).slice(0,8).map((v,j)=>(<td key={j} style={{padding:"4px 8px",color:C.tx,maxWidth:150,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{v!=null?String(v).slice(0,50):<i style={{color:C.tm}}>null</i>}</td>))}
            </tr>))}</tbody>
          </table>
        </div>}
        {data[k]?.length===0&&<div style={{textAlign:"center",padding:20,color:C.tm,fontSize:12,fontStyle:"italic"}}>Tabelle leer</div>}
      </div>}
    </div>))}
  </div>);
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
