<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>bee-doo Vertriebskalender</title>
<script src="config.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
body { background: #0c1222; font-family: 'DM Sans', sans-serif; color: #e1e7ef; -webkit-font-smoothing: antialiased; }
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: #0c1222; }
::-webkit-scrollbar-thumb { background: #263354; border-radius: 3px; }
button { font-family: 'DM Sans', sans-serif; }
button:active { opacity: 0.8; }
</style>

<style>

/* ═══ bee-doo Responsive + Lesbarkeit Fix ═══ */

/* === LESBARKEIT: Schriften aufhellen === */
/* Zu dunkle Grautöne auf Dark Theme aufhellen */
body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }

/* === TABLET (768px) === */
@media (max-width: 768px) {
  /* Grid → weniger Spalten */
  [style*="grid-template-columns"][style*="repeat"] { 
    grid-template-columns: repeat(2, 1fr) !important; 
  }
  [style*="gridTemplateColumns"] {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  /* Flex-Container wrappen */
  [style*="display:flex"], [style*="display: flex"],
  [style*='display:"flex"'], [style*="display:'flex'"] {
    flex-wrap: wrap !important;
  }
  /* Ausnahme: Nav-Items und kleine Icon-Rows nicht wrappen */
  [style*="align-items:center"][style*="gap:4px"],
  [style*="alignItems:"center""][style*="gap:"4px""] {
    flex-wrap: nowrap !important;
  }
  
  /* Sidebar verkleinern */
  [style*="width:240px"], [style*="width: 240px"],
  [style*="width:260px"], [style*="width: 260px"],
  [style*="width:280px"], [style*="width: 280px"],
  [style*='width:"240px"'], [style*='width:"260px"'], [style*='width:"280px"'] {
    width: 200px !important;
    min-width: 200px !important;
  }
  
  /* Modals nicht breiter als Screen */
  .modal, [style*="width:480px"], [style*="width:520px"], [style*="width:560px"],
  [style*="width:600px"], [style*="width:640px"], [style*="width:700px"] {
    width: 95vw !important;
    max-width: 95vw !important;
  }
  
  /* Padding reduzieren */
  [style*="padding:40px"], [style*="padding:48px"], [style*="padding:32px"] {
    padding: 20px !important;
  }
  [style*="padding: 40px"], [style*="padding: 48px"], [style*="padding: 32px"] {
    padding: 20px !important;
  }
  
  /* Tabellen scrollbar */
  table { display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
  
  /* Font-Size Minimum */
  * { min-height: 0; }
}

/* === MOBILE (480px) === */
@media (max-width: 480px) {
  /* Grid → 1 Spalte */
  [style*="grid-template-columns"], [style*="gridTemplateColumns"] { 
    grid-template-columns: 1fr !important; 
  }
  .grid { grid-template-columns: 1fr !important; }
  
  /* Sidebar ausblenden oder collapsieren */
  [style*="width:240px"], [style*="width: 240px"],
  [style*="width:260px"], [style*="width: 260px"],
  [style*="width:280px"], [style*="width: 280px"],
  [style*="width:200px"], [style*="width: 200px"],
  [style*='width:"240px"'], [style*='width:"260px"'], [style*='width:"280px"'],
  [style*='width:"200px"'] {
    position: fixed !important;
    left: -300px !important;
    z-index: 999 !important;
    transition: left 0.3s ease !important;
    width: 260px !important;
    height: 100vh !important;
    top: 0 !important;
  }
  
  /* Alle Flex-Container stacken */
  [style*="display:flex"], [style*="display: flex"],
  [style*='display:"flex"'] {
    flex-wrap: wrap !important;
  }
  [style*="flex-direction:row"], [style*="flexDirection:"row""],
  [style*="flex-direction: row"] {
    flex-direction: column !important;
  }
  
  /* Form-Elemente full width */
  input, select, textarea, .input-field {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    font-size: 16px !important; /* Prevents iOS zoom */
  }
  
  /* Buttons touch-friendly */
  button, .btn-primary, .btn-secondary, [role="button"] {
    min-height: 44px !important;
    min-width: 44px !important;
    font-size: 14px !important;
  }
  
  /* Padding stark reduzieren */
  [style*="padding:40px"], [style*="padding:48px"], [style*="padding:32px"],
  [style*="padding:28px"], [style*="padding:24px"],
  [style*="padding: 40px"], [style*="padding: 48px"], [style*="padding: 32px"],
  [style*="padding: 28px"], [style*="padding: 24px"] {
    padding: 12px !important;
  }
  
  /* Gap reduzieren */
  [style*="gap:24px"], [style*="gap:20px"], [style*="gap:28px"],
  [style*="gap: 24px"], [style*="gap: 20px"], [style*="gap: 28px"] {
    gap: 12px !important;
  }
  
  /* Font sizes - minimum 12px */
  [style*="font-size:8px"], [style*="font-size:9px"], [style*="font-size:10px"],
  [style*="font-size: 8px"], [style*="font-size: 9px"], [style*="font-size: 10px"],
  [style*="fontSize:8px"], [style*="fontSize:9px"], [style*="fontSize:10px"],
  [style*='fontSize:"8px"'], [style*='fontSize:"9px"'], [style*='fontSize:"10px"'] {
    font-size: 12px !important;
  }
  
  /* Bilder responsive */
  img { max-width: 100% !important; height: auto !important; }
  
  /* Fixed elements repositionieren */
  [style*="position:fixed"][style*="top:12px"][style*="left:12px"],
  [style*="position: fixed"][style*="top: 12px"][style*="left: 12px"] {
    top: 6px !important;
    left: 6px !important;
    font-size: 11px !important;
    padding: 4px 8px !important;
  }
  
  /* Logo kleiner */
  .logo { font-size: 32px !important; }
  
  /* Text wrap erzwingen */
  * { word-wrap: break-word !important; overflow-wrap: break-word !important; }
  [style*="white-space:nowrap"], [style*="white-space: nowrap"],
  [style*='whiteSpace:"nowrap"'] {
    white-space: normal !important;
  }
  
  /* Modals full width */
  .modal, [class*="modal"], [style*="width:480px"], [style*="width:520px"],
  [style*="width:560px"], [style*="width:600px"] {
    width: 96vw !important;
    max-width: 96vw !important;
    padding: 16px !important;
    margin: 8px !important;
  }
  
  /* Map containers */
  #map, .leaflet-container, [style*="height:100vh"] {
    height: calc(100vh - 60px) !important;
  }
  .map-toolbar {
    flex-direction: column !important;
    top: 6px !important;
    left: 6px !important;
    right: 6px !important;
  }
  .map-tool-btn {
    font-size: 11px !important;
    padding: 5px 10px !important;
  }
}

/* ═══ Lesbarkeit: Zu dunkle Farben aufhellen ═══ */
/* #0c1222 backgrounds → Schrift mindestens #8b95a5 */
[style*="color:#0c1222"], [style*="color: #0c1222"] { color: #8b95a5 !important; }
[style*="color:#151d30"], [style*="color: #151d30"] { color: #8b95a5 !important; }
[style*="color:#263354"], [style*="color: #263354"] { color: #7a8baa !important; }
[style*="color:#1c2640"], [style*="color: #1c2640"] { color: #8b95a5 !important; }
[style*="color:#334155"], [style*="color: #334155"] { color: #8b95a5 !important; }
[style*="color:#252530"], [style*="color: #252530"] { color: #8b95a5 !important; }
[style*='color:"#0c1222"'] { color: #8b95a5 !important; }
[style*='color:"#151d30"'] { color: #8b95a5 !important; }
[style*='color:"#263354"'] { color: #7a8baa !important; }
[style*='color:"#1c2640"'] { color: #8b95a5 !important; }
[style*='color:"#334155"'] { color: #8b95a5 !important; }
[style*='color:"#252530"'] { color: #8b95a5 !important; }

/* Grüntöne auf Dark besser lesbar machen */
[style*="color:#166534"], [style*="color: #166534"] { color: #34d399 !important; }
[style*='color:"#166534"'] { color: #34d399 !important; }

/* Generell: Alle font-sizes unter 10px auf mindestens 11px */

/* kalender.html specific */
@media (max-width: 480px) {
  td, th { padding: 2px !important; font-size: 11px !important; }
}
</style>
</head>
<body>
<a href="index.html" style="position:fixed;top:10px;left:10px;z-index:9999;background:#111827;border:1px solid #333;color:#9ca3af;padding:6px 13px;border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;font-family:inherit;transition:all .15s" onmouseover="this.style.color='#F5C500';this.style.borderColor='#F5C500'" onmouseout="this.style.color='#9ca3af';this.style.borderColor='#333'">← Launcher</a>
<div id="root"></div>
<script>
// ═══ SUPABASE DATA LOADER ═══
window._sbData = { v: [], t: [], b: [], loaded: false };
window._sbCfg = {
  url: (window.BEEDOO_CONFIG && window.BEEDOO_CONFIG.SB_URL) || "https://hqzpemfaljxcysyqssng.supabase.co",
  key: (window.BEEDOO_CONFIG && window.BEEDOO_CONFIG.SB_SRV) || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxenBlbWZhbGp4Y3lzeXFzc25nIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MTMzNTM5NywiZXhwIjoyMDg2OTExMzk3fQ.MJ3cyAAquE8DK2ngzfIIn4bTpQ8_H9DaeJ3YTlBdFz4"
};
window._sbH = { "apikey": window._sbCfg.key, "Authorization": "Bearer " + window._sbCfg.key, "Content-Type": "application/json" };

window.sbFetch = function(path) {
  return fetch(window._sbCfg.url + "/rest/v1/" + path, { headers: window._sbH }).then(function(r) { return r.json(); });
};
window.sbSave = function(table, id, data) {
  return fetch(window._sbCfg.url + "/rest/v1/" + table + "?id=eq." + id, {
    method: "PATCH", headers: Object.assign({}, window._sbH, {"Prefer": "return=representation"}),
    body: JSON.stringify(data)
  });
};
window.sbInsert = function(table, data) {
  return fetch(window._sbCfg.url + "/rest/v1/" + table, {
    method: "POST", headers: Object.assign({}, window._sbH, {"Prefer": "return=representation"}),
    body: JSON.stringify(data)
  }).then(function(r) { return r.json(); });
};
window.sbDelete = function(table, id) {
  return fetch(window._sbCfg.url + "/rest/v1/" + table + "?id=eq." + id, {
    method: "DELETE", headers: window._sbH
  });
};

window.loadSBData = function() {
  return Promise.all([
    window.sbFetch("vertriebler?aktiv=eq.true&select=id,name,farbe&order=name"),
    window.sbFetch("termine?select=*&order=datum,zeit_minuten"),
    window.sbFetch("blocker?select=*&order=datum")
  ]).then(function(results) {
    var vData = results[0], tData = results[1], bData = results[2];
    window._sbData.v = vData.map(function(v) { return { id: v.id, name: v.name, color: v.farbe }; });
    window._sbData.t = tData.map(function(t) {
      return {
        id: t.id, vertriebId: t.vertrieb_id, datum: t.datum,
        zeit: t.zeit_minuten, dauer: t.dauer_minuten,
        status: t.status, nr: t.termin_nr, kunde: t.kunde,
        adresse: t.adresse, plz: t.plz, ort: t.ort,
        telefon: t.telefon, notizen: t.notizen,
        hatAuftrag: t.status === "auftrag"
      };
    });
    window._sbData.b = bData.map(function(b) {
      return {
        id: b.id, vertriebId: b.vertrieb_id, typ: b.typ,
        label: b.label, datum: b.datum,
        zeitVon: b.zeit_von, zeitBis: b.zeit_bis,
        ganztaegig: b.ganztaegig
      };
    });
    window._sbData.loaded = true;
    console.log("✅ Supabase:", window._sbData.v.length, "Vertriebler,", window._sbData.t.length, "Termine,", window._sbData.b.length, "Blocker");
    return window._sbData;
  }).catch(function(e) {
    console.error("❌ Supabase Fehler:", e);
    return window._sbData;
  });
};

// Save termin changes back to Supabase
window.saveTerminToSB = function(t) {
  return window.sbSave("termine", t.id, {
    zeit_minuten: t.zeit, dauer_minuten: t.dauer,
    status: t.status, kunde: t.kunde, datum: t.datum,
    adresse: t.adresse, plz: t.plz, ort: t.ort,
    telefon: t.telefon, notizen: t.notizen
  }).catch(function(e) { console.error("Save failed:", e); });
};

window.createTerminInSB = function(t) {
  return window.sbInsert("termine", {
    vertrieb_id: t.vertriebId, datum: t.datum,
    zeit_minuten: t.zeit, dauer_minuten: t.dauer || 120,
    status: t.status || "offen", kunde: t.kunde || "",
    adresse: t.adresse, plz: t.plz, ort: t.ort,
    telefon: t.telefon, notizen: t.notizen, termin_nr: t.nr
  });
};
</script>

<script>
window.require = function(mod) {
  if (mod === 'react') return window.React;
  if (mod === 'react-dom') return window.ReactDOM;
  throw new Error('Unknown module: ' + mod);
};
</script>
<script>
var BeeDooApp = (() => {
  var __defProp = Object.defineProperty;
  var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
  var __getOwnPropNames = Object.getOwnPropertyNames;
  var __hasOwnProp = Object.prototype.hasOwnProperty;
  var __require = /* @__PURE__ */ ((x) => typeof require !== "undefined" ? require : typeof Proxy !== "undefined" ? new Proxy(x, {
    get: (a, b) => (typeof require !== "undefined" ? require : a)[b]
  }) : x)(function(x) {
    if (typeof require !== "undefined") return require.apply(this, arguments);
    throw Error('Dynamic require of "' + x + '" is not supported');
  });
  var __export = (target, all) => {
    for (var name in all)
      __defProp(target, name, { get: all[name], enumerable: true });
  };
  var __copyProps = (to, from, except, desc) => {
    if (from && typeof from === "object" || typeof from === "function") {
      for (let key of __getOwnPropNames(from))
        if (!__hasOwnProp.call(to, key) && key !== except)
          __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
    }
    return to;
  };
  var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

  // app.jsx
  var app_exports = {};
  __export(app_exports, {
    default: () => App
  });
  var import_react = __require("react");
  var C = { bg: "#0c1222", c1: "#151d30", c2: "#1c2640", bd: "#263354", tx: "#e1e7ef", dm: "#5c6b8a", y: "#FDE154" };
  var VERTRIEBLER = (window._sbData && window._sbData.v && window._sbData.v.length) ? window._sbData.v : [
    { id: "AK", name: "Andreas Klee", color: "#4f8ef7" },
    { id: "FR", name: "Frank Reddig", color: "#FDE154" },
    { id: "JP", name: "Jannis Pfeiffer", color: "#a78bfa" },
    { id: "KM", name: "Maximilian Koch", color: "#f74f4f" },
    { id: "MSC", name: "Miguel Schader", color: "#4fc7f7" },
    { id: "PM", name: "Pascal Meier", color: "#f7914f" },
    { id: "DV", name: "Dimitri van Eeuwen", color: "#34d399" },
    { id: "PTH", name: "P.-Torben Hannig", color: "#fb7185" }
  ];
  var STATUS_CFG = {
    offen: { label: "Offen", color: "#FDE154", tc: "#0c1222" },
    bestaetigt: { label: "Best\xE4tigt", color: "#4f8ef7", tc: "#fff" },
    storniert: { label: "Storniert", color: "#5c6b8a", tc: "#e1e7ef" },
    verpasst: { label: "Verpasst", color: "#f74f4f", tc: "#fff" },
    auftrag: { label: "Auftrag", color: "#34d399", tc: "#0c1222" }
  };
  var BLOCK_TYPEN = [
    { key: "urlaub", label: "Urlaub", color: "#4fc7f7", icon: "\u{1F3D6}" },
    { key: "krank", label: "Krank", color: "#f74f4f", icon: "\u{1F912}" },
    { key: "meeting", label: "Meeting", color: "#f7914f", icon: "\u{1F465}" },
    { key: "training", label: "Schulung", color: "#a78bfa", icon: "\u{1F4DA}" },
    { key: "sonstiges", label: "Sonstiges", color: "#5c6b8a", icon: "\u{1F512}" }
  ];
  var TAGE = ["Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"];
  var GS = 8 * 60;
  var GE = 22 * 60;
  var GSP = GE - GS;
  var HOURS = Array.from({ length: 15 }, (_, i) => i + 8);
  var TODAY = new Date().toISOString().split("T")[0];
  var MAX_PER_DAY = 4;
  var pct = (m) => Math.max(0, Math.min(100, (m - GS) / GSP * 100));
  var wPct = (d) => d / GSP * 100;
  var m2t = (m) => {
    const h = Math.floor(m / 60), mn = Math.round(m % 60);
    return `${String(h).padStart(2, "0")}:${String(mn).padStart(2, "0")}`;
  };
  var defaultAz = () => TAGE.reduce((a, t) => ({ ...a, [t]: ["Mo", "Di", "Mi", "Do", "Fr"].includes(t) ? GS : null, [t + "E"]: ["Mo", "Di", "Mi", "Do", "Fr"].includes(t) ? GE : null }), {});
  var INIT_AZ = VERTRIEBLER.reduce((a, v) => ({ ...a, [v.id]: defaultAz() }), {});
  var _now = new Date(); var _year = _now.getFullYear(); var _month = _now.getMonth();
  var _daysInMonth = new Date(_year, _month + 1, 0).getDate();
  var FEB_DAYS = Array.from({ length: _daysInMonth }, (_, i) => { var d = new Date(_year, _month, i + 1); return d.toISOString().split("T")[0]; });
  var febStartDow = new Date(_year, _month, 1).getDay();
  var DOW_MAP = { 0: "So", 1: "Mo", 2: "Di", 3: "Mi", 4: "Do", 5: "Fr", 6: "Sa" };
  // ═══ SUPABASE DATA (replaces hardcoded ROWS/BLOCKS) ═══
  var TERMINE_DATA = (window._sbData && window._sbData.t) ? window._sbData.t : [];
  var BLOCKS = (window._sbData && window._sbData.b) ? window._sbData.b : [];
  function Badge({ type }) {
    if (type === "auftrag") return /* @__PURE__ */ React.createElement("span", { style: { background: "#34d399", color: "#0c1222", fontSize: 8, fontWeight: 800, padding: "1px 4px", borderRadius: 3, letterSpacing: "0.05em", whiteSpace: "nowrap", flexShrink: 0 } }, "AUFTRAG");
    if (type === "storniert") return /* @__PURE__ */ React.createElement("span", { style: { background: "#5c6b8a", color: "#e1e7ef", fontSize: 8, fontWeight: 800, padding: "1px 4px", borderRadius: 3, letterSpacing: "0.05em", whiteSpace: "nowrap", flexShrink: 0 } }, "STORNIERT");
    return null;
  }
  function AuslastungsBar({ pct: p, color, small }) {
    const col = p >= 100 ? "#f74f4f" : p >= 75 ? C.y : p >= 50 ? "#4f8ef7" : color;
    return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: small ? 3 : 5 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1, height: small ? 4 : 6, background: C.bd + "55", borderRadius: 3, overflow: "hidden", minWidth: small ? 28 : 40 } }, /* @__PURE__ */ React.createElement("div", { style: { width: `${Math.min(100, p)}%`, height: "100%", background: col, borderRadius: 3, transition: "width 0.3s" } })), /* @__PURE__ */ React.createElement("span", { style: { fontSize: small ? 9 : 10, color: p >= 100 ? "#f74f4f" : p >= 75 ? C.y : C.dm, fontWeight: 700, minWidth: 24 } }, Math.round(p), "%"));
  }
  function KapazitaetDot({ termine, az, datum }) {
    const dow = DOW_MAP[(/* @__PURE__ */ new Date(datum + "T12:00")).getDay()];
    const hasWork = az[dow] != null && az[dow + "E"] != null;
    if (!hasWork) return /* @__PURE__ */ React.createElement("span", { style: { width: 8, height: 8, borderRadius: "50%", background: C.bd, display: "inline-block" }, title: "Kein Arbeitstag" });
    const cnt = termine.length;
    const col = cnt >= MAX_PER_DAY ? "#f74f4f" : cnt >= MAX_PER_DAY - 1 ? C.y : "#34d399";
    const label = cnt >= MAX_PER_DAY ? "Voll" : `${MAX_PER_DAY - cnt} frei`;
    return /* @__PURE__ */ React.createElement("span", { style: { width: 8, height: 8, borderRadius: "50%", background: col, display: "inline-block", flexShrink: 0 }, title: label });
  }
  function ConversionBadge({ termine }) {
    const total = termine.filter((t) => t.status !== "storniert").length;
    const auftraege = termine.filter((t) => t.status === "auftrag").length;
    if (total === 0) return null;
    const rate = Math.round(auftraege / total * 100);
    const col = rate >= 30 ? "#34d399" : rate >= 15 ? C.y : "#f74f4f";
    return /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, fontWeight: 800, color: col, background: col + "22", padding: "1px 5px", borderRadius: 4, whiteSpace: "nowrap" } }, "CR ", rate, "%");
  }
  function VertrieblerStat({ v, termine, period, az, datum }) {
    const total = termine.length;
    const auftraege = termine.filter((t) => t.status === "auftrag").length;
    const storniert = termine.filter((t) => t.status === "storniert").length;
    const effective = termine.filter((t) => t.status !== "storniert").length;
    const days = period === "tag" ? 1 : period === "woche" ? 5 : 20;
    const auslastung = total / (days * MAX_PER_DAY) * 100;
    return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 2 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 5, alignItems: "center", flexWrap: "wrap" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 700, color: C.tx } }, total), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: C.dm } }, "T"), /* @__PURE__ */ React.createElement(ConversionBadge, { termine }), datum && /* @__PURE__ */ React.createElement(KapazitaetDot, { termine: termine.filter((t) => t.datum === datum), az, datum })), /* @__PURE__ */ React.createElement(AuslastungsBar, { pct: auslastung, color: v.color, small: true }));
  }
  function RangeSlider({ vonM, bisM, onChange, disabled }) {
    const trackRef = (0, import_react.useRef)(null);
    const dragging = (0, import_react.useRef)(null);
    const getM = (0, import_react.useCallback)((cx) => {
      if (!trackRef.current) return vonM;
      const rect = trackRef.current.getBoundingClientRect();
      const ratio = Math.max(0, Math.min(1, (cx - rect.left) / rect.width));
      return Math.round((GS + ratio * GSP) / 30) * 30;
    }, [vonM]);
    const onMD = (handle) => (e) => {
      if (disabled) return;
      e.preventDefault();
      dragging.current = handle;
      const mv = (ev) => {
        const m = getM(ev.clientX);
        if (dragging.current === "von") onChange(Math.max(GS, Math.min(m, bisM - 60)), bisM);
        else onChange(vonM, Math.min(GE, Math.max(m, vonM + 60)));
      };
      const up = () => {
        dragging.current = null;
        window.removeEventListener("mousemove", mv);
        window.removeEventListener("mouseup", up);
      };
      window.addEventListener("mousemove", mv);
      window.addEventListener("mouseup", up);
    };
    const lp = (vonM - GS) / GSP * 100, rp = (bisM - GS) / GSP * 100;
    return /* @__PURE__ */ React.createElement("div", { ref: trackRef, style: { position: "relative", height: 28, borderRadius: 6, background: C.bg, border: "1px solid " + C.bd, userSelect: "none", opacity: disabled ? 0.4 : 1, marginTop: 14 } }, HOURS.map((h) => /* @__PURE__ */ React.createElement("div", { key: h, style: { position: "absolute", left: `${(h * 60 - GS) / GSP * 100}%`, top: 0, bottom: 0, borderLeft: "1px solid " + (h % 2 === 0 ? C.bd + "55" : C.bd + "22") } }, h % 2 === 0 && /* @__PURE__ */ React.createElement("span", { style: { position: "absolute", top: 2, left: 2, fontSize: 8, color: C.dm + "88" } }, h))), /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", left: `${lp}%`, width: `${rp - lp}%`, top: 4, bottom: 4, background: "linear-gradient(90deg,#4f8ef733,#FDE15433)", border: "1px solid " + C.y + "55", borderRadius: 4, pointerEvents: "none" } }), [["von", "#4f8ef7", lp, vonM], ["bis", C.y, rp, bisM]].map(([h, col, pos, val]) => /* @__PURE__ */ React.createElement("div", { key: h, onMouseDown: onMD(h), style: { position: "absolute", left: `${pos}%`, top: "50%", transform: "translate(-50%,-50%)", width: 16, height: 20, background: col, borderRadius: 4, cursor: disabled ? "default" : "ew-resize", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 3, boxShadow: "0 2px 6px #00000055" } }, /* @__PURE__ */ React.createElement("div", { style: { width: 2, height: 10, background: "#ffffff44", borderRadius: 1 } }))), /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", left: `${lp}%`, transform: "translateX(-50%)", top: -14, fontSize: 9, color: "#4f8ef7", fontWeight: 700, pointerEvents: "none", whiteSpace: "nowrap" } }, m2t(vonM)), /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", left: `${rp}%`, transform: "translateX(-50%)", top: -14, fontSize: 9, color: C.y, fontWeight: 700, pointerEvents: "none", whiteSpace: "nowrap" } }, m2t(bisM)));
  }
  function DayRow({ v, termine, az, blocks, onTerminClick, period, allTermine, displayDate, onDrop }) {
    const [hov, setHov] = (0, import_react.useState)(null);
    const [dragOver, setDragOver] = (0, import_react.useState)(false);
    const timelineRef = (0, import_react.useRef)(null);
    const dow = DOW_MAP[(/* @__PURE__ */ new Date(displayDate + "T12:00")).getDay()];
    const von = az[dow], bis = az[dow + "E"];
    const hasAz = von != null && bis != null;
    const ganztaegig = blocks.find((b) => b.ganztaegig);
    const periodTermine = period === "tag" ? allTermine.filter((t) => t.datum === displayDate && t.vertriebId === v.id) : period === "woche" ? allTermine.filter((t) => t.datum >= "2026-02-16" && t.datum <= "2026-02-22" && t.vertriebId === v.id) : allTermine.filter((t) => t.vertriebId === v.id);
    const freeSlots = (0, import_react.useMemo)(() => {
      if (!hasAz || ganztaegig) return [];
      const busy = [];
      blocks.filter((b) => !b.ganztaegig && b.zeitVon != null).forEach((b) => busy.push([b.zeitVon, b.zeitBis]));
      termine.forEach((t) => busy.push([t.zeit, t.zeit + t.dauer]));
      busy.sort((a, b) => a[0] - b[0]);
      const slots = [];
      let cur = von;
      busy.forEach(([s, e]) => {
        const bs = Math.max(s, von), be = Math.min(e, bis);
        if (bs > cur + 15) slots.push([cur, bs]);
        if (be > cur) cur = be;
      });
      if (cur < bis - 15) slots.push([cur, bis]);
      return slots;
    }, [hasAz, ganztaegig, von, bis, blocks, termine]);
    const conflicts = (0, import_react.useMemo)(() => {
      const ids = /* @__PURE__ */ new Set();
      for (let i = 0; i < termine.length; i++) {
        for (let j = i + 1; j < termine.length; j++) {
          const a = termine[i], b = termine[j];
          if (a.zeit < b.zeit + b.dauer && a.zeit + a.dauer > b.zeit) {
            ids.add(a.id);
            ids.add(b.id);
          }
        }
      }
      return ids;
    }, [termine]);
    const getTimeFromX = (clientX) => {
      if (!timelineRef.current) return null;
      const rect = timelineRef.current.getBoundingClientRect();
      const ratio = Math.max(0, Math.min(1, (clientX - rect.left) / rect.width));
      return Math.round((GS + ratio * GSP) / 30) * 30;
    };
    const handleDragOver = (e) => {
      e.preventDefault();
      setDragOver(true);
    };
    const handleDragLeave = () => setDragOver(false);
    const handleDrop = (e) => {
      e.preventDefault();
      setDragOver(false);
      const tid = parseInt(e.dataTransfer.getData("terminId"));
      if (!tid) return;
      const newTime = getTimeFromX(e.clientX);
      if (newTime != null) onDrop(tid, newTime);
    };
    const blockTyp = ganztaegig ? BLOCK_TYPEN.find((t) => t.key === ganztaegig.typ) : null;
    return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "stretch", borderBottom: "1px solid " + C.bd + "22", minHeight: 60 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 200, flexShrink: 0, padding: "6px 12px", display: "flex", flexDirection: "column", justifyContent: "center", gap: 3, borderRight: "1px solid " + C.bd, position: "sticky", left: 0, zIndex: 12, background: C.bg, boxShadow: "4px 0 12px #00000044" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 24, height: 24, borderRadius: "50%", background: v.color + "22", border: "2px solid " + v.color, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 9, fontWeight: 800, color: v.color, flexShrink: 0 } }, v.id.slice(0, 2)), /* @__PURE__ */ React.createElement("div", { style: { overflow: "hidden", flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: C.tx, whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" } }, v.name), hasAz && !ganztaegig && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: C.dm } }, m2t(von), "\u2013", m2t(bis)), ganztaegig && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: blockTyp?.color } }, blockTyp?.icon, " ", ganztaegig.label)), conflicts.size > 0 && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14, flexShrink: 0 }, title: `${conflicts.size} Konflikte` }, "\u26A0\uFE0F")), /* @__PURE__ */ React.createElement(VertrieblerStat, { v, termine: periodTermine, period, az, datum: displayDate })), /* @__PURE__ */ React.createElement(
      "div",
      {
        ref: timelineRef,
        onDragOver: handleDragOver,
        onDragLeave: handleDragLeave,
        onDrop: handleDrop,
        style: { flex: 1, position: "relative", opacity: ganztaegig ? 0.6 : 1, background: dragOver ? C.y + "08" : "transparent", transition: "background 0.1s" }
      },
      HOURS.map((h) => /* @__PURE__ */ React.createElement("div", { key: h, style: { position: "absolute", left: `${(h * 60 - GS) / GSP * 100}%`, top: 0, bottom: 0, borderLeft: "1px solid " + C.bd + "22" } })),
      hasAz && !ganztaegig && von > GS && /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", left: 0, width: `${(von - GS) / GSP * 100}%`, top: 0, bottom: 0, background: "repeating-linear-gradient(45deg,transparent,transparent 4px,#ffffff05 4px,#ffffff05 8px)", borderRight: "2px dashed " + C.bd + "44" } }),
      hasAz && !ganztaegig && bis < GE && /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", left: `${(bis - GS) / GSP * 100}%`, right: 0, top: 0, bottom: 0, background: "repeating-linear-gradient(45deg,transparent,transparent 4px,#ffffff05 4px,#ffffff05 8px)", borderLeft: "2px dashed " + C.bd + "44" } }),
      ganztaegig && /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", inset: 0, background: `repeating-linear-gradient(45deg,transparent,transparent 8px,${blockTyp?.color}15 8px,${blockTyp?.color}15 16px)`, display: "flex", alignItems: "center", justifyContent: "center", pointerEvents: "none" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 22, opacity: 0.2 } }, blockTyp?.icon)),
      !ganztaegig && freeSlots.map(([s, e], i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { position: "absolute", left: `${pct(s)}%`, width: `${wPct(e - s)}%`, top: 0, bottom: 0, background: "linear-gradient(180deg,#34d39910 0%,#34d39920 100%)", borderLeft: "1px solid #34d39928", borderRight: "1px solid #34d39928", pointerEvents: "none", zIndex: 1 } })),
      !ganztaegig && blocks.filter((b) => !b.ganztaegig && b.zeitVon != null).map((b) => {
        const typ = BLOCK_TYPEN.find((t) => t.key === b.typ);
        return /* @__PURE__ */ React.createElement("div", { key: b.id, style: { position: "absolute", left: `${pct(b.zeitVon)}%`, width: `${wPct(b.zeitBis - b.zeitVon)}%`, top: 4, bottom: 4, background: `repeating-linear-gradient(45deg,${typ.color}22,${typ.color}22 4px,${typ.color}0a 4px,${typ.color}0a 8px)`, border: "1.5px dashed " + typ.color + "88", borderRadius: 6, display: "flex", alignItems: "center", paddingLeft: 6, overflow: "hidden", zIndex: 2 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: typ.color, fontWeight: 700, whiteSpace: "nowrap" } }, typ.icon, " ", b.label));
      }),
      !ganztaegig && termine.map((t) => {
        const s = STATUS_CFG[t.status];
        const isHov = hov === t.id;
        const hasConflict = conflicts.has(t.id);
        return /* @__PURE__ */ React.createElement(
          "div",
          {
            key: t.id,
            draggable: true,
            onClick: () => onTerminClick(t),
            onDragStart: (e) => {
              e.dataTransfer.setData("terminId", String(t.id));
            },
            onMouseEnter: () => setHov(t.id),
            onMouseLeave: () => setHov(null),
            style: { position: "absolute", left: `${pct(t.zeit)}%`, width: `${wPct(t.dauer)}%`, top: 5, bottom: 5, background: s.color, borderRadius: 8, padding: "2px 6px", overflow: "hidden", cursor: "grab", zIndex: isHov ? 10 : 3, boxShadow: isHov ? `0 4px 16px ${s.color}55` : "0 1px 4px " + s.color + "33", transform: isHov ? "scaleY(1.06)" : "scaleY(1)", transition: "all 0.12s", outline: hasConflict ? "2px solid #ff4444" : "none", outlineOffset: 1 }
          },
          /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 3, alignItems: "center" } }, hasConflict && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, flexShrink: 0 } }, "\u26A0\uFE0F"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, fontWeight: 700, color: s.tc, whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis", flex: 1 } }, t.kunde), t.status === "auftrag" && /* @__PURE__ */ React.createElement(Badge, { type: "auftrag" }), t.status === "storniert" && /* @__PURE__ */ React.createElement(Badge, { type: "storniert" })),
          /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: s.tc + "bb" } }, "#", t.nr, " \xB7 ", m2t(t.zeit))
        );
      })
    ));
  }
  function WeekView({ termine, activeV, onDayClick, activeStatus }) {
    const weekDays = [
      { datum: "2026-02-16", label: "Mo 16", short: "Mo" },
      { datum: "2026-02-17", label: "Di 17", short: "Di" },
      { datum: "2026-02-18", label: "Mi 18", short: "Mi" },
      { datum: "2026-02-19", label: "Do 19", short: "Do" },
      { datum: "2026-02-20", label: "Fr 20 \u25C0", isToday: true, short: "Fr" },
      { datum: "2026-02-21", label: "Sa 21", short: "Sa" },
      { datum: "2026-02-22", label: "So 22", short: "So" }
    ];
    const prevWeekDays = [
      { datum: "2026-02-09", short: "Mo" },
      { datum: "2026-02-10", short: "Di" },
      { datum: "2026-02-11", short: "Mi" },
      { datum: "2026-02-12", short: "Do" },
      { datum: "2026-02-13", short: "Fr" }
    ];
    const activeVList = VERTRIEBLER.filter((v) => activeV[v.id]);
    const filtered = termine.filter((t) => activeStatus[t.status]);
    const prevTotal = filtered.filter((t) => t.datum >= "2026-02-09" && t.datum <= "2026-02-15").length;
    const currTotal = filtered.filter((t) => t.datum >= "2026-02-16" && t.datum <= "2026-02-22").length;
    const prevAuftraege = filtered.filter((t) => t.datum >= "2026-02-09" && t.datum <= "2026-02-15" && t.status === "auftrag").length;
    const currAuftraege = filtered.filter((t) => t.datum >= "2026-02-16" && t.datum <= "2026-02-22" && t.status === "auftrag").length;
    const delta = currTotal - prevTotal;
    const deltaA = currAuftraege - prevAuftraege;
    return /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 20px", background: C.c2, borderBottom: "1px solid " + C.bd, display: "flex", gap: 20, alignItems: "center", flexWrap: "wrap" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 700, color: C.dm } }, "KW 8 vs KW 7:"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: delta > 0 ? "#34d399" : delta < 0 ? "#f74f4f" : C.dm } }, delta > 0 ? "+" : "", delta, " Termine ", delta > 0 ? "\u2191" : delta < 0 ? "\u2193" : "\u2192"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: deltaA > 0 ? "#34d399" : deltaA < 0 ? "#f74f4f" : C.dm } }, deltaA > 0 ? "+" : "", deltaA, " Auftr\xE4ge"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: C.dm } }, "Vorwoche: ", prevTotal, "T \xB7 ", prevAuftraege, "A"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: C.tx, fontWeight: 600 } }, "Diese Woche: ", currTotal, "T \xB7 ", currAuftraege, "A")), /* @__PURE__ */ React.createElement("div", { style: { overflowX: "auto" } }, /* @__PURE__ */ React.createElement("div", { style: { minWidth: 700 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", background: C.c1, borderBottom: "1px solid " + C.bd, position: "sticky", top: 0, zIndex: 20 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 200, flexShrink: 0, borderRight: "1px solid " + C.bd, padding: "7px 14px", position: "sticky", left: 0, zIndex: 22, background: C.c1, boxShadow: "4px 0 12px #00000044" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: C.dm, fontWeight: 600 } }, "VERTRIEBLER")), weekDays.map((d) => /* @__PURE__ */ React.createElement(
      "div",
      {
        key: d.datum,
        onClick: () => onDayClick(d.datum),
        style: { flex: 1, borderRight: "1px solid " + C.bd + "22", padding: "7px 6px", cursor: "pointer", background: d.isToday ? C.y + "11" : "transparent", transition: "background 0.15s" },
        onMouseEnter: (e) => e.currentTarget.style.background = d.isToday ? C.y + "22" : C.c2,
        onMouseLeave: (e) => e.currentTarget.style.background = d.isToday ? C.y + "11" : "transparent"
      },
      /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: d.isToday ? 800 : 600, color: d.isToday ? C.y : C.dm, whiteSpace: "nowrap" } }, d.label),
      /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: C.dm + "88", marginTop: 1 } }, filtered.filter((t) => t.datum === d.datum).length, "T")
    ))), activeVList.map((v) => {
      const days = weekDays.map((d) => ({ ...d, termine: filtered.filter((t) => t.vertriebId === v.id && t.datum === d.datum) }));
      const wt = filtered.filter((t) => t.vertriebId === v.id && t.datum >= "2026-02-16" && t.datum <= "2026-02-22").length;
      const pt = filtered.filter((t) => t.vertriebId === v.id && t.datum >= "2026-02-09" && t.datum <= "2026-02-15").length;
      const wa = filtered.filter((t) => t.vertriebId === v.id && t.datum >= "2026-02-16" && t.datum <= "2026-02-22" && t.status === "auftrag").length;
      const ausl = wt / (5 * MAX_PER_DAY) * 100;
      const cr = wt > 0 ? Math.round(wa / wt * 100) : 0;
      const wtDelta = wt - pt;
      return /* @__PURE__ */ React.createElement("div", { key: v.id, style: { display: "flex", borderBottom: "1px solid " + C.bd + "22", minHeight: 52 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 200, flexShrink: 0, padding: "6px 12px", display: "flex", flexDirection: "column", justifyContent: "center", gap: 3, borderRight: "1px solid " + C.bd, position: "sticky", left: 0, zIndex: 12, background: C.bg, boxShadow: "4px 0 12px #00000044" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 22, height: 22, borderRadius: "50%", background: v.color + "22", border: "2px solid " + v.color, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 9, fontWeight: 800, color: v.color, flexShrink: 0 } }, v.id.slice(0, 2)), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 700, color: C.tx, whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" } }, v.name), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: wtDelta > 0 ? "#34d399" : wtDelta < 0 ? "#f74f4f" : C.dm, fontWeight: 700, flexShrink: 0 } }, wtDelta > 0 ? "+" : "", wtDelta !== 0 ? wtDelta : "")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, alignItems: "center" } }, /* @__PURE__ */ React.createElement(AuslastungsBar, { pct: ausl, color: v.color, small: true }), wa > 0 && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: "#34d399", fontWeight: 700, flexShrink: 0 } }, cr, "%CR"))), days.map((d) => {
        const cnt = d.termine.length;
        const hasA = d.termine.some((t) => t.status === "auftrag");
        const hasS = d.termine.some((t) => t.status === "storniert");
        const dp = Math.min(100, cnt / MAX_PER_DAY * 100);
        return /* @__PURE__ */ React.createElement(
          "div",
          {
            key: d.datum,
            onClick: () => onDayClick(d.datum),
            style: { flex: 1, borderRight: "1px solid " + C.bd + "22", padding: 5, cursor: "pointer", background: d.isToday ? C.y + "0a" : "transparent", transition: "background 0.15s" },
            onMouseEnter: (e) => e.currentTarget.style.background = d.isToday ? C.y + "18" : C.c2 + "88",
            onMouseLeave: (e) => e.currentTarget.style.background = d.isToday ? C.y + "0a" : "transparent"
          },
          cnt === 0 ? /* @__PURE__ */ React.createElement("div", { style: { height: "100%", display: "flex", alignItems: "center", justifyContent: "center" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: C.bd } }, "\u2014")) : /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 3, marginBottom: 3, flexWrap: "wrap" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, fontWeight: 800, color: v.color } }, cnt), hasA && /* @__PURE__ */ React.createElement(Badge, { type: "auftrag" }), hasS && /* @__PURE__ */ React.createElement(Badge, { type: "storniert" })), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 2, flexWrap: "wrap" } }, Object.entries(STATUS_CFG).map(([k, s]) => {
            const c2 = d.termine.filter((t) => t.status === k).length;
            if (!c2) return null;
            return /* @__PURE__ */ React.createElement("span", { key: k, style: { fontSize: 8, background: s.color + "33", color: s.color, padding: "1px 3px", borderRadius: 3, fontWeight: 700 } }, c2, k === "bestaetigt" ? "B" : k === "offen" ? "O" : k === "storniert" ? "S" : k === "auftrag" ? "A" : "V");
          })), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 3, height: 3, background: C.bd + "44", borderRadius: 2, overflow: "hidden" } }, /* @__PURE__ */ React.createElement("div", { style: { width: `${dp}%`, height: "100%", background: dp >= 100 ? "#f74f4f" : dp >= 75 ? C.y : v.color, borderRadius: 2 } })))
        );
      }));
    }))));
  }
  function MonthView({ termine, activeV, onDayClick, activeStatus }) {
    const activeVList = VERTRIEBLER.filter((v) => activeV[v.id]);
    const filtered = termine.filter((t) => activeStatus[t.status]);
    const calDays = [];
    for (let i = 0; i < febStartDow; i++) calDays.push(null);
    FEB_DAYS.forEach((d) => calDays.push(d));
    while (calDays.length % 7 !== 0) calDays.push(null);
    const DOW = ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"];
    const monthAuftraege = filtered.filter((t) => t.status === "auftrag").length;
    const monthTotal = filtered.length;
    return /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 20px", background: C.c2, borderBottom: "1px solid " + C.bd, display: "flex", gap: 16, flexWrap: "wrap", alignItems: "center" } }, activeVList.map((v) => {
      const vt = filtered.filter((t) => t.vertriebId === v.id);
      const va = vt.filter((t) => t.status === "auftrag").length;
      const cr = vt.length > 0 ? Math.round(va / vt.length * 100) : 0;
      const ausl = vt.length / (20 * MAX_PER_DAY) * 100;
      return /* @__PURE__ */ React.createElement("div", { key: v.id, style: { background: C.c1, border: "1px solid " + v.color + "44", borderRadius: 10, padding: "5px 10px", display: "flex", alignItems: "center", gap: 7, minWidth: 140 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 22, height: 22, borderRadius: "50%", background: v.color + "22", border: "2px solid " + v.color, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 8, fontWeight: 800, color: v.color, flexShrink: 0 } }, v.id.slice(0, 2)), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: C.tx } }, v.name.split(" ")[0]), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 5, alignItems: "center", marginTop: 1 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: C.dm } }, vt.length, "T"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: "#34d399", fontWeight: 700 } }, va, "A"), /* @__PURE__ */ React.createElement(ConversionBadge, { termine: vt })), /* @__PURE__ */ React.createElement(AuslastungsBar, { pct: ausl, color: v.color, small: true })));
    })), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 20px" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(7,1fr)", gap: 3, marginBottom: 5 } }, DOW.map((d) => /* @__PURE__ */ React.createElement("div", { key: d, style: { textAlign: "center", fontSize: 10, fontWeight: 700, color: d === "So" || d === "Sa" ? "#5c6b8a55" : C.dm, padding: "4px 0" } }, d))), Array.from({ length: calDays.length / 7 }, (_, wi) => /* @__PURE__ */ React.createElement("div", { key: wi, style: { display: "grid", gridTemplateColumns: "repeat(7,1fr)", gap: 3, marginBottom: 3 } }, calDays.slice(wi * 7, wi * 7 + 7).map((datum, di) => {
      if (!datum) return /* @__PURE__ */ React.createElement("div", { key: di, style: { aspectRatio: "1", borderRadius: 8, background: C.c1 + "33" } });
      const isToday = datum === TODAY;
      const isSun = di === 0, isSat = di === 6;
      const dt = filtered.filter((t) => t.datum === datum);
      const cnt = dt.length;
      const hasA = dt.some((t) => t.status === "auftrag");
      const heat = Math.min(1, cnt / (MAX_PER_DAY * activeVList.length || 1));
      const dayNum = datum.split("-")[2];
      return /* @__PURE__ */ React.createElement(
        "div",
        {
          key: datum,
          onClick: () => onDayClick(datum),
          style: { aspectRatio: "1", borderRadius: 8, border: "1px solid " + (isToday ? C.y : isSun || isSat ? C.bd + "44" : C.bd + "88"), background: isToday ? C.y + "15" : isSun || isSat ? C.c1 + "44" : C.c1, cursor: "pointer", padding: 4, display: "flex", flexDirection: "column", transition: "border-color 0.1s", position: "relative", overflow: "hidden" },
          onMouseEnter: (e) => e.currentTarget.style.borderColor = isToday ? C.y : C.y + "88",
          onMouseLeave: (e) => e.currentTarget.style.borderColor = isToday ? C.y : isSun || isSat ? C.bd + "44" : C.bd + "88"
        },
        heat > 0 && /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", inset: 0, background: C.y + Math.round(heat * 28).toString(16).padStart(2, "0"), borderRadius: 7, pointerEvents: "none" } }),
        /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "flex-start", justifyContent: "space-between", position: "relative" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: isToday ? 800 : 600, color: isToday ? C.y : isSun || isSat ? C.dm + "55" : C.dm } }, dayNum), hasA && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 7, fontWeight: 800, color: "#34d399", background: "#34d39922", padding: "1px 3px", borderRadius: 3 } }, "A")),
        cnt > 0 && /* @__PURE__ */ React.createElement("div", { style: { marginTop: "auto", position: "relative" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 1, flexWrap: "wrap", marginBottom: 1 } }, activeVList.map((v) => {
          const vc = dt.filter((t) => t.vertriebId === v.id).length;
          if (!vc) return null;
          return /* @__PURE__ */ React.createElement("div", { key: v.id, style: { width: 6, height: 6, borderRadius: "50%", background: v.color, opacity: 0.9 } });
        })), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: C.tx, fontWeight: 700 } }, cnt))
      );
    })))));
  }
  function TerminModal({ termin, v, onSave, onClose }) {
    const [dauer, setDauer] = (0, import_react.useState)(termin.dauer);
    const [zeitM, setZeitM] = (0, import_react.useState)(termin.zeit);
    const [status, setStatus] = (0, import_react.useState)(termin.status);
    return /* @__PURE__ */ React.createElement("div", { style: { position: "fixed", inset: 0, background: "#000a", display: "flex", alignItems: "center", justifyContent: "center", zIndex: 1e3, padding: 16 }, onClick: onClose }, /* @__PURE__ */ React.createElement("div", { onClick: (e) => e.stopPropagation(), style: { background: C.c1, border: "1px solid " + v.color + "55", borderRadius: 14, width: 460, maxWidth: "100%" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", padding: "14px 18px", borderBottom: "1px solid " + C.bd } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 8, height: 8, borderRadius: "50%", background: v.color } }), /* @__PURE__ */ React.createElement("span", { style: { fontWeight: 700, fontSize: 14, color: C.tx } }, termin.kunde), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: C.dm } }, "#", termin.nr), /* @__PURE__ */ React.createElement(Badge, { type: status })), /* @__PURE__ */ React.createElement("button", { onClick: onClose, style: { background: "none", border: "none", color: C.dm, fontSize: 20, cursor: "pointer" } }, "\xD7")), /* @__PURE__ */ React.createElement("div", { style: { padding: 18, display: "flex", flexDirection: "column", gap: 14 } }, /* @__PURE__ */ React.createElement("div", { style: { background: C.c2, borderRadius: 10, padding: 12, display: "grid", gridTemplateColumns: "repeat(4,1fr)", gap: 8 } }, [["Vertriebler", v.name, v.color], ["Start", m2t(zeitM), C.tx], ["Ende", m2t(zeitM + dauer), C.tx], ["Dauer", dauer + "min", C.y]].map(([l, val, col]) => /* @__PURE__ */ React.createElement("div", { key: l, style: { textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: C.dm, marginBottom: 2 } }, l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: col } }, val)))), /* @__PURE__ */ React.createElement(RangeSlider, { vonM: zeitM, bisM: zeitM + dauer, onChange: (v2, b2) => {
      setZeitM(v2);
      setDauer(b2 - v2);
    } }), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, flexWrap: "wrap" } }, [60, 90, 120, 150, 180].map((d) => /* @__PURE__ */ React.createElement("button", { key: d, onClick: () => setDauer(d), style: { padding: "5px 12px", borderRadius: 7, border: "1.5px solid " + (dauer === d ? C.y : C.bd), background: dauer === d ? C.y + "22" : "transparent", color: dauer === d ? C.y : C.dm, fontSize: 12, fontWeight: 700, cursor: "pointer", fontFamily: "'DM Sans',sans-serif" } }, d, "min"))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, flexWrap: "wrap" } }, Object.entries(STATUS_CFG).map(([k, s]) => /* @__PURE__ */ React.createElement("button", { key: k, onClick: () => setStatus(k), style: { display: "flex", alignItems: "center", gap: 5, padding: "5px 10px", borderRadius: 7, border: "1.5px solid " + (status === k ? s.color : C.bd), background: status === k ? s.color + "22" : "transparent", color: status === k ? s.color : C.dm, fontSize: 11, fontWeight: 700, cursor: "pointer", fontFamily: "'DM Sans',sans-serif" } }, /* @__PURE__ */ React.createElement("span", { style: { width: 6, height: 6, borderRadius: "50%", background: status === k ? s.color : C.bd } }), s.label))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "flex-end", gap: 8 } }, /* @__PURE__ */ React.createElement("button", { onClick: onClose, style: { padding: "6px 14px", borderRadius: 8, border: "1.5px solid " + C.bd, background: "transparent", color: C.dm, fontSize: 12, fontWeight: 700, cursor: "pointer", fontFamily: "'DM Sans',sans-serif" } }, "Abbrechen"), /* @__PURE__ */ React.createElement("button", { onClick: () => {
      onSave({ ...termin, zeit: zeitM, dauer, status });
      onClose();
    }, style: { padding: "6px 14px", borderRadius: 8, border: "1.5px solid " + C.y, background: C.y + "22", color: C.y, fontSize: 12, fontWeight: 700, cursor: "pointer", fontFamily: "'DM Sans',sans-serif" } }, "Speichern")))));
  }
  function MobileTerminKarte({ t, v, onKlick }) {
    const s = STATUS_CFG[t.status];
    return /* @__PURE__ */ React.createElement(
      "div",
      {
        onClick: () => onKlick(t),
        style: { background: C.c2, borderRadius: 12, padding: "10px 14px", border: "1px solid " + s.color + "44", cursor: "pointer", transition: "border-color 0.15s,transform 0.1s", active: { transform: "scale(0.98)" } }
      },
      /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "flex-start", justifyContent: "space-between", gap: 8, marginBottom: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1, minWidth: 0 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: C.tx, whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" } }, t.kunde), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: C.dm, marginTop: 1 } }, "#", t.nr)), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", alignItems: "flex-end", gap: 3, flexShrink: 0 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 700, color: s.color, background: s.color + "22", padding: "2px 8px", borderRadius: 6 } }, s.label), t.status === "auftrag" && /* @__PURE__ */ React.createElement(Badge, { type: "auftrag" }))),
      /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 5 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 22, height: 22, borderRadius: "50%", background: v.color + "22", border: "2px solid " + v.color, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 8, fontWeight: 800, color: v.color, flexShrink: 0 } }, v.id.slice(0, 2)), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: C.dm, fontWeight: 600 } }, v.name.split(" ")[0])), /* @__PURE__ */ React.createElement("div", { style: { marginLeft: "auto", display: "flex", alignItems: "center", gap: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: C.tx } }, m2t(t.zeit)), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: C.dm } }, "\u2013", m2t(t.zeit + t.dauer)), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: C.dm } }, t.dauer, "min")))
    );
  }
  function MobileView({ termine, activeV, activeStatus, onTerminClick, selectedDate, onShift, onDayClick }) {
    const [expandedSec, setExpandedSec] = (0, import_react.useState)("alle");
    const activeVList = VERTRIEBLER.filter((v) => activeV[v.id]);
    const days = (0, import_react.useMemo)(() => {
      const result = [];
      const start = /* @__PURE__ */ new Date(selectedDate + "T12:00");
      for (let i = 0; i < 7; i++) {
        const d = new Date(start);
        d.setDate(d.getDate() + i);
        const datum = d.toISOString().slice(0, 10);
        if (datum >= "2026-02-01" && datum <= "2026-02-28") result.push(datum);
      }
      return result;
    }, [selectedDate]);
    const filtered = (0, import_react.useMemo)(() => termine.filter((t) => activeStatus[t.status] && activeV[t.vertriebId]), [termine, activeStatus, activeV]);
    const DOW = ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"];
    const todayT = filtered.filter((t) => t.datum === selectedDate);
    const todayA = todayT.filter((t) => t.status === "auftrag").length;
    const todayCR = todayT.length > 0 ? Math.round((todayA / todayT.filter((t) => t.status !== "storniert").length || 1) * 100) : 0;
    return /* @__PURE__ */ React.createElement("div", { style: { background: C.bg, minHeight: "100vh", paddingBottom: 80 } }, /* @__PURE__ */ React.createElement("div", { style: { background: C.c1, borderBottom: "1px solid " + C.bd, padding: "8px 16px" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("button", { onClick: () => onShift(-1), style: { width: 34, height: 34, borderRadius: 8, border: "1px solid " + C.bd, background: C.c2, color: C.dm, fontSize: 18, cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", fontFamily: "sans-serif", flexShrink: 0 } }, "\u2039"), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: selectedDate === TODAY ? C.y : C.tx } }, DOW[(/* @__PURE__ */ new Date(selectedDate + "T12:00")).getDay()], ", ", selectedDate.split("-")[2], ".", selectedDate.split("-")[1], ".", selectedDate.split("-")[0], selectedDate === TODAY && " \xB7 Heute"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: C.dm, marginTop: 1 } }, todayT.length, " Termine \xB7 ", todayA, " Auftr\xE4ge", todayT.length > 0 ? " \xB7 CR " + todayCR + "%" : "")), /* @__PURE__ */ React.createElement("button", { onClick: () => onShift(1), style: { width: 34, height: 34, borderRadius: 8, border: "1px solid " + C.bd, background: C.c2, color: C.dm, fontSize: 18, cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", fontFamily: "sans-serif", flexShrink: 0 } }, "\u203A")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 4, overflowX: "auto", paddingBottom: 2 } }, days.map((d) => {
      const cnt = filtered.filter((t) => t.datum === d).length;
      const hasA = filtered.some((t) => t.datum === d && t.status === "auftrag");
      const isToday = d === TODAY;
      const isSel = d === selectedDate;
      const dow = (/* @__PURE__ */ new Date(d + "T12:00")).getDay();
      const dayNum = d.split("-")[2];
      return /* @__PURE__ */ React.createElement(
        "div",
        {
          key: d,
          onClick: () => onDayClick(d),
          style: { flex: "0 0 auto", width: 42, textAlign: "center", padding: "6px 4px", borderRadius: 10, cursor: "pointer", background: isSel ? C.y : isToday ? C.y + "22" : "transparent", border: "1px solid " + (isSel ? C.y : isToday ? C.y + "44" : C.bd + "44"), transition: "all 0.15s", position: "relative" }
        },
        /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 600, color: isSel ? C.bg : C.dm, marginBottom: 2 } }, ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"][dow]),
        /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: isSel ? C.bg : isToday ? C.y : dow === 0 || dow === 6 ? C.dm : C.tx } }, dayNum),
        cnt > 0 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: isSel ? C.bg : C.y, marginTop: 2 } }, cnt),
        cnt === 0 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: isSel ? C.bg + "88" : C.bd, marginTop: 2 } }, "\u2013"),
        hasA && /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", top: 3, right: 3, width: 6, height: 6, borderRadius: "50%", background: isSel ? C.bg : "#34d399" } })
      );
    }))), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 16px 0", display: "flex", gap: 6, overflowX: "auto" } }, /* @__PURE__ */ React.createElement(
      "button",
      {
        onClick: () => setExpandedSec("alle"),
        style: { padding: "5px 14px", borderRadius: 20, border: "1.5px solid " + (expandedSec === "alle" ? C.y : C.bd), background: expandedSec === "alle" ? C.y + "22" : "transparent", color: expandedSec === "alle" ? C.y : C.dm, fontSize: 12, fontWeight: 700, cursor: "pointer", fontFamily: "'DM Sans',sans-serif", whiteSpace: "nowrap", flexShrink: 0 }
      },
      "Alle (",
      todayT.length,
      ")"
    ), activeVList.map((v) => {
      const vc = filtered.filter((t) => t.datum === selectedDate && t.vertriebId === v.id).length;
      const isActive = expandedSec === v.id;
      return /* @__PURE__ */ React.createElement(
        "button",
        {
          key: v.id,
          onClick: () => setExpandedSec(isActive ? "alle" : v.id),
          style: { display: "flex", alignItems: "center", gap: 5, padding: "5px 10px 5px 6px", borderRadius: 20, border: "1.5px solid " + (isActive ? v.color : C.bd), background: isActive ? v.color + "22" : "transparent", color: isActive ? C.tx : C.dm, fontSize: 12, fontWeight: 600, cursor: "pointer", fontFamily: "'DM Sans',sans-serif", whiteSpace: "nowrap", flexShrink: 0 }
        },
        /* @__PURE__ */ React.createElement("div", { style: { width: 18, height: 18, borderRadius: "50%", background: isActive ? v.color : C.bd, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 7, fontWeight: 800, color: isActive ? "#0c1222" : C.bg } }, v.id.slice(0, 2)),
        v.name.split(" ")[0],
        " ",
        vc > 0 && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 800, color: isActive ? v.color : C.dm + "88" } }, "(", vc, ")")
      );
    })), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 16px", display: "flex", flexDirection: "column", gap: 8 } }, (() => {
      const dayT = filtered.filter((t) => t.datum === selectedDate);
      const show = expandedSec === "alle" ? dayT : dayT.filter((t) => t.vertriebId === expandedSec);
      const sorted = show.slice().sort((a, b) => a.zeit - b.zeit);
      if (sorted.length === 0) return /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", padding: "40px 20px", color: C.dm } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 32, marginBottom: 10 } }, "\u{1F4C5}"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 600 } }, "Keine Termine"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, marginTop: 4 } }, "f\xFCr diesen Tag / Filter"));
      const groups = {};
      sorted.forEach((t) => {
        const h = Math.floor(t.zeit / 60);
        const key = h < 12 ? "Vormittag" : h < 17 ? "Nachmittag" : "Abend";
        if (!groups[key]) groups[key] = [];
        groups[key].push(t);
      });
      return Object.entries(groups).map(([label, items]) => /* @__PURE__ */ React.createElement("div", { key: label }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: C.dm, textTransform: "uppercase", letterSpacing: "0.08em", marginBottom: 6, marginTop: 4 } }, label), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 6 } }, items.map((t) => {
        const v = VERTRIEBLER.find((x) => x.id === t.vertriebId);
        return /* @__PURE__ */ React.createElement(MobileTerminKarte, { key: t.id, t, v, onKlick: onTerminClick });
      }))));
    })()), expandedSec === "alle" && todayT.length > 0 && /* @__PURE__ */ React.createElement("div", { style: { margin: "0 16px 16px", background: C.c1, borderRadius: 14, padding: "12px 14px", border: "1px solid " + C.bd } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: C.dm, textTransform: "uppercase", letterSpacing: "0.07em", marginBottom: 10 } }, "Team Auslastung \xB7 Heute"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 8 } }, activeVList.map((v) => {
      const vt = filtered.filter((t) => t.datum === selectedDate && t.vertriebId === v.id);
      const va = vt.filter((t) => t.status === "auftrag").length;
      const pct2 = Math.min(100, vt.length / MAX_PER_DAY * 100);
      const col = pct2 >= 100 ? "#f74f4f" : pct2 >= 75 ? C.y : pct2 >= 50 ? "#4f8ef7" : "#34d399";
      if (vt.length === 0) return null;
      return /* @__PURE__ */ React.createElement("div", { key: v.id, style: { display: "flex", alignItems: "center", gap: 10 }, onClick: () => setExpandedSec(v.id) }, /* @__PURE__ */ React.createElement("div", { style: { width: 28, height: 28, borderRadius: "50%", background: v.color + "22", border: "2px solid " + v.color, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 9, fontWeight: 800, color: v.color, flexShrink: 0 } }, v.id.slice(0, 2)), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, minWidth: 0 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 3 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 700, color: C.tx } }, v.name.split(" ")[0]), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, alignItems: "center" } }, va > 0 && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: "#34d399", fontWeight: 700 } }, "+", va, "A"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 700, color: col } }, Math.round(pct2), "%"))), /* @__PURE__ */ React.createElement("div", { style: { height: 5, background: C.bd + "55", borderRadius: 3, overflow: "hidden" } }, /* @__PURE__ */ React.createElement("div", { style: { width: `${pct2}%`, height: "100%", background: col, borderRadius: 3, transition: "width 0.3s" } }))));
    }))));
  }
  function App() {
    const [view, setView] = (0, import_react.useState)("tag");
    const [activeStatus, setActiveStatus] = (0, import_react.useState)(Object.keys(STATUS_CFG).reduce((a, k) => ({ ...a, [k]: true }), {}));
    const [activeV, setActiveV] = (0, import_react.useState)(VERTRIEBLER.reduce((a, v) => ({ ...a, [v.id]: true }), {}));
    const [az] = (0, import_react.useState)(INIT_AZ);
    const [termine, setTermine] = (0, import_react.useState)(TERMINE_DATA);
    const [terminModal, setTerminModal] = (0, import_react.useState)(null);
    const [selectedDate, setSelectedDate] = (0, import_react.useState)(TODAY);
    const [isMobile, setIsMobile] = (0, import_react.useState)(() => typeof window !== "undefined" && window.innerWidth < 768);
    (0, import_react.useEffect)(() => {
      const check = () => setIsMobile(window.innerWidth < 768);
      window.addEventListener("resize", check);
      return () => window.removeEventListener("resize", check);
    }, []);
    const activeVList = VERTRIEBLER.filter((v) => activeV[v.id]);
    const allVActive = VERTRIEBLER.every((v) => activeV[v.id]);
    const dayTermine = (0, import_react.useMemo)(() => termine.filter((t) => t.datum === selectedDate && activeStatus[t.status] && activeV[t.vertriebId]), [termine, selectedDate, activeStatus, activeV]);
    const allFiltered = (0, import_react.useMemo)(() => termine.filter((t) => activeStatus[t.status] && activeV[t.vertriebId]), [termine, activeStatus, activeV]);
    const kpis = (0, import_react.useMemo)(() => {
      const scope = view === "tag" ? dayTermine : view === "woche" ? allFiltered.filter((t) => t.datum >= "2026-02-16" && t.datum <= "2026-02-22") : allFiltered;
      const eff = scope.filter((t) => t.status !== "storniert");
      return {
        total: scope.length,
        auftraege: scope.filter((t) => t.status === "auftrag").length,
        storniert: scope.filter((t) => t.status === "storniert").length,
        offen: scope.filter((t) => t.status === "offen").length,
        cr: eff.length > 0 ? Math.round(scope.filter((t) => t.status === "auftrag").length / eff.length * 100) : 0
      };
    }, [view, dayTermine, allFiltered]);
    const handleDrop = (tid, newTime) => {
      setTermine((p) => p.map((t) => t.id === tid ? { ...t, zeit: Math.max(GS, Math.min(newTime, GE - t.dauer)) } : t)); var _mt = termine.find(function(t){return t.id===tid}); if(_mt && window.saveTerminToSB) window.saveTerminToSB({..._mt, zeit: Math.max(GS, Math.min(newTime, GE - _mt.dauer))});
    };
    const handleDayClick = (datum) => {
      setSelectedDate(datum);
      setView("tag");
    };
    const shiftDay = (delta) => {
      const dt = /* @__PURE__ */ new Date(selectedDate + "T12:00");
      dt.setDate(dt.getDate() + delta);
      const nd = dt.toISOString().slice(0, 10);
      if (nd >= "2026-02-01" && nd <= "2026-02-28") setSelectedDate(nd);
    };
    const dateLabel = (d) => {
      const dw = ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"];
      const dt = /* @__PURE__ */ new Date(d + "T12:00");
      return `${dw[dt.getDay()]}, ${d.split("-")[2]}.${d.split("-")[1]}.${d.split("-")[0]}`;
    };
    const days = view === "tag" ? 1 : view === "woche" ? 5 : 20;
    const auslGesamt = kpis.total / (days * MAX_PER_DAY * activeVList.length || 1) * 100;
    const dayConflictCount = (0, import_react.useMemo)(() => {
      let total = 0;
      activeVList.forEach((v) => {
        const vt = dayTermine.filter((t) => t.vertriebId === v.id);
        for (let i = 0; i < vt.length; i++) for (let j = i + 1; j < vt.length; j++) {
          if (vt[i].zeit < vt[j].zeit + vt[j].dauer && vt[i].zeit + vt[i].dauer > vt[j].zeit) total++;
        }
      });
      return total;
    }, [dayTermine, activeVList]);
    return /* @__PURE__ */ React.createElement("div", { style: { background: C.bg, minHeight: "100vh", fontFamily: "'DM Sans',sans-serif", color: C.tx } }, /* @__PURE__ */ React.createElement("link", { href: "https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap", rel: "stylesheet" }), /* @__PURE__ */ React.createElement("div", { style: { background: C.c1, borderBottom: "1px solid " + C.bd, padding: "10px 20px", display: "flex", alignItems: "center", justifyContent: "space-between", gap: 12, flexWrap: "wrap" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 800, letterSpacing: "0.1em", color: C.y, textTransform: "uppercase" } }, "bee-doo"), /* @__PURE__ */ React.createElement("span", { style: { color: C.bd } }, "|"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 15, fontWeight: 700 } }, "Vertriebskalender"), /* @__PURE__ */ React.createElement("span", { style: { background: C.c2, border: "1px solid " + C.bd, borderRadius: 6, padding: "2px 8px", fontSize: 10, color: C.dm } }, "Feb 2026")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, alignItems: "center" } }, /* @__PURE__ */ React.createElement(
      "button",
      {
        onClick: () => setIsMobile((p) => !p),
        title: isMobile ? "Desktop-Ansicht" : "Mobile-Ansicht",
        style: { width: 32, height: 32, borderRadius: 8, border: "1.5px solid " + (isMobile ? C.y : C.bd), background: isMobile ? C.y + "22" : "transparent", color: isMobile ? C.y : C.dm, cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 16, flexShrink: 0 }
      },
      isMobile ? "\u{1F5A5}" : "\u{1F4F1}"
    ), !isMobile && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 3, background: C.c2, borderRadius: 10, padding: 3 } }, [["tag", "Tag"], ["woche", "Woche"], ["monat", "Monat"]].map(([v, l]) => /* @__PURE__ */ React.createElement("button", { key: v, onClick: () => setView(v), style: { padding: "5px 14px", borderRadius: 7, border: "none", background: view === v ? C.y : "transparent", color: view === v ? C.bg : C.dm, fontWeight: 700, fontSize: 12, cursor: "pointer", fontFamily: "'DM Sans',sans-serif", transition: "all 0.15s" } }, l))))), /* @__PURE__ */ React.createElement("div", { style: { background: C.c2, borderBottom: "1px solid " + C.bd, padding: "6px 20px", display: "flex", gap: 16, alignItems: "center", flexWrap: "wrap" } }, [[kpis.total, "Gesamt", C.tx], [kpis.auftraege, "Auftr\xE4ge", "#34d399"], [kpis.offen, "Offen", C.y], [kpis.storniert, "Storniert", "#5c6b8a"]].map(([val, l, col]) => /* @__PURE__ */ React.createElement("div", { key: l, style: { display: "flex", alignItems: "center", gap: 5 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: C.dm } }, l, ":"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14, fontWeight: 800, color: col } }, val))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 5 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: C.dm } }, "CR:"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, fontWeight: 700, color: kpis.cr >= 25 ? "#34d399" : kpis.cr >= 15 ? C.y : "#f74f4f" } }, kpis.cr, "%")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 5 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: C.dm } }, "Auslastung:"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, fontWeight: 700, color: auslGesamt >= 90 ? "#f74f4f" : auslGesamt >= 60 ? C.y : C.tx } }, Math.round(auslGesamt), "%")), dayConflictCount > 0 && view === "tag" && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 5, background: "#f7444422", borderRadius: 6, padding: "2px 8px", border: "1px solid #f7444488" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12 } }, "\u26A0\uFE0F"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: "#f74f4f", fontWeight: 700 } }, dayConflictCount, " Konflikt", dayConflictCount > 1 ? "e" : ""))), /* @__PURE__ */ React.createElement("div", { style: { background: C.c1, borderBottom: "1px solid " + C.bd, padding: "8px 20px", display: "flex", flexDirection: "column", gap: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6, flexWrap: "wrap" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: C.dm, fontWeight: 700, textTransform: "uppercase", letterSpacing: "0.07em", minWidth: 50 } }, "Status"), Object.entries(STATUS_CFG).map(([k, s]) => /* @__PURE__ */ React.createElement("button", { key: k, onClick: () => setActiveStatus((p) => ({ ...p, [k]: !p[k] })), style: { display: "flex", alignItems: "center", gap: 4, padding: "3px 9px", borderRadius: 7, border: "1.5px solid " + (activeStatus[k] ? s.color : C.bd), background: activeStatus[k] ? s.color + "22" : "transparent", color: activeStatus[k] ? s.color : C.dm, fontSize: 11, fontWeight: 700, cursor: "pointer", fontFamily: "'DM Sans',sans-serif" } }, /* @__PURE__ */ React.createElement("span", { style: { width: 5, height: 5, borderRadius: "50%", background: activeStatus[k] ? s.color : C.bd } }), s.label))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 5, flexWrap: "wrap" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: C.dm, fontWeight: 700, textTransform: "uppercase", letterSpacing: "0.07em", minWidth: 50 } }, "Team"), /* @__PURE__ */ React.createElement("button", { onClick: () => setActiveV(VERTRIEBLER.reduce((a, v) => ({ ...a, [v.id]: !allVActive }), {})), style: { padding: "3px 9px", borderRadius: 14, border: "1.5px solid " + (allVActive ? C.y : C.bd), background: allVActive ? C.y + "22" : "transparent", color: allVActive ? C.y : C.dm, fontSize: 11, fontWeight: 700, cursor: "pointer", fontFamily: "'DM Sans',sans-serif" } }, "Alle"), VERTRIEBLER.map((v) => /* @__PURE__ */ React.createElement("button", { key: v.id, onClick: () => setActiveV((p) => ({ ...p, [v.id]: !p[v.id] })), style: { display: "flex", alignItems: "center", gap: 4, padding: "3px 9px 3px 5px", borderRadius: 14, border: "1.5px solid " + (activeV[v.id] ? v.color : C.bd), background: activeV[v.id] ? v.color + "18" : "transparent", color: activeV[v.id] ? C.tx : C.dm, fontSize: 11, fontWeight: 600, cursor: "pointer", fontFamily: "'DM Sans',sans-serif", whiteSpace: "nowrap" } }, /* @__PURE__ */ React.createElement("span", { style: { width: 16, height: 16, borderRadius: "50%", background: activeV[v.id] ? v.color : C.bd, color: activeV[v.id] ? "#0c1222" : C.dm, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 7, fontWeight: 800, flexShrink: 0 } }, v.id.slice(0, 2)), v.name.split(" ")[0])))), view === "tag" && /* @__PURE__ */ React.createElement("div", { style: { background: C.c1, borderBottom: "1px solid " + C.bd, padding: "6px 20px", display: "flex", alignItems: "center", gap: 10 } }, /* @__PURE__ */ React.createElement("button", { onClick: () => shiftDay(-1), style: { background: C.c2, border: "1px solid " + C.bd, borderRadius: 7, color: C.dm, padding: "3px 10px", cursor: "pointer", fontSize: 13, fontFamily: "'DM Sans',sans-serif" } }, "\u2039"), /* @__PURE__ */ React.createElement("span", { style: { fontWeight: 700, fontSize: 13, color: selectedDate === TODAY ? C.y : C.tx } }, dateLabel(selectedDate), selectedDate === TODAY ? " \xB7 Heute" : ""), /* @__PURE__ */ React.createElement("button", { onClick: () => shiftDay(1), style: { background: C.c2, border: "1px solid " + C.bd, borderRadius: 7, color: C.dm, padding: "3px 10px", cursor: "pointer", fontSize: 13, fontFamily: "'DM Sans',sans-serif" } }, "\u203A"), selectedDate !== TODAY && /* @__PURE__ */ React.createElement("button", { onClick: () => setSelectedDate(TODAY), style: { marginLeft: "auto", padding: "3px 12px", borderRadius: 7, border: "1.5px solid " + C.y, background: C.y + "22", color: C.y, fontSize: 11, fontWeight: 700, cursor: "pointer", fontFamily: "'DM Sans',sans-serif" } }, "Heute"), /* @__PURE__ */ React.createElement("span", { style: { marginLeft: "auto", fontSize: 10, color: C.dm, fontStyle: "italic" } }, "\u2194 Termine verschiebbar")), isMobile ? /* @__PURE__ */ React.createElement(
      MobileView,
      {
        termine,
        activeV,
        activeStatus,
        onTerminClick: (t) => {
          const v = VERTRIEBLER.find((x) => x.id === t.vertriebId);
          setTerminModal({ t, v });
        },
        selectedDate,
        onShift: shiftDay,
        onDayClick: (d) => setSelectedDate(d)
      }
    ) : /* @__PURE__ */ React.createElement(React.Fragment, null, view === "tag" && /* @__PURE__ */ React.createElement("div", { style: { overflowX: "auto" } }, /* @__PURE__ */ React.createElement("div", { style: { minWidth: 1100 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", borderBottom: "1px solid " + C.bd, background: C.c1, position: "sticky", top: 0, zIndex: 20 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 200, flexShrink: 0, borderRight: "1px solid " + C.bd, padding: "7px 14px", position: "sticky", left: 0, zIndex: 22, background: C.c1, boxShadow: "4px 0 12px #00000044" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: C.dm, fontWeight: 600 } }, "RESSOURCEN")), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, position: "relative", height: 30 } }, HOURS.map((h) => /* @__PURE__ */ React.createElement("div", { key: h, style: { position: "absolute", left: `${(h * 60 - GS) / GSP * 100}%`, top: 0, bottom: 0, display: "flex", alignItems: "center", paddingLeft: 4 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: C.dm, fontWeight: 600 } }, String(h).padStart(2, "0"), ":00"))))), activeVList.map((v) => /* @__PURE__ */ React.createElement(
      DayRow,
      {
        key: v.id,
        v,
        termine: dayTermine.filter((t) => t.vertriebId === v.id),
        az: az[v.id] || {},
        blocks: BLOCKS.filter((b) => b.vertriebId === v.id && b.datum === selectedDate),
        onTerminClick: (t) => setTerminModal({ t, v }),
        period: "tag",
        allTermine: termine,
        displayDate: selectedDate,
        onDrop: handleDrop
      }
    )))), view === "woche" && /* @__PURE__ */ React.createElement(WeekView, { termine: allFiltered, activeV, onDayClick: handleDayClick, activeStatus }), view === "monat" && /* @__PURE__ */ React.createElement(MonthView, { termine: allFiltered, activeV, onDayClick: handleDayClick, activeStatus })), terminModal && /* @__PURE__ */ React.createElement(
      TerminModal,
      {
        termin: terminModal.t,
        v: terminModal.v,
        onSave: (t) => { setTermine((p) => p.map((x) => x.id === t.id ? t : x)); if (window.saveTerminToSB) window.saveTerminToSB(t); },
        onClose: () => setTerminModal(null)
      }
    ));
  }
  return __toCommonJS(app_exports);
})();

</script>
<script>
// Show loading indicator
document.getElementById('root').innerHTML = '<div style="display:flex;align-items:center;justify-content:center;min-height:100vh;font-family:DM Sans,sans-serif"><div style="text-align:center"><div style="font-size:32px;margin-bottom:12px">🐝</div><div style="color:#F5C500;font-weight:700;font-size:16px">bee-doo Kalender</div><div style="color:#5c6b8a;font-size:13px;margin-top:6px">Lade Termine aus Supabase...</div></div></div>';

// Load data from Supabase, then render
window.loadSBData().then(function() {
  try {
    var root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(BeeDooApp.default));
  } catch(e) {
    document.getElementById('root').innerHTML =
      '<div style="color:#f74f4f;padding:40px;font-family:monospace;font-size:12px;white-space:pre-wrap">' +
      e.message + '\n\n' + e.stack + '</div>';
  }
});
</script>

<script>
// Hint toast - always show
(function(){
  const isMob = window.innerWidth < 768;
  const DURATION = 8000; // 8 seconds

  // Arrow pointing to top-right toggle button
  const arrowSvg = `<svg width="60" height="40" viewBox="0 0 60 40" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:block">
    <path d="M4 36 Q10 10 52 4" stroke="#FDE154" stroke-width="2" stroke-dasharray="4 3" fill="none" stroke-linecap="round"/>
    <polygon points="52,4 44,8 50,14" fill="#FDE154"/>
  </svg>`;

  const el = document.createElement('div');
  el.id = 'hint-toast';
  el.innerHTML = `
    <div style="display:flex;align-items:flex-start;gap:12px;">
      <span style="font-size:26px;flex-shrink:0">${isMob ? '📱' : '🖥'}</span>
      <div style="flex:1">
        <div style="font-size:13px;font-weight:700;color:#e1e7ef;margin-bottom:5px;">
          ${isMob ? 'Mobile-Ansicht aktiv' : 'Desktop-Ansicht aktiv'}
        </div>
        <div style="font-size:12px;color:#8899bb;line-height:1.6;">
          Das System erkennt dein Gerät automatisch und wählt die beste Ansicht.<br>
          Mit dem <strong style="color:#FDE154">${isMob ? '🖥' : '📱'}-Symbol</strong> oben rechts kannst du jederzeit umschalten.
        </div>
      </div>
      <button onclick="dismissHint()" style="background:none;border:none;color:#5c6b8a;font-size:22px;cursor:pointer;padding:0;line-height:1;flex-shrink:0;margin-top:-2px;">×</button>
    </div>
    <div style="display:flex;justify-content:flex-end;margin-top:4px;margin-right:8px;opacity:0.9">
      ${arrowSvg}
    </div>
    <div id="hint-progress" style="margin-top:6px;height:3px;background:#263354;border-radius:2px;overflow:hidden;">
      <div id="hint-bar" style="height:100%;background:#FDE154;border-radius:2px;width:100%;transition:width ${DURATION/1000}s linear;"></div>
    </div>
  `;

  Object.assign(el.style, {
    position: 'fixed',
    top: '64px',
    right: '12px',
    background: '#151d30',
    border: '1.5px solid #FDE15444',
    borderRadius: '14px',
    padding: '14px 16px 12px',
    width: 'min(320px, calc(100vw - 24px))',
    boxShadow: '0 8px 32px rgba(0,0,0,0.6)',
    zIndex: '9999',
    fontFamily: "'DM Sans', sans-serif",
    opacity: '0',
    transform: 'translateY(-8px)',
    transition: 'opacity 0.35s ease, transform 0.35s ease',
  });

  document.body.appendChild(el);

  requestAnimationFrame(() => requestAnimationFrame(() => {
    el.style.opacity = '1';
    el.style.transform = 'translateY(0)';
    setTimeout(() => {
      const bar = document.getElementById('hint-bar');
      if(bar) bar.style.width = '0%';
    }, 100);
  }));

  window.dismissHint = function() {
    el.style.opacity = '0';
    el.style.transform = 'translateY(-8px)';
    setTimeout(() => { if(el.parentNode) el.remove(); }, 350);
  };

  setTimeout(window.dismissHint, DURATION);
})();
</script>
</body>
</html>
