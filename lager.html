<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>bee-doo Â· LAGER</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“¦</text></svg>" />
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0c1222; color: #e1e7ef; font-family: 'DM Sans', system-ui, sans-serif; }
  button, select, input, textarea { font-family: inherit; }
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: #263354; border-radius: 2px; }
  .back-btn { position: fixed; top: 10px; left: 10px; z-index: 9999; background: #151d30; border: 1px solid #263354; color: #5c6b8a; padding: 6px 14px; border-radius: 8px; font-size: 12px; font-family: 'DM Sans', sans-serif; cursor: pointer; text-decoration: none; transition: all .15s; }
  .back-btn:hover { border-color: #FDE154; color: #FDE154; }
</style>
</head>
<body>
<a href="index.html" class="back-btn">â† Launcher</a>
<div id="root"></div>
<script type="text/babel">
const { useState, useMemo } = React;

const Y="#FDE154",BG="#0c1222",C1="#151d30",C2="#1c2640",BR="#263354",TX="#e1e7ef",TX2="#5c6b8a";
const OK="#34d399",WARN="#f59e0b",ERR="#f87171",PURPLE="#E879F9",BLUE="#60A5FA";
const FARBEN=[BLUE,OK,PURPLE,WARN,"#F472B6","#2DD4BF",Y,ERR];
const KATEGORIEN=["Alle","Wechselrichter","Batterie","ZubehÃ¶r","ZÃ¤hlerschrank","PV-Module","Kabel"];
const CARD={background:C1,border:`1px solid ${BR}`,borderRadius:12,padding:"16px"};
const INPUT={background:C2,border:`1px solid ${BR}`,borderRadius:8,color:TX,padding:"8px 12px",fontSize:13,width:"100%",boxSizing:"border-box",outline:"none"};

const INIT_ARTIKEL=[
  {id:"WR-50", name:"Wechselrichter 5.0 kW",  kat:"Wechselrichter", bestand:8,  min:5,  einheit:"Stk",preis:1240,serienNr:true},
  {id:"WR-80", name:"Wechselrichter 8.0 kW",  kat:"Wechselrichter", bestand:3,  min:5,  einheit:"Stk",preis:1480,serienNr:true},
  {id:"WR-100",name:"Wechselrichter 10.0 kW", kat:"Wechselrichter", bestand:5,  min:3,  einheit:"Stk",preis:1680,serienNr:true},
  {id:"BAT-M", name:"Batterie Master",         kat:"Batterie",       bestand:10, min:5,  einheit:"Stk",preis:2100,serienNr:true},
  {id:"BAT-S", name:"Batterie Slave",          kat:"Batterie",       bestand:18, min:10, einheit:"Stk",preis:1800,serienNr:true},
  {id:"EPS",   name:"EPS Box",                 kat:"ZubehÃ¶r",        bestand:12, min:5,  einheit:"Stk",preis:320, serienNr:true},
  {id:"ZS-1P", name:"ZÃ¤hlerschrank 1-phasig", kat:"ZÃ¤hlerschrank",  bestand:6,  min:3,  einheit:"Stk",preis:480, serienNr:false},
  {id:"ZS-3P", name:"ZÃ¤hlerschrank 3-phasig", kat:"ZÃ¤hlerschrank",  bestand:9,  min:4,  einheit:"Stk",preis:640, serienNr:false},
  {id:"MOD-405",name:"PV-Modul 405W",          kat:"PV-Module",      bestand:84, min:40, einheit:"Stk",preis:89,  serienNr:false},
  {id:"MOD-430",name:"PV-Modul 430W",          kat:"PV-Module",      bestand:22, min:30, einheit:"Stk",preis:94,  serienNr:false},
  {id:"KAB-DC",name:"DC-Kabel 6mmÂ²",           kat:"Kabel",          bestand:325,min:100,einheit:"m",  preis:1.20,serienNr:false},
  {id:"MC4",   name:"MC4-Steckverbinder",      kat:"Kabel",          bestand:180,min:100,einheit:"Paar",preis:2.40,serienNr:false},
];

const INIT_PAKETE=[
  {id:"PKT-001",name:"Starter 5kW + 10kWh",   farbe:BLUE,  beschreibung:"Einstiegspaket fÃ¼r kleinere DachflÃ¤chen",
   komponenten:[{artikelId:"WR-50",menge:1},{artikelId:"BAT-M",menge:1},{artikelId:"BAT-S",menge:1},{artikelId:"EPS",menge:1},{artikelId:"ZS-3P",menge:1}]},
  {id:"PKT-002",name:"Standard 8kW + 15kWh",  farbe:OK,    beschreibung:"Meistverkauftes Paket fÃ¼r EinfamilienhÃ¤user",
   komponenten:[{artikelId:"WR-80",menge:1},{artikelId:"BAT-M",menge:1},{artikelId:"BAT-S",menge:2},{artikelId:"EPS",menge:1},{artikelId:"ZS-3P",menge:1}]},
  {id:"PKT-003",name:"Premium 10kW + 20kWh",  farbe:PURPLE,beschreibung:"FÃ¼r groÃŸe DachflÃ¤chen und hohen Verbrauch",
   komponenten:[{artikelId:"WR-100",menge:1},{artikelId:"BAT-M",menge:1},{artikelId:"BAT-S",menge:3},{artikelId:"EPS",menge:1},{artikelId:"ZS-3P",menge:1}]},
];

function getVerfuegbarkeit(paket, artikel) {
  let moeglich = Infinity;
  const details = paket.komponenten.map(k => {
    const art = artikel.find(a => a.id === k.artikelId);
    if (!art) return {...k, art:null, moeglich:0};
    const m = Math.floor(art.bestand / k.menge);
    if (m < moeglich) moeglich = m;
    return {...k, art, moeglich:m};
  });
  return {moeglich: moeglich===Infinity?0:moeglich, details};
}

function Badge({color, label}) {
  return <span style={{background:`${color}18`,color,border:`1px solid ${color}40`,borderRadius:6,padding:"2px 8px",fontSize:10,fontWeight:700,letterSpacing:"0.5px",display:"inline-block"}}>{label}</span>;
}

function Bar({bestand,min}) {
  const max=Math.max(min*2,bestand);
  const pct=Math.min((bestand/max)*100,100);
  const color=bestand===0?ERR:bestand<min?WARN:OK;
  return <div style={{background:BR,borderRadius:4,height:4,width:"100%"}}><div style={{width:`${pct}%`,height:"100%",background:color,borderRadius:4}}/></div>;
}

// â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const [tab,setTab]=useState("pakete");
  const [artikel,setArtikel]=useState(INIT_ARTIKEL);
  const [pakete,setPakete]=useState(INIT_PAKETE);
  const [modal,setModal]=useState(null);
  const [toast,setToast]=useState(null);

  function showToast(msg,ok=true){setToast({msg,ok});setTimeout(()=>setToast(null),3000);}

  const kritisch=artikel.filter(a=>a.bestand<a.min);
  const gesamtwert=artikel.reduce((s,a)=>s+a.bestand*a.preis,0);
  const paketeVerfuegbar=pakete.reduce((s,p)=>s+getVerfuegbarkeit(p,artikel).moeglich,0);

  const TABS=[
    {id:"pakete",   label:"Pakete",   icon:"ğŸ“‹"},
    {id:"bestand",  label:"Bestand",  icon:"ğŸ“¦"},
    {id:"ausgabe",  label:"Ausgabe",  icon:"ğŸ“¤"},
    {id:"bestellen",label:"Bestellen",icon:"ğŸ›’"},
  ];

  return (
    <div style={{fontFamily:"'DM Sans',system-ui,sans-serif",background:BG,minHeight:"100vh",color:TX,maxWidth:480,margin:"0 auto",paddingBottom:80}}>
      <div style={{background:C1,borderBottom:`1px solid ${BR}`,padding:"48px 16px 0",position:"sticky",top:0,zIndex:50}}>
        <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12}}>
          <div style={{display:"flex",alignItems:"center",gap:10}}>
            <div style={{width:36,height:36,borderRadius:10,background:`${PURPLE}20`,border:`1px solid ${PURPLE}40`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18}}>ğŸ“¦</div>
            <div>
              <div style={{fontWeight:800,fontSize:16}}>bee-doo LAGER</div>
              <div style={{fontSize:10,color:TX2}}>
                {paketeVerfuegbar} Pakete Â· {artikel.length} Artikel
                {kritisch.length>0&&<span style={{color:WARN}}> Â· {kritisch.length} kritisch</span>}
              </div>
            </div>
          </div>
          <div style={{textAlign:"right"}}>
            <div style={{fontSize:10,color:TX2}}>Lagerwert</div>
            <div style={{fontSize:14,fontWeight:700,color:Y}}>â‚¬{gesamtwert.toLocaleString("de-DE",{maximumFractionDigits:0})}</div>
          </div>
        </div>
        <div style={{display:"flex",gap:3,background:C2,borderRadius:10,padding:3}}>
          {TABS.map(t=>(
            <button key={t.id} onClick={()=>setTab(t.id)} style={{flex:1,padding:"6px 4px",borderRadius:8,border:"none",cursor:"pointer",background:tab===t.id?C1:"transparent",color:tab===t.id?TX:TX2,fontSize:9,fontWeight:700,letterSpacing:"0.3px",boxShadow:tab===t.id?`0 0 0 1px ${BR}`:"none",transition:"all 0.15s"}}>
              <div style={{fontSize:13,marginBottom:1}}>{t.icon}</div>{t.label}
            </button>
          ))}
        </div>
        <div style={{height:12}}/>
      </div>

      <div style={{padding:"12px 16px"}}>
        {tab==="pakete"    && <PaketeTab    pakete={pakete} setPakete={setPakete} artikel={artikel} setModal={setModal} showToast={showToast}/>}
        {tab==="bestand"   && <BestandTab   artikel={artikel} setArtikel={setArtikel} kritisch={kritisch} setModal={setModal} showToast={showToast}/>}
        {tab==="ausgabe"   && <AusgabeTab   pakete={pakete} artikel={artikel} setArtikel={setArtikel} showToast={showToast}/>}
        {tab==="bestellen" && <BestellenTab artikel={artikel} setArtikel={setArtikel} kritisch={kritisch} showToast={showToast}/>}
      </div>

      {modal?.type==="paketBuilder" && (
        <PaketBuilderModal
          paket={modal.data} artikel={artikel}
          onSave={p=>{
            if(modal.data) setPakete(prev=>prev.map(x=>x.id===p.id?p:x));
            else setPakete(prev=>[...prev,{...p,id:`PKT-${String(prev.length+1).padStart(3,"0")}`}]);
            setModal(null);
            showToast(modal.data?"Paket aktualisiert":"Paket angelegt");
          }}
          onDelete={id=>{setPakete(prev=>prev.filter(p=>p.id!==id));setModal(null);showToast("Paket gelÃ¶scht");}}
          onClose={()=>setModal(null)}
        />
      )}
      {modal?.type==="artikel" && (
        <ArtikelModal art={modal.data}
          onSave={a=>{
            if(modal.data) setArtikel(prev=>prev.map(x=>x.id===a.id?a:x));
            else setArtikel(prev=>[...prev,{...a,id:a.id||`ART-${Date.now()}`}]);
            setModal(null);
            showToast(modal.data?"Artikel gespeichert":"Artikel angelegt");
          }}
          onClose={()=>setModal(null)}
        />
      )}

      {toast&&(
        <div style={{position:"fixed",bottom:90,left:"50%",transform:"translateX(-50%)",background:toast.ok?`${OK}20`:`${ERR}20`,border:`1px solid ${toast.ok?OK:ERR}50`,color:toast.ok?OK:ERR,borderRadius:10,padding:"10px 18px",fontSize:13,fontWeight:600,zIndex:300,whiteSpace:"nowrap",boxShadow:"0 4px 20px #00000060"}}>
          {toast.ok?"âœ“":"!"} {toast.msg}
        </div>
      )}
    </div>
  );
}

// â”€â”€ PAKETE TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PaketeTab({pakete,setPakete,artikel,setModal,showToast}) {
  return (
    <div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:8,marginBottom:14}}>
        {[
          {label:"Pakettypen",value:pakete.length,color:PURPLE},
          {label:"Komplett verfÃ¼gbar",value:pakete.reduce((s,p)=>s+getVerfuegbarkeit(p,artikel).moeglich,0),color:OK},
          {label:"EngpÃ¤sse",value:pakete.filter(p=>getVerfuegbarkeit(p,artikel).moeglich===0).length,color:ERR},
        ].map((s,i)=>(
          <div key={i} style={{...CARD,padding:"10px 12px"}}>
            <div style={{fontSize:20,fontWeight:800,color:s.color}}>{s.value}</div>
            <div style={{fontSize:9,color:TX2,marginTop:2,lineHeight:1.3}}>{s.label}</div>
          </div>
        ))}
      </div>

      <div style={{display:"flex",flexDirection:"column",gap:10}}>
        {pakete.map(p=>{
          const {moeglich,details}=getVerfuegbarkeit(p,artikel);
          const engpass=details.find(d=>d.moeglich===moeglich&&moeglich<3);
          const pktPreis=p.komponenten.reduce((s,k)=>{const a=artikel.find(x=>x.id===k.artikelId);return s+(a?.preis||0)*k.menge;},0);
          return (
            <div key={p.id} style={{...CARD,borderColor:moeglich>0?`${p.farbe}50`:BR}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:10}}>
                <div style={{flex:1}}>
                  <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:4}}>
                    <div style={{width:8,height:8,borderRadius:"50%",background:p.farbe}}/>
                    <span style={{fontSize:10,color:TX2}}>{p.id}</span>
                    <span style={{fontSize:10,color:TX2}}>Â· â‚¬{pktPreis.toLocaleString("de-DE",{maximumFractionDigits:0})}/Stk</span>
                  </div>
                  <div style={{fontWeight:800,fontSize:15,color:TX}}>{p.name}</div>
                  <div style={{fontSize:11,color:TX2,marginTop:2}}>{p.beschreibung}</div>
                </div>
                <div style={{textAlign:"center",marginLeft:12,flexShrink:0}}>
                  <div style={{fontSize:32,fontWeight:800,color:moeglich===0?ERR:moeglich<3?WARN:OK,lineHeight:1}}>{moeglich}</div>
                  <div style={{fontSize:9,color:TX2}}>verfÃ¼gbar</div>
                </div>
              </div>

              <div style={{borderTop:`1px solid ${BR}`,paddingTop:10,display:"flex",flexDirection:"column",gap:6}}>
                {details.map((d,i)=>{
                  if(!d.art) return null;
                  const c=d.moeglich===0?ERR:d.moeglich<3?WARN:OK;
                  return (
                    <div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                      <div style={{display:"flex",alignItems:"center",gap:6}}>
                        <div style={{width:6,height:6,borderRadius:"50%",background:c,flexShrink:0}}/>
                        <span style={{fontSize:12,color:TX}}>{d.menge}Ã— {d.art.name}</span>
                      </div>
                      <span style={{fontSize:11,color:c!==OK?c:TX2}}>{d.art.bestand} im Lager</span>
                    </div>
                  );
                })}
              </div>

              {moeglich===0&&<div style={{marginTop:8,background:`${ERR}10`,border:`1px solid ${ERR}30`,borderRadius:8,padding:"6px 10px",fontSize:11,color:ERR}}>âœ• Paket aktuell nicht komplettierbar</div>}
              {engpass&&moeglich>0&&<div style={{marginTop:8,background:`${WARN}10`,border:`1px solid ${WARN}30`,borderRadius:8,padding:"6px 10px",fontSize:11,color:WARN}}>âš ï¸ Engpass: {engpass.art?.name}</div>}

              <button onClick={()=>setModal({type:"paketBuilder",data:p})} style={{width:"100%",marginTop:10,padding:"8px",borderRadius:8,border:`1px solid ${BR}`,background:"transparent",color:TX2,fontSize:11,fontWeight:600,cursor:"pointer"}}>âœï¸ Bearbeiten</button>
            </div>
          );
        })}
      </div>

      <button onClick={()=>setModal({type:"paketBuilder",data:null})} style={{width:"100%",marginTop:12,padding:"13px",borderRadius:10,border:`1px dashed ${PURPLE}60`,background:`${PURPLE}08`,color:PURPLE,fontSize:13,fontWeight:700,cursor:"pointer"}}>
        + Neues Paket erstellen
      </button>
    </div>
  );
}

// â”€â”€ PAKET BUILDER MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PaketBuilderModal({paket,artikel,onSave,onDelete,onClose}) {
  const [name,setName]=useState(paket?.name||"");
  const [beschr,setBeschr]=useState(paket?.beschreibung||"");
  const [farbe,setFarbe]=useState(paket?.farbe||BLUE);
  const [komp,setKomp]=useState(paket?.komponenten||[]);
  const [addId,setAddId]=useState(artikel[0]?.id||"");

  function add(){
    if(komp.find(k=>k.artikelId===addId)) setKomp(p=>p.map(k=>k.artikelId===addId?{...k,menge:k.menge+1}:k));
    else setKomp(p=>[...p,{artikelId:addId,menge:1}]);
  }
  function setM(id,m){
    if(m<=0) setKomp(p=>p.filter(k=>k.artikelId!==id));
    else setKomp(p=>p.map(k=>k.artikelId===id?{...k,menge:m}:k));
  }

  const preview=komp.length>0?komp.reduce((min,k)=>{
    const a=artikel.find(x=>x.id===k.artikelId);
    return a?Math.min(min,Math.floor(a.bestand/k.menge)):0;
  },Infinity)===Infinity?0:komp.reduce((min,k)=>{const a=artikel.find(x=>x.id===k.artikelId);return a?Math.min(min,Math.floor(a.bestand/k.menge)):0;},Infinity):0;

  const gesamtpreis=komp.reduce((s,k)=>{const a=artikel.find(x=>x.id===k.artikelId);return s+(a?.preis||0)*k.menge;},0);

  const canSave=name&&komp.length>0;

  return (
    <div style={{position:"fixed",inset:0,background:"#00000095",zIndex:200,display:"flex",alignItems:"flex-end",justifyContent:"center"}}>
      <div style={{background:C1,borderRadius:"16px 16px 0 0",width:"100%",maxWidth:480,maxHeight:"92vh",overflowY:"auto",padding:20,border:`1px solid ${BR}`}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:18}}>
          <div style={{fontWeight:800,fontSize:16}}>{paket?"Paket bearbeiten":"Neues Paket"}</div>
          <button onClick={onClose} style={{background:"none",border:"none",color:TX2,fontSize:22,cursor:"pointer"}}>âœ•</button>
        </div>

        <div style={{marginBottom:12}}>
          <label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Paketname *</label>
          <input style={INPUT} value={name} onChange={e=>setName(e.target.value)} placeholder="z.B. Standard 8kW + 15kWh"/>
        </div>
        <div style={{marginBottom:12}}>
          <label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Beschreibung</label>
          <input style={INPUT} value={beschr} onChange={e=>setBeschr(e.target.value)} placeholder="Kurzbeschreibung..."/>
        </div>

        <div style={{marginBottom:16}}>
          <label style={{fontSize:11,color:TX2,display:"block",marginBottom:6}}>Farbe</label>
          <div style={{display:"flex",gap:8,flexWrap:"wrap"}}>
            {FARBEN.map(f=>(
              <div key={f} onClick={()=>setFarbe(f)} style={{width:28,height:28,borderRadius:"50%",background:f,cursor:"pointer",border:farbe===f?`3px solid ${TX}`:"3px solid transparent",transition:"all 0.15s"}}/>
            ))}
          </div>
        </div>

        <div style={{marginBottom:16}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
            <label style={{fontSize:11,color:TX2,fontWeight:700,letterSpacing:"0.5px"}}>KOMPONENTEN *</label>
            {komp.length>0&&<span style={{fontSize:11,color:TX2}}>{preview} mÃ¶glich Â· â‚¬{gesamtpreis.toLocaleString("de-DE",{maximumFractionDigits:0})}/Paket</span>}
          </div>

          {komp.map(k=>{
            const a=artikel.find(x=>x.id===k.artikelId);
            if(!a) return null;
            const vm=Math.floor(a.bestand/k.menge);
            return (
              <div key={k.artikelId} style={{display:"flex",alignItems:"center",gap:8,marginBottom:8,background:C2,borderRadius:8,padding:"9px 10px"}}>
                <div style={{flex:1}}>
                  <div style={{fontSize:12,fontWeight:600,color:TX}}>{a.name}</div>
                  <div style={{fontSize:10,color:TX2}}>Lager: {a.bestand} {a.einheit} â†’ {vm} Pakete mÃ¶glich</div>
                </div>
                <div style={{display:"flex",alignItems:"center",gap:5}}>
                  <button onClick={()=>setM(k.artikelId,k.menge-1)} style={{width:28,height:28,borderRadius:6,border:`1px solid ${BR}`,background:C1,color:TX,cursor:"pointer",fontSize:16,lineHeight:1}}>âˆ’</button>
                  <span style={{fontSize:15,fontWeight:700,minWidth:22,textAlign:"center"}}>{k.menge}</span>
                  <button onClick={()=>setM(k.artikelId,k.menge+1)} style={{width:28,height:28,borderRadius:6,border:`1px solid ${BR}`,background:C1,color:TX,cursor:"pointer",fontSize:16,lineHeight:1}}>+</button>
                  <button onClick={()=>setM(k.artikelId,0)} style={{width:28,height:28,borderRadius:6,border:"none",background:`${ERR}20`,color:ERR,cursor:"pointer",fontSize:13}}>âœ•</button>
                </div>
              </div>
            );
          })}

          <div style={{display:"flex",gap:8,marginTop:10}}>
            <select style={{...INPUT,flex:1,appearance:"auto"}} value={addId} onChange={e=>setAddId(e.target.value)}>
              {artikel.map(a=><option key={a.id} value={a.id}>{a.name} ({a.bestand} {a.einheit})</option>)}
            </select>
            <button onClick={add} style={{padding:"8px 14px",borderRadius:8,border:"none",background:Y,color:BG,fontWeight:700,fontSize:13,cursor:"pointer",whiteSpace:"nowrap"}}>+ Add</button>
          </div>
        </div>

        <button onClick={()=>canSave&&onSave({id:paket?.id,name,beschreibung:beschr,farbe,komponenten:komp})} style={{width:"100%",padding:"13px",borderRadius:10,border:"none",background:canSave?Y:BR,color:canSave?BG:TX2,fontWeight:700,fontSize:14,cursor:canSave?"pointer":"default",marginBottom:8}}>
          âœ“ Paket speichern
        </button>
        {paket&&(
          <button onClick={()=>{if(window.confirm("Paket lÃ¶schen?"))onDelete(paket.id);}} style={{width:"100%",padding:"10px",borderRadius:10,border:`1px solid ${ERR}40`,background:"transparent",color:ERR,fontWeight:600,fontSize:13,cursor:"pointer"}}>
            ğŸ—‘ Paket lÃ¶schen
          </button>
        )}
      </div>
    </div>
  );
}

// â”€â”€ AUSGABE TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AusgabeTab({pakete,artikel,setArtikel,showToast}) {
  const [gewPaket,setGewPaket]=useState(pakete[0]?.id||"");
  const [auftragNr,setAuftragNr]=useState("");
  const [monteur,setMonteur]=useState("");
  const [serNr,setSerNr]=useState({});
  const [log,setLog]=useState([]);

  const paket=pakete.find(p=>p.id===gewPaket);
  const {moeglich,details}=paket?getVerfuegbarkeit(paket,artikel):{moeglich:0,details:[]};

  function ausgeben(){
    if(!paket||moeglich===0||!auftragNr||!monteur) return;
    setArtikel(prev=>prev.map(a=>{
      const k=paket.komponenten.find(c=>c.artikelId===a.id);
      return k?{...a,bestand:a.bestand-k.menge}:a;
    }));
    setLog(prev=>[{id:Date.now(),paket:paket.name,paketId:paket.id,auftrag:auftragNr,monteur,datum:new Date().toLocaleDateString("de-DE"),serNr:{...serNr}},...prev]);
    setAuftragNr("");setMonteur("");setSerNr({});
    showToast(`Paket "${paket.name}" ausgegeben`);
  }

  const canSend=paket&&moeglich>0&&auftragNr&&monteur;

  return (
    <div>
      <div style={{fontSize:11,color:TX2,marginBottom:14}}>Paket wÃ¤hlen, Auftrag zuweisen, Seriennummern erfassen</div>

      <div style={{marginBottom:12}}>
        <label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Paket wÃ¤hlen</label>
        <select style={{...INPUT,appearance:"auto"}} value={gewPaket} onChange={e=>{setGewPaket(e.target.value);setSerNr({});}}>
          {pakete.map(p=>{const v=getVerfuegbarkeit(p,artikel).moeglich;return <option key={p.id} value={p.id}>{p.name} â€” {v} verfÃ¼gbar</option>;})}
        </select>
      </div>

      <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:12}}>
        <div>
          <label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Auftragsnummer</label>
          <input style={INPUT} value={auftragNr} onChange={e=>setAuftragNr(e.target.value)} placeholder="AU-2026-..."/>
        </div>
        <div>
          <label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Monteur</label>
          <input style={INPUT} value={monteur} onChange={e=>setMonteur(e.target.value)} placeholder="Name..."/>
        </div>
      </div>

      {paket&&(
        <div style={{...CARD,marginBottom:12,borderColor:moeglich>0?`${paket.farbe}50`:`${ERR}40`}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
            <div style={{fontWeight:700,fontSize:14}}>{paket.name}</div>
            <div style={{textAlign:"center"}}>
              <div style={{fontSize:26,fontWeight:800,color:moeglich===0?ERR:moeglich<3?WARN:OK,lineHeight:1}}>{moeglich}</div>
              <div style={{fontSize:9,color:TX2}}>verfÃ¼gbar</div>
            </div>
          </div>
          {details.map((d,i)=>{
            if(!d.art) return null;
            return (
              <div key={i} style={{marginBottom:10}}>
                <div style={{display:"flex",justifyContent:"space-between",marginBottom:d.art.serienNr?5:0}}>
                  <div style={{display:"flex",alignItems:"center",gap:6}}>
                    <div style={{width:6,height:6,borderRadius:"50%",background:d.art.bestand>=d.menge?OK:ERR}}/>
                    <span style={{fontSize:12,color:TX}}>{d.menge}Ã— {d.art.name}</span>
                  </div>
                  <span style={{fontSize:11,color:d.art.bestand<d.menge?ERR:TX2}}>Lager: {d.art.bestand}</span>
                </div>
                {d.art.serienNr&&(
                  <input style={{...INPUT,fontSize:11,padding:"6px 10px"}}
                    value={serNr[d.artikelId]||""}
                    onChange={e=>setSerNr(prev=>({...prev,[d.artikelId]:e.target.value}))}
                    placeholder={`Seriennummer${d.menge>1?"n (kommagetrennt)":""}â€¦`}
                  />
                )}
              </div>
            );
          })}
          {moeglich===0&&<div style={{background:`${ERR}10`,border:`1px solid ${ERR}30`,borderRadius:8,padding:"8px 12px",fontSize:11,color:ERR}}>âœ• Paket nicht komplettierbar â€“ Bestand prÃ¼fen</div>}
        </div>
      )}

      <button onClick={ausgeben} disabled={!canSend} style={{width:"100%",padding:"13px",borderRadius:10,border:"none",background:canSend?Y:BR,color:canSend?BG:TX2,fontWeight:700,fontSize:14,cursor:canSend?"pointer":"default",marginBottom:20}}>
        ğŸ“¤ Paket ausgeben & Bestand buchen
      </button>

      {log.length>0&&(
        <div>
          <div style={{fontSize:10,color:TX2,fontWeight:700,letterSpacing:"0.5px",marginBottom:8}}>AUSGABE-PROTOKOLL</div>
          {log.map(l=>(
            <div key={l.id} style={{...CARD,marginBottom:8}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
                <div>
                  <div style={{fontWeight:700,fontSize:13}}>{l.paket}</div>
                  <div style={{fontSize:11,color:TX2}}>ğŸ“‹ {l.auftrag} Â· ğŸ‘· {l.monteur}</div>
                  <div style={{fontSize:11,color:TX2}}>ğŸ—“ {l.datum}</div>
                  {Object.entries(l.serNr).map(([id,sn])=>sn&&<div key={id} style={{fontSize:10,color:PURPLE,marginTop:2}}>SN: {sn}</div>)}
                </div>
                <Badge color={OK} label="Ausgegeben"/>
              </div>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

// â”€â”€ BESTAND TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function BestandTab({artikel,setArtikel,kritisch,setModal,showToast}) {
  const [search,setSearch]=useState("");
  const [kat,setKat]=useState("Alle");
  const filtered=useMemo(()=>artikel.filter(a=>(kat==="Alle"||a.kat===kat)&&(a.name.toLowerCase().includes(search.toLowerCase())||a.id.includes(search.toUpperCase()))),[artikel,kat,search]);

  return (
    <div>
      {kritisch.length>0&&(
        <div style={{background:`${WARN}12`,border:`1px solid ${WARN}30`,borderRadius:10,padding:"10px 14px",marginBottom:12}}>
          <div style={{color:WARN,fontWeight:700,fontSize:12}}>âš ï¸ {kritisch.length} Artikel unter Mindestbestand</div>
          <div style={{color:TX2,fontSize:11,marginTop:2}}>{kritisch.map(a=>a.name).join(" Â· ")}</div>
        </div>
      )}
      <input style={INPUT} placeholder="ğŸ”  Artikel suchen..." value={search} onChange={e=>setSearch(e.target.value)}/>
      <div style={{display:"flex",gap:6,overflowX:"auto",paddingBottom:4,marginTop:8,marginBottom:12}}>
        {KATEGORIEN.map(k=>(
          <button key={k} onClick={()=>setKat(k)} style={{padding:"5px 10px",borderRadius:20,border:`1px solid ${kat===k?Y:BR}`,background:kat===k?`${Y}15`:"transparent",color:kat===k?Y:TX2,fontSize:10,fontWeight:600,cursor:"pointer",whiteSpace:"nowrap"}}>{k}</button>
        ))}
      </div>
      <div style={{display:"flex",flexDirection:"column",gap:8}}>
        {filtered.map(a=>(
          <div key={a.id} onClick={()=>setModal({type:"artikel",data:a})} style={{...CARD,cursor:"pointer"}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8}}>
              <div style={{flex:1,marginRight:8}}>
                <div style={{fontSize:11,color:TX2,marginBottom:2}}>{a.id} Â· {a.kat}</div>
                <div style={{fontWeight:700,fontSize:13}}>{a.name}</div>
              </div>
              {a.bestand===0?<Badge color={ERR} label="Kein Bestand"/>:a.bestand<a.min?<Badge color={WARN} label="Nachbestellen"/>:<Badge color={OK} label="OK"/>}
            </div>
            <Bar bestand={a.bestand} min={a.min}/>
            <div style={{display:"flex",justifyContent:"space-between",marginTop:8}}>
              <div>
                <span style={{fontWeight:800,fontSize:16,color:a.bestand<a.min?WARN:TX}}>{a.bestand}</span>
                <span style={{color:TX2,fontSize:11}}> / {a.min} Min Â· {a.einheit}</span>
              </div>
              <span style={{color:TX2,fontSize:11}}>â‚¬{a.preis.toFixed(2)}/{a.einheit}</span>
            </div>
          </div>
        ))}
      </div>
      <button onClick={()=>setModal({type:"artikel",data:null})} style={{width:"100%",marginTop:12,padding:"12px",borderRadius:10,border:`1px dashed ${BR}`,background:"transparent",color:TX2,fontSize:12,fontWeight:600,cursor:"pointer"}}>+ Neuer Artikel</button>
    </div>
  );
}

// â”€â”€ ARTIKEL MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ArtikelModal({art,onSave,onClose}) {
  const [form,setForm]=useState(art||{id:"",name:"",kat:"Wechselrichter",bestand:0,min:5,einheit:"Stk",preis:0,serienNr:false});
  const f=(k,v)=>setForm(p=>({...p,[k]:v}));
  const ok=form.id&&form.name;

  return (
    <div style={{position:"fixed",inset:0,background:"#00000095",zIndex:200,display:"flex",alignItems:"flex-end",justifyContent:"center"}}>
      <div style={{background:C1,borderRadius:"16px 16px 0 0",width:"100%",maxWidth:480,maxHeight:"85vh",overflowY:"auto",padding:20,border:`1px solid ${BR}`}}>
        <div style={{display:"flex",justifyContent:"space-between",marginBottom:16}}>
          <div style={{fontWeight:800,fontSize:15}}>{art?"Artikel bearbeiten":"Neuer Artikel"}</div>
          <button onClick={onClose} style={{background:"none",border:"none",color:TX2,fontSize:22,cursor:"pointer"}}>âœ•</button>
        </div>
        <div style={{display:"flex",flexDirection:"column",gap:11}}>
          <div><label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Artikel-ID *</label><input style={INPUT} value={form.id} onChange={e=>f("id",e.target.value)} placeholder="z.B. WR-50"/></div>
          <div><label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Bezeichnung *</label><input style={INPUT} value={form.name} onChange={e=>f("name",e.target.value)} placeholder="Produktname"/></div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>
            <div><label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Kategorie</label>
              <select style={{...INPUT,appearance:"auto"}} value={form.kat} onChange={e=>f("kat",e.target.value)}>
                {KATEGORIEN.filter(k=>k!=="Alle").map(k=><option key={k}>{k}</option>)}
              </select>
            </div>
            <div><label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Einheit</label>
              <select style={{...INPUT,appearance:"auto"}} value={form.einheit} onChange={e=>f("einheit",e.target.value)}>
                {["Stk","m","Paar","Rolle","Box"].map(u=><option key={u}>{u}</option>)}
              </select>
            </div>
          </div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:10}}>
            <div><label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Bestand</label><input style={INPUT} type="number" value={form.bestand} onChange={e=>f("bestand",+e.target.value)}/></div>
            <div><label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Minimum</label><input style={INPUT} type="number" value={form.min} onChange={e=>f("min",+e.target.value)}/></div>
            <div><label style={{fontSize:11,color:TX2,display:"block",marginBottom:4}}>Preis â‚¬</label><input style={INPUT} type="number" step="0.01" value={form.preis} onChange={e=>f("preis",+e.target.value)}/></div>
          </div>
          <div style={{display:"flex",alignItems:"center",gap:8}}>
            <input type="checkbox" id="sn3" checked={form.serienNr} onChange={e=>f("serienNr",e.target.checked)}/>
            <label htmlFor="sn3" style={{fontSize:12,color:TX,cursor:"pointer"}}>Seriennummern erfassen</label>
          </div>
          <button onClick={()=>ok&&onSave(form)} style={{width:"100%",padding:"12px",borderRadius:10,border:"none",background:ok?Y:BR,color:ok?BG:TX2,fontWeight:700,fontSize:14,cursor:ok?"pointer":"default",marginTop:4}}>
            âœ“ {art?"Speichern":"Anlegen"}
          </button>
        </div>
      </div>
    </div>
  );
}

// â”€â”€ BESTELLEN TAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function BestellenTab({artikel,setArtikel,kritisch,showToast}) {
  const [bestellungen,setBestellungen]=useState([]);

  function bestellen(a){
    setBestellungen(p=>[{id:Date.now(),name:a.name,artId:a.id,menge:a.min*2,datum:new Date().toLocaleDateString("de-DE"),status:"bestellt"},...p]);
    showToast(`Bestellung fÃ¼r ${a.name} aufgegeben`);
  }
  function empfangen(id){
    const b=bestellungen.find(x=>x.id===id);
    setBestellungen(p=>p.map(x=>x.id===id?{...x,status:"geliefert"}:x));
    setArtikel(p=>p.map(a=>a.id===b.artId?{...a,bestand:a.bestand+b.menge}:a));
    showToast("Lieferung empfangen â€“ Bestand aktualisiert");
  }

  return (
    <div>
      {kritisch.length>0?(
        <div style={{marginBottom:16}}>
          <div style={{fontSize:10,color:WARN,fontWeight:700,letterSpacing:"0.5px",marginBottom:8}}>âš ï¸ NACHBESTELL-VORSCHLÃ„GE</div>
          {kritisch.map(a=>(
            <div key={a.id} style={{...CARD,marginBottom:8,borderColor:`${WARN}40`,background:`${WARN}06`}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                <div>
                  <div style={{fontWeight:600,fontSize:12}}>{a.name}</div>
                  <div style={{fontSize:11,color:TX2}}>Bestand: {a.bestand} Â· Min: {a.min} Â· Vorschlag: {a.min*2} {a.einheit}</div>
                  <div style={{fontSize:11,color:TX2}}>ca. â‚¬{(a.min*2*a.preis).toLocaleString("de-DE",{maximumFractionDigits:0})}</div>
                </div>
                <button onClick={()=>bestellen(a)} style={{background:Y,border:"none",color:BG,borderRadius:8,padding:"7px 14px",fontSize:12,fontWeight:700,cursor:"pointer"}}>Bestellen</button>
              </div>
            </div>
          ))}
        </div>
      ):(
        <div style={{textAlign:"center",padding:"30px 20px",color:TX2,marginBottom:16}}>
          <div style={{fontSize:32,marginBottom:8}}>âœ…</div>
          <div style={{fontSize:14,fontWeight:600,color:OK}}>Alles im grÃ¼nen Bereich</div>
          <div style={{fontSize:12,marginTop:4}}>Kein Artikel unter Mindestbestand</div>
        </div>
      )}

      {bestellungen.length>0&&(
        <div>
          <div style={{fontSize:10,color:TX2,fontWeight:700,letterSpacing:"0.5px",marginBottom:8}}>BESTELLUNGEN</div>
          {bestellungen.map(b=>(
            <div key={b.id} style={{...CARD,marginBottom:8}}>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:6}}>
                <div style={{fontWeight:700,fontSize:13}}>{b.name}</div>
                {b.status==="bestellt"?<Badge color={Y} label="Bestellt"/>:<Badge color={OK} label="Geliefert"/>}
              </div>
              <div style={{fontSize:11,color:TX2}}>ğŸ“¦ {b.menge} Stk Â· ğŸ—“ {b.datum}</div>
              {b.status==="bestellt"&&(
                <button onClick={()=>empfangen(b.id)} style={{width:"100%",marginTop:10,padding:"9px",borderRadius:8,border:"none",background:OK,color:BG,fontWeight:700,fontSize:12,cursor:"pointer"}}>âœ“ Lieferung empfangen & Bestand buchen</button>
              )}
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
