<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="theme-color" content="#0c1222"/>
<title>bee-doo Â· KI Toolbox</title>
<link rel="icon" href="favicon.svg" type="image/svg+xml"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.2/babel.min.js"></script>

<style>

/* â•â•â• bee-doo Responsive + Lesbarkeit Fix â•â•â• */

/* === LESBARKEIT: Schriften aufhellen === */
/* Zu dunkle GrautÃ¶ne auf Dark Theme aufhellen */
body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }

/* === TABLET (768px) === */
@media (max-width: 768px) {
  /* Grid â†’ weniger Spalten */
  [style*="grid-template-columns"][style*="repeat"] { 
    grid-template-columns: repeat(2, 1fr) !important; 
  }
  [style*="gridTemplateColumns"] {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  /* Flex-Container wrappen */
  [style*="display:flex"], [style*="display: flex"],
  [style*='display:"flex"'], [style*="display:'flex'"] {
    flex-wrap: wrap !important;
  }
  /* Ausnahme: Nav-Items und kleine Icon-Rows nicht wrappen */
  [style*="align-items:center"][style*="gap:4px"],
  [style*="alignItems:"center""][style*="gap:"4px""] {
    flex-wrap: nowrap !important;
  }
  
  /* Sidebar verkleinern */
  [style*="width:240px"], [style*="width: 240px"],
  [style*="width:260px"], [style*="width: 260px"],
  [style*="width:280px"], [style*="width: 280px"],
  [style*='width:"240px"'], [style*='width:"260px"'], [style*='width:"280px"'] {
    width: 200px !important;
    min-width: 200px !important;
  }
  
  /* Modals nicht breiter als Screen */
  .modal, [style*="width:480px"], [style*="width:520px"], [style*="width:560px"],
  [style*="width:600px"], [style*="width:640px"], [style*="width:700px"] {
    width: 95vw !important;
    max-width: 95vw !important;
  }
  
  /* Padding reduzieren */
  [style*="padding:40px"], [style*="padding:48px"], [style*="padding:32px"] {
    padding: 20px !important;
  }
  [style*="padding: 40px"], [style*="padding: 48px"], [style*="padding: 32px"] {
    padding: 20px !important;
  }
  
  /* Tabellen scrollbar */
  table { display: block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
  
  /* Font-Size Minimum */
  * { min-height: 0; }
}

/* === MOBILE (480px) === */
@media (max-width: 480px) {
  /* Grid â†’ 1 Spalte */
  [style*="grid-template-columns"], [style*="gridTemplateColumns"] { 
    grid-template-columns: 1fr !important; 
  }
  .grid { grid-template-columns: 1fr !important; }
  
  /* Sidebar ausblenden oder collapsieren */
  [style*="width:240px"], [style*="width: 240px"],
  [style*="width:260px"], [style*="width: 260px"],
  [style*="width:280px"], [style*="width: 280px"],
  [style*="width:200px"], [style*="width: 200px"],
  [style*='width:"240px"'], [style*='width:"260px"'], [style*='width:"280px"'],
  [style*='width:"200px"'] {
    position: fixed !important;
    left: -300px !important;
    z-index: 999 !important;
    transition: left 0.3s ease !important;
    width: 260px !important;
    height: 100vh !important;
    top: 0 !important;
  }
  
  /* Alle Flex-Container stacken */
  [style*="display:flex"], [style*="display: flex"],
  [style*='display:"flex"'] {
    flex-wrap: wrap !important;
  }
  [style*="flex-direction:row"], [style*="flexDirection:"row""],
  [style*="flex-direction: row"] {
    flex-direction: column !important;
  }
  
  /* Form-Elemente full width */
  input, select, textarea, .input-field {
    width: 100% !important;
    max-width: 100% !important;
    min-width: 0 !important;
    font-size: 16px !important; /* Prevents iOS zoom */
  }
  
  /* Buttons touch-friendly */
  button, .btn-primary, .btn-secondary, [role="button"] {
    min-height: 44px !important;
    min-width: 44px !important;
    font-size: 14px !important;
  }
  
  /* Padding stark reduzieren */
  [style*="padding:40px"], [style*="padding:48px"], [style*="padding:32px"],
  [style*="padding:28px"], [style*="padding:24px"],
  [style*="padding: 40px"], [style*="padding: 48px"], [style*="padding: 32px"],
  [style*="padding: 28px"], [style*="padding: 24px"] {
    padding: 12px !important;
  }
  
  /* Gap reduzieren */
  [style*="gap:24px"], [style*="gap:20px"], [style*="gap:28px"],
  [style*="gap: 24px"], [style*="gap: 20px"], [style*="gap: 28px"] {
    gap: 12px !important;
  }
  
  /* Font sizes - minimum 12px */
  [style*="font-size:8px"], [style*="font-size:9px"], [style*="font-size:10px"],
  [style*="font-size: 8px"], [style*="font-size: 9px"], [style*="font-size: 10px"],
  [style*="fontSize:8px"], [style*="fontSize:9px"], [style*="fontSize:10px"],
  [style*='fontSize:"8px"'], [style*='fontSize:"9px"'], [style*='fontSize:"10px"'] {
    font-size: 12px !important;
  }
  
  /* Bilder responsive */
  img { max-width: 100% !important; height: auto !important; }
  
  /* Fixed elements repositionieren */
  [style*="position:fixed"][style*="top:12px"][style*="left:12px"],
  [style*="position: fixed"][style*="top: 12px"][style*="left: 12px"] {
    top: 6px !important;
    left: 6px !important;
    font-size: 11px !important;
    padding: 4px 8px !important;
  }
  
  /* Logo kleiner */
  .logo { font-size: 32px !important; }
  
  /* Text wrap erzwingen */
  * { word-wrap: break-word !important; overflow-wrap: break-word !important; }
  [style*="white-space:nowrap"], [style*="white-space: nowrap"],
  [style*='whiteSpace:"nowrap"'] {
    white-space: normal !important;
  }
  
  /* Modals full width */
  .modal, [class*="modal"], [style*="width:480px"], [style*="width:520px"],
  [style*="width:560px"], [style*="width:600px"] {
    width: 96vw !important;
    max-width: 96vw !important;
    padding: 16px !important;
    margin: 8px !important;
  }
  
  /* Map containers */
  #map, .leaflet-container, [style*="height:100vh"] {
    height: calc(100vh - 60px) !important;
  }
  .map-toolbar {
    flex-direction: column !important;
    top: 6px !important;
    left: 6px !important;
    right: 6px !important;
  }
  .map-tool-btn {
    font-size: 11px !important;
    padding: 5px 10px !important;
  }
}

/* â•â•â• Lesbarkeit: Zu dunkle Farben aufhellen â•â•â• */
/* #0c1222 backgrounds â†’ Schrift mindestens #8b95a5 */
[style*="color:#0c1222"], [style*="color: #0c1222"] { color: #8b95a5 !important; }
[style*="color:#151d30"], [style*="color: #151d30"] { color: #8b95a5 !important; }
[style*="color:#263354"], [style*="color: #263354"] { color: #7a8baa !important; }
[style*="color:#1c2640"], [style*="color: #1c2640"] { color: #8b95a5 !important; }
[style*="color:#334155"], [style*="color: #334155"] { color: #8b95a5 !important; }
[style*="color:#252530"], [style*="color: #252530"] { color: #8b95a5 !important; }
[style*='color:"#0c1222"'] { color: #8b95a5 !important; }
[style*='color:"#151d30"'] { color: #8b95a5 !important; }
[style*='color:"#263354"'] { color: #7a8baa !important; }
[style*='color:"#1c2640"'] { color: #8b95a5 !important; }
[style*='color:"#334155"'] { color: #8b95a5 !important; }
[style*='color:"#252530"'] { color: #8b95a5 !important; }

/* GrÃ¼ntÃ¶ne auf Dark besser lesbar machen */
[style*="color:#166534"], [style*="color: #166534"] { color: #34d399 !important; }
[style*='color:"#166534"'] { color: #34d399 !important; }

/* Generell: Alle font-sizes unter 10px auf mindestens 11px */
</style>
</head>
<body style="margin:0;background:#0c1222">
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useCallback, useRef } = React;

/* â•â•â• bee-doo AI TOOLBOX â•â•â• */
const Y="#FDE154",DK="#0c1222",C1="#151d30",C2="#1c2640",BD="#263354",TX="#e1e7ef",DM="#5c6b8a",
  BL="#60A5FA",GN="#34D399",RD="#F87171",OR="#FB923C",PP="#A78BFA",CY="#22D3EE",PK="#F472B6";

const fmt=n=>n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(0)+"k":n.toFixed(0);

/* â•â•â• DEMO DATA â•â•â• */
const NAMES=["Gerhard Hergerdt","Sarah Karmazin","Tobias Endert","Kathrin Schuriemmer","Werner Cusumano","Fabian Wichmann","Carolina Beer","Stephan Schneller","Julia Gleinhauf","Alexander Brengelmann","Anja Karmazin","Reinhard Schmitz","Eva Klein","Klaus Gau","Natalie Lambert","Robert Wichmann","Christoph Hergerdt","Michel Morgen","Helga Ferkau","Jakob Mueller"];
const SRCS=["Eigenvertrieb","Enpal","Enpal-WP","MvPP","Omega","SAOD","Empfehlung","Eigenleads"];
const ORTS=["Bielefeld","OsnabrÃ¼ck","MÃ¼nster","Paderborn","Hagen","Essen","Dortmund","GÃ¼tersloh","Minden","Herford"];
const BERATER=["Kadir Danyildiz","Miguel Schader","Gino Ulitzka","Carlos Eichler","Fabian Hindenberg","Calogero Iannuzzo","Pascal Schellenberg","Dimitri van Eeuwen","Martin Bott","Klaus Vollmer"];
const STR=["Herforder Str.","Meisenweg","Bahnhofstr.","Hauptstr.","Detmolder Str.","Finkenkr.","Heeper Str.","Am Stadtholz","Kirchweg","Lerchenweg"];
const ri=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const r=a=>a[Math.floor(Math.random()*a.length)];

const genLeads=(n=30)=>Array.from({length:n},(_,i)=>{
  const kwp=ri(5,25),src=r(SRCS),ort=r(ORTS),age=ri(0,45);
  return{id:i+1,name:r(NAMES),nid:40200+i,src,kwp,mod:Math.round(kwp*1.8),eur:kwp*ri(1100,1600),
    tel:"0"+ri(151,179)+" "+ri(10000000,99999999),str:r(STR)+" "+ri(1,120),plz:""+ri(30000,49999),ort,
    berater:r(BERATER),age,stage:r(["Angebot erstellt","Hold","Auftrag","Vertrag","Finanzierung","Bonitaet","AC Board","Storniert"]),
    created:new Date(Date.now()-age*86400000).toISOString().slice(0,10),
    zahl:r(["Finanzierung","Barzahler"]),dach:r(["SÃ¼d","Ost-West","SÃ¼d-West","Flachdach"]),
    notizen:r(["","Kunde hat Fragen zum Speicher","Dach Ost-West, Gaube links","Warte auf Nachbar-Genehmigung","Finanzierung Ã¼ber Volksbank","Termin nur nachmittags mÃ¶glich","RÃ¼ckruf nÃ¤chste Woche","Nachbar hat auch Interesse"]),
    email:r(NAMES).toLowerCase().replace(/ /g,".")+"@"+r(["web.de","gmx.de","gmail.com","mail.de"]),
    conv_prob:Math.min(95,Math.max(5,ri(10,90)-(src==="Eigenleads"?20:src==="Empfehlung"?-15:0)-(age>14?15:0)+(kwp>15?10:0))),
  }
});

const LEADS=genLeads(30);

/* â•â•â• COMPONENTS â•â•â• */
const Tab=({active,label,icon,onClick,color})=><button onClick={onClick} style={{padding:"10px 18px",borderRadius:8,border:active?`2px solid ${color||Y}`:`1px solid ${BD}`,background:active?`${(color||Y)}15`:C1,color:active?(color||Y):DM,fontWeight:active?700:500,fontSize:13,cursor:"pointer",display:"flex",alignItems:"center",gap:6,transition:"all .2s"}}>{icon&&<span style={{fontSize:16}}>{icon}</span>}{label}</button>;

const Card=({children,style})=><div style={{background:C1,borderRadius:10,border:`1px solid ${BD}`,padding:"16px 18px",marginBottom:8,...style}}>{children}</div>;

const Score=({value,max=100,color=GN})=>{const pct=Math.round(value/max*100);return <div style={{display:"flex",alignItems:"center",gap:10,width:"100%"}}><div style={{flex:1,height:8,borderRadius:4,background:`${DM}30`}}><div style={{width:pct+"%",height:"100%",borderRadius:4,background:color,transition:"width .6s ease"}}/></div><span style={{fontSize:13,fontWeight:700,color,minWidth:36,textAlign:"right"}}>{value}</span></div>};

const Btn=({children,onClick,color=Y,small,disabled})=><button disabled={disabled} onClick={onClick} style={{padding:small?"6px 14px":"10px 20px",borderRadius:8,border:"none",background:disabled?DM:color,color:disabled?BD:DK,fontWeight:700,fontSize:small?12:14,cursor:disabled?"default":"pointer",opacity:disabled?.5:1}}>{children}</button>;

/* â•â•â• 1. LEAD SCORING â•â•â• */
function LeadScoring(){
  const[leads]=useState(()=>LEADS.map(l=>({...l,score:Math.min(98,Math.max(8,
    (l.src==="Empfehlung"?25:l.src==="Eigenvertrieb"?18:l.src==="Enpal"?15:l.src==="MvPP"?12:10)+
    (l.kwp>15?15:l.kwp>10?10:5)+
    (l.age<3?20:l.age<7?15:l.age<14?8:0)+
    (l.zahl==="Barzahler"?10:5)+
    (l.dach==="SÃ¼d"?12:l.dach==="SÃ¼d-West"?8:4)+
    ri(-5,10)
  ))})).sort((a,b)=>b.score-a.score));
  const[exp,setExp]=useState(null);
  const sc=v=>v>=80?GN:v>=60?BL:v>=40?OR:RD;
  return <div>
    <div style={{marginBottom:16,padding:"12px 16px",borderRadius:8,background:`${BL}10`,border:`1px solid ${BL}20`}}>
      <div style={{fontSize:14,color:BL,fontWeight:600,marginBottom:4}}>ğŸ§  Lead-Scoring Algorithmus</div>
      <div style={{fontSize:12,color:DM}}>Quelle (25p) + AnlagengrÃ¶ÃŸe (15p) + Alter (20p) + Zahlungsart (10p) + Dachausrichtung (12p) + Zufall â†’ Score 0-98</div>
    </div>
    <div style={{display:"flex",gap:8,marginBottom:12,flexWrap:"wrap"}}>
      <div style={{padding:"6px 14px",borderRadius:6,background:`${GN}15`,color:GN,fontSize:12,fontWeight:700}}>ğŸŸ¢ 80+ Hot ({leads.filter(l=>l.score>=80).length})</div>
      <div style={{padding:"6px 14px",borderRadius:6,background:`${BL}15`,color:BL,fontSize:12,fontWeight:700}}>ğŸ”µ 60-79 Warm ({leads.filter(l=>l.score>=60&&l.score<80).length})</div>
      <div style={{padding:"6px 14px",borderRadius:6,background:`${OR}15`,color:OR,fontSize:12,fontWeight:700}}>ğŸŸ  40-59 Kalt ({leads.filter(l=>l.score>=40&&l.score<60).length})</div>
      <div style={{padding:"6px 14px",borderRadius:6,background:`${RD}15`,color:RD,fontSize:12,fontWeight:700}}>ğŸ”´ &lt;40 Eis ({leads.filter(l=>l.score<40).length})</div>
    </div>
    {leads.map(l=><Card key={l.id} style={{cursor:"pointer",border:exp===l.id?`1px solid ${sc(l.score)}`:`1px solid ${BD}`}} onClick={()=>setExp(exp===l.id?null:l.id)}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
        <div style={{fontWeight:700,fontSize:15,color:TX}}>{l.name}</div>
        <div style={{fontSize:22,fontWeight:800,color:sc(l.score)}}>{l.score}</div>
      </div>
      <Score value={l.score} color={sc(l.score)}/>
      <div style={{display:"flex",gap:8,marginTop:8,flexWrap:"wrap",fontSize:11}}>
        <span style={{color:DM}}>#{l.nid}</span>
        <span style={{color:sc(l.score),fontWeight:600,padding:"1px 6px",borderRadius:4,background:`${sc(l.score)}12`}}>{l.src}</span>
        <span style={{color:Y,fontWeight:700}}>{l.kwp}kWp</span>
        <span style={{color:DM}}>{l.ort}</span>
        <span style={{color:l.age>14?RD:l.age>7?OR:GN,fontWeight:600}}>{l.age}d alt</span>
        <span style={{color:DM}}>{l.zahl}</span>
      </div>
      {exp===l.id&&<div style={{marginTop:12,padding:"10px 14px",borderRadius:8,background:`${DM}10`,border:`1px solid ${BD}`}}>
        <div style={{fontSize:13,fontWeight:700,color:TX,marginBottom:8}}>Score-AufschlÃ¼sselung</div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6,fontSize:12}}>
          <div style={{color:DM}}>Quelle ({l.src})</div><div style={{color:TX,fontWeight:600}}>+{l.src==="Empfehlung"?25:l.src==="Eigenvertrieb"?18:l.src==="Enpal"?15:l.src==="MvPP"?12:10}</div>
          <div style={{color:DM}}>Anlage ({l.kwp}kWp)</div><div style={{color:TX,fontWeight:600}}>+{l.kwp>15?15:l.kwp>10?10:5}</div>
          <div style={{color:DM}}>Alter ({l.age}d)</div><div style={{color:TX,fontWeight:600}}>+{l.age<3?20:l.age<7?15:l.age<14?8:0}</div>
          <div style={{color:DM}}>Zahlung ({l.zahl})</div><div style={{color:TX,fontWeight:600}}>+{l.zahl==="Barzahler"?10:5}</div>
          <div style={{color:DM}}>Dach ({l.dach})</div><div style={{color:TX,fontWeight:600}}>+{l.dach==="SÃ¼d"?12:l.dach==="SÃ¼d-West"?8:4}</div>
        </div>
        <div style={{marginTop:8,fontSize:12,color:BL}}>ğŸ“ {l.tel} Â· âœ‰ {l.email}</div>
        <div style={{fontSize:12,color:DM,marginTop:4}}>{l.str}, {l.plz} {l.ort} Â· Berater: {l.berater}</div>
        {l.notizen&&<div style={{marginTop:6,fontSize:12,color:PP,fontStyle:"italic"}}>ğŸ’¬ {l.notizen}</div>}
      </div>}
    </Card>)}
  </div>
}

/* â•â•â• 2. STORNO-VORHERSAGE â•â•â• */
function StornoPredict(){
  const[leads]=useState(()=>LEADS.map(l=>{
    let risk=ri(5,30);
    if(l.age>21)risk+=25;if(l.age>14)risk+=15;
    if(l.src==="Eigenleads")risk+=15;if(l.src==="MvPP")risk+=10;
    if(l.zahl==="Finanzierung")risk+=8;
    if(l.stage==="Hold")risk+=20;if(l.stage==="Bonitaet")risk+=12;
    if(!l.notizen)risk+=10;
    risk=Math.min(95,Math.max(5,risk));
    return{...l,stornoRisk:risk,reasons:[
      l.age>21?"â° Ãœber 21 Tage in Phase":null,
      l.age>14?"â° Ãœber 14 Tage in Phase":null,
      l.src==="Eigenleads"?"ğŸ“‰ Quelle: Eigenleads (niedrige QualitÃ¤t)":null,
      l.stage==="Hold"?"ğŸ›‘ Liegt auf Hold":null,
      l.stage==="Bonitaet"?"âš ï¸ BonitÃ¤t noch offen":null,
      l.zahl==="Finanzierung"?"ğŸ’° Finanzierung (Ablehnungsrisiko)":null,
      !l.notizen?"ğŸ“ Keine Notizen (wenig Engagement)":null,
    ].filter(Boolean)}
  }).sort((a,b)=>b.stornoRisk-a.stornoRisk));
  const[show,setShow]=useState("high");
  const filtered=show==="high"?leads.filter(l=>l.stornoRisk>=60):show==="mid"?leads.filter(l=>l.stornoRisk>=30&&l.stornoRisk<60):leads;
  const sc=v=>v>=60?RD:v>=30?OR:GN;
  return <div>
    <div style={{marginBottom:16,padding:"12px 16px",borderRadius:8,background:`${RD}10`,border:`1px solid ${RD}20`}}>
      <div style={{fontSize:14,color:RD,fontWeight:600,marginBottom:4}}>âš ï¸ Storno-FrÃ¼hwarnsystem</div>
      <div style={{fontSize:12,color:DM}}>Analysiert: Verweildauer, Leadquelle, Finanzierungsart, Engagement, Phase â†’ Storno-Wahrscheinlichkeit</div>
    </div>
    <div style={{display:"flex",gap:8,marginBottom:12}}>
      {[["high","ğŸ”´ Hohes Risiko",RD],["mid","ğŸŸ  Mittleres",OR],["all","Alle",DM]].map(([k,l,c])=><button key={k} onClick={()=>setShow(k)} style={{padding:"6px 14px",borderRadius:6,background:show===k?`${c}20`:C1,color:show===k?c:DM,border:`1px solid ${show===k?c:BD}`,fontSize:12,fontWeight:600,cursor:"pointer"}}>{l}</button>)}
    </div>
    {filtered.map(l=><Card key={l.id}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
        <div><span style={{fontWeight:700,fontSize:15,color:TX}}>{l.name}</span><span style={{color:DM,fontSize:12,marginLeft:8}}>#{l.nid} Â· {l.stage}</span></div>
        <div style={{fontSize:20,fontWeight:800,color:sc(l.stornoRisk)}}>{l.stornoRisk}%</div>
      </div>
      <Score value={l.stornoRisk} color={sc(l.stornoRisk)}/>
      <div style={{marginTop:8,display:"flex",flexDirection:"column",gap:3}}>
        {l.reasons.map((r,i)=><div key={i} style={{fontSize:12,color:OR}}>{r}</div>)}
      </div>
      <div style={{marginTop:8,display:"flex",gap:6}}>
        <Btn small color={BL}>ğŸ“ Jetzt anrufen</Btn>
        <Btn small color={GN}>ğŸ“§ Nachfass-Mail</Btn>
      </div>
    </Card>)}
  </div>
}

/* â•â•â• 3. FOTO-OCR SIMULATION â•â•â• */
function FotoOCR(){
  const[result,setResult]=useState(null);
  const[loading,setLoading]=useState(false);
  const demos=[
    {type:"ZÃ¤hlerschrank",img:"âš¡",data:{apz:"Vorhanden â€“ 4 freie PlÃ¤tze",zaehler:"ZweirichtungszÃ¤hler (eHZ)",zustand:"Gut â€“ kein Austausch nÃ¶tig",plombe:"Intakt",sls:"35A vorhanden",fi:"30mA FI vorhanden",vde:"VDE 0100/0105 konform",notiz:"ZÃ¤hlerschrank Baujahr ca. 2015, ausreichend dimensioniert fÃ¼r PV-Anlage bis 15kWp"}},
    {type:"Dachfoto",img:"ğŸ ",data:{ausrichtung:"SÃ¼d-West (ca. 210Â°)",neigung:"ca. 35Â°",ziegel:"Frankfurter Pfanne (Beton)",zustand:"Gut â€“ keine sichtbaren SchÃ¤den",verschattung:"Minimal â€“ Baum SÃ¼dost ab 16 Uhr",flaeche:"ca. 48mÂ² nutzbar",gauben:"1 Gaube mittig â€“ muss umplant werden",notiz:"Ideale DachflÃ¤che fÃ¼r 8-10kWp, Gaube reduziert um ca. 4 Module"}},
    {type:"Lieferschein",img:"ğŸ“¦",data:{lieferant:"BayWa r.e. Solar",material:"24x JA Solar JAM54S30-410 (9.84kWp)",wechselrichter:"SMA Sunny Tripower 10.0",speicher:"BYD HVS 10.2",montagesystem:"K2 SingleRail",status:"VollstÃ¤ndig geliefert",datum:"18.02.2026",notiz:"Alles komplett, Montage kann starten"}},
  ];
  const simulate=(demo)=>{setLoading(true);setResult(null);setTimeout(()=>{setResult(demo);setLoading(false)},1500)};
  return <div>
    <div style={{marginBottom:16,padding:"12px 16px",borderRadius:8,background:`${CY}10`,border:`1px solid ${CY}20`}}>
      <div style={{fontSize:14,color:CY,fontWeight:600,marginBottom:4}}>ğŸ“¸ Foto-OCR & Bildanalyse</div>
      <div style={{fontSize:12,color:DM}}>Fotografiere ZÃ¤hlerschrank, Dach oder Lieferschein â†’ KI erkennt automatisch alle relevanten Daten</div>
    </div>
    <div style={{display:"flex",gap:10,marginBottom:16,flexWrap:"wrap"}}>
      {demos.map(d=><button key={d.type} onClick={()=>simulate(d)} style={{flex:"1 1 150px",padding:"20px 16px",borderRadius:10,background:C1,border:`1px solid ${BD}`,cursor:"pointer",textAlign:"center"}}>
        <div style={{fontSize:36,marginBottom:6}}>{d.img}</div>
        <div style={{fontSize:13,fontWeight:700,color:TX}}>{d.type}</div>
        <div style={{fontSize:11,color:DM,marginTop:2}}>Klick zum Simulieren</div>
      </button>)}
    </div>
    {loading&&<Card style={{textAlign:"center",padding:30}}>
      <div style={{fontSize:28,marginBottom:10,animation:"spin 1s linear infinite"}}>ğŸ”„</div>
      <div style={{fontSize:14,color:CY,fontWeight:600}}>KI analysiert Foto...</div>
      <div style={{fontSize:12,color:DM,marginTop:4}}>Texterkennung + Bildanalyse + Klassifizierung</div>
    </Card>}
    {result&&<Card style={{border:`1px solid ${CY}30`}}>
      <div style={{fontSize:16,fontWeight:700,color:CY,marginBottom:12}}>{result.img} {result.type} â€“ Analyse-Ergebnis</div>
      <div style={{display:"grid",gridTemplateColumns:"140px 1fr",gap:8}}>
        {Object.entries(result.data).map(([k,v])=><React.Fragment key={k}>
          <div style={{fontSize:12,color:DM,fontWeight:700,textTransform:"capitalize"}}>{k.replace(/([A-Z])/g," $1")}</div>
          <div style={{fontSize:13,color:k==="notiz"?PP:TX,fontWeight:k==="notiz"?400:600}}>{v}</div>
        </React.Fragment>)}
      </div>
      <div style={{marginTop:12,display:"flex",gap:8}}>
        <Btn small color={GN}>âœ… Ãœbernehmen</Btn>
        <Btn small color={OR}>âœï¸ Korrigieren</Btn>
        <Btn small color={BL}>ğŸ“„ PDF Export</Btn>
      </div>
    </Card>}
  </div>
}

/* â•â•â• 4. ROUTE / TERMIN-OPTIMIZER â•â•â• */
function RouteOptimizer(){
  const[berater]=useState(r(BERATER));
  const[termine]=useState(()=>{
    const t=[];const orts=["Bielefeld","OsnabrÃ¼ck","Paderborn","Herford","GÃ¼tersloh"];
    orts.forEach((ort,i)=>{t.push({id:i+1,name:r(NAMES),ort,str:r(STR)+" "+ri(1,99),plz:""+ri(30000,49999),
      zeit:["09:00","10:30","13:00","15:00","16:30"][i],kwp:ri(6,20),
      fahrt:ri(12,45),dist:ri(5,35)})});
    return t;
  });
  const[nearbyLeads]=useState(()=>LEADS.slice(0,5).map(l=>({...l,distToRoute:ri(1,8),scoreBoost:ri(5,15)})));
  const totalFahrt=termine.reduce((s,t)=>s+t.fahrt,0);
  const optFahrt=Math.round(totalFahrt*0.65);
  return <div>
    <div style={{marginBottom:16,padding:"12px 16px",borderRadius:8,background:`${GN}10`,border:`1px solid ${GN}20`}}>
      <div style={{fontSize:14,color:GN,fontWeight:600,marginBottom:4}}>ğŸ—ºï¸ Intelligente Termin- & Routenplanung</div>
      <div style={{fontSize:12,color:DM}}>KI optimiert Fahrtstrecken, schlÃ¤gt Leads auf der Route vor, berechnet Zeitfenster</div>
    </div>
    <Card style={{border:`1px solid ${Y}20`}}>
      <div style={{fontSize:14,fontWeight:700,color:TX,marginBottom:8}}>ğŸ“… Morgen â€“ {berater}</div>
      <div style={{display:"flex",gap:16,flexWrap:"wrap",fontSize:12,color:DM,marginBottom:12}}>
        <span>{termine.length} Termine</span>
        <span style={{color:RD}}>Aktuell: {totalFahrt} Min Fahrzeit</span>
        <span style={{color:GN}}>Optimiert: {optFahrt} Min (âˆ’{totalFahrt-optFahrt} Min)</span>
      </div>
      {termine.map((t,i)=><div key={t.id} style={{display:"flex",alignItems:"center",gap:12,padding:"10px 12px",marginBottom:4,borderRadius:8,background:i===0?`${GN}08`:C2}}>
        <div style={{width:50,textAlign:"center"}}><div style={{fontSize:15,fontWeight:800,color:Y}}>{t.zeit}</div></div>
        <div style={{width:3,height:40,background:i<termine.length-1?BD:"transparent",borderRadius:2}}/>
        <div style={{flex:1}}>
          <div style={{fontSize:14,fontWeight:600,color:TX}}>{t.name}</div>
          <div style={{fontSize:11,color:DM}}>{t.str}, {t.plz} {t.ort} Â· {t.kwp}kWp</div>
        </div>
        <div style={{textAlign:"right",fontSize:11}}>
          <div style={{color:DM}}>{t.dist}km</div>
          <div style={{color:t.fahrt>30?OR:GN}}>{t.fahrt}â€² Fahrt</div>
        </div>
      </div>)}
    </Card>
    <Card style={{marginTop:10,border:`1px solid ${BL}20`}}>
      <div style={{fontSize:14,fontWeight:700,color:BL,marginBottom:10}}>ğŸ’¡ Leads auf deiner Route</div>
      <div style={{fontSize:12,color:DM,marginBottom:10}}>Diese Leads liegen auf deiner Strecke â€“ ein kurzer Stopp lohnt sich!</div>
      {nearbyLeads.map(l=><div key={l.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 10px",marginBottom:4,borderRadius:6,background:`${BL}06`,border:`1px solid ${BL}12`}}>
        <div>
          <div style={{fontSize:13,fontWeight:600,color:TX}}>{l.name}</div>
          <div style={{fontSize:11,color:DM}}>{l.ort} Â· {l.kwp}kWp Â· {l.age}d alt Â· {l.src}</div>
        </div>
        <div style={{textAlign:"right"}}>
          <div style={{fontSize:12,fontWeight:700,color:BL}}>{l.distToRoute}km entfernt</div>
          <div style={{fontSize:10,color:GN}}>+{l.scoreBoost} Score Bonus</div>
        </div>
      </div>)}
    </Card>
  </div>
}

/* â•â•â• 5. MAIL-GENERATOR â•â•â• */
function MailGenerator(){
  const[sel,setSel]=useState(null);
  const[mailType,setMailType]=useState("angebot");
  const[generated,setGenerated]=useState(null);
  const[loading,setLoading]=useState(false);
  const templates={
    angebot:{subject:"Ihr individuelles Solarangebot â€“ {kwp}kWp fÃ¼r Ihr Zuhause",
      body:`Sehr geehrte/r {name},

vielen Dank fÃ¼r das freundliche GesprÃ¤ch am {date}. Wie besprochen habe ich Ihnen ein individuelles Angebot fÃ¼r Ihre Solaranlage zusammengestellt:

ğŸ“Š Ihre Anlage im Ãœberblick:
â€¢ Leistung: {kwp} kWp ({mod} Module)
â€¢ Dachausrichtung: {dach}
â€¢ GeschÃ¤tzte Jahresproduktion: ca. {prod} kWh
â€¢ Ihre jÃ¤hrliche Ersparnis: ca. {saving} â‚¬
â€¢ Amortisation: ca. {amort} Jahre

ğŸ’° Investition: {eur} â‚¬ ({zahl})
{finanz}

Die aktuelle EinspeisevergÃ¼tung von 8,1 Ct/kWh ist nur noch bis {evuDate} garantiert â€“ je frÃ¼her Sie starten, desto besser die Konditionen.

Haben Sie Fragen? Ich bin jederzeit fÃ¼r Sie erreichbar.

Mit sonnigen GrÃ¼ÃŸen,
{berater}
bee-doo GmbH | â˜ {beraterTel}`},
    nachfass:{subject:"Kurze RÃ¼ckfrage zu Ihrem Solarangebot",
      body:`Hallo {name},

ich wollte mich kurz melden â€“ haben Sie unser Angebot vom {date} erhalten und konnten es sich in Ruhe anschauen?

Falls noch Fragen offen sind, stehe ich Ihnen gerne zur VerfÃ¼gung. Viele unserer Kunden in {ort} haben sich fÃ¼r eine Ã¤hnliche Anlage entschieden und sind begeistert.

Ein kurzer RÃ¼ckruf genÃ¼gt: {beraterTel}

Beste GrÃ¼ÃŸe,
{berater}`},
    storno:{subject:"Schade â€“ aber die TÃ¼r steht offen",
      body:`Hallo {name},

ich habe gehÃ¶rt, dass Sie Ihre Entscheidung noch einmal Ã¼berdenken mÃ¶chten. Das ist vÃ¶llig in Ordnung!

Darf ich fragen, was der ausschlaggebende Grund war? Vielleicht kann ich noch offene Punkte klÃ¤ren:

â€¢ Preis? â†’ Wir haben flexible FinanzierungsmÃ¶glichkeiten
â€¢ Timing? â†’ Die Anlage kann auch spÃ¤ter installiert werden
â€¢ Technische Bedenken? â†’ Gerne komme ich nochmal vorbei

Ihr Angebot Ã¼ber {kwp}kWp bleibt 4 Wochen gÃ¼ltig. Melden Sie sich einfach, wenn Sie es sich anders Ã¼berlegen.

Herzliche GrÃ¼ÃŸe,
{berater}`},
  };
  const gen=(lead,type)=>{
    setLoading(true);
    setTimeout(()=>{
      const t=templates[type];
      const prod=Math.round(lead.kwp*950);
      const saving=Math.round(prod*0.30);
      const fill=s=>s.replace(/{name}/g,lead.name).replace(/{kwp}/g,lead.kwp).replace(/{mod}/g,lead.mod)
        .replace(/{dach}/g,lead.dach).replace(/{eur}/g,fmt(lead.eur)).replace(/{zahl}/g,lead.zahl)
        .replace(/{prod}/g,prod).replace(/{saving}/g,saving).replace(/{amort}/g,Math.round(lead.eur/(saving)))
        .replace(/{ort}/g,lead.ort).replace(/{berater}/g,lead.berater).replace(/{beraterTel}/g,"0521 "+ri(1000000,9999999))
        .replace(/{date}/g,lead.created).replace(/{evuDate}/g,"31.03.2026")
        .replace(/{finanz}/g,lead.zahl==="Finanzierung"?"Ab nur "+Math.round(lead.eur/180)+"â‚¬/Monat bei 180 Monaten Laufzeit.":"");
      setGenerated({subject:fill(t.subject),body:fill(t.body),lead});
      setLoading(false);
    },800);
  };
  return <div>
    <div style={{marginBottom:16,padding:"12px 16px",borderRadius:8,background:`${PP}10`,border:`1px solid ${PP}20`}}>
      <div style={{fontSize:14,color:PP,fontWeight:600,marginBottom:4}}>âœ‰ï¸ KI-Mail-Generator</div>
      <div style={{fontSize:12,color:DM}}>Personalisierte Mails auf Knopfdruck â€“ Angebot, Nachfass, Storno-RÃ¼ckgewinnung</div>
    </div>
    <div style={{display:"flex",gap:8,marginBottom:12}}>
      {[["angebot","ğŸ“Š Angebot"],["nachfass","ğŸ“ Nachfass"],["storno","ğŸ”„ RÃ¼ckgewinnung"]].map(([k,l])=>
        <button key={k} onClick={()=>setMailType(k)} style={{padding:"6px 14px",borderRadius:6,background:mailType===k?`${PP}20`:C1,color:mailType===k?PP:DM,border:`1px solid ${mailType===k?PP:BD}`,fontSize:12,fontWeight:600,cursor:"pointer"}}>{l}</button>
      )}
    </div>
    {!generated&&<div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:8}}>
      {LEADS.slice(0,12).map(l=><Card key={l.id} style={{cursor:"pointer",padding:"12px 14px"}} onClick={()=>gen(l,mailType)}>
        <div style={{fontSize:13,fontWeight:700,color:TX}}>{l.name}</div>
        <div style={{fontSize:11,color:DM}}>#{l.nid} Â· {l.src} Â· {l.kwp}kWp</div>
        <div style={{fontSize:11,color:l.stage==="Storniert"?RD:BL,marginTop:2}}>{l.stage} Â· {l.age}d</div>
      </Card>)}
    </div>}
    {loading&&<Card style={{textAlign:"center",padding:30}}><div style={{fontSize:14,color:PP}}>âœ¨ Generiere personalisierte Mail...</div></Card>}
    {generated&&<div>
      <Card style={{border:`1px solid ${PP}30`}}>
        <div style={{fontSize:11,color:DM,marginBottom:4}}>An: {generated.lead.email}</div>
        <div style={{fontSize:14,fontWeight:700,color:TX,marginBottom:12,padding:"8px 12px",background:`${PP}08`,borderRadius:6}}>{generated.subject}</div>
        <pre style={{fontSize:13,color:TX,lineHeight:1.6,whiteSpace:"pre-wrap",fontFamily:"inherit",margin:0}}>{generated.body}</pre>
        <div style={{marginTop:16,display:"flex",gap:8}}>
          <Btn color={GN}>ğŸ“¤ Ãœber Brevo senden</Btn>
          <Btn color={BL} small>ğŸ“‹ Kopieren</Btn>
          <Btn color={OR} small onClick={()=>setGenerated(null)}>ğŸ”„ Andere Mail</Btn>
        </div>
      </Card>
    </div>}
  </div>
}

/* â•â•â• 6. CALL-ANALYSE â•â•â• */
function CallAnalyse(){
  const[calls]=useState(()=>BERATER.slice(0,8).map((b,i)=>({
    id:i,name:b,calls:ri(15,45),avgDur:ri(180,480),conversion:ri(8,35),
    score:ri(45,95),einwaende:{preis:ri(2,12),timing:ri(1,8),partner:ri(0,5),wettbewerb:ri(0,4),technik:ri(0,3)},
    stimmung:ri(50,95),redeanteil:ri(40,75),
    topSkill:r(["Einwandbehandlung","Abschlusstechnik","Bedarfsanalyse","Rapport-Aufbau","Fragetechnik"]),
    weakSpot:r(["Preisverhandlung","Dringlichkeit erzeugen","Einwand 'zu teuer'","Follow-Up Vereinbarung","Partner einbeziehen"]),
  })).sort((a,b)=>b.score-a.score));
  const[sel,setSel]=useState(null);
  return <div>
    <div style={{marginBottom:16,padding:"12px 16px",borderRadius:8,background:`${PK}10`,border:`1px solid ${PK}20`}}>
      <div style={{fontSize:14,color:PK,fontWeight:600,marginBottom:4}}>ğŸ™ï¸ Call-Center Analyse & Coaching</div>
      <div style={{fontSize:12,color:DM}}>GesprÃ¤che transkribieren â†’ EinwÃ¤nde kategorisieren â†’ Berater-Score â†’ Coaching-Empfehlungen</div>
    </div>
    <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(280px,1fr))",gap:10}}>
      {calls.map(c=><Card key={c.id} style={{cursor:"pointer",border:sel===c.id?`1px solid ${PK}`:`1px solid ${BD}`}} onClick={()=>setSel(sel===c.id?null:c.id)}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
          <div style={{fontWeight:700,fontSize:15,color:TX}}>{c.name}</div>
          <div style={{fontSize:22,fontWeight:800,color:c.score>=80?GN:c.score>=60?BL:OR}}>{c.score}</div>
        </div>
        <Score value={c.score} color={c.score>=80?GN:c.score>=60?BL:OR}/>
        <div style={{display:"flex",justifyContent:"space-between",fontSize:11,color:DM,marginTop:8}}>
          <span>ğŸ“ {c.calls} Calls</span>
          <span>â± Ã˜{Math.round(c.avgDur/60)}min</span>
          <span style={{color:c.conversion>=20?GN:OR}}>ğŸ¯ {c.conversion}% Conv.</span>
        </div>
        {sel===c.id&&<div style={{marginTop:12,borderTop:`1px solid ${BD}`,paddingTop:10}}>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:10}}>
            <div style={{padding:"8px 10px",borderRadius:6,background:`${GN}08`,border:`1px solid ${GN}15`}}>
              <div style={{fontSize:10,color:GN,fontWeight:700}}>ğŸ’ª STÃ„RKE</div>
              <div style={{fontSize:12,color:TX,marginTop:2}}>{c.topSkill}</div>
            </div>
            <div style={{padding:"8px 10px",borderRadius:6,background:`${OR}08`,border:`1px solid ${OR}15`}}>
              <div style={{fontSize:10,color:OR,fontWeight:700}}>ğŸ“ˆ TRAINIEREN</div>
              <div style={{fontSize:12,color:TX,marginTop:2}}>{c.weakSpot}</div>
            </div>
          </div>
          <div style={{fontSize:12,fontWeight:700,color:DM,marginBottom:6}}>Einwand-Verteilung</div>
          {Object.entries(c.einwaende).map(([k,v])=><div key={k} style={{display:"flex",alignItems:"center",gap:8,marginBottom:3}}>
            <span style={{fontSize:11,color:DM,width:90,textTransform:"capitalize"}}>{k}</span>
            <div style={{flex:1,height:6,borderRadius:3,background:`${DM}20`}}><div style={{width:Math.min(100,v*8)+"%",height:"100%",borderRadius:3,background:PP}}/></div>
            <span style={{fontSize:10,color:PP,fontWeight:700,width:20}}>{v}</span>
          </div>)}
          <div style={{marginTop:10,display:"flex",gap:6}}>
            <Btn small color={PK}>ğŸ¯ Training zuweisen</Btn>
            <Btn small color={BL}>ğŸ“Š Detail-Report</Btn>
          </div>
        </div>}
      </Card>)}
    </div>
  </div>
}

/* â•â•â• MAIN APP â•â•â• */
function App(){
  const[tab,setTab]=useState("score");
  const tabs=[
    {id:"score",label:"Lead-Scoring",icon:"ğŸ§ ",color:GN},
    {id:"storno",label:"Storno-Warnung",icon:"âš ï¸",color:RD},
    {id:"ocr",label:"Foto-OCR",icon:"ğŸ“¸",color:CY},
    {id:"route",label:"Routen-KI",icon:"ğŸ—ºï¸",color:GN},
    {id:"mail",label:"Mail-Generator",icon:"âœ‰ï¸",color:PP},
    {id:"call",label:"Call-Analyse",icon:"ğŸ™ï¸",color:PK},
  ];
  return <div style={{minHeight:"100vh",background:DK,color:TX,fontFamily:"'DM Sans',system-ui,sans-serif",display:"flex",flexDirection:"column"}}>
    <style>{`@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap');
    *{box-sizing:border-box;margin:0;padding:0;scrollbar-width:thin;scrollbar-color:${BD} transparent}
    ::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:${BD};border-radius:3px}
    @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
    `}</style>
    {/* Header */}
    <div style={{padding:"12px 16px",borderBottom:`1px solid ${BD}`,background:C1,display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0}}>
      <div style={{display:"flex",alignItems:"center",gap:10}}>
        <a href="index.html" style={{color:DM,textDecoration:"none",fontSize:13}}>â† Launcher</a>
        <span style={{fontSize:18,fontWeight:800,color:Y}}>bee-doo</span>
        <span style={{fontSize:14,fontWeight:600,color:TX}}>KI Toolbox</span>
      </div>
      <div style={{fontSize:11,color:DM}}>6 KI-Module Â· Demo-Modus</div>
    </div>
    {/* Tabs */}
    <div style={{padding:"10px 16px",borderBottom:`1px solid ${BD}`,display:"flex",gap:8,overflowX:"auto",flexShrink:0}}>
      {tabs.map(t=><Tab key={t.id} active={tab===t.id} label={t.label} icon={t.icon} color={t.color} onClick={()=>setTab(t.id)}/>)}
    </div>
    {/* Content */}
    <div style={{flex:1,overflow:"auto",padding:16,maxWidth:900,width:"100%",margin:"0 auto"}}>
      {tab==="score"&&<LeadScoring/>}
      {tab==="storno"&&<StornoPredict/>}
      {tab==="ocr"&&<FotoOCR/>}
      {tab==="route"&&<RouteOptimizer/>}
      {tab==="mail"&&<MailGenerator/>}
      {tab==="call"&&<CallAnalyse/>}
    </div>
  </div>
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
