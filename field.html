<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta name="theme-color" content="#0c1222" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>bee-doo FIELD</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #0c1222; overflow-x: hidden; }
function compressVideo(file, maxSizeMB) {
  maxSizeMB = maxSizeMB || 15;
  return new Promise(function(resolve) {
    if (file.size <= maxSizeMB * 1024 * 1024) {
      + "KB");
      resolve(file);
      return;
    }
    // For large videos, create a compressed version using canvas+mediarecorder
    var video = document.createElement("video");
    video.muted = true;
    video.playsInline = true;
    video.src = URL.createObjectURL(file);
    video.onloadedmetadata = function() {
      var scale = Math.min(1, 1280 / Math.max(video.videoWidth, video.videoHeight));
      var w = Math.round(video.videoWidth * scale);
      var h = Math.round(video.videoHeight * scale);
      var canvas = document.createElement("canvas");
      canvas.width = w; canvas.height = h;
      var ctx = canvas.getContext("2d");
      var stream = canvas.captureStream(15);
      // Try to get audio
      try {
        var audioCtx = new AudioContext();
        var source = audioCtx.createMediaElementSource(video);
        var dest = audioCtx.createMediaStreamDestination();
        source.connect(dest);
        source.connect(audioCtx.destination);
        dest.stream.getAudioTracks().forEach(function(t) { stream.addTrack(t); });
      } catch(e) {}
      var recorder = new MediaRecorder(stream, { mimeType: "video/webm;codecs=vp8", videoBitsPerSecond: 1500000 });
      var chunks = [];
      recorder.ondataavailable = function(e) { if (e.data.size > 0) chunks.push(e.data); };
      recorder.onstop = function() {
        var blob = new Blob(chunks, { type: "video/webm" });
        var compressed = new File([blob], file.name.replace(/\.[^.]+$/, ".webm"), { type: "video/webm" });
        + "KB -> " + Math.round(compressed.size/1024) + "KB");
        URL.revokeObjectURL(video.src);
        resolve(compressed);
      };
      recorder.start();
      video.currentTime = 0;
      video.play();
      var drawFrame = function() {
        if (video.ended || video.paused) { recorder.stop(); return; }
        ctx.drawImage(video, 0, 0, w, h);
        requestAnimationFrame(drawFrame);
      };
      drawFrame();
      video.onended = function() { recorder.stop(); };
    };
  });
}
function generateVideoThumbnail(file) {
  return new Promise(function(resolve) {
    var video = document.createElement("video");
    video.muted = true;
    video.playsInline = true;
    video.src = URL.createObjectURL(file);
    video.onloadeddata = function() {
      video.currentTime = Math.min(1, video.duration / 2);
    };
    video.onseeked = function() {
      var canvas = document.createElement("canvas");
      var w = Math.min(400, video.videoWidth);
      var h = Math.round(w * (video.videoHeight / video.videoWidth));
      canvas.width = w; canvas.height = h;
      var ctx = canvas.getContext("2d");
      ctx.drawImage(video, 0, 0, w, h);
      // Draw play button overlay
      ctx.fillStyle = "rgba(0,0,0,0.4)";
      ctx.beginPath(); ctx.arc(w/2, h/2, 24, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = "#fff";
      ctx.beginPath(); ctx.moveTo(w/2-8, h/2-12); ctx.lineTo(w/2+12, h/2); ctx.lineTo(w/2-8, h/2+12); ctx.closePath(); ctx.fill();
      canvas.toBlob(function(blob) {
        URL.revokeObjectURL(video.src);
        resolve(URL.createObjectURL(blob));
      }, "image/jpeg", 0.7);
    };
  });
}

  #root { min-height: 100vh; }

    @keyframes pulseRedBorder {
      0%, 100% { border-color: rgba(239,68,68,0.35); box-shadow: 0 0 0 0 rgba(239,68,68,0); }
      50% { border-color: rgba(239,68,68,0.8); box-shadow: 0 0 20px rgba(239,68,68,0.15); }
    }
</style>
<script src="config.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

<style>

/* ═══ bee-doo FIELD Responsive ═══ */

/* === GLOBAL RESET === */
html, body {
  margin: 0; padding: 0;
  overflow-x: hidden !important;
  width: 100% !important;
  max-width: 100vw !important;
}
body { background: #0c1222; -webkit-font-smoothing: antialiased; }
*, *::before, *::after { box-sizing: border-box !important; }

/* Nuclear overflow prevention - every element */
body * {
  max-width: 100vw !important;
  min-width: 0 !important;
}

/* === FIELD DASHBOARD GRID === */
.field-grid { grid-template-columns: 1fr !important; }
.field-grid > * { max-width: 100% !important; }
.field-stats { grid-template-columns: 1fr 1fr 1fr !important; }
@media (min-width: 640px) { .field-grid { grid-template-columns: 1fr 1fr !important; } }

/* === MOBILE FIXES (< 640px) === */
@media (max-width: 639px) {
  /* Force all grids to single column */
  [style*="grid-template-columns"] {
    grid-template-columns: 1fr !important;
  }
  
  /* Preserve specific multi-col layouts */
  .field-stats { grid-template-columns: 1fr 1fr 1fr !important; }
  .field-streak { grid-template-columns: 1fr 1fr !important; }
  .field-grid { grid-template-columns: 1fr !important; }

  /* Modals */
  [style*="max-width: 440"], [style*="max-width: 420"],
  [style*="max-width: 360"], [style*="max-width: 480"] {
    max-width: calc(100vw - 32px) !important;
    width: calc(100vw - 32px) !important;
  }

  /* Images */
  img { max-width: 100% !important; height: auto !important; }
  
  /* Inputs */
  input, select, textarea {
    max-width: 100% !important;
    font-size: 16px !important;
  }
  
  /* Touch targets */
  button { min-height: 44px !important; }
  
  /* Text overflow */
  * { word-wrap: break-word !important; overflow-wrap: break-word !important; }
}

/* === TABLET (640-1024px) === */
@media (min-width: 640px) and (max-width: 1024px) {
  [style*="max-width: 440"], [style*="max-width: 420"] {
    max-width: calc(100vw - 48px) !important;
  }
}

/* ═══ Lesbarkeit: Zu dunkle Farben aufhellen ═══ */
[style*="color: rgb(12, 18, 34)"], [style*="color: rgb(21, 29, 48)"],
[style*="color: rgb(38, 51, 84)"], [style*="color: rgb(28, 38, 64)"],
[style*="color: rgb(51, 65, 85)"], [style*="color: rgb(37, 37, 48)"] {
  color: #8b95a5 !important;
}

</style>
</head>
<body>
<a href="index.html" style="position:fixed;top:10px;left:10px;z-index:9999;background:#111827;border:1px solid #333;color:#9ca3af;padding:6px 13px;border-radius:8px;font-size:12px;font-weight:600;text-decoration:none;font-family:inherit;transition:all .15s" onmouseover="this.style.color='#F5C500';this.style.borderColor='#F5C500'" onmouseout="this.style.color='#9ca3af';this.style.borderColor='#333'">← Launcher</a>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.15.0/Recharts.min.js"></script>
<script>
// Extract Recharts components (CDN exposes window.Recharts)
var _RC = window.Recharts || {};
var ResponsiveContainer = _RC.ResponsiveContainer || function(props) { return React.createElement("div", { style: { width: "100%", height: props.height || 200, position: "relative" }}, props.children); };
var AreaChart = _RC.AreaChart || function(props) { return React.createElement("div", { style: { height: "100%", display: "flex", alignItems: "center", justifyContent: "center", color: "#64748b", fontSize: 11 }}, "Chart lädt..."); };
var CartesianGrid = _RC.CartesianGrid || function() { return null; };
var XAxis = _RC.XAxis || function() { return null; };
var YAxis = _RC.YAxis || function() { return null; };
var Tooltip = _RC.Tooltip || function() { return null; };
var Area = _RC.Area || function() { return null; };
var Line = _RC.Line || function() { return null; };
var ReferenceLine = _RC.ReferenceLine || function() { return null; };
var LineChart = _RC.LineChart || function(props) { return React.createElement(AreaChart, props); };
var ComposedChart = _RC.ComposedChart || function(props) { return React.createElement(AreaChart, props); };

const { useState, useEffect, useCallback, useRef, useMemo } = React;
if (!window.storage) {
  const _s = {};
  window.storage = { get: async (k) => {
    const v = _s[k];
    return v ? { key: k, value: v } : null;
  }, set: async (k, v) => {
    _s[k] = v;
    return { key: k, value: v };
  }, delete: async (k) => {
    delete _s[k];
    return { key: k, deleted: true };
  }, list: async (p) => ({ keys: Object.keys(_s).filter((k) => !p || k.startsWith(p)) }) };
}
const STROM_PREISE = [
  { j: 2005, p: 18.7, f: 0 },
  { j: 2006, p: 19.5, f: 0 },
  { j: 2007, p: 20.6, f: 0 },
  { j: 2008, p: 21.7, f: 0 },
  { j: 2009, p: 23.2, f: 0 },
  { j: 2010, p: 23.7, f: 0 },
  { j: 2011, p: 25.2, f: 0 },
  { j: 2012, p: 25.9, f: 0 },
  { j: 2013, p: 29.2, f: 0 },
  { j: 2014, p: 29.5, f: 0 },
  { j: 2015, p: 28.8, f: 0 },
  { j: 2016, p: 28.7, f: 0 },
  { j: 2017, p: 29.3, f: 0 },
  { j: 2018, p: 29.5, f: 0 },
  { j: 2019, p: 30.4, f: 0 },
  { j: 2020, p: 31.5, f: 0 },
  { j: 2021, p: 31.9, f: 0 },
  { j: 2022, p: 34.6, f: 0 },
  { j: 2023, p: 42.2, f: 0 },
  { j: 2024, p: 36.4, f: 0 },
  { j: 2025, p: 35, f: 35 },
  { j: 2026, f: 36.4 },
  { j: 2027, f: 38 },
  { j: 2028, f: 39.7 },
  { j: 2029, f: 41.5 },
  { j: 2030, f: 43.5 }
];
const EV_DB = {
  "Tesla": [
    { m: "Model 3 Standard", v: 13.5 },
    { m: "Model 3 Long Range", v: 14.2 },
    { m: "Model 3 Performance", v: 15.3 },
    { m: "Model Y Standard", v: 15.8 },
    { m: "Model Y Long Range", v: 16 },
    { m: "Model Y Performance", v: 17.2 },
    { m: "Model S", v: 16.1 },
    { m: "Model S Plaid", v: 16.8 },
    { m: "Model X", v: 19.5 }
  ],
  "Volkswagen": [
    { m: "ID.3 Pure", v: 16 },
    { m: "ID.3 Pro", v: 16.2 },
    { m: "ID.3 Pro S", v: 16.6 },
    { m: "ID.3 GTX", v: 16.8 },
    { m: "ID.4 Pro", v: 17.3 },
    { m: "ID.4 GTX", v: 18.5 },
    { m: "ID.5 Pro", v: 16.9 },
    { m: "ID.5 GTX", v: 18 },
    { m: "ID.7 Pro", v: 16.2 },
    { m: "ID.7 Pro S", v: 16.4 },
    { m: "ID.7 GTX", v: 17.2 },
    { m: "ID.7 Tourer Pro", v: 16.4 },
    { m: "ID.7 Tourer GTX", v: 17.2 },
    { m: "ID. Buzz Pro", v: 20.9 },
    { m: "ID. Buzz GTX", v: 21.5 }
  ],
  "BMW": [
    { m: "i4 eDrive35", v: 15.4 },
    { m: "i4 eDrive40", v: 15.5 },
    { m: "i4 xDrive40", v: 16.4 },
    { m: "i4 M50", v: 18 },
    { m: "iX1 eDrive20", v: 16.3 },
    { m: "iX1 xDrive30", v: 16.7 },
    { m: "iX2 eDrive20", v: 16.1 },
    { m: "iX2 xDrive30", v: 16.5 },
    { m: "i5 eDrive40", v: 16.9 },
    { m: "i5 xDrive40", v: 17.5 },
    { m: "i5 M60", v: 19.3 },
    { m: "iX xDrive40", v: 19.5 },
    { m: "iX xDrive50", v: 20.9 },
    { m: "iX M60", v: 22.5 }
  ],
  "Mercedes": [
    { m: "EQA 250", v: 16.8 },
    { m: "EQA 250+", v: 16.8 },
    { m: "EQA 350 4MATIC", v: 18.5 },
    { m: "EQB 250+", v: 17.9 },
    { m: "EQB 350 4MATIC", v: 19.2 },
    { m: "EQE 300", v: 17 },
    { m: "EQE 350+", v: 17.3 },
    { m: "EQE SUV 350+", v: 20.7 },
    { m: "EQS 350", v: 16.8 },
    { m: "EQS 450+", v: 17.2 },
    { m: "EQS SUV 450+", v: 21.8 },
    { m: "CLA 250+", v: 14.5 }
  ],
  "Audi": [
    { m: "Q4 e-tron 40", v: 17.8 },
    { m: "Q4 e-tron 50", v: 18.5 },
    { m: "Q4 Sportback 40", v: 17.4 },
    { m: "A6 Sportback e-tron", v: 15.6 },
    { m: "A6 Avant e-tron", v: 16.3 },
    { m: "Q6 e-tron", v: 18.4 },
    { m: "Q8 e-tron 50", v: 21.2 },
    { m: "Q8 e-tron 55", v: 22.3 },
    { m: "e-tron GT", v: 19.6 }
  ],
  "Hyundai": [
    { m: "Kona Electric 48 kWh", v: 16.5 },
    { m: "Kona Electric 65 kWh", v: 16.8 },
    { m: "IONIQ 5 63 kWh RWD", v: 17.4 },
    { m: "IONIQ 5 84 kWh RWD", v: 17.8 },
    { m: "IONIQ 5 84 kWh AWD", v: 19 },
    { m: "IONIQ 6 Standard RWD", v: 14.9 },
    { m: "IONIQ 6 Long Range RWD", v: 14.9 },
    { m: "IONIQ 6 AWD", v: 16.8 },
    { m: "INSTER Standard", v: 15.3 },
    { m: "INSTER Long Range", v: 15.3 }
  ],
  "Kia": [
    { m: "EV3 Standard", v: 16.9 },
    { m: "EV3 Long Range", v: 17.1 },
    { m: "EV6 Standard 2WD", v: 17.4 },
    { m: "EV6 Long Range 2WD", v: 17.6 },
    { m: "EV6 Long Range AWD", v: 18.9 },
    { m: "EV6 GT", v: 20.6 },
    { m: "EV9 Long Range RWD", v: 21.3 },
    { m: "EV9 Long Range AWD", v: 22.8 },
    { m: "Niro EV", v: 17.2 }
  ],
  "\u0160koda": [
    { m: "Enyaq 60", v: 16.4 },
    { m: "Enyaq 85", v: 16.9 },
    { m: "Enyaq 85x", v: 17.1 },
    { m: "Enyaq RS", v: 17.2 },
    { m: "Enyaq Coup\xE9 60", v: 15.9 },
    { m: "Enyaq Coup\xE9 85", v: 16.4 },
    { m: "Enyaq Coup\xE9 RS", v: 16.8 },
    { m: "Elroq 50", v: 16.8 },
    { m: "Elroq 60", v: 16.9 },
    { m: "Elroq 85", v: 17.1 }
  ],
  "Renault": [
    { m: "Megane E-Tech 130hp", v: 15.8 },
    { m: "Megane E-Tech 220hp", v: 15.8 },
    { m: "Scenic E-Tech 60kWh", v: 17.5 },
    { m: "Scenic E-Tech 87kWh", v: 17.8 },
    { m: "5 E-Tech 40kWh", v: 15.4 },
    { m: "5 E-Tech 52kWh", v: 15.5 },
    { m: "4 E-Tech 40kWh", v: 16.3 },
    { m: "4 E-Tech 52kWh", v: 16.5 },
    { m: "Zoe R135", v: 17.3 }
  ],
  "Opel": [
    { m: "Corsa Electric 50 kWh", v: 16 },
    { m: "Corsa Electric 54 kWh", v: 15.2 },
    { m: "Mokka Electric", v: 17.4 },
    { m: "Astra Electric", v: 16.1 }
  ],
  "Peugeot": [
    { m: "e-208 50 kWh", v: 15.7 },
    { m: "e-208 54 kWh", v: 15.2 },
    { m: "e-2008 54 kWh", v: 16.9 },
    { m: "e-308", v: 16.1 },
    { m: "e-3008 73kWh", v: 17.8 },
    { m: "e-408", v: 16.7 },
    { m: "e-5008", v: 18.3 }
  ],
  "CUPRA": [
    { m: "Born 59 kWh", v: 16.4 },
    { m: "Born 79 kWh", v: 16.8 },
    { m: "Born VZ", v: 17 },
    { m: "Tavascan Endurance", v: 17.3 },
    { m: "Tavascan VZ", v: 19.3 }
  ],
  "Fiat": [{ m: "500e 24 kWh", v: 15.8 }, { m: "500e 42 kWh", v: 15.9 }, { m: "600e", v: 16.4 }, { m: "Grande Panda", v: 16.8 }],
  "Dacia": [{ m: "Spring Electric 45", v: 14.5 }, { m: "Spring Electric 70", v: 14.5 }],
  "MINI": [{ m: "Cooper E", v: 14.6 }, { m: "Cooper SE", v: 14.9 }, { m: "Countryman E", v: 16.3 }, { m: "Countryman SE ALL4", v: 16.9 }],
  "Nissan": [{ m: "Leaf 40 kWh", v: 17.1 }, { m: "Leaf 62 kWh", v: 18.5 }, { m: "Ariya 63 kWh", v: 18.6 }, { m: "Ariya 87 kWh", v: 19.4 }],
  "Ford": [
    { m: "Explorer Standard RWD", v: 17.3 },
    { m: "Explorer Extended AWD", v: 18.9 },
    { m: "Capri Standard RWD", v: 16.6 },
    { m: "Capri Extended RWD", v: 16.8 },
    { m: "Mustang Mach-E SR RWD", v: 17.5 },
    { m: "Mustang Mach-E ER AWD", v: 19 },
    { m: "Puma Gen-E", v: 15.9 }
  ],
  "Porsche": [
    { m: "Taycan", v: 16.6 },
    { m: "Taycan 4S", v: 16.8 },
    { m: "Taycan Turbo", v: 19.5 },
    { m: "Taycan Turbo S", v: 21 },
    { m: "Macan Electric", v: 19.8 },
    { m: "Macan 4 Electric", v: 20.5 }
  ],
  "Volvo": [
    { m: "EX30 Single Motor", v: 16.5 },
    { m: "EX30 Twin Motor", v: 17.5 },
    { m: "EX40 Single Motor", v: 18.4 },
    { m: "EC40 Single Motor", v: 18 },
    { m: "EX90 Twin Motor", v: 21.5 }
  ],
  "Polestar": [{ m: "2 Standard SM", v: 16.5 }, { m: "2 Long Range SM", v: 16.6 }, { m: "2 Long Range DM", v: 17.4 }, { m: "3 Long Range DM", v: 19.6 }, { m: "4 Long Range SM", v: 17.2 }],
  "MG": [{ m: "MG4 51 kWh", v: 16.9 }, { m: "MG4 64 kWh", v: 17.1 }, { m: "MG5 61 kWh", v: 18.2 }, { m: "ZS EV", v: 18 }],
  "BYD": [{ m: "Dolphin 44.9 kWh", v: 16 }, { m: "Dolphin 60.4 kWh", v: 17.3 }, { m: "Seal RWD", v: 16.8 }, { m: "Seal AWD", v: 18.6 }, { m: "Atto 3", v: 18.5 }, { m: "Seal U", v: 18.4 }],
  "smart": [{ m: "Fortwo EQ", v: 16.7 }, { m: "#1 Pro", v: 17.4 }, { m: "#1 Brabus", v: 18.5 }, { m: "#3 Pro+", v: 17 }],
  "Citro\xEBn": [{ m: "\xEB-C3 44 kWh", v: 17.2 }, { m: "\xEB-C4", v: 16.2 }, { m: "\xEB-C4 X", v: 15.2 }],
  "Sonstiges": [{ m: "Anderes E-Auto (\xD8 17,5)", v: 17.5 }]
};
const SOLAR_REGIONS = {
  "0": { name: "Sachsen/Th\xFCringen/Brandenburg", sonne: 1760, ertrag: 980 },
  "1": { name: "Berlin/Brandenburg", sonne: 1800, ertrag: 1e3 },
  "17": { name: "Meckl.-Vorpommern", sonne: 1790, ertrag: 990 },
  "18": { name: "Meckl.-Vorpommern", sonne: 1790, ertrag: 990 },
  "19": { name: "Meckl.-Vorpommern", sonne: 1790, ertrag: 990 },
  "2": { name: "Hamburg/Schleswig-H./Niedersachsen", sonne: 1700, ertrag: 920 },
  "3": { name: "OWL/Niedersachsen/NRW", sonne: 1680, ertrag: 930 },
  "4": { name: "NRW/Weser-Ems", sonne: 1680, ertrag: 930 },
  "5": { name: "NRW/Rheinland", sonne: 1710, ertrag: 950 },
  "6": { name: "Hessen/Rheinland-Pfalz/Saarland", sonne: 1750, ertrag: 970 },
  "7": { name: "Baden-W\xFCrttemberg", sonne: 1850, ertrag: 1050 },
  "8": { name: "Bayern S\xFCd", sonne: 1855, ertrag: 1050 },
  "9": { name: "Bayern Nord/Franken", sonne: 1800, ertrag: 1020 }
};
function getSolarRegion(plz) {
  if (!plz || plz.length < 1) return { name: "Deutschland \xD8", sonne: 1750, ertrag: 980 };
  const p2 = plz.substring(0, 2);
  if (SOLAR_REGIONS[p2]) return SOLAR_REGIONS[p2];
  const p1 = plz.substring(0, 1);
  if (SOLAR_REGIONS[p1]) return SOLAR_REGIONS[p1];
  return { name: "Deutschland \xD8", sonne: 1750, ertrag: 980 };
}
const MONTHLY_PV = [
  { monat: "Jan", pct: 0.03, label: "J" },
  { monat: "Feb", pct: 0.04, label: "F" },
  { monat: "M\xE4r", pct: 0.08, label: "M" },
  { monat: "Apr", pct: 0.1, label: "A" },
  { monat: "Mai", pct: 0.13, label: "M" },
  { monat: "Jun", pct: 0.14, label: "J" },
  { monat: "Jul", pct: 0.14, label: "J" },
  { monat: "Aug", pct: 0.12, label: "A" },
  { monat: "Sep", pct: 0.09, label: "S" },
  { monat: "Okt", pct: 0.06, label: "O" },
  { monat: "Nov", pct: 0.04, label: "N" },
  { monat: "Dez", pct: 0.03, label: "D" }
];
const STEPS = [
  { id: "kunde", label: "Kunde", icon: "\u{1F464}" },
  { id: "einstieg", label: "Einstieg", icon: "\u{1F4A1}" },
  { id: "technik", label: "Technik", icon: "\u{1F527}" },
  { id: "fotos", label: "Fotos", icon: "\u{1F4F8}" },
  { id: "angebot", label: "Angebot", icon: "\u{1F4CB}" }
];
const BRAND = {
  darkGray: "#404040",
  yellow: "#F5C500",
  yellowDark: "#E8CC3D",
  tagline: "#606060"
};
const T = {
  bg: "#0A0E1A",
  surface: "#111827",
  surfaceAlt: "#161E2E",
  card: "#1A2332",
  cardHover: "#1E2A3C",
  border: "#1F2B3D",
  borderLight: "#2A3A52",
  accent: BRAND.yellow,
  accentDark: BRAND.yellowDark,
  accentGlow: "rgba(232,212,77,0.10)",
  green: "#34D399",
  greenSoft: "rgba(52,211,153,0.1)",
  red: "#F87171",
  redSoft: "rgba(248,113,113,0.1)",
  blue: "#60A5FA",
  blueSoft: "rgba(96,165,250,0.1)",
  purple: "#A78BFA",
  text: "#E8ECF4",
  textSec: "#94A3B8",
  textDim: "#4B5563"
};
const font = "'Outfit', 'Segoe UI', sans-serif";
const fontMono = "'JetBrains Mono', 'Fira Code', monospace";
const dir8 = [{ value: "", label: "Keine Auswahl" }, { value: "N", label: "Nord" }, { value: "NO", label: "Nordost" }, { value: "O", label: "Ost" }, { value: "SO", label: "S\xFCdost" }, { value: "S", label: "S\xFCd" }, { value: "SW", label: "S\xFCdwest" }, { value: "W", label: "West" }, { value: "NW", label: "Nordwest" }];
const PRICING = [
  [8, 3.76, 6.4, 16e3, "Smart 12"],
  [10, 4.7, 6.4, 16900, "Smart 12"],
  [12, 5.64, 6.4, 17800, "Smart 12"],
  [14, 6.58, 6.4, 18700, "Smart 12"],
  [16, 7.52, 6.4, 19900, "Smart 12"],
  [18, 8.46, 6.4, 20500, "Smart 12"],
  [20, 9.4, 6.4, 21400, "Smart 12"],
  [22, 10.34, 6.4, 22300, "Smart 12"],
  [24, 11.28, 9.84, 23200, "Smart 12"],
  [26, 12.22, 9.84, 24100, "Smart 12"],
  [28, 13.16, 9.84, 25e3, "Smart 12"],
  [30, 14.1, 9.84, 25900, "Smart 12"],
  [32, 15.04, 9.84, 26800, "Smart 15"],
  [34, 15.98, 9.84, 27700, "Smart 15"],
  [36, 16.92, 9.84, 28600, "Smart 15"],
  [38, 17.86, 9.84, 29500, "Smart 15"],
  [40, 18.8, 9.84, 30400, "Pro 20"],
  [42, 19.74, 9.84, 31300, "Pro 20"],
  [44, 20.68, 9.84, 32200, "Pro 20"],
  [46, 21.62, 9.84, 33100, "Pro 20"],
  [48, 22.56, 9.84, 34e3, "Pro 20"],
  [50, 23.5, 9.84, 34900, "Pro 20"],
  [52, 24.44, 9.84, 35800, "Pro 20"],
  [54, 25.38, 9.84, 36700, "Pro 25"],
  [56, 26.32, 9.84, 37600, "Pro 25"],
  [58, 27.26, 9.84, 38500, "Pro 25"],
  [60, 28.2, 9.84, 39400, "Pro 25"]
];
function getPricing(mod) {
  return PRICING.find((p) => p[0] === mod) || null;
}
const GDRIVE = {
  CLIENT_ID: "YOUR_CLIENT_ID.apps.googleusercontent.com",
  // TODO: echte Client ID
  SCOPES: "https://www.googleapis.com/auth/drive.file",
  PARENT_FOLDER: "bee-doo FIELD Fotos"
};
const gDriveState = { token: null, folderId: null, customerFolderId: null };
async function gDriveAuth() {
  if (!GDRIVE.CLIENT_ID || GDRIVE.CLIENT_ID.includes('YOUR_CLIENT_ID')) {
    alert('⚠️ Google Drive ist noch nicht konfiguriert.\n\nBitte hinterlege eine echte Google OAuth Client ID in field.html (GDRIVE.CLIENT_ID).\n\n→ Erstelle diese unter console.cloud.google.com > APIs & Services > Credentials');
    throw new Error('Google Drive Client ID nicht konfiguriert');
  }
  return new Promise((resolve, reject) => {
    const redir = window.location.origin + window.location.pathname;
    const url = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${encodeURIComponent(GDRIVE.CLIENT_ID)}&redirect_uri=${encodeURIComponent(redir)}&response_type=token&scope=${encodeURIComponent(GDRIVE.SCOPES)}&prompt=consent`;
    const popup = window.open(url, "gdriveAuth", "width=500,height=600");
    const interval = setInterval(() => {
      try {
        if (!popup || popup.closed) {
          clearInterval(interval);
          reject("closed");
          return;
        }
        if (popup.location.hash) {
          const params = new URLSearchParams(popup.location.hash.substring(1));
          const token = params.get("access_token");
          if (token) {
            clearInterval(interval);
            popup.close();
            gDriveState.token = token;
            resolve(token);
          }
        }
      } catch (e) {
      }
    }, 200);
  });
}
async function gDriveEnsureFolder(name, parentId) {
  const q = parentId ? `name='${name}' and '${parentId}' in parents and mimeType='application/vnd.google-apps.folder' and trashed=false` : `name='${name}' and 'root' in parents and mimeType='application/vnd.google-apps.folder' and trashed=false`;
  const res = await fetch(`https://www.googleapis.com/drive/v3/files?q=${encodeURIComponent(q)}&fields=files(id)`, {
    headers: { Authorization: `Bearer ${gDriveState.token}` }
  });
  const data = await res.json();
  if (data.files?.length > 0) return data.files[0].id;
  const create = await fetch("https://www.googleapis.com/drive/v3/files", {
    method: "POST",
    headers: { Authorization: `Bearer ${gDriveState.token}`, "Content-Type": "application/json" },
    body: JSON.stringify({ name, mimeType: "application/vnd.google-apps.folder", parents: parentId ? [parentId] : [] })
  });
  const folder = await create.json();
  return folder.id;
}
async function gDriveUploadPhoto(file, fileName, customerName) {
  if (!gDriveState.token) throw new Error("Nicht angemeldet");
  if (!gDriveState.folderId) {
    gDriveState.folderId = await gDriveEnsureFolder(GDRIVE.PARENT_FOLDER, null);
  }
  const folderName = customerName || "Unbekannt";
  if (!gDriveState.customerFolderId || gDriveState.customerName !== folderName) {
    gDriveState.customerFolderId = await gDriveEnsureFolder(folderName, gDriveState.folderId);
    gDriveState.customerName = folderName;
  }
  const metadata = { name: fileName, parents: [gDriveState.customerFolderId] };
  const form = new FormData();
  form.append("metadata", new Blob([JSON.stringify(metadata)], { type: "application/json" }));
  form.append("file", file);
  const res = await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id,webViewLink", {
    method: "POST",
    headers: { Authorization: `Bearer ${gDriveState.token}` },
    body: form
  });
  if (!res.ok) throw new Error("Upload fehlgeschlagen " + res.status);
  return await res.json();
}
function triggerGDriveUpload(file, photoKey, label, data, u) {
  if (!gDriveState.token) return;
  const kundenName = [data.nachname, data.vorname, data.ort].filter(Boolean).join("_") || "Unbekannt";
  const ts = (/* @__PURE__ */ new Date()).toISOString().replace(/[:.]/g, "-").slice(0, 19);
  const ext = file.type?.includes("png") ? "png" : "jpg";
  const fileName = `${label.replace(/[^a-zA-Z0-9äöüÄÖÜß\-_ ]/g, "")}_${ts}.${ext}`;
  u(`${photoKey}_gd`, "uploading");
  gDriveUploadPhoto(file, fileName, kundenName).then((result) => {
    u(`${photoKey}_gd`, "done");
    u(`${photoKey}_gdLink`, result.webViewLink || "");
  }).catch(() => {
    u(`${photoKey}_gd`, "error");
  });
}
function GDriveStatus({ status }) {
  if (!status) return null;
  const s = { uploading: { icon: "\u2601\uFE0F", text: "Hochladen...", color: BRAND.yellow, anim: true }, done: { icon: "\u2705", text: "In Drive", color: T.green, anim: false }, error: { icon: "\u26A0\uFE0F", text: "Fehler", color: T.red, anim: false } }[status];
  if (!s) return null;
  return /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: s.color, fontWeight: 600, display: "inline-flex", alignItems: "center", gap: 3 } }, /* @__PURE__ */ React.createElement("span", { style: s.anim ? { animation: "spin 1s linear infinite", display: "inline-block" } : {} }, s.icon), " ", s.text);
}
function getSnowZone(plz) {
  const p = parseInt(plz);
  if (!p) return "";
  if (p >= 82e3 && p <= 87999) return "2a";
  if (p >= 88e3 && p <= 88999) return "2";
  if (p >= 72e3 && p <= 73999) return "2";
  if (p >= 98e3 && p <= 98999) return "2a";
  if (p >= 8e3 && p <= 9999) return "2a";
  if (p >= 36e3 && p <= 36999) return "2";
  if (p >= 37e3 && p <= 37999) return "1a";
  if (p >= 38e3 && p <= 38999) return "2";
  if (p >= 2e4 && p <= 27999) return "1";
  if (p >= 18e3 && p <= 19999) return "1a";
  if (p >= 23e3 && p <= 25999) return "1a";
  if (p >= 28e3 && p <= 31999) return "1";
  if (p >= 1e4 && p <= 16999) return "1a";
  if (p >= 2048 && p <= 7999) return "1a";
  if (p >= 3e4 && p <= 35999) return "1";
  if (p >= 4e4 && p <= 53999) return "1";
  if (p >= 54e3 && p <= 56999) return "1";
  if (p >= 6e4 && p <= 69999) return "1";
  if (p >= 7e4 && p <= 71999) return "1a";
  if (p >= 74e3 && p <= 79999) return "1a";
  if (p >= 8e4 && p <= 81999) return "1a";
  if (p >= 9e4 && p <= 97999) return "1a";
  return "1a";
}
function getWindZone(plz) {
  const p = parseInt(plz);
  if (!p) return "";
  if (p >= 25e3 && p <= 25999) return "4";
  if (p >= 26e3 && p <= 26999) return "3";
  if (p >= 23e3 && p <= 24999) return "3";
  if (p >= 18e3 && p <= 18999) return "3";
  if (p >= 27e3 && p <= 27999) return "2";
  if (p >= 19e3 && p <= 19999) return "2";
  if (p >= 2e4 && p <= 22999) return "2";
  if (p >= 28e3 && p <= 29999) return "2";
  if (p >= 3e4 && p <= 31999) return "2";
  if (p >= 1e4 && p <= 16999) return "2";
  if (p >= 32e3 && p <= 33999) return "1";
  if (p >= 34e3 && p <= 37999) return "1";
  if (p >= 38e3 && p <= 39999) return "2";
  if (p >= 2048 && p <= 9999) return "2";
  if (p >= 4e4 && p <= 53999) return "1";
  if (p >= 54e3 && p <= 69999) return "1";
  if (p >= 7e4 && p <= 99999) return "1";
  return "1";
}
const NETZBETREIBER_PLZ = {
  "01-09": "MITNETZ Strom",
  "10-12": "Stromnetz Berlin",
  "13-16": "E.DIS Netz",
  "17-19": "WEMAG Netz",
  "20-22": "Stromnetz Hamburg",
  "23-24": "SH Netz",
  "25": "SH Netz",
  "26-27": "EWE NETZ",
  "28": "Wesernetz Bremen",
  "29": "Avacon Netz",
  "30-31": "enercity Netz / Avacon",
  "32-33": "Westfalen Weser Netz",
  "34": "EAM Netz",
  "35-36": "Mittelhessen Netz",
  "37": "EAM Netz / Avacon",
  "38-39": "Avacon Netz",
  "40-41": "Netz D\xFCsseldorf",
  "42": "Bergische Stadtwerke Netz",
  "44-46": "Westnetz GmbH",
  "47": "Westnetz GmbH",
  "48-49": "Westnetz GmbH",
  "50-51": "RheinEnergie / Westnetz",
  "52-53": "Regionetz / Westnetz",
  "54-56": "Westnetz GmbH",
  "57-59": "Westnetz GmbH",
  "60-63": "NRM Netzdienste Rhein-Main",
  "64-65": "e-netz S\xFCdhessen",
  "66-67": "Pfalzwerke Netz",
  "68-69": "MVV Netze / Netze BW",
  "70-73": "Netze BW",
  "74-76": "Netze BW",
  "77-79": "Netze BW / badenova",
  "80-83": "Bayernwerk Netz",
  "84-85": "Bayernwerk Netz",
  "86-89": "LEW Verteilnetz",
  "90-92": "N-ERGIE Netz",
  "93-96": "Bayernwerk Netz",
  "97": "Bayernwerk Netz",
  "98-99": "TEN Th\xFCringer Energienetze"
};
function getNetzbetreiber(plz) {
  if (!plz || plz.length < 2) return null;
  const p2 = plz.substring(0, 2);
  const p1 = plz.substring(0, 2);
  for (const [range, nb] of Object.entries(NETZBETREIBER_PLZ)) {
    if (range.includes("-")) {
      const [from, to] = range.split("-").map((s) => parseInt(s.padEnd(2, "0")));
      const num = parseInt(p2);
      if (num >= from && num <= to) return nb;
    } else {
      if (p2.startsWith(range) || range === p2) return nb;
    }
  }
  return null;
}
const AUFNAHME_TYPEN = [
  { id: "PV", label: "Photovoltaik", icon: "\u2600\uFE0F", desc: "PV-Anlage mit Speicher", color: BRAND.yellow },
  { id: "WP", label: "W\xE4rmepumpe", icon: "\u2668\uFE0F", desc: "W\xE4rmepumpen-Aufnahme", color: "#60A5FA" },
  { id: "PV+WP", label: "PV + W\xE4rmepumpe", icon: "\u26A1", desc: "Kombi-Aufnahme", color: "#34D399" }
];

function AlertScreen({ stornos, rueckkehrer, onDismiss }) {
  const [countdown, setCountdown] = useState(10);
  const [tried, setTried] = useState(0);
  const [shakeMsg, setShakeMsg] = useState("");
  const [canDismiss, setCanDismiss] = useState(false);
  const timerRef = React.useRef(null);
  function startTimer(secs) {
    if (timerRef.current) clearInterval(timerRef.current);
    var c = secs;
    setCountdown(c);
    setCanDismiss(false);
    timerRef.current = setInterval(function() {
      c--;
      if (c <= 0) { clearInterval(timerRef.current); setCanDismiss(true); setCountdown(0); }
      else { setCountdown(c); }
    }, 1000);
  }
  useEffect(function() { startTimer(10); return function() { if(timerRef.current) clearInterval(timerRef.current); }; }, []);
  var totalItems = (stornos ? stornos.length : 0) + (rueckkehrer ? rueckkehrer.length : 0);
  var msgs = ["\u274C Das kannst du nicht wegklicken! Bearbeite deine F\xe4lle!","\u274C Netter Versuch! +10s. K\xfcmmere dich um deine Kunden!","\u274C Schon wieder? +10s! Diese Kunden brauchen dich JETZT!","\u274C Du kommst hier nicht raus!","\u274C Aufgeben? Niemals! +10s."];
  function handleBtn() {
    if (canDismiss) { onDismiss(); return; }
    startTimer(countdown + 10);
    setShakeMsg(msgs[tried % msgs.length]);
    setTried(function(p) { return p + 1; });
    setTimeout(function() { setShakeMsg(""); }, 4000);
  }
  return React.createElement("div", { style: { position: "fixed", inset: 0, zIndex: 30000, background: "radial-gradient(ellipse at 50% 30%, rgba(239,68,68,0.2) 0%, #0A0E1A 70%)", fontFamily: font, color: "#fff", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "flex-start", padding: "20px 16px", overflow: "auto", boxSizing: "border-box" }},
    React.createElement("style", null, "@keyframes shk{0%,100%{transform:translateX(0);}25%{transform:translateX(-5px);}75%{transform:translateX(5px);}} @keyframes bf{0%,100%{border-color:rgba(239,68,68,0.15);box-shadow:0 0 0 rgba(239,68,68,0);}50%{border-color:rgba(239,68,68,0.8);box-shadow:0 0 20px rgba(239,68,68,0.3);}} @keyframes bl{0%,100%{opacity:1;}50%{opacity:0.3;}}"),
    React.createElement("div", { style: { width: "100%", maxWidth: 480, display: "flex", flexDirection: "column", alignItems: "center" }},
      React.createElement("div", { style: { textAlign: "center", marginBottom: 14, marginTop: 10 }},
        React.createElement("div", { style: { fontSize: 44, marginBottom: 6, animation: "bl 1s infinite" }}, "\ud83d\udea8"),
        React.createElement("div", { style: { fontSize: 20, fontWeight: 900, color: "#ef4444", textTransform: "uppercase", letterSpacing: 2, animation: "bl 1.5s infinite" }}, "ACHTUNG"),
        React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: "#ef4444", marginTop: 2 }}, "SOFORT BEARBEITEN!"),
        React.createElement("div", { style: { fontSize: 12, color: "rgba(255,255,255,0.55)", marginTop: 6 }}, totalItems + " offene F\xe4lle warten auf dich")),
      stornos && stornos.length > 0 && React.createElement("div", { style: { width: "100%", marginBottom: 12 }},
        React.createElement("div", { style: { fontSize: 11, fontWeight: 800, color: "#f97316", textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 8 }}, "\ud83d\udd25 STORNO-RETTER (" + stornos.length + ")"),
        stornos.map(function(st, i) {
          var bc = st.restStunden > 24 ? "#f97316" : "#dc2626";
          return React.createElement("div", { key: "s"+i, style: { display: "flex", alignItems: "center", justifyContent: "space-between", padding: "12px 14px", marginBottom: 6, borderRadius: 12, background: "rgba(249,115,22,0.1)", border: "2px solid rgba(249,115,22,0.4)", animation: "bf 2s infinite", gap: 10 }},
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, flex: 1, minWidth: 0 }}, React.createElement("div", { style: { fontSize: 22, flexShrink: 0 }}, "\ud83d\udd25"), React.createElement("div", { style: { minWidth: 0 }}, React.createElement("div", { style: { fontSize: 14, fontWeight: 700 }}, st.name), React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.55)" }}, st.grund + " \xb7 " + st.typ))),
            React.createElement("div", { style: { textAlign: "right", flexShrink: 0 }}, React.createElement("div", { style: { fontSize: 20, fontWeight: 900, color: bc }}, st.restStunden + " Std."), React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.4)" }}, "verbleibend")));
        })),
      rueckkehrer && rueckkehrer.length > 0 && React.createElement("div", { style: { width: "100%", marginBottom: 14 }},
        React.createElement("div", { style: { fontSize: 11, fontWeight: 800, color: "#ef4444", textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 8 }}, "\ud83d\udea8 R\xdcCKKEHRER (" + rueckkehrer.length + ")"),
        rueckkehrer.map(function(rk, i) {
          return React.createElement("div", { key: "r"+i, style: { display: "flex", alignItems: "center", justifyContent: "space-between", padding: "12px 14px", marginBottom: 6, borderRadius: 12, background: "rgba(239,68,68,0.08)", border: "2px solid rgba(239,68,68,0.35)", animation: "bf 2s infinite", gap: 10 }},
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, flex: 1, minWidth: 0 }}, React.createElement("div", { style: { fontSize: 22, flexShrink: 0 }}, "\u26a0\ufe0f"), React.createElement("div", { style: { minWidth: 0 }}, React.createElement("div", { style: { fontSize: 14, fontWeight: 700 }}, rk.name), React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.55)" }}, rk.grund + " \xb7 " + rk.typ))),
            React.createElement("div", { style: { fontSize: 15, fontWeight: 800, color: "#ef4444", flexShrink: 0 }}, rk.tage + " Tage \u2192"));
        })),
      shakeMsg && React.createElement("div", { style: { width: "100%", padding: "10px 14px", borderRadius: 10, background: "rgba(239,68,68,0.15)", border: "2px solid rgba(239,68,68,0.6)", marginBottom: 10, textAlign: "center", animation: "shk 0.5s ease" }}, React.createElement("div", { style: { fontSize: 13, fontWeight: 800, color: "#ef4444" }}, shakeMsg)),
      React.createElement("div", { style: { textAlign: "center", marginTop: 6, width: "100%" }},
        React.createElement("div", { style: { width: 56, height: 56, borderRadius: "50%", border: "3px solid " + (canDismiss ? "rgba(52,211,153,0.5)" : "rgba(239,68,68,0.5)"), display: "flex", alignItems: "center", justifyContent: "center", margin: "0 auto 10px", fontSize: 20, fontWeight: 900, color: canDismiss ? "#34D399" : "#ef4444", background: canDismiss ? "rgba(52,211,153,0.08)" : "rgba(239,68,68,0.08)" }}, canDismiss ? "\u2713" : countdown),
        React.createElement("button", { onClick: handleBtn, style: { padding: "12px 32px", borderRadius: 12, border: canDismiss ? "none" : "2px solid rgba(239,68,68,0.4)", background: canDismiss ? "linear-gradient(135deg, #22c55e, #16a34a)" : "rgba(239,68,68,0.08)", color: canDismiss ? "#fff" : "#ef4444", fontSize: 14, fontWeight: 800, fontFamily: font, cursor: "pointer", boxShadow: canDismiss ? "0 4px 20px rgba(34,197,94,0.4)" : "none" }}, canDismiss ? "\u2705 Weiter zum Dashboard" : "\u2192 Zum Dashboard"),
        tried > 0 && React.createElement("div", { style: { fontSize: 11, color: "rgba(239,68,68,0.7)", marginTop: 8, fontWeight: 700 }}, "Versuch " + tried + " \u2014 +" + (tried * 10) + "s hinzugef\xfcgt"),
        React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.35)", marginTop: 4, paddingBottom: 20 }}, canDismiss ? "Du darfst jetzt weiter" : "Noch " + countdown + " Sek. warten"))));
}

function DashboardScreen({ onNewAufnahme, onTerminClick, rueckkehrer, onRueckkehrerClick, onRueckkehrerErledigt }) {
  const [clk, setClk] = useState(new Date());
  const [showAlertSplash, setShowAlertSplash] = useState(false);
  const [alertPulse, setAlertPulse] = useState(false);
  const [selectedRK, setSelectedRK] = useState(null);
  const [rkNotes, setRkNotes] = useState({});
  const [selectedStorno, setSelectedStorno] = useState(null);
  const [rettungNotiz, setRettungNotiz] = useState("");
  const [showRettungNotiz, setShowRettungNotiz] = useState(false);
  const [showManualConfirm, setShowManualConfirm] = useState(false);
  const [showReferral, setShowReferral] = useState(false);
  const [refForm, setRefForm] = useState({ vorname: "", nachname: "", telefon: "", email: "", plz: "", ort: "" });
  const [refCode, setRefCode] = useState("");
  const [refSent, setRefSent] = useState(false);
  const [statsPopup, setStatsPopup] = useState(null);
  useEffect(() => { const t = setInterval(() => setClk(new Date()), 60000); return () => clearInterval(t); }, []);
  useEffect(() => { if(showAlertSplash) { var p = setInterval(function(){ setAlertPulse(function(v){return !v;}); }, 600); var t2 = setTimeout(function(){ setShowAlertSplash(false); }, 10000); return function(){ clearTimeout(t2); clearInterval(p); }; } }, [showAlertSplash]);

  // Termine mit Distanzen, Wetter & Scouter-Notizen
  const termine = [
    { zeit: "09:00", name: "M\xFCller, Detmold", typ: "PV", status: "offen", distVon: "Bielefeld (Start)", distKm: 32, distMin: 35, wetter: "\u2600\uFE0F 4\xB0C", scouterNotiz: "Hat einen Hund (Sch\xE4ferhund). Klingel defekt, bitte klopfen.", kunde: { anrede: "Herr", vorname: "Thomas", nachname: "M\xFCller", strasse: "Lemgoer Str.", hausnr: "42", plz: "32756", ort: "Detmold", telefon: "05231 9876543", mobil: "0176 34567890", email: "t.mueller@mail.de" }},
    { zeit: "11:30", name: "Weber, Bielefeld", typ: "WP", status: "offen", distVon: "Detmold", distKm: 32, distMin: 35, wetter: "\u26C5 5\xB0C", scouterNotiz: "Ehepaar, beide m\xFCssen anwesend sein. Dach Ost-West.", kunde: { anrede: "Frau", vorname: "Sandra", nachname: "Weber", strasse: "Herforder Str.", hausnr: "118", plz: "33602", ort: "Bielefeld", telefon: "0521 1234567", mobil: "0171 98765432", email: "s.weber@web.de" }},
    { zeit: "14:00", name: "Schmidt, G\xFCtersloh", typ: "PV+WP", status: "offen", distVon: "Bielefeld", distKm: 18, distMin: 22, wetter: "\uD83C\uDF24\uFE0F 6\xB0C", scouterNotiz: "Neubau 2023, WP bereits geplant. Hoher Stromverbrauch 6000 kWh.", kunde: { anrede: "Herr", vorname: "Martin", nachname: "Schmidt", strasse: "Berliner Str.", hausnr: "7a", plz: "33330", ort: "G\xFCtersloh", telefon: "05241 5556677", mobil: "0152 12345678", email: "m.schmidt@gmail.com" }},
    { zeit: "16:30", name: "Braun, Paderborn", typ: "PV", status: "best\xE4tigt", distVon: "G\xFCtersloh", distKm: 35, distMin: 40, wetter: "\uD83C\uDF27\uFE0F 3\xB0C", scouterNotiz: "Kunde will schnell, Vergleich mit Enpal. Garage-Dach evtl. zus\xE4tzlich.", kunde: { anrede: "Herr", vorname: "Klaus", nachname: "Braun", strasse: "Warburger Str.", hausnr: "55", plz: "33098", ort: "Paderborn", telefon: "05251 4443322", mobil: "0163 87654321", email: "k.braun@t-online.de" }},
  ];

  // Aktuellen Termin ermitteln
  const currentTerminIdx = (() => {
    const now = clk.getHours() * 60 + clk.getMinutes();
    for (let i = termine.length - 1; i >= 0; i--) {
      const [h, m] = termine[i].zeit.split(":").map(Number);
      if (now >= h * 60 + m) return i;
    }
    return -1;
  })();

  // Stats mit klickbaren Detail-Listen
  const terminStats = { heute: 4, woche: 12, monat: 38 };
  const salesStats = { heute: 1, woche: 3, monat: 10 };
  const stornoStats = { heute: 0, woche: 1, monat: 3 };
  // Demo Kundenlisten f\xFCr Klick-Popup
  const statsListen = {
    "termine_heute": [{n:"M\xFCller, Detmold",t:"PV"},{n:"Weber, Bielefeld",t:"WP"},{n:"Schmidt, G\xFCtersloh",t:"PV+WP"},{n:"Braun, Paderborn",t:"PV"}],
    "termine_woche": [{n:"M\xFCller, Detmold",t:"PV"},{n:"Weber, Bielefeld",t:"WP"},{n:"Schmidt, G\xFCtersloh",t:"PV+WP"},{n:"Braun, Paderborn",t:"PV"},{n:"Schulze, Herford",t:"PV"},{n:"Becker, Minden",t:"WP"},{n:"Huber, Lage",t:"PV"},{n:"Frank, Horn",t:"PV+WP"},{n:"Meier, Bad Salzuflen",t:"PV"},{n:"Wagner, Detmold",t:"WP"},{n:"Koch, Bielefeld",t:"PV"},{n:"Richter, G\xFCtersloh",t:"PV+WP"}],
    "termine_monat": [{n:"38 Termine in Feb. 2026",t:"Liste"}],
    "sales_heute": [{n:"Schmidt, G\xFCtersloh",t:"PV+WP 14.2 kWp"}],
    "sales_woche": [{n:"Schmidt, G\xFCtersloh",t:"PV+WP 14.2 kWp"},{n:"Schulze, Herford",t:"PV 9.8 kWp"},{n:"Becker, Minden",t:"WP 12 kW"}],
    "sales_monat": [{n:"10 Abschl\xFCsse in Feb.",t:"Pipeline 142.000\u20AC"}],
    "storno_heute": [],
    "storno_woche": [{n:"Petersen, Lemgo",t:"Preis zu hoch"}],
    "storno_monat": [{n:"Petersen, Lemgo",t:"Preis"},{n:"Drescher, Herford",t:"Finanzierung"},{n:"Klein, Herford",t:"Finanzierung"}],
  };

  // Letzte Aufnahmen MIT Board-Status
  const letzte = [
    { name: "Schneider", ort: "Herford", typ: "PV", kwp: "9.8", zeit: "Gestern 16:20", board: "DC-Montage", boardColor: "#3b82f6" },
    { name: "Fischer", ort: "Minden", typ: "WP", kwp: "\u2014", zeit: "Gestern 11:45", board: "Netzanmeldung", boardColor: "#a855f7" },
    { name: "Hoffmann", ort: "Bielefeld", typ: "PV", kwp: "12.3", zeit: "21.02. 14:10", board: "Abgeschlossen", boardColor: "#22c55e" },
    { name: "Yilmaz", ort: "Bielefeld", typ: "PV+WP", kwp: "14.7", zeit: "20.02. 10:30", board: "AC-Montage", boardColor: "#f59e0b" },
    { name: "Krause", ort: "Detmold", typ: "PV", kwp: "11.4", zeit: "19.02. 15:00", board: "Storno", boardColor: "#ef4444" },
  ];

  // Storno-Retter
  const [stornos, setStornos] = useState([
    { id: "st1", name: "Petersen, Lemgo", plz: "32657", ort: "Lemgo", typ: "PV 10.2 kWp", grund: "Preis zu hoch", stornoDatum: "22.02.2026", restStunden: 26, aufgabe: "Kunde hat bei Enpal g\xFCnstiger gesehen. Nachverhandlung m\xF6glich \u2014 Rabattfreigabe bei Patrick anfragen.", notiz: "Frau Petersen war beim Termin sehr interessiert, Mann hat gebremst", kontakt: "0170 1234567" },
    { id: "st2", name: "Klein, Herford", plz: "32049", ort: "Herford", typ: "PV+WP 13.5 kWp", grund: "Finanzierung abgelehnt", stornoDatum: "23.02.2026", restStunden: 44, aufgabe: "EFS hat abgelehnt, Alternative: SWK Finanzierung pr\xFCfen oder Barzahlung mit Sonderskonto.", notiz: null, kontakt: "0152 9876543" },
  ]);

  // Ranking mit allen KPIs + Gamification
  const ranking = [
    { name: "Du", initialen: "DU", color: "#F5C500", abschluesse: 10, verdient: 17000, eigenleads: 4, empfehlungen: 3, speicher: 2, zero: 1, weekDeals: 3, streak: 5, convRate: 32 },
    { name: "Lisa M.", initialen: "LM", color: "#ec4899", abschluesse: 9, verdient: 15300, eigenleads: 2, empfehlungen: 4, speicher: 1, zero: 2, weekDeals: 2, streak: 3, convRate: 28 },
    { name: "Kevin T.", initialen: "KT", color: "#3b82f6", abschluesse: 7, verdient: 11900, eigenleads: 3, empfehlungen: 1, speicher: 3, zero: 0, weekDeals: 1, streak: 1, convRate: 22 },
    { name: "Sarah W.", initialen: "SW", color: "#22c55e", abschluesse: 5, verdient: 8500, eigenleads: 1, empfehlungen: 2, speicher: 1, zero: 1, weekDeals: 1, streak: 0, convRate: 18 },
    { name: "Max B.", initialen: "MB", color: "#f97316", abschluesse: 4, verdient: 6800, eigenleads: 2, empfehlungen: 0, speicher: 0, zero: 1, weekDeals: 0, streak: 0, convRate: 14 },
  ];
  var myRank = 1;
  var myBadges = [
    { icon: "\uD83D\uDD25", label: "10+ Deals/Monat", earned: true },
    { icon: "\uD83C\uDFAF", label: "30%+ Conversion", earned: true },
    { icon: "\uD83D\uDE80", label: "3+ Deals/Woche", earned: true },
    { icon: "\u26A1", label: "5-Tage Streak", earned: true },
    { icon: "\uD83D\uDC8E", label: "20k+ Provision", earned: false },
    { icon: "\uD83D\uDC51", label: "Monats-Champion", earned: false },
  ];

  // N\xE4chster Termin
  var nextTermin = (() => {
    var now = clk.getHours() * 60 + clk.getMinutes();
    for (var i = 0; i < termine.length; i++) {
      var parts = termine[i].zeit.split(":");
      var tMin = parseInt(parts[0]) * 60 + parseInt(parts[1]);
      if (tMin > now) return Object.assign({}, termine[i], { minBis: tMin - now });
    }
    return null;
  })();

  // Provisionstufe: ab 8 Auftr\xE4ge = 1700\u20AC
  var salesMonat = salesStats.monat;
  var provStufen = [{ab:0,prov:1400},{ab:8,prov:1700}];
  var currentStufe = provStufen.slice().reverse().find(function(s){ return salesMonat >= s.ab; }) || provStufen[0];
  var nextStufe = provStufen.find(function(s){ return s.ab > salesMonat; });
  var fehlendBis = nextStufe ? (nextStufe.ab - salesMonat) : 0;
  // Rückwirkend: ab 8 Aufträge werden ALLE mit 1700€ vergütet
  var provVerdient = salesMonat >= 8 ? salesMonat * 1700 : salesMonat * 1400;

  const gr = clk.getHours() < 12 ? "Guten Morgen" : clk.getHours() < 18 ? "Guten Tag" : "Guten Abend";
  const ds = clk.toLocaleDateString("de-DE", { weekday: "long", day: "2-digit", month: "long", year: "numeric" });
  const ts = clk.toLocaleTimeString("de-DE", { hour: "2-digit", minute: "2-digit" });
  const cs = { background: "rgba(255,255,255,0.03)", border: "1px solid rgba(255,255,255,0.08)", borderRadius: 16, padding: "18px 20px" };
  const ls = { fontSize: 10, color: "rgba(255,255,255,0.45)", fontWeight: 700, textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 12 };
  return React.createElement("div", { style: { position: "fixed", inset: 0, zIndex: 10000, background: "radial-gradient(ellipse at 30% 20%, rgba(232,212,77,0.06) 0%, transparent 50%), radial-gradient(ellipse at 70% 80%, rgba(96,165,250,0.04) 0%, transparent 50%), #0A0E1A", fontFamily: font, color: "#fff", overflowX: "hidden", overflowY: "auto", padding: 0, width: "100%", maxWidth: "100vw", boxSizing: "border-box" }},
    /* ── ALERT SPLASH (10s) ── */
    showAlertSplash && React.createElement("div", { style: { position: "fixed", inset: 0, zIndex: 30000, background: "radial-gradient(ellipse at 50% 30%, rgba(239,68,68,0.08) 0%, #0A0E1A 70%)", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center", padding: 28, fontFamily: font, animation: "fadeInUp 0.4s ease" }},
      React.createElement("div", { style: { fontSize: 48, marginBottom: 16, animation: alertPulse ? "none" : "none" }}, "\u{1F6A8}"),
      React.createElement("div", { style: { fontSize: 22, fontWeight: 900, color: alertPulse ? "#ef4444" : "#ff6b6b", marginBottom: 6, transition: "color 0.3s", textAlign: "center" }}, "ACHTUNG \u2014 OFFENE AUFGABEN"),
      React.createElement("div", { style: { fontSize: 12, color: "rgba(255,255,255,0.4)", marginBottom: 28 }}, "Diese Kunden brauchen deine Aufmerksamkeit!"),

      /* Storno-Retter */
      stornos.length > 0 && React.createElement("div", { style: { width: "100%", maxWidth: 440, marginBottom: 16 }},
        React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: "#f97316", textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 8 }}, "\uD83D\uDD25 STORNO-RETTER \u2014 Frist l\xE4uft!"),
        stornos.map(function(st, i) {
          var urgent = st.restStunden < 30;
          return React.createElement("div", { key: i, style: { display: "flex", alignItems: "center", justifyContent: "space-between", padding: "14px 16px", marginBottom: 8, borderRadius: 12, background: alertPulse && urgent ? "rgba(239,68,68,0.12)" : "rgba(249,115,22,0.06)", border: alertPulse && urgent ? "2px solid rgba(239,68,68,0.5)" : "1.5px solid rgba(249,115,22,0.25)", transition: "all 0.3s" }},
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 }},
              React.createElement("div", { style: { fontSize: 22 }}, "\uD83D\uDD25"),
              React.createElement("div", null,
                React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: "#fff" }}, st.name),
                React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.5)" }}, st.grund + " \xB7 " + st.typ))),
            React.createElement("div", { style: { fontSize: 20, fontWeight: 900, color: urgent ? (alertPulse ? "#ef4444" : "#ff8888") : "#f97316", transition: "color 0.3s" }}, st.restStunden + " Std."));
        })),

      /* R\xFCckkehrer */
      React.createElement("div", { style: { width: "100%", maxWidth: 440, marginBottom: 28 }},
        React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: "#ef4444", textTransform: "uppercase", letterSpacing: 1.5, marginBottom: 8 }}, "\u{1F6A8} R\xDCCKKEHRER AUS MONTAGE \u2014 Aktion n\xF6tig!"),
        (rueckkehrer || [{ name: "Krause, Detmold", grund: "Z\xE4hlerschrank zu klein", typ: "PV 11.4 kWp", tage: "3T" }, { name: "Yilmaz, Bielefeld", grund: "Dachsanierung n\xF6tig", typ: "PV+WP 14.7 kWp", tage: "7T" }, { name: "Hofmann, Herford", grund: "Netzanmeldung abgelehnt", typ: "PV 9.5 kWp", tage: "12T" }]).map(function(rk, i) {
          return React.createElement("div", { key: i, style: { display: "flex", alignItems: "center", justifyContent: "space-between", padding: "14px 16px", marginBottom: 8, borderRadius: 12, background: alertPulse ? "rgba(239,68,68,0.08)" : "rgba(239,68,68,0.04)", border: alertPulse ? "2px solid rgba(239,68,68,0.4)" : "1.5px solid rgba(239,68,68,0.2)", transition: "all 0.3s" }},
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 }},
              React.createElement("div", { style: { width: 32, height: 32, borderRadius: 8, background: "rgba(239,68,68,0.15)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 16 }}, "\u26A0\uFE0F"),
              React.createElement("div", null,
                React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: "#fff" }}, rk.name),
                React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.5)" }}, rk.grund + " \xB7 " + rk.typ))),
            React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: alertPulse ? "#ef4444" : "#ff8888", transition: "color 0.3s" }}, rk.tage + " \u2192"));
        })),

      /* Countdown + Skip Button */
      React.createElement("div", { style: { textAlign: "center" }},
        React.createElement("button", { onClick: function() { setShowAlertSplash(false); }, style: { padding: "14px 40px", borderRadius: 12, border: "1.5px solid rgba(255,255,255,0.15)", background: "rgba(255,255,255,0.05)", color: "rgba(255,255,255,0.6)", fontSize: 14, fontWeight: 600, fontFamily: font, cursor: "pointer" }}, "Verstanden \u2192 zum Dashboard"),
        React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.25)", marginTop: 8 }}, "Wechselt automatisch in 10 Sekunden"))),


        /* ── HEADER mit Name + Wetter ── */
    React.createElement("div", { style: { padding: "20px 16px 12px", display: "flex", justifyContent: "space-between", alignItems: "flex-start", flexWrap: "wrap", gap: 8 }},
      React.createElement("div", { style: { minWidth: 0, flex: "1 1 200px" }},
        React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, marginBottom: 4, flexWrap: "nowrap" }},
          React.createElement("span", { style: { fontSize: 28, fontWeight: 900 }}, "bee"),
          React.createElement("span", { style: { fontSize: 28, fontWeight: 900, color: "#F5C500" }}, "\xB7"),
          React.createElement("span", { style: { fontSize: 28, fontWeight: 900 }}, "doo"),
          React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: "rgba(255,255,255,0.3)", marginLeft: 8, borderLeft: "2px solid rgba(255,255,255,0.15)", paddingLeft: 8 }}, "FIELD")),
        React.createElement("div", { style: { fontSize: 14, color: "rgba(255,255,255,0.6)", marginTop: 4 }}, "Hallo Bernd \uD83D\uDC4B Willkommen in der bee-doo Welt"),
        React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.4)", marginTop: 2 }}, gr + " \xB7 " + ds)),
      React.createElement("div", { style: { textAlign: "right", flexShrink: 0 }},
        React.createElement("div", { style: { fontSize: 28, fontWeight: 900, color: "#F5C500" }}, ts),
        React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.3)" }}, "NRW \xB7 bee-doo GmbH"))),

    React.createElement("div", { className: "field-grid", style: { padding: "0 12px 28px", display: "grid", gridTemplateColumns: "1fr", gap: 10, maxWidth: 900, margin: "0 auto" }},

      /* ── NÄCHSTER TERMIN (ganz oben, volle Breite) ── */
      nextTermin && React.createElement("div", { style: { ...cs, gridColumn: "1 / -1", background: "rgba(52,211,153,0.04)", borderColor: "rgba(52,211,153,0.2)", cursor: "pointer" }, onClick: function() { if(onTerminClick && nextTermin.kunde) onTerminClick(nextTermin); } },
        React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between" }},
          React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 12 }},
            React.createElement("div", { style: { width: 44, height: 44, borderRadius: 12, background: "rgba(52,211,153,0.12)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 22 }}, "\uD83D\uDE97"),
            React.createElement("div", null,
              React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: "#34D399" }}, "N\xE4chster Termin in " + (nextTermin.minBis >= 60 ? Math.floor(nextTermin.minBis/60) + "h " + (nextTermin.minBis%60) + "min" : nextTermin.minBis + "min")),
              React.createElement("div", { style: { fontSize: 12, color: "rgba(255,255,255,0.6)", marginTop: 2 }}, nextTermin.name + " \xB7 " + nextTermin.typ),
              nextTermin.scouterNotiz && React.createElement("div", { style: { fontSize: 10, color: "rgba(130,185,255,0.85)", marginTop: 3 }}, "\uD83D\uDCDD " + nextTermin.scouterNotiz))),
          React.createElement("div", { style: { textAlign: "right" }},
            React.createElement("div", { style: { fontSize: 22, fontWeight: 800, color: "#34D399" }}, nextTermin.zeit),
            React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.3)" }}, nextTermin.wetter),
            nextTermin.distKm && React.createElement("div", { style: { fontSize: 10, color: "rgba(130,185,255,0.8)", marginTop: 2 }}, "\uD83D\uDEE3\uFE0F " + nextTermin.distKm + " km \xB7 ~" + nextTermin.distMin + " min")))),

      /* ── STATS: Termine / Sales / Storno (klickbar) ── */
      React.createElement("div", { style: { ...cs, gridColumn: "1 / -1", padding: "14px 16px" }},
        React.createElement("div", { className: "field-stats", style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 1 }},
          /* Termine */
          React.createElement("div", null,
            React.createElement("div", { style: { fontSize: 9, fontWeight: 700, color: "rgba(255,255,255,0.3)", textTransform: "uppercase", letterSpacing: 1, marginBottom: 8 }}, "\uD83D\uDCC5 Termine"),
            [["Heute", terminStats.heute, "termine_heute"],["Woche", terminStats.woche, "termine_woche"],["Monat", terminStats.monat, "termine_monat"]].map(function(r) {
              return React.createElement("div", { key: r[0], onClick: function() { setStatsPopup({title: "Termine " + r[0], list: statsListen[r[2]] || []}); }, style: { display: "flex", justifyContent: "space-between", padding: "4px 8px", cursor: "pointer", borderRadius: 6, marginBottom: 2 }, onMouseEnter: function(e){e.currentTarget.style.background="rgba(253,225,84,0.06)";}, onMouseLeave: function(e){e.currentTarget.style.background="transparent";} },
                React.createElement("span", { style: { fontSize: 11, color: "rgba(255,255,255,0.6)" }}, r[0]),
                React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: "#F5C500" }}, r[1]));
            })),
          /* Sales */
          React.createElement("div", { style: { borderLeft: "1px solid rgba(255,255,255,0.06)", paddingLeft: 12 }},
            React.createElement("div", { style: { fontSize: 9, fontWeight: 700, color: "rgba(255,255,255,0.3)", textTransform: "uppercase", letterSpacing: 1, marginBottom: 8 }}, "\uD83D\uDCB0 Sales"),
            [["Heute", salesStats.heute, "sales_heute"],["Woche", salesStats.woche, "sales_woche"],["Monat", salesStats.monat, "sales_monat"]].map(function(r) {
              return React.createElement("div", { key: r[0], onClick: function() { setStatsPopup({title: "Sales " + r[0], list: statsListen[r[2]] || []}); }, style: { display: "flex", justifyContent: "space-between", padding: "4px 8px", cursor: "pointer", borderRadius: 6, marginBottom: 2 }, onMouseEnter: function(e){e.currentTarget.style.background="rgba(52,211,153,0.06)";}, onMouseLeave: function(e){e.currentTarget.style.background="transparent";} },
                React.createElement("span", { style: { fontSize: 11, color: "rgba(255,255,255,0.6)" }}, r[0]),
                React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: "#22c55e" }}, r[1]));
            })),
          /* Storno */
          React.createElement("div", { style: { borderLeft: "1px solid rgba(255,255,255,0.06)", paddingLeft: 12 }},
            React.createElement("div", { style: { fontSize: 9, fontWeight: 700, color: "rgba(255,255,255,0.3)", textTransform: "uppercase", letterSpacing: 1, marginBottom: 8 }}, "\u274C Storno"),
            [["Heute", stornoStats.heute, "storno_heute"],["Woche", stornoStats.woche, "storno_woche"],["Monat", stornoStats.monat, "storno_monat"]].map(function(r) {
              return React.createElement("div", { key: r[0], onClick: function() { setStatsPopup({title: "Storno " + r[0], list: statsListen[r[2]] || []}); }, style: { display: "flex", justifyContent: "space-between", padding: "4px 8px", cursor: "pointer", borderRadius: 6, marginBottom: 2 }, onMouseEnter: function(e){e.currentTarget.style.background="rgba(239,68,68,0.06)";}, onMouseLeave: function(e){e.currentTarget.style.background="transparent";} },
                React.createElement("span", { style: { fontSize: 11, color: "rgba(255,255,255,0.6)" }}, r[0]),
                React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: r[1] > 0 ? "#ef4444" : "rgba(255,255,255,0.2)" }}, r[1]));
            }))),

      /* ── Stats Popup Modal ── */
      statsPopup && React.createElement("div", { onClick: function() { setStatsPopup(null); }, style: { position: "fixed", inset: 0, zIndex: 21000, background: "rgba(0,0,0,0.6)", display: "flex", alignItems: "center", justifyContent: "center", padding: 20 }},
        React.createElement("div", { onClick: function(e) { e.stopPropagation(); }, style: { width: "100%", maxWidth: 360, background: "#1A2332", borderRadius: 16, border: "1px solid rgba(255,255,255,0.1)", overflow: "hidden" }},
          React.createElement("div", { style: { padding: "14px 18px", borderBottom: "1px solid rgba(255,255,255,0.06)", display: "flex", justifyContent: "space-between", alignItems: "center" }},
            React.createElement("div", { style: { fontSize: 14, fontWeight: 700 }}, statsPopup.title),
            React.createElement("button", { onClick: function() { setStatsPopup(null); }, style: { background: "none", border: "none", color: "rgba(255,255,255,0.4)", fontSize: 18, cursor: "pointer" }}, "\xD7")),
          React.createElement("div", { style: { padding: "12px 18px", maxHeight: 300, overflow: "auto" }},
            statsPopup.list.length === 0 ? React.createElement("div", { style: { fontSize: 12, color: "rgba(255,255,255,0.3)", textAlign: "center", padding: 20 }}, "Keine Eintr\xE4ge") :
            statsPopup.list.map(function(item, i) {
              return React.createElement("div", { key: i, style: { display: "flex", justifyContent: "space-between", padding: "8px 0", borderBottom: i < statsPopup.list.length - 1 ? "1px solid rgba(255,255,255,0.04)" : "none" }},
                React.createElement("span", { style: { fontSize: 12, fontWeight: 600 }}, item.n),
                React.createElement("span", { style: { fontSize: 11, color: "rgba(255,255,255,0.4)" }}, item.t));
            })))),

      /* ── HEUTIGE TERMINE mit Fahrtzeiten + Wetter + Scouter-Notizen ── */
      React.createElement("div", { style: cs },
        React.createElement("div", { style: ls }, "\uD83D\uDCC5 Heutige Termine"),
        ...termine.map(function(t, i) {
          var isCurrent = i === currentTerminIdx;
          return React.createElement(React.Fragment, { key: i },
            i > 0 && React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, padding: "4px 0 4px 48px", margin: "2px 0" }},
              React.createElement("div", { style: { flex: 1, height: 1, background: "rgba(130,185,255,0.12)" }}),
              React.createElement("div", { style: { fontSize: 9, color: "rgba(130,185,255,0.7)", whiteSpace: "nowrap" }}, "\uD83D\uDE97 " + (t.distKm || "?") + " km \xB7 ~" + (t.distMin || "?") + " min"),
              React.createElement("div", { style: { flex: 1, height: 1, background: "rgba(130,185,255,0.12)" }})),
            React.createElement("div", { onClick: function() { if(onTerminClick && t.kunde) onTerminClick(t); }, style: { display: "flex", alignItems: "center", gap: 10, padding: "10px 6px", cursor: t.kunde ? "pointer" : "default", borderRadius: 8, margin: "0 -6px", background: isCurrent ? "rgba(52,211,153,0.08)" : "transparent", border: isCurrent ? "1.5px solid rgba(52,211,153,0.3)" : "1.5px solid transparent", animation: isCurrent ? "pulseGreen 2s infinite" : "none" }, onMouseEnter: function(e) { if(t.kunde) e.currentTarget.style.background = isCurrent ? "rgba(52,211,153,0.15)" : "rgba(253,225,84,0.06)"; }, onMouseLeave: function(e) { e.currentTarget.style.background = isCurrent ? "rgba(52,211,153,0.08)" : "transparent"; } },
              isCurrent && React.createElement("div", { style: { width: 6, height: 6, borderRadius: "50%", background: "#34D399", boxShadow: "0 0 8px rgba(52,211,153,0.6)", animation: "pulse 1.5s infinite", flexShrink: 0 } }),
              React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: "#F5C500", minWidth: 48 } }, t.zeit),
              React.createElement("div", { style: { flex: 1 } },
                React.createElement("div", { style: { fontSize: 13, fontWeight: 600 } }, t.name),
                React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.45)" } }, t.typ),
                t.scouterNotiz && React.createElement("div", { style: { fontSize: 9, color: "rgba(130,185,255,0.8)", marginTop: 2 }}, "\uD83D\uDCDD " + t.scouterNotiz)),
              React.createElement("div", { style: { textAlign: "right" }},
                React.createElement("div", { style: { fontSize: 9, fontWeight: 700, padding: "3px 8px", borderRadius: 6, background: isCurrent ? "rgba(52,211,153,0.2)" : t.status === "best\xE4tigt" ? "rgba(52,211,153,0.15)" : "rgba(253,225,84,0.1)", color: isCurrent ? "#34D399" : t.status === "best\xE4tigt" ? "#34D399" : "#F5C500" } }, isCurrent ? "JETZT" : t.status.toUpperCase()),
                React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.3)", marginTop: 3 }}, t.wetter || "")),
              t.kunde && React.createElement("span", { style: { fontSize: 14, color: isCurrent ? "rgba(52,211,153,0.6)" : "rgba(253,225,84,0.4)", marginLeft: 4 } }, "\u203A")));
        })),

      /* ── STORNO-RETTER ── */
      stornos.length > 0 && React.createElement("div", { style: { ...cs, gridColumn: "1 / -1", borderColor: "rgba(249,115,22,0.3)", background: "rgba(249,115,22,0.03)" }},
        React.createElement("div", { style: { ...ls, color: "#f97316", display: "flex", alignItems: "center", gap: 6 }}, "\uD83D\uDD25 STORNO-RETTER ", React.createElement("span", { style: { background: "#f97316", color: "#fff", borderRadius: 10, padding: "1px 7px", fontSize: 10, fontWeight: 800 }}, stornos.length)),
        React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.45)", marginBottom: 10, marginTop: -6 }}, "Kunden heilen bevor die Frist abl\xE4uft!"),
        stornos.map(function(st, i) {
          var pct = Math.max(0, Math.round((st.restStunden / 48) * 100));
          var barColor = pct > 50 ? "#f97316" : pct > 25 ? "#ef4444" : "#dc2626";
          return React.createElement("button", { key: i, onClick: function() { setSelectedStorno(st); }, style: { width: "100%", display: "flex", alignItems: "center", justifyContent: "space-between", padding: "12px 14px", marginBottom: i < stornos.length - 1 ? 8 : 0, borderRadius: 12, border: "1.5px solid rgba(249,115,22,0.2)", background: "rgba(249,115,22,0.04)", cursor: "pointer", fontFamily: font, textAlign: "left" }},
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, flex: 1 }},
              React.createElement("div", { style: { width: 38, height: 38, borderRadius: 10, background: "rgba(249,115,22,0.12)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 18 }}, "\uD83D\uDD25"),
              React.createElement("div", { style: { flex: 1 }},
                React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: "#fff" }}, st.name),
                React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.5)" }}, st.grund + " \xB7 " + st.typ),
                React.createElement("div", { style: { marginTop: 4, height: 3, borderRadius: 2, background: "rgba(255,255,255,0.06)", overflow: "hidden" }},
                  React.createElement("div", { style: { width: pct + "%", height: "100%", background: barColor, borderRadius: 2, transition: "width 0.5s" }})))),
            React.createElement("div", { style: { textAlign: "right", flexShrink: 0, marginLeft: 10 }},
              React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: barColor }}, st.restStunden + " Std."),
              React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.4)" }}, "verbleibend")));
        })
      ),

      /* ── RÜCKKEHRER AUS MONTAGE ── */
      React.createElement("div", { style: { gridColumn: "1 / -1" }},

      /* ── STORNO DETAIL MODAL ── */
      selectedStorno && React.createElement("div", { style: { position: "fixed", inset: 0, zIndex: 20000, background: "rgba(0,0,0,0.7)", display: "flex", alignItems: "center", justifyContent: "center", padding: 20 }},
        React.createElement("div", { style: { width: "100%", maxWidth: 420, background: "#1A2332", borderRadius: 18, border: "1.5px solid rgba(249,115,22,0.3)", overflow: "hidden" }},
          React.createElement("div", { style: { padding: "18px 20px", background: "rgba(249,115,22,0.08)", borderBottom: "1px solid rgba(249,115,22,0.2)" }},
            React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between" }},
              React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: "#f97316" }}, "\uD83D\uDD25 Storno retten"),
              React.createElement("button", { onClick: function() { setSelectedStorno(null); setRettungNotiz(""); setShowRettungNotiz(false); }, style: { background: "none", border: "none", color: "rgba(255,255,255,0.4)", fontSize: 20, cursor: "pointer", padding: "0 4px" }}, "\xD7")),
            React.createElement("div", { style: { fontSize: 13, fontWeight: 600, color: "#fff", marginTop: 4 }}, selectedStorno.name)),
          React.createElement("div", { style: { padding: "16px 20px" }},
            React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginBottom: 14 }},
              [["Typ", selectedStorno.typ], ["PLZ / Ort", selectedStorno.plz + " " + selectedStorno.ort], ["Storno-Grund", selectedStorno.grund], ["Rest-Zeit", selectedStorno.restStunden + " Std."]].map(function(pair, j) {
                return React.createElement("div", { key: j, style: { padding: "8px 10px", background: "rgba(255,255,255,0.03)", borderRadius: 8, border: "1px solid rgba(255,255,255,0.06)" }},
                  React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.35)", textTransform: "uppercase", fontWeight: 700, marginBottom: 2 }}, pair[0]),
                  React.createElement("div", { style: { fontSize: 13, fontWeight: 600, color: "#fff" }}, pair[1]));
              })),
            React.createElement("div", { style: { padding: "12px 14px", background: "rgba(249,115,22,0.06)", borderRadius: 10, border: "1px solid rgba(249,115,22,0.15)", marginBottom: 14 }},
              React.createElement("div", { style: { fontSize: 10, color: "#f97316", fontWeight: 700, textTransform: "uppercase", marginBottom: 6 }}, "\uD83D\uDCCB Rettungs-Strategie"),
              React.createElement("div", { style: { fontSize: 13, color: "#fff", lineHeight: 1.5 }}, selectedStorno.aufgabe)),
            selectedStorno.notiz && React.createElement("div", { style: { padding: "10px 14px", background: "rgba(253,225,84,0.04)", borderRadius: 10, border: "1px solid rgba(253,225,84,0.1)", marginBottom: 14, fontSize: 12, color: "rgba(255,255,255,0.6)" }}, "\uD83D\uDCDD " + selectedStorno.notiz),
            React.createElement("a", { href: "tel:" + selectedStorno.kontakt, style: { display: "block", textAlign: "center", padding: "12px", borderRadius: 10, background: "rgba(52,211,153,0.1)", border: "1px solid rgba(52,211,153,0.2)", color: "#34D399", fontSize: 13, fontWeight: 700, textDecoration: "none", marginBottom: 10 }}, "\uD83D\uDCDE " + selectedStorno.kontakt + " anrufen"),
            React.createElement("div", { style: { display: "flex", gap: 10 }},
              React.createElement("button", { onClick: function() { setSelectedStorno(null); setRettungNotiz(""); setShowRettungNotiz(false); }, style: { flex: 1, padding: "12px", borderRadius: 10, border: "1px solid rgba(255,255,255,0.1)", background: "transparent", color: "rgba(255,255,255,0.5)", fontSize: 13, fontFamily: font, cursor: "pointer" }}, "Sp\xE4ter"),
              React.createElement("button", { onClick: function() { setShowRettungNotiz(true); }, style: { flex: 2, padding: "12px", borderRadius: 10, border: "none", background: showRettungNotiz ? "rgba(249,115,22,0.2)" : "linear-gradient(135deg, #f97316, #ea580c)", color: "#fff", fontSize: 13, fontWeight: 700, fontFamily: font, cursor: "pointer", boxShadow: showRettungNotiz ? "none" : "0 4px 16px rgba(249,115,22,0.3)" }}, "\u2705 Gerettet \u2192 Notiz schreiben")),
            showRettungNotiz && React.createElement("div", { style: { marginTop: 12, animation: "fadeInUp 0.2s ease" }},
              React.createElement("div", { style: { fontSize: 10, color: "#f97316", fontWeight: 700, textTransform: "uppercase", marginBottom: 6 }}, "\uD83D\uDCDD Rettungs-Notiz (Pflicht)"),
              React.createElement("textarea", { value: rettungNotiz, onChange: function(e) { setRettungNotiz(e.target.value); }, placeholder: "Was wurde besprochen? Wie wurde der Kunde gerettet? Neuer Preis, neues Angebot, etc\u2026", style: { width: "100%", minHeight: 80, padding: "12px", borderRadius: 10, border: "1.5px solid rgba(249,115,22,0.3)", background: "rgba(249,115,22,0.04)", color: "#fff", fontSize: 13, fontFamily: font, resize: "vertical", outline: "none", lineHeight: 1.5 }}),
              React.createElement("button", { onClick: function() { if(!rettungNotiz.trim()) return; setStornos(function(prev) { return prev.filter(function(s) { return s.id !== selectedStorno.id; }); }); setSelectedStorno(null); setRettungNotiz(""); setShowRettungNotiz(false); }, disabled: !rettungNotiz.trim(), style: { width: "100%", marginTop: 8, padding: "14px", borderRadius: 10, border: "none", background: rettungNotiz.trim() ? "linear-gradient(135deg, #22c55e, #16a34a)" : "rgba(255,255,255,0.06)", color: rettungNotiz.trim() ? "#fff" : "rgba(255,255,255,0.2)", fontSize: 14, fontWeight: 800, fontFamily: font, cursor: rettungNotiz.trim() ? "pointer" : "not-allowed", boxShadow: rettungNotiz.trim() ? "0 4px 16px rgba(34,197,94,0.3)" : "none", transition: "all 0.2s" }}, "\u2705 Gerettet \u2192 zur\xFCck ins Board"))))
      ),

      React.createElement("div", { style: { gridColumn: "1 / -1" }},
        rueckkehrer && rueckkehrer.length > 0 && React.createElement("div", { style: { ...cs, marginBottom: 14, borderColor: "rgba(239,68,68,0.3)", background: "rgba(239,68,68,0.04)" } },
          React.createElement("div", { style: { ...ls, color: "#ef4444", display: "flex", alignItems: "center", gap: 6 } }, "\u{1F6A8} R\xDCCKKEHRER AUS MONTAGE ", React.createElement("span", { style: { background: "#ef4444", color: "#fff", borderRadius: 10, padding: "1px 7px", fontSize: 10, fontWeight: 800, animation: "pulseRed 1.5s infinite" } }, rueckkehrer.length)),
          rueckkehrer.map(function(rk, i) {
            return React.createElement("button", { key: i, onClick: function() { setSelectedRK(rk); }, style: { width: "100%", display: "flex", alignItems: "center", justifyContent: "space-between", padding: "10px 12px", marginBottom: i < rueckkehrer.length - 1 ? 8 : 0, borderRadius: 10, border: "1.5px solid rgba(239,68,68,0.3)", background: "rgba(239,68,68,0.06)", cursor: "pointer", fontFamily: font, animation: "pulseRed 2s infinite", animationDelay: (i * 0.3) + "s" } },
              React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, textAlign: "left" } },
                React.createElement("div", { style: { width: 36, height: 36, borderRadius: 8, background: "rgba(239,68,68,0.15)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 18 } }, "\u26A0\uFE0F"),
                React.createElement("div", null,
                  React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: "#fff" } }, rk.name),
                  React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.55)" } }, rk.grund, " \xB7 ", rk.typ))),
              React.createElement("div", { style: { fontSize: 10, color: "#ef4444", fontWeight: 700 } }, rk.tage + "T \u2192"));
          })
        ),
        selectedRK && React.createElement("div", { style: { position: "fixed", inset: 0, zIndex: 20000, background: "rgba(0,0,0,0.75)", display: "flex", alignItems: "center", justifyContent: "center", padding: 16 }, onClick: function(e) { if(e.target === e.currentTarget) setSelectedRK(null); } },
          React.createElement("div", { style: { width: "100%", maxWidth: 440, maxHeight: "90vh", background: "#1A2332", borderRadius: 18, border: "1.5px solid rgba(239,68,68,0.3)", overflow: "auto" } },
            /* Header */
            React.createElement("div", { style: { padding: "16px 20px", background: "rgba(239,68,68,0.08)", borderBottom: "1px solid rgba(239,68,68,0.2)", position: "sticky", top: 0, zIndex: 1 } },
              React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between" } },
                React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: "#ef4444" } }, "\u26A0\uFE0F R\xFCckkehrer"),
                React.createElement("button", { onClick: function() { setSelectedRK(null); }, style: { background: "none", border: "none", color: "rgba(255,255,255,0.4)", fontSize: 22, cursor: "pointer", padding: "0 4px", lineHeight: 1 } }, "\xD7")),
              React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: "#fff", marginTop: 4 } }, selectedRK.name),
              React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.35)", marginTop: 2 } }, selectedRK.typ, " \xB7 ", selectedRK.plz, " ", selectedRK.ort)),

            React.createElement("div", { style: { padding: "16px 20px" } },

              /* Auftraggeber & Timing */
              React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginBottom: 12 } },
                [["\u{1F464} Erstellt von", selectedRK.erstelltVon || "Montage"], ["\u{1F4C5} Erstellt am", selectedRK.erstelltAm || "\u2014"], ["\u26A0\uFE0F Grund", selectedRK.grund], ["\u23F3 Seit", selectedRK.tage + " Tagen"]].map(function(pair, j) {
                  return React.createElement("div", { key: j, style: { padding: "8px 10px", background: "rgba(255,255,255,0.03)", borderRadius: 8, border: "1px solid rgba(255,255,255,0.06)" } },
                    React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.35)", textTransform: "uppercase", fontWeight: 700, marginBottom: 2 } }, pair[0]),
                    React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: "#fff" } }, pair[1]));
                })),

              /* Deadline */
              selectedRK.deadline && React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, padding: "10px 14px", marginBottom: 12, borderRadius: 10, background: (function() { var dl = new Date(selectedRK.deadline.split(".").reverse().join("-")); var now = new Date(); var diff = Math.ceil((dl - now) / 86400000); return diff < 0 ? "rgba(239,68,68,0.12)" : diff <= 2 ? "rgba(251,191,36,0.1)" : "rgba(52,211,153,0.06)"; })(), border: "1px solid " + (function() { var dl = new Date(selectedRK.deadline.split(".").reverse().join("-")); var now = new Date(); var diff = Math.ceil((dl - now) / 86400000); return diff < 0 ? "rgba(239,68,68,0.3)" : diff <= 2 ? "rgba(251,191,36,0.25)" : "rgba(52,211,153,0.15)"; })() } },
                React.createElement("span", { style: { fontSize: 16 } }, (function() { var dl = new Date(selectedRK.deadline.split(".").reverse().join("-")); var diff = Math.ceil((dl - new Date()) / 86400000); return diff < 0 ? "\u{1F6A8}" : diff <= 2 ? "\u23F0" : "\u{1F4C6}"; })()),
                React.createElement("div", null,
                  React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.35)", textTransform: "uppercase", fontWeight: 700 } }, "Deadline"),
                  React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: (function() { var dl = new Date(selectedRK.deadline.split(".").reverse().join("-")); var diff = Math.ceil((dl - new Date()) / 86400000); return diff < 0 ? "#ef4444" : diff <= 2 ? "#fbbf24" : "#34D399"; })() } }, selectedRK.deadline, (function() { var dl = new Date(selectedRK.deadline.split(".").reverse().join("-")); var diff = Math.ceil((dl - new Date()) / 86400000); return diff < 0 ? " \u2014 \xDCBERF\xC4LLIG!" : diff === 0 ? " \u2014 HEUTE" : diff === 1 ? " \u2014 morgen" : " \u2014 noch " + diff + " Tage"; })()))),

              /* Aufgabe */
              React.createElement("div", { style: { padding: "12px 14px", background: "rgba(239,68,68,0.06)", borderRadius: 10, border: "1px solid rgba(239,68,68,0.15)", marginBottom: 12 } },
                React.createElement("div", { style: { fontSize: 10, color: "#ef4444", fontWeight: 700, textTransform: "uppercase", marginBottom: 6 } }, "\u{1F4CB} Aufgabe von ", selectedRK.erstelltVon || "Montage"),
                React.createElement("div", { style: { fontSize: 13, color: "#fff", lineHeight: 1.6 } }, selectedRK.aufgabe)),

              /* Montage-Notiz (read-only) */
              selectedRK.notiz && React.createElement("div", { style: { padding: "10px 14px", background: "rgba(253,225,84,0.04)", borderRadius: 10, border: "1px solid rgba(253,225,84,0.1)", marginBottom: 12, fontSize: 12, color: "rgba(255,255,255,0.6)" } },
                React.createElement("div", { style: { fontSize: 9, color: "rgba(253,225,84,0.6)", fontWeight: 700, textTransform: "uppercase", marginBottom: 4 } }, "\u{1F4DD} Notiz Montage"),
                selectedRK.notiz),

              /* Vertrieb Antwort-Feld */
              React.createElement("div", { style: { marginBottom: 14 } },
                React.createElement("div", { style: { fontSize: 10, color: "#60A5FA", fontWeight: 700, textTransform: "uppercase", marginBottom: 6, letterSpacing: 0.5 } }, "\u270F\uFE0F Deine Antwort / Notiz"),
                React.createElement("textarea", {
                  value: rkNotes[selectedRK.id] || "",
                  onChange: function(e) { var id = selectedRK.id; setRkNotes(function(prev) { var n = Object.assign({}, prev); n[id] = e.target.value; return n; }); },
                  placeholder: "Status-Update, R\xFCckfrage, Ergebnis\u2026",
                  rows: 3,
                  style: { width: "100%", padding: "12px 14px", background: "rgba(96,165,250,0.06)", border: "1.5px solid rgba(96,165,250,0.2)", borderRadius: 10, color: "#fff", fontSize: 13, fontFamily: font, lineHeight: 1.5, resize: "vertical", outline: "none", boxSizing: "border-box" }
                }),
                (rkNotes[selectedRK.id] || "").length > 0 && React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.2)", textAlign: "right", marginTop: 2 } }, (rkNotes[selectedRK.id] || "").length, " Zeichen")),

              /* Buttons */
              React.createElement("div", { style: { display: "flex", gap: 8 } },
                React.createElement("button", { onClick: function() { setSelectedRK(null); }, style: { flex: 1, padding: "12px", borderRadius: 10, border: "1px solid rgba(255,255,255,0.1)", background: "transparent", color: "rgba(255,255,255,0.5)", fontSize: 13, fontFamily: font, cursor: "pointer" } }, "Sp\xE4ter"),
                React.createElement("button", { onClick: function() { if (onRueckkehrerErledigt) onRueckkehrerErledigt(selectedRK.id, rkNotes[selectedRK.id] || ""); setSelectedRK(null); }, style: { flex: 2, padding: "12px", borderRadius: 10, border: "none", background: "linear-gradient(135deg, #22c55e, #16a34a)", color: "#fff", fontSize: 13, fontWeight: 700, fontFamily: font, cursor: "pointer", boxShadow: "0 4px 16px rgba(34,197,94,0.3)" } }, "\u2705 Erledigt \u2192 Montage"))
            )
          )
        ),
        
      /* ── LETZTE AUFNAHMEN ── */
      React.createElement("div", { style: cs },
        React.createElement("div", { style: ls }, "\uD83D\uDD70 Letzte Aufnahmen"),
        ...letzte.map(function(l, i) { return React.createElement("div", { key: i, style: { display: "flex", alignItems: "center", gap: 10, padding: "10px 0", borderBottom: i < letzte.length - 1 ? "1px solid rgba(255,255,255,0.05)" : "none" }},
          React.createElement("div", { style: { width: 36, height: 36, borderRadius: 10, background: l.typ === "PV" ? "rgba(253,225,84,0.1)" : l.typ === "WP" ? "rgba(239,68,68,0.1)" : "rgba(96,165,250,0.1)", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 16 }}, l.typ === "PV" ? "\u2600\uFE0F" : l.typ === "WP" ? "\uD83C\uDF21" : "\u26A1"),
          React.createElement("div", { style: { flex: 1 }},
            React.createElement("div", { style: { fontSize: 13, fontWeight: 600 }}, l.name + ", " + l.ort),
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6, marginTop: 2 }},
              React.createElement("span", { style: { fontSize: 10, color: "rgba(255,255,255,0.5)" }}, l.typ + (l.kwp !== "\u2014" ? " \xB7 " + l.kwp + " kWp" : "")),
              React.createElement("span", { style: { fontSize: 8, fontWeight: 700, padding: "1px 6px", borderRadius: 4, background: l.boardColor + "20", color: l.boardColor }}, l.board.toUpperCase()))),
          React.createElement("div", { style: { textAlign: "right" }},
            React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)" }}, l.zeit),
            l.board === "Storno" && React.createElement("div", { style: { fontSize: 9, color: "#ef4444", fontWeight: 700, marginTop: 2 }}, "\u26A0 STORNO"))); })),

      /* ── DEIN STATUS HERO ── */
      React.createElement("div", { style: { ...cs, gridColumn: "1 / -1", padding: "20px 16px", background: "linear-gradient(135deg, rgba(245,197,0,0.06), rgba(52,211,153,0.04))", borderColor: "rgba(245,197,0,0.2)", textAlign: "center", position: "relative", overflow: "hidden" }},
        React.createElement("div", { style: { position: "absolute", top: -20, right: -20, fontSize: 80, opacity: 0.04 }}, "\uD83C\uDFC6"),
        React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: "rgba(255,255,255,0.35)", textTransform: "uppercase", letterSpacing: 2, marginBottom: 10 }}, "Dein Status \xB7 Februar 2026"),
        React.createElement("div", { style: { display: "flex", justifyContent: "center", alignItems: "center", gap: 12, marginBottom: 14 }},
          React.createElement("div", { style: { width: 56, height: 56, borderRadius: "50%", background: "rgba(245,197,0,0.15)", border: "3px solid #F5C500", display: "flex", alignItems: "center", justifyContent: "center", fontSize: 18, fontWeight: 900, color: "#F5C500", boxShadow: "0 0 20px rgba(245,197,0,0.25)" }}, "DU"),
          React.createElement("div", null,
            React.createElement("div", { style: { fontSize: 32, fontWeight: 900, color: "#22c55e", lineHeight: 1 }}, "#" + myRank),
            React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.4)" }}, "von " + ranking.length + " Beratern"))),
        React.createElement("div", { style: { display: "flex", justifyContent: "center", gap: 20 }},
          React.createElement("div", null, React.createElement("div", { style: { fontSize: 22, fontWeight: 900, color: "#F5C500" }}, ranking[0].verdient.toLocaleString("de-DE") + "\u20AC"), React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.35)" }}, "Provision")),
          React.createElement("div", { style: { width: 1, background: "rgba(255,255,255,0.08)" }}),
          React.createElement("div", null, React.createElement("div", { style: { fontSize: 22, fontWeight: 900, color: "#fff" }}, String(ranking[0].abschluesse)), React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.35)" }}, "Abschl\xFCsse")),
          React.createElement("div", { style: { width: 1, background: "rgba(255,255,255,0.08)" }}),
          React.createElement("div", null, React.createElement("div", { style: { fontSize: 22, fontWeight: 900, color: "#22c55e" }}, ranking[0].convRate + "%"), React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.35)" }}, "Conversion")))),

      /* ── STREAK + WOCHE ── */
      React.createElement("div", { className: "field-streak", style: { gridColumn: "1 / -1", display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 }},
        React.createElement("div", { style: { ...cs, background: "rgba(249,115,22,0.04)", borderColor: "rgba(249,115,22,0.15)" }},
          React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6, marginBottom: 6 }},
            React.createElement("span", { style: { fontSize: 20 }}, "\uD83D\uDD25"),
            React.createElement("span", { style: { fontSize: 10, color: "rgba(255,255,255,0.35)", fontWeight: 700, textTransform: "uppercase" }}, "Streak")),
          React.createElement("div", { style: { fontSize: 26, fontWeight: 900, color: "#f97316" }}, ranking[0].streak + " Tage"),
          React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)" }}, "Jeden Tag ein Deal!"),
          React.createElement("div", { style: { display: "flex", gap: 3, marginTop: 8 }},
            [1,2,3,4,5,6,7].map(function(d) { return React.createElement("div", { key: d, style: { width: 18, height: 18, borderRadius: 4, background: d <= ranking[0].streak ? "rgba(249,115,22,0.2)" : "rgba(255,255,255,0.04)", border: "1px solid " + (d <= ranking[0].streak ? "#f97316" : "rgba(255,255,255,0.08)"), display: "flex", alignItems: "center", justifyContent: "center", fontSize: 8, color: d <= ranking[0].streak ? "#f97316" : "rgba(255,255,255,0.2)", animation: d <= ranking[0].streak ? "streakPop 0.3s ease " + (d * 0.05) + "s both" : "none" }}, d <= ranking[0].streak ? "\u2713" : "\xB7"); }))),
        React.createElement("div", { style: { ...cs, background: "rgba(52,211,153,0.04)", borderColor: "rgba(52,211,153,0.15)" }},
          React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6, marginBottom: 6 }},
            React.createElement("span", { style: { fontSize: 20 }}, "\uD83D\uDE80"),
            React.createElement("span", { style: { fontSize: 10, color: "rgba(255,255,255,0.35)", fontWeight: 700, textTransform: "uppercase" }}, "Diese Woche")),
          React.createElement("div", { style: { fontSize: 26, fontWeight: 900, color: "#22c55e" }}, ranking[0].weekDeals + " Deals"),
          React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)" }}, "Bester der Woche!"),
          React.createElement("div", { style: { display: "flex", gap: 2, marginTop: 8 }},
            [1,2,3,4,5].map(function(d) { return React.createElement("div", { key: d, style: { flex: 1, height: 4, borderRadius: 2, background: d <= ranking[0].weekDeals ? "#22c55e" : "rgba(255,255,255,0.06)" }}); })),
          React.createElement("div", { style: { fontSize: 8, color: "rgba(255,255,255,0.3)", marginTop: 3 }}, "Ziel: 5 Deals/Woche"))),

      /* ── PROVISIONSSTUFE ENHANCED ── */
      nextStufe && React.createElement("div", { style: { ...cs, gridColumn: "1 / -1", background: "rgba(253,225,84,0.03)", borderColor: "rgba(253,225,84,0.15)", position: "relative", overflow: "hidden" }},
        React.createElement("div", { style: { position: "absolute", top: 0, left: 0, right: 0, height: 3, background: "linear-gradient(90deg, rgba(245,197,0,0), rgba(245,197,0,0.4), rgba(245,197,0,0))", backgroundSize: "200% 100%", animation: "shimmerGold 2s ease infinite" }}),
        React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 10 }},
          React.createElement("div", null,
            React.createElement("div", { style: { fontSize: 13, fontWeight: 800, color: "#F5C500" }}, "\uD83D\uDCB0 " + currentStufe.prov + "\u20AC / Auftrag" + (salesMonat >= 8 ? " (r\xFCckwirkend!)" : "")),
            React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)" }}, "Stufe " + (provStufen.indexOf(currentStufe) + 1) + " von " + provStufen.length)),
          React.createElement("div", { style: { textAlign: "right" }},
            React.createElement("div", { style: { fontSize: 18, fontWeight: 900, color: "#22c55e" }}, "+" + fehlendBis),
            React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.4)" }}, "bis " + nextStufe.prov + "\u20AC/Auftrag"))),
        React.createElement("div", { style: { height: 10, borderRadius: 5, background: "rgba(255,255,255,0.06)", overflow: "hidden", position: "relative" }},
          React.createElement("div", { style: { width: Math.round((salesMonat / nextStufe.ab) * 100) + "%", height: "100%", background: "linear-gradient(90deg, #F5C500, #E8CC3D)", borderRadius: 5, transition: "width 0.5s" }})),
        React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginTop: 6 }},
          provStufen.map(function(s, i) { return React.createElement("div", { key: i, style: { fontSize: 8, color: salesMonat >= s.ab ? "#F5C500" : "rgba(255,255,255,0.25)", fontWeight: salesMonat >= s.ab ? 700 : 400 }}, s.prov + "\u20AC"); }))),

      /* ── KUNDEN WERBEN KUNDEN ── */
      React.createElement("div", { onClick: function() { setShowReferral(true); setRefSent(false); setRefCode(""); setRefForm({ vorname: "", nachname: "", telefon: "", email: "", plz: "", ort: "" }); }, style: { ...cs, gridColumn: "1 / -1", cursor: "pointer", background: "linear-gradient(135deg, rgba(245,197,0,0.06), rgba(52,211,153,0.04))", borderColor: "rgba(245,197,0,0.15)", transition: "all 0.2s" }},
        React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between" }},
          React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 }},
            React.createElement("span", { style: { fontSize: 28 }}, "\uD83E\uDD1D"),
            React.createElement("div", null,
              React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: "#F5C500" }}, "Kunden werben Kunden"),
              React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.5)", marginTop: 2 }}, "Kunde registrieren & Empfehlungslink teilen"))),
          React.createElement("div", { style: { fontSize: 22, color: "rgba(255,255,255,0.3)" }}, "\u276F"))),

      /* ── REFERRAL MODAL ── */
      showReferral && React.createElement("div", { style: { position: "fixed", inset: 0, zIndex: 25000, background: "rgba(0,0,0,0.75)", display: "flex", alignItems: "center", justifyContent: "center", padding: 16 }, onClick: function() { setShowReferral(false); }},
        React.createElement("div", { onClick: function(e) { e.stopPropagation(); }, style: { width: "100%", maxWidth: 420, maxHeight: "90vh", background: "#111927", borderRadius: 16, border: "1.5px solid rgba(245,197,0,0.2)", overflow: "auto", boxSizing: "border-box" }},
          /* Modal Header */
          React.createElement("div", { style: { padding: "16px 20px", background: "rgba(245,197,0,0.06)", borderBottom: "1px solid rgba(245,197,0,0.1)", display: "flex", alignItems: "center", justifyContent: "space-between" }},
            React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 }},
              React.createElement("span", { style: { fontSize: 20 }}, "\uD83E\uDD1D"),
              React.createElement("div", { style: { fontSize: 15, fontWeight: 800, color: "#F5C500" }}, "Kunden werben Kunden")),
            React.createElement("button", { onClick: function() { setShowReferral(false); }, style: { background: "none", border: "none", color: "rgba(255,255,255,0.4)", fontSize: 22, cursor: "pointer" }}, "\u00D7")),

          refSent ? (
            /* Success State */
            React.createElement("div", { style: { padding: "24px 20px", textAlign: "center" }},
              React.createElement("div", { style: { fontSize: 56, marginBottom: 12 }}, "\u2705"),
              React.createElement("div", { style: { fontSize: 18, fontWeight: 800, marginBottom: 6 }}, "Werber registriert!"),
              React.createElement("div", { style: { fontSize: 13, color: "rgba(255,255,255,0.5)", marginBottom: 16 }}, refForm.vorname + " " + refForm.nachname + " kann jetzt Freunde empfehlen"),
              React.createElement("div", { style: { padding: "12px 16px", borderRadius: 10, background: "rgba(245,197,0,0.06)", border: "1px solid rgba(245,197,0,0.15)", marginBottom: 12 }},
                React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.4)", fontWeight: 700, textTransform: "uppercase", marginBottom: 4 }}, "Empfehlungscode"),
                React.createElement("div", { style: { fontSize: 22, fontWeight: 900, color: "#F5C500", letterSpacing: 2 }}, refCode)),
              React.createElement("div", { style: { padding: "12px 16px", borderRadius: 10, background: "rgba(255,255,255,0.03)", border: "1px solid rgba(255,255,255,0.06)", marginBottom: 12, wordBreak: "break-all" }},
                React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.4)", fontWeight: 700, textTransform: "uppercase", marginBottom: 4 }}, "Empfehlungslink"),
                React.createElement("div", { style: { fontSize: 12, color: "#F5C500", fontWeight: 600 }}, "https://bee-doo-tools.vercel.app/empfehlung-r.html?c=" + refCode)),
              /* Prämien-Staffelung */
              React.createElement("div", { style: { padding: "14px 16px", borderRadius: 12, background: "linear-gradient(135deg, rgba(245,197,0,0.06), rgba(34,197,94,0.04))", border: "1.5px solid rgba(245,197,0,0.15)", marginBottom: 14, textAlign: "left" }},
                React.createElement("div", { style: { fontSize: 9, fontWeight: 700, color: "rgba(255,255,255,0.35)", textTransform: "uppercase", letterSpacing: 1.2, marginBottom: 8 }}, "\uD83C\uDFC6 Pr\u00E4mien-Staffelung"),
                React.createElement("div", { style: { display: "flex", gap: 4 }},
                  [{ n: "1.", e: "700\u20AC" }, { n: "2.", e: "800\u20AC" }, { n: "3.", e: "900\u20AC" }, { n: "4.+", e: "1.000\u20AC" }].map(function(s, i) {
                    return React.createElement("div", { key: i, style: { flex: 1, padding: "8px 4px", borderRadius: 8, background: "rgba(245,197,0,0.08)", border: "1px solid rgba(245,197,0,0.15)", textAlign: "center" }},
                      React.createElement("div", { style: { fontSize: 14, fontWeight: 900, color: "#F5C500" }}, s.e),
                      React.createElement("div", { style: { fontSize: 8, color: "rgba(255,255,255,0.35)", marginTop: 2 }}, s.n + " Sale"));
                  })),
                React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)", marginTop: 8, textAlign: "center" }}, "Pro erfolgreichem Abschluss \u2013 steigend!")),
              React.createElement("div", { style: { display: "flex", gap: 8 }},
                React.createElement("button", { onClick: function() {
                  var link = "https://bee-doo-tools.vercel.app/empfehlung-r.html?c=" + refCode + "&s=whatsapp";
                  var text = "Hallo! Ich habe gerade meine Solaranlage mit bee-doo geplant und bin begeistert! \u2600\uFE0F\n\nWenn du auch Interesse hast, kannst du hier ein kostenloses Angebot anfragen:\n" + link + "\n\nWenn du dich dar\u00FCber anmeldest, bekomme ich eine Pr\u00E4mie. Danke! \uD83D\uDE4F";
                  window.open("https://wa.me/?text=" + encodeURIComponent(text), "_blank");
                }, style: { flex: 1, padding: "12px", borderRadius: 10, border: "none", background: "#25D366", color: "#fff", fontSize: 13, fontWeight: 700, fontFamily: font, cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", gap: 6 }}, "\uD83D\uDCAC WhatsApp"),
                React.createElement("button", { onClick: function() {
                  navigator.clipboard.writeText("https://bee-doo-tools.vercel.app/empfehlung-r.html?c=" + refCode);
                }, style: { flex: 1, padding: "12px", borderRadius: 10, border: "1px solid rgba(255,255,255,0.1)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 13, fontWeight: 700, fontFamily: font, cursor: "pointer" }}, "\uD83D\uDCCB Link kopieren")),
              React.createElement("button", { onClick: function() { setShowReferral(false); }, style: { width: "100%", marginTop: 10, padding: "12px", borderRadius: 10, border: "none", background: "rgba(255,255,255,0.06)", color: "rgba(255,255,255,0.5)", fontSize: 13, fontWeight: 600, fontFamily: font, cursor: "pointer" }}, "Schlie\u00DFen"),
              React.createElement("a", { href: "empfehlung-vb.html", style: { display: "block", width: "100%", marginTop: 8, padding: "12px", borderRadius: 10, border: "1px solid rgba(245,197,0,0.2)", background: "rgba(245,197,0,0.04)", color: "#F5C500", fontSize: 13, fontWeight: 700, fontFamily: font, textDecoration: "none", textAlign: "center" }}, "\uD83D\uDCCA Empfehlungs-Dashboard \u00F6ffnen"))
          ) : (
            /* Form State */
            React.createElement("div", { style: { padding: "16px 20px" }},
              React.createElement("div", { style: { fontSize: 12, color: "rgba(255,255,255,0.5)", marginBottom: 14, lineHeight: 1.5 }}, "Registrieren Sie den Kunden als Werber. Er erh\u00E4lt einen pers\u00F6nlichen Empfehlungslink."),
              React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginBottom: 8 }},
                React.createElement("div", null,
                  React.createElement("label", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)", display: "block", marginBottom: 3 }}, "Vorname *"),
                  React.createElement("input", { value: refForm.vorname, onChange: function(e) { setRefForm(function(f) { return Object.assign({}, f, { vorname: e.target.value }); }); }, placeholder: "Max", style: { width: "100%", padding: "10px 12px", borderRadius: 8, border: "1px solid rgba(255,255,255,0.08)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 14, fontFamily: font, outline: "none", boxSizing: "border-box" }})),
                React.createElement("div", null,
                  React.createElement("label", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)", display: "block", marginBottom: 3 }}, "Nachname *"),
                  React.createElement("input", { value: refForm.nachname, onChange: function(e) { setRefForm(function(f) { return Object.assign({}, f, { nachname: e.target.value }); }); }, placeholder: "Mustermann", style: { width: "100%", padding: "10px 12px", borderRadius: 8, border: "1px solid rgba(255,255,255,0.08)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 14, fontFamily: font, outline: "none", boxSizing: "border-box" }}))),
              React.createElement("div", { style: { marginBottom: 8 }},
                React.createElement("label", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)", display: "block", marginBottom: 3 }}, "Telefon *"),
                React.createElement("input", { value: refForm.telefon, onChange: function(e) { setRefForm(function(f) { return Object.assign({}, f, { telefon: e.target.value }); }); }, placeholder: "0151 1234567", type: "tel", style: { width: "100%", padding: "10px 12px", borderRadius: 8, border: "1px solid rgba(255,255,255,0.08)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 14, fontFamily: font, outline: "none", boxSizing: "border-box" }})),
              React.createElement("div", { style: { marginBottom: 8 }},
                React.createElement("label", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)", display: "block", marginBottom: 3 }}, "E-Mail"),
                React.createElement("input", { value: refForm.email, onChange: function(e) { setRefForm(function(f) { return Object.assign({}, f, { email: e.target.value }); }); }, placeholder: "max@email.de", type: "email", style: { width: "100%", padding: "10px 12px", borderRadius: 8, border: "1px solid rgba(255,255,255,0.08)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 14, fontFamily: font, outline: "none", boxSizing: "border-box" }})),
              React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 2fr", gap: 8, marginBottom: 14 }},
                React.createElement("div", null,
                  React.createElement("label", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)", display: "block", marginBottom: 3 }}, "PLZ"),
                  React.createElement("input", { value: refForm.plz, onChange: function(e) { setRefForm(function(f) { return Object.assign({}, f, { plz: e.target.value }); }); }, placeholder: "33602", style: { width: "100%", padding: "10px 12px", borderRadius: 8, border: "1px solid rgba(255,255,255,0.08)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 14, fontFamily: font, outline: "none", boxSizing: "border-box" }})),
                React.createElement("div", null,
                  React.createElement("label", { style: { fontSize: 10, color: "rgba(255,255,255,0.4)", display: "block", marginBottom: 3 }}, "Ort"),
                  React.createElement("input", { value: refForm.ort, onChange: function(e) { setRefForm(function(f) { return Object.assign({}, f, { ort: e.target.value }); }); }, placeholder: "Bielefeld", style: { width: "100%", padding: "10px 12px", borderRadius: 8, border: "1px solid rgba(255,255,255,0.08)", background: "rgba(255,255,255,0.04)", color: "#fff", fontSize: 14, fontFamily: font, outline: "none", boxSizing: "border-box" }}))),
              React.createElement("button", { onClick: function() {
                if (!refForm.vorname || !refForm.nachname || !refForm.telefon) return;
                var code = (refForm.vorname.substring(0, 5).toUpperCase() + Math.floor(Math.random() * 100)).replace(/\s/g, "");
                setRefCode(code);
                /* Save to Supabase */
                fetch("https://hqzpemfaljxcysyqssng.supabase.co/rest/v1/referral_customers", {
                  method: "POST",
                  headers: { apikey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxenBlbWZhbGp4Y3lzeXFzc25nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzUzOTcsImV4cCI6MjA4NjkxMTM5N30.LSlMApceWuLk5MUctCGCVspXfYhc_As559aaoV2uSik", "Content-Type": "application/json" },
                  body: JSON.stringify({ code: code, vorname: refForm.vorname, nachname: refForm.nachname, telefon: refForm.telefon, email: refForm.email, plz: refForm.plz, ort: refForm.ort, berater_name: "Bernd Schulz", status: "aktiv" })
                }).then(function() {
                  /* Create field notification */
                  fetch("https://hqzpemfaljxcysyqssng.supabase.co/rest/v1/referral_field_notifications", {
                    method: "POST",
                    headers: { apikey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxenBlbWZhbGp4Y3lzeXFzc25nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzUzOTcsImV4cCI6MjA4NjkxMTM5N30.LSlMApceWuLk5MUctCGCVspXfYhc_As559aaoV2uSik", "Content-Type": "application/json" },
                    body: JSON.stringify({ berater_name: "Bernd Schulz", typ: "neuer_promoter", titel: "Neuer Promoter registriert!", nachricht: refForm.vorname + " " + refForm.nachname + " (" + (refForm.ort || "unbekannt") + ") kann jetzt Freunde empfehlen. Code: " + code, werber_code: code })
                  }).catch(function() {});
                }).catch(function() {});
                setRefSent(true);
              }, disabled: !refForm.vorname || !refForm.nachname || !refForm.telefon, style: { width: "100%", padding: "14px", borderRadius: 12, border: "none", background: (!refForm.vorname || !refForm.nachname || !refForm.telefon) ? "rgba(255,255,255,0.06)" : "linear-gradient(135deg, #F5C500, #E8CC3D)", color: (!refForm.vorname || !refForm.nachname || !refForm.telefon) ? "rgba(255,255,255,0.3)" : "#080C14", fontSize: 15, fontWeight: 800, fontFamily: font, cursor: (!refForm.vorname || !refForm.nachname || !refForm.telefon) ? "default" : "pointer" }}, "\uD83E\uDD1D Werber registrieren"))))),

      /* ── BADGES ── */
      React.createElement("div", { style: { ...cs, gridColumn: "1 / -1" }},
        React.createElement("div", { style: { ...ls, marginBottom: 10 }}, "\uD83C\uDFC5 Deine Badges"),
        React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 6 }},
          myBadges.map(function(b, i) { return React.createElement("div", { key: i, style: { padding: "6px 10px", borderRadius: 8, background: b.earned ? "rgba(245,197,0,0.06)" : "rgba(255,255,255,0.02)", border: "1px solid " + (b.earned ? "rgba(245,197,0,0.2)" : "rgba(255,255,255,0.05)"), display: "flex", alignItems: "center", gap: 6, opacity: b.earned ? 1 : 0.4 }},
            React.createElement("span", { style: { fontSize: 16, filter: b.earned ? "none" : "grayscale(1)" }}, b.icon),
            React.createElement("span", { style: { fontSize: 10, fontWeight: b.earned ? 700 : 400, color: b.earned ? "#fff" : "rgba(255,255,255,0.35)" }}, b.label),
            b.earned && React.createElement("span", { style: { fontSize: 9, color: "#22c55e" }}, "\u2713")); }))),

      /* ── PODIUM TOP 3 ── */
      React.createElement("div", { style: { ...cs, gridColumn: "1 / -1", padding: "16px 12px", background: "linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.1))", textAlign: "center" }},
        React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: "rgba(255,255,255,0.35)", textTransform: "uppercase", letterSpacing: 2, marginBottom: 14 }}, "\uD83C\uDFC6 Team Podium \xB7 Februar"),
        React.createElement("div", { style: { display: "flex", justifyContent: "center", alignItems: "flex-end", gap: 8 }},
          [1,0,2].map(function(idx) {
            var r = ranking[idx]; if(!r) return null;
            var isMe = r.name === "Du";
            var podColors = ["#F5C500", "#C0C0C0", "#CD7F32"];
            var podHeights = [85, 110, 70];
            var medals = ["\uD83E\uDD47","\uD83E\uDD48","\uD83E\uDD49"];
            return React.createElement("div", { key: idx, style: { display: "flex", flexDirection: "column", alignItems: "center", width: 100, animation: "podiumRise 0.5s ease " + [0.1,0,0.2][idx] + "s both" }},
              idx === 0 && React.createElement("div", { style: { fontSize: 22, marginBottom: 4, animation: "crownBounce 2s ease-in-out infinite" }}, "\uD83D\uDC51"),
              React.createElement("div", { style: { width: 44, height: 44, borderRadius: "50%", background: podColors[idx] + "20", border: "2.5px solid " + podColors[idx], display: "flex", alignItems: "center", justifyContent: "center", fontSize: 13, fontWeight: 900, color: podColors[idx], boxShadow: isMe ? "0 0 16px " + podColors[idx] + "40" : "none" }}, r.initialen),
              React.createElement("div", { style: { fontSize: 11, fontWeight: 700, marginTop: 4, color: isMe ? "#F5C500" : "#fff" }}, r.name),
              React.createElement("div", { style: { fontSize: 11, fontWeight: 900, color: "#22c55e" }}, r.verdient.toLocaleString("de-DE") + "\u20AC"),
              React.createElement("div", { style: { width: "100%", height: podHeights[idx===1?0:idx===0?1:2], marginTop: 6, background: "linear-gradient(180deg, " + podColors[idx] + "25, " + podColors[idx] + "08)", borderRadius: "8px 8px 0 0", border: "1px solid " + podColors[idx] + "30", borderBottom: "none", display: "flex", alignItems: "center", justifyContent: "center", flexDirection: "column" }},
                React.createElement("span", { style: { fontSize: 20, fontWeight: 900 }}, medals[idx]),
                React.createElement("span", { style: { fontSize: 9, fontWeight: 600, color: podColors[idx] }}, r.weekDeals + " /Woche")));
          }))),

      /* ── PERFORMANCE BARS ── */
      React.createElement("div", { style: { ...cs, gridColumn: "1 / -1" }},
        React.createElement("div", { style: { ...ls, marginBottom: 10 }}, "\uD83D\uDCCA Performance Ranking"),
        ranking.map(function(r, i) {
          var isMe = r.name === "Du";
          var maxV = ranking[0].verdient || 1;
          var pct = Math.round((r.verdient / maxV) * 100);
          var barCol = i === 0 ? "#F5C500" : i === 1 ? "#C0C0C0" : i === 2 ? "#CD7F32" : "#60A5FA";
          return React.createElement("div", { key: i, style: { display: "flex", alignItems: "center", gap: 10, padding: "8px 0", borderBottom: i < ranking.length - 1 ? "1px solid rgba(255,255,255,0.04)" : "none" }},
            React.createElement("span", { style: { width: 20, fontSize: 12, fontWeight: 800, color: i < 3 ? "#F5C500" : "rgba(255,255,255,0.3)", textAlign: "center" }}, String(i + 1)),
            React.createElement("div", { style: { width: 32, height: 32, borderRadius: "50%", background: r.color + "18", border: "2px solid " + r.color, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 10, fontWeight: 800, color: r.color, flexShrink: 0 }}, r.initialen),
            React.createElement("div", { style: { flex: 1, minWidth: 0 }},
              React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 3 }},
                React.createElement("span", { style: { fontSize: 12, fontWeight: isMe ? 800 : 600, color: isMe ? "#F5C500" : "#fff" }}, r.name),
                React.createElement("span", { style: { fontSize: 11, fontWeight: 800, color: "#22c55e", flexShrink: 0 }}, r.verdient.toLocaleString("de-DE") + "\u20AC")),
              React.createElement("div", { style: { height: 6, background: "rgba(255,255,255,0.06)", borderRadius: 3, overflow: "hidden" }},
                React.createElement("div", { style: { width: pct + "%", height: "100%", background: "linear-gradient(90deg, " + barCol + "90, " + barCol + "50)", borderRadius: 3, transition: "width 0.8s ease" }})),
              React.createElement("div", { style: { display: "flex", gap: 8, marginTop: 3, flexWrap: "wrap" }},
                React.createElement("span", { style: { fontSize: 9, color: "rgba(255,255,255,0.35)" }}, r.abschluesse + " Deals"),
                React.createElement("span", { style: { fontSize: 9, color: r.convRate >= 25 ? "#22c55e" : r.convRate >= 15 ? "#f97316" : "#ef4444" }}, r.convRate + "% Conv."),
                React.createElement("span", { style: { fontSize: 9, color: "#60A5FA" }}, "\u00D8 " + Math.round(r.verdient / Math.max(r.abschluesse, 1)).toLocaleString("de-DE") + "\u20AC"),
                r.streak >= 3 && React.createElement("span", { style: { fontSize: 9, color: "#f97316" }}, "\uD83D\uDD25 " + r.streak + "d"),
                [
                  { label: "Eigenleads", val: r.eigenleads, color: "#3b82f6", icon: "\uD83C\uDFAF" },
                  { label: "Empfehlungen", val: r.empfehlungen, color: "#a855f7", icon: "\uD83E\uDD1D" },
                  { label: "Speicher+", val: r.speicher, color: "#f59e0b", icon: "\uD83D\uDD0B" },
                  { label: "Zero-Bonus", val: r.zero, color: "#22c55e", icon: "\u2B50" },
                ].filter(function(kpi){ return kpi.val > 0; }).map(function(kpi) {
                  return React.createElement("span", { key: kpi.label, style: { fontSize: 9 }, title: kpi.label }, kpi.icon + kpi.val);
                }))));
        })
      ),

      React.createElement("button", { onClick: function() { setShowManualConfirm(true); }, style: { width: "100%", padding: "18px 0", borderRadius: 14, background: "rgba(255,255,255,0.06)", border: "1.5px solid rgba(255,255,255,0.12)", cursor: "pointer", fontFamily: font, fontSize: 15, fontWeight: 700, color: "rgba(255,255,255,0.5)", letterSpacing: 0.5 }}, "\u270D\uFE0F Manuelle Aufnahme (ohne Kundendaten)"),
        showManualConfirm && React.createElement("div", { style: { marginTop: 12, padding: "16px", borderRadius: 12, background: "rgba(249,115,22,0.06)", border: "1.5px solid rgba(249,115,22,0.3)", animation: "fadeInUp 0.2s ease" }},
          React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, marginBottom: 10 }},
            React.createElement("span", { style: { fontSize: 20 }}, "\u26A0\uFE0F"),
            React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: "#f97316" }}, "Bist du sicher?")),
          React.createElement("div", { style: { fontSize: 12, color: "rgba(255,255,255,0.5)", marginBottom: 14, lineHeight: 1.5 }}, "Du startest eine neue Aufnahme ohne vorhandene Kundendaten. Alle Felder m\xFCssen manuell ausgef\xFCllt werden."),
          React.createElement("div", { style: { display: "flex", gap: 10 }},
            React.createElement("button", { onClick: function() { setShowManualConfirm(false); }, style: { flex: 1, padding: "12px", borderRadius: 10, border: "1px solid rgba(255,255,255,0.1)", background: "transparent", color: "rgba(255,255,255,0.5)", fontSize: 13, fontFamily: font, cursor: "pointer" }}, "Abbrechen"),
            React.createElement("button", { onClick: function() { setShowManualConfirm(false); onNewAufnahme(); }, style: { flex: 2, padding: "12px", borderRadius: 10, border: "none", background: "linear-gradient(135deg, #F5C500, #E8CC3D)", color: "#0A0E1A", fontSize: 13, fontWeight: 800, fontFamily: font, cursor: "pointer", boxShadow: "0 4px 16px rgba(253,225,84,0.25)" }}, "\u26A1 Ja, manuell starten"))))),


    React.createElement("div", { style: { textAlign: "center", padding: "16px 0 24px", fontSize: 10, color: "rgba(255,255,255,0.12)" }}, "v2.0 \xB7 bee-doo FIELD \xB7 Bielefeld \xB7 \uD83D\uDC1D"))));
}
function StartScreen({ onStart }) {
  const [hovered, setHovered] = useState(null);
  const [fadeOut, setFadeOut] = useState(false);
  const [visible, setVisible] = useState(true);
  const handleSelect = (typ) => {
    setFadeOut(true);
    setTimeout(() => {
      setVisible(false);
      onStart(typ);
    }, 500);
  };
  if (!visible) return null;
  return /* @__PURE__ */ React.createElement("div", { style: {
    position: "fixed",
    inset: 0,
    zIndex: 9999,
    background: `radial-gradient(ellipse at 30% 20%, rgba(232,212,77,0.06) 0%, transparent 50%),
                    radial-gradient(ellipse at 70% 80%, rgba(96,165,250,0.04) 0%, transparent 50%),
                    #0A0E1A`,
    display: "flex",
    flexDirection: "column",
    alignItems: "center",
    justifyContent: "center",
    fontFamily: font,
    transition: "opacity 0.5s ease",
    opacity: fadeOut ? 0 : 1,
    overflow: "auto",
    padding: "40px 24px"
  } }, /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", inset: 0, overflow: "hidden", opacity: 0.03, pointerEvents: "none" } }, /* @__PURE__ */ React.createElement("svg", { width: "100%", height: "100%", viewBox: "0 0 800 600" }, Array.from({ length: 30 }).map((_, i) => /* @__PURE__ */ React.createElement(
    "polygon",
    {
      key: i,
      points: (() => {
        const cx = i % 6 * 140 + Math.floor(i / 6) % 2 * 70;
        const cy = Math.floor(i / 6) * 120;
        const r = 55;
        return Array.from({ length: 6 }).map((_2, j) => {
          const a = Math.PI / 3 * j - Math.PI / 6;
          return `${cx + r * Math.cos(a)},${cy + r * Math.sin(a)}`;
        }).join(" ");
      })(),
      fill: "none",
      stroke: BRAND.yellow,
      strokeWidth: "1",
      style: { animation: `hexPulse ${3 + i * 0.2}s ease-in-out infinite`, animationDelay: `${i * 0.1}s` }
    }
  )))), /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", alignItems: "center" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 52, fontWeight: 800, color: "#fff", letterSpacing: -1, lineHeight: 1, fontFamily: font } }, "bee-doo"), /* @__PURE__ */ React.createElement("div", { style: { width: 240, height: 3.5, background: BRAND.yellow, borderRadius: 2, marginTop: 5, boxShadow: `0 0 20px ${BRAND.yellow}40` } }), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: "rgba(255,255,255,0.4)", letterSpacing: 8, fontWeight: 300, marginTop: 6, fontFamily: font } }, "ENERGY FOR YOU"))), /* @__PURE__ */ React.createElement("div", { style: {
    fontSize: 42,
    fontWeight: 900,
    letterSpacing: 5,
    marginTop: 12,
    marginBottom: 4,
    background: `linear-gradient(135deg, ${BRAND.yellow}, #FFE566, ${BRAND.yellow})`,
    WebkitBackgroundClip: "text",
    WebkitTextFillColor: "transparent"
  } }, "FIELD"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, color: "rgba(255,255,255,0.35)", fontWeight: 300, letterSpacing: 1.5, marginBottom: 36, fontFamily: font, display: "flex", alignItems: "center", gap: 8, justifyContent: "center" } }, "Aufnahmetyp w\xE4hlen"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 14, width: "100%", maxWidth: 380 } }, AUFNAHME_TYPEN.map((typ) => /* @__PURE__ */ React.createElement(
    "button",
    {
      key: typ.id,
      onMouseEnter: () => setHovered(typ.id),
      onMouseLeave: () => setHovered(null),
      onClick: () => handleSelect(typ.id),
      style: {
        padding: "20px 24px",
        borderRadius: 16,
        border: `2px solid ${hovered === typ.id ? typ.color : `${typ.color}25`}`,
        background: hovered === typ.id ? `${typ.color}10` : `${typ.color}05`,
        cursor: "pointer",
        textAlign: "left",
        fontFamily: font,
        transition: "all 0.2s ease",
        transform: hovered === typ.id ? "scale(1.02)" : "scale(1)",
        boxShadow: hovered === typ.id ? `0 0 30px ${typ.color}12` : "none"
      }
    },
    /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 14 } }, /* @__PURE__ */ React.createElement("div", { style: {
      width: 50,
      height: 50,
      borderRadius: 14,
      background: `${typ.color}15`,
      border: `1px solid ${typ.color}25`,
      display: "flex",
      alignItems: "center",
      justifyContent: "center",
      fontSize: 24
    } }, typ.icon), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 700, color: "#fff", letterSpacing: 0.3 } }, typ.label), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: "rgba(255,255,255,0.35)", marginTop: 3 } }, typ.desc)), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, color: `${typ.color}60`, transition: "transform 0.2s", transform: hovered === typ.id ? "translateX(4px)" : "none" } }, "\u2192"))
  ))), /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", bottom: 24, fontSize: 10, color: "rgba(255,255,255,0.15)", letterSpacing: 1.5 } }, "v1.1 \xB7 bee-doo GmbH \xB7 Bielefeld \xB7 \u{1F34C}"), /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", bottom: 50, right: 20, fontSize: 28, animation: "minionWobble 3s ease-in-out infinite" } }, "\u{1F41D}"), /* @__PURE__ */ React.createElement("style", null, `
        @keyframes hexPulse { 0%,100% { opacity: 0.3; } 50% { opacity: 1; } }
      `));
}
function BeedooLogoSmall({ height = 32 }) {
  return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", alignItems: "flex-start" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: height * 0.6, fontWeight: 800, color: "#fff", letterSpacing: -0.5, lineHeight: 1, fontFamily: font } }, "bee-doo"), /* @__PURE__ */ React.createElement("div", { style: { width: "100%", height: 2.5, background: BRAND.yellow, borderRadius: 2, marginTop: 2 } }), /* @__PURE__ */ React.createElement("span", { style: { fontSize: height * 0.22, color: "rgba(255,255,255,0.5)", letterSpacing: 4, fontWeight: 300, marginTop: 2, fontFamily: font } }, "ENERGY FOR YOU")), /* @__PURE__ */ React.createElement("div", { style: { width: 1, height: height * 0.7, background: T.border, margin: "0 4px" } }), /* @__PURE__ */ React.createElement("span", { style: {
    fontSize: height * 0.55,
    fontWeight: 800,
    letterSpacing: 2,
    background: `linear-gradient(135deg, ${BRAND.yellow}, #FFE566)`,
    WebkitBackgroundClip: "text",
    WebkitTextFillColor: "transparent",
    fontFamily: font
  } }, "FIELD"));
}
function Input({ label, value, onChange, placeholder, type = "text", suffix, half, icon, required, error, success, inputMode, actionBtn, autoFocus }) {
  const [focused, setFocused] = useState(false);
  const borderColor = error ? T.red : success ? T.green : focused ? BRAND.yellow : T.border;
  const hasRight = suffix || success || actionBtn;
  return /* @__PURE__ */ React.createElement("div", { style: { flex: half ? "1 1 48%" : "1 1 100%", minWidth: half ? 150 : "auto" } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, icon && /* @__PURE__ */ React.createElement("span", { style: { marginRight: 6 } }, icon), label, required && /* @__PURE__ */ React.createElement("span", { style: { color: T.red, marginLeft: 3 } }, "*")), /* @__PURE__ */ React.createElement("div", { style: { position: "relative" } }, /* @__PURE__ */ React.createElement(
    "input",
    {
      type: type === "number" ? "text" : type,
      inputMode: type === "number" ? "decimal" : inputMode,
      pattern: type === "number" ? "[0-9.,]*" : void 0,
      value,
      onChange: (e) => {
        if (type === "number") {
          const v = e.target.value.replace(/[^0-9.,]/g, "");
          onChange(v);
        } else {
          onChange(e.target.value);
        }
      },
      placeholder,
      autoFocus,
      onFocus: () => setFocused(true),
      onBlur: () => setFocused(false),
      style: {
        width: "100%",
        padding: "12px 16px",
        paddingRight: hasRight ? 50 : 16,
        background: T.surface,
        border: `1.5px solid ${borderColor}`,
        borderRadius: 10,
        color: T.text,
        fontSize: 15,
        fontFamily: font,
        outline: "none",
        transition: "all 0.2s ease",
        boxShadow: focused ? `0 0 0 3px ${error ? T.redSoft : success ? T.greenSoft : T.accentGlow}` : "none",
        boxSizing: "border-box"
      }
    }
  ), suffix && /* @__PURE__ */ React.createElement("span", { style: { position: "absolute", right: 14, top: "50%", transform: "translateY(-50%)", fontSize: 13, color: T.textDim, fontFamily: fontMono } }, suffix), success && !suffix && !actionBtn && /* @__PURE__ */ React.createElement("span", { style: { position: "absolute", right: 12, top: "50%", transform: "translateY(-50%)", fontSize: 14, color: T.green } }, "\u2713"), actionBtn && /* @__PURE__ */ React.createElement("a", { href: actionBtn.href, style: {
    position: "absolute",
    right: 6,
    top: "50%",
    transform: "translateY(-50%)",
    width: 34,
    height: 34,
    borderRadius: 8,
    background: `${T.green}20`,
    border: `1px solid ${T.green}40`,
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    fontSize: 16,
    textDecoration: "none",
    cursor: "pointer"
  } }, actionBtn.label)), error && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.red, marginTop: 4 } }, error));
}
function Select({ label, value, onChange, options, half, icon, required, error }) {
  const borderColor = error ? T.red : T.border;
  return /* @__PURE__ */ React.createElement("div", { style: { flex: half ? "1 1 48%" : "1 1 100%", minWidth: half ? 150 : "auto" } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, icon && /* @__PURE__ */ React.createElement("span", { style: { marginRight: 6 } }, icon), label, required && /* @__PURE__ */ React.createElement("span", { style: { color: T.red, marginLeft: 3 } }, "*")), /* @__PURE__ */ React.createElement(
    "select",
    {
      value,
      onChange: (e) => onChange(e.target.value),
      style: {
        width: "100%",
        padding: "12px 16px",
        background: T.surface,
        border: `1.5px solid ${borderColor}`,
        borderRadius: 10,
        color: value ? T.text : T.textDim,
        fontSize: 15,
        fontFamily: font,
        outline: "none",
        cursor: "pointer",
        appearance: "none",
        backgroundImage: `url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath d='M2 4l4 4 4-4' stroke='%2394A3B8' fill='none' stroke-width='1.5'/%3E%3C/svg%3E")`,
        backgroundRepeat: "no-repeat",
        backgroundPosition: "right 14px center",
        boxSizing: "border-box"
      }
    },
    options.map((o) => /* @__PURE__ */ React.createElement("option", { key: o.value, value: o.value }, o.label))
  ), error && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.red, marginTop: 4 } }, error));
}
function validateEmail(email) {
  if (!email) return null;
  if (email.length < 5) return "Zu kurz";
  if (!email.includes("@")) return "@ fehlt";
  const [local, domain] = email.split("@");
  if (!local || local.length === 0) return "Name vor @ fehlt";
  if (!domain || !domain.includes(".")) return "Domain ung\xFCltig";
  const parts = domain.split(".");
  if (parts[parts.length - 1].length < 2) return "Endung zu kurz";
  if (/\s/.test(email)) return "Leerzeichen nicht erlaubt";
  if (/\.\./.test(email)) return "Doppelte Punkte";
  return null;
}
const BLZ_BANK = {
  "10010010": ["Postbank", "PBNKDEFF"],
  "10020500": ["Bank f\xFCr Sozialwirtschaft", "BFSWDE33BER"],
  "10050000": ["Landesbank Berlin", "BELADEBEXXX"],
  "10070000": ["Deutsche Bank Berlin", "DEUTDEBBXXX"],
  "10070024": ["Deutsche Bank", "DEUTDEDBBER"],
  "10090000": ["Berliner Volksbank", "BEVODEBB"],
  "12030000": ["Deutsche Kreditbank", "BYLADEM1001"],
  "20010020": ["Postbank Hamburg", "PBNKDEFFXXX"],
  "20050550": ["Hamburger Sparkasse", "HASPDEHHXXX"],
  "20070000": ["Deutsche Bank Hamburg", "DEUTDEHHXXX"],
  "20070024": ["Deutsche Bank", "DEUTDEDBHAM"],
  "20090500": ["Sparda-Bank Hamburg", "GENODEF1S11"],
  "21050000": ["Sparkasse Kiel", "NOLADE21KIE"],
  "21090007": ["Kieler Volksbank", "GENODEF1KIL"],
  "22050000": ["Sparkasse Harburg-Buxtehude", "HASPDEHHXXX"],
  "23050000": ["Sparkasse S\xFCdholstein", "NOLADE21SHO"],
  "24050110": ["Sparkasse Kiel", "NOLADE21KIE"],
  "25020600": ["Santander Hannover", "SCFBDE33XXX"],
  "25050000": ["NORD/LB Hannover", "NOLADE2HXXX"],
  "25050180": ["Sparkasse Hannover", "SPKHDE2HXXX"],
  "25050299": ["Sparkasse Celle-Gifhorn-Wolfsburg", "NOLADE21GFW"],
  "25250001": ["Sparkasse Hildesheim-G.-P.", "NOLADE21HIK"],
  "25450110": ["Sparkasse Schaumburg", "NOLADE21SHG"],
  "25451450": ["Sparkasse Hameln-Weserbergland", "NOLADE21HMS"],
  "25470024": ["Deutsche Bank Hameln", "DEUTDEDB254"],
  "25490070": ["Volksbank Hameln-Stadthagen", "GENODEF1HMP"],
  "25550000": ["Sparkasse G\xF6ttingen", "NOLADE21GOE"],
  "25570024": ["Deutsche Bank G\xF6ttingen", "DEUTDEDB255"],
  "25690009": ["Volksbank G\xF6ttingen", "GENODEF1GOE"],
  "25070000": ["Deutsche Bank Hannover", "DEUTDEDBHAN"],
  "25070024": ["Deutsche Bank", "DEUTDEDB250"],
  "25090500": ["Sparda-Bank Hannover", "GENODEF1S09"],
  "26050001": ["Sparkasse Osnabr\xFCck", "NOLADE22XXX"],
  "26570024": ["Deutsche Bank Osnabr\xFCck", "DEUTDEDB265"],
  "26570090": ["Sparda-Bank Hannover", "GENODEF1S09"],
  "26590025": ["Volksbank Osnabr\xFCck", "GENODEF1OSV"],
  "27050000": ["Sparkasse L\xFCneburg", "NOLADE21LBG"],
  "27090000": ["Volksbank L\xFCneburger Heide", "GENODEF1NBU"],
  "28050000": ["Sparkasse Bremen", "SBREDE22XXX"],
  "28070024": ["Deutsche Bank Bremen", "DEUTDEDB280"],
  "29050000": ["Sparkasse LeerWittmund", "BRLADE21LER"],
  "29050101": ["Sparkasse Aurich-Norden", "BRLADE21ANO"],
  "29070024": ["Deutsche Bank Oldenburg", "DEUTDEDB290"],
  "30010400": ["Commerzbank D\xFCsseldorf", "COBADEFFXXX"],
  "30050000": ["Landesbank Hessen-Th\xFCr.", "WELADEDDXXX"],
  "30050110": ["Stadtsparkasse D\xFCsseldorf", "DUSSDEDDXXX"],
  "30060010": ["Sparda-Bank West", "GENODED1SPW"],
  "30060601": ["Deutsche Apotheker-Bank", "DAAEDED1XXX"],
  "30070010": ["Deutsche Bank D\xFCsseldorf", "DEUTDEDDXXX"],
  "30070024": ["Deutsche Bank", "DEUTDEDBDUE"],
  "31050000": ["Sparkasse M\xF6nchengladbach", "MGLSDE33XXX"],
  "32050000": ["Sparkasse Bielefeld", "SPBIDE3BXXX"],
  "32060362": ["Volksbank Bielefeld-G\xFCtersloh", "GENODED1GTL"],
  "32070024": ["Deutsche Bank Bielefeld", "DEUTDEDB320"],
  "32050030": ["Sparkasse G\xFCtersloh-Rietberg", "WELADED1GTL"],
  "33050000": ["Sparkasse Paderborn-Detmold", "SPBIDE3BXXX"],
  "33060098": ["Volksbank Paderborn", "GENODED1PBH"],
  "33060592": ["Volksbank H\xF6xter", "GENODED1HXB"],
  "33070024": ["Deutsche Bank Paderborn", "DEUTDEDB330"],
  "33450000": ["Sparkasse Detmold", "WELADED1DET"],
  "34050000": ["Sparkasse Kassel", "HELADEF1KAS"],
  "35050000": ["Sparkasse Aachen", "AACSDE33XXX"],
  "35070024": ["Deutsche Bank Aachen", "DEUTDEDB350"],
  "36050105": ["Sparkasse Essen", "SPESDE3EXXX"],
  "36070024": ["Deutsche Bank Essen", "DEUTDEDB360"],
  "37010050": ["Postbank K\xF6ln", "PBNKDEFFXXX"],
  "37050198": ["Sparkasse K\xF6lnBonn", "COLSDE33XXX"],
  "37070000": ["Deutsche Bank K\xF6ln", "DEUTDEDBKOE"],
  "37070024": ["Deutsche Bank", "DEUTDEDK"],
  "38010111": ["SEB Bonn", "ESSEDE5FXXX"],
  "38050000": ["Sparkasse Bonn", "COLSDE33BON"],
  "39050000": ["Sparkasse Krefeld", "SPMHDE3EXXX"],
  "39060180": ["Volksbank Krefeld", "GENODED1HTK"],
  "40050150": ["Sparkasse M\xFCnster", "WELADED1MST"],
  "40060000": ["DZ BANK M\xFCnster", "GENODEDDXXX"],
  "40060300": ["Volksbank M\xFCnster", "GENODEM1GBE"],
  "40070024": ["Deutsche Bank", "DEUTDEDBMUE"],
  "40090900": ["Volksbank M\xFCnsterland Nord", "GENODEF1IBB"],
  "40150050": ["Sparkasse Steinfurt", "WELADED1STF"],
  "40154530": ["Sparkasse Gronau", "WELADED1GRO"],
  "40164352": ["Volksbank Nordm\xFCnsterland", "GENODEM1BOB"],
  "41050095": ["Sparkasse Hagen", "WELADED1HAG"],
  "41060120": ["Volksbank im M\xE4rkischen Kreis", "GENODEM1NRD"],
  "42050001": ["Sparkasse Wuppertal", "WUPSDE33XXX"],
  "42060000": ["DZ BANK Wuppertal", "GENODEDDXXX"],
  "42070024": ["Deutsche Bank Wuppertal", "DEUTDEDB420"],
  "43050001": ["Sparkasse Bochum", "WELADED1BOC"],
  "43060967": ["Volksbank Bochum", "GENODEM1BOC"],
  "43070024": ["Deutsche Bank Bochum", "DEUTDEDB430"],
  "44050199": ["Sparkasse Dortmund", "DORTDE33XXX"],
  "44050000": ["Sparkasse Dortmund", "DORTDE33XXX"],
  "44060122": ["Volksbank Dortmund", "GENODEM1DOR"],
  "44070024": ["Deutsche Bank Dortmund", "DEUTDEDB440"],
  "45050001": ["Sparkasse Gelsenkirchen", "WELADED1GEK"],
  "45060009": ["GLS Gemeinschaftsbank", "GENODEM1GLS"],
  "45070024": ["Deutsche Bank Gelsenkirchen", "DEUTDEDB450"],
  "46050001": ["Sparkasse Oberhausen", "WELADED1OBH"],
  "47050101": ["Sparkasse Duisburg", "WELADED1DUI"],
  "47250101": ["Sparkasse Moers", "WELADED1MRS"],
  "47260307": ["Volksbank Rhein-Ruhr", "GENODED1VRR"],
  "48040035": ["Commerzbank M\xFCnster", "COBADEFFXXX"],
  "48050001": ["WL-Bank", "WELADED1MST"],
  "48050161": ["Sparkasse Westm\xFCnsterland", "WELADED1BOR"],
  "48060036": ["Volksbank Baumberge", "GENODEM1COE"],
  "48090000": ["Volksbank Osnabr\xFCcker Land", "GENODEF1MEB"],
  "49050101": ["Sparkasse Osnabr\xFCck", "NOLADE22XXX"],
  "49090900": ["Volksbank Bad Laer-Borgl.", "GENODEF1BGL"],
  "50010060": ["Postbank Frankfurt", "PBNKDEFFXXX"],
  "50010517": ["ING-DiBa", "INGDDEFFXXX"],
  "50020200": ["BHF-BANK", "BHFBDEFF500"],
  "50050201": ["Frankfurter Sparkasse", "HELADEF1822"],
  "50060400": ["Evangelische Bank", "GENODEF1EK1"],
  "50070010": ["Deutsche Bank Frankfurt", "DEUTDEFFXXX"],
  "50070024": ["Deutsche Bank", "DEUTDEDBFRA"],
  "50090500": ["Sparda-Bank Hessen", "GENODEF1S12"],
  "51050015": ["Nassauische Sparkasse", "NASSDE55XXX"],
  "55050000": ["Sparkasse Mainz", "MALADE51MNZ"],
  "60010070": ["Postbank Stuttgart", "PBNKDEFFXXX"],
  "60050101": ["BW-Bank", "SOLADEST600"],
  "60070070": ["Deutsche Bank Stuttgart", "DEUTDESSXXX"],
  "60070024": ["Deutsche Bank", "DEUTDEDBSTU"],
  "60090100": ["Volksbank Stuttgart", "VOBADESSXXX"],
  "66050101": ["Sparkasse Karlsruhe", "KARSDE66XXX"],
  "68050101": ["Sparkasse Freiburg", "FRSPDE66XXX"],
  "68090000": ["Volksbank Freiburg", "GENODE61FR1"],
  "70010080": ["Postbank M\xFCnchen", "PBNKDEFFXXX"],
  "70020270": ["HypoVereinsbank", "HYVEDEMMXXX"],
  "70050000": ["Bayerische Landesbank", "BYLADEMMXXX"],
  "70070010": ["Deutsche Bank M\xFCnchen", "DEUTDEMM"],
  "70070024": ["Deutsche Bank", "DEUTDEDBMUC"],
  "70090100": ["Volksbank M\xFCnchen", "GENODEF1M01"],
  "72050000": ["Sparkasse Augsburg", "AUGSDE77XXX"],
  "76050101": ["Sparkasse N\xFCrnberg", "SSKNDE77XXX"],
  "79050000": ["Sparkasse W\xFCrzburg", "BYLADEM1SWU"],
  "80070000": ["Deutsche Bank Leipzig", "DEUTDE8LXXX"],
  "86050200": ["Sparkasse Leipzig", "SOLADES1LEI"]
};
function lookupIBAN(iban) {
  if (!iban) return null;
  const clean = iban.replace(/\s/g, "").toUpperCase();
  if (clean.length < 12 || !clean.startsWith("DE")) return null;
  const blz = clean.substring(4, 12);
  const match = BLZ_BANK[blz];
  if (match) return { bank: match[0], bic: match[1] };
  const b3 = blz.substring(0, 3);
  const b4 = blz.substring(3, 5);
  if (blz[3] === "5") {
    for (const [key, val] of Object.entries(BLZ_BANK)) {
      if (key.startsWith(blz.substring(0, 5)) && key[3] === "5") return { bank: val[0], bic: val[1] };
    }
    return { bank: `Sparkasse (BLZ ${blz})`, bic: "" };
  }
  if (blz[3] === "6" || blz[3] === "9") {
    for (const [key, val] of Object.entries(BLZ_BANK)) {
      if (key.startsWith(blz.substring(0, 3)) && (key[3] === "6" || key[3] === "9")) return { bank: val[0], bic: val[1] };
    }
    return { bank: `Volksbank/Raiffeisenbank (BLZ ${blz})`, bic: "" };
  }
  if (blz[3] === "7") {
    return { bank: "Deutsche Bank", bic: "DEUTDEDBXXX" };
  }
  if (blz[3] === "4" || blz[3] === "1" && blz[4] === "0") {
    return { bank: "Commerzbank", bic: "COBADEFFXXX" };
  }
  if (blz.startsWith("1001") || blz[3] === "1" && blz[4] === "0" && blz[5] === "0") {
    return { bank: "Postbank", bic: "PBNKDEFFXXX" };
  }
  for (const [key, val] of Object.entries(BLZ_BANK)) {
    if (key.startsWith(blz.substring(0, 5))) return { bank: val[0], bic: val[1] };
  }
  for (const [key, val] of Object.entries(BLZ_BANK)) {
    if (key.startsWith(b3)) return { bank: val[0] + " (Region)", bic: val[1] };
  }
  return null;
}
function Chip({ label, active, onClick, icon }) {
  return /* @__PURE__ */ React.createElement("button", { onClick, style: {
    padding: "10px 20px",
    borderRadius: 10,
    border: `1.5px solid ${active ? BRAND.yellow : T.border}`,
    background: active ? T.accentGlow : "transparent",
    color: active ? BRAND.yellow : T.textSec,
    fontSize: 14,
    fontWeight: active ? 600 : 400,
    cursor: "pointer",
    fontFamily: font,
    transition: "all 0.2s ease",
    display: "inline-flex",
    alignItems: "center",
    gap: 8
  } }, icon && /* @__PURE__ */ React.createElement("span", null, icon), label);
}
function Buddy({ emoji = "\u{1F41D}", msg, size = 20, style: extraStyle }) {
  return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, ...extraStyle } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: size, lineHeight: 1 } }, emoji), msg && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: T.textDim, fontStyle: "italic" } }, msg));
}
const BUDDY_TIPS = {
  kunde: [
    { e: "\u{1F41D}", t: "Bzzz! Pflichtfelder nicht vergessen!" },
    { e: "\u{1F36F}", t: "Name + Nummer = Honig f\xFCrs Team!" },
    { e: "\u{1F41D}", t: "Kontaktdaten sind die Grundlage!" }
  ],
  einstieg: [
    { e: "\u{1F4A1}", t: "Was bewegt den Kunden wirklich?" },
    { e: "\u{1F3AF}", t: "Hauptgrund = Verkaufsargument Nr. 1!" },
    { e: "\u{1F41D}", t: "Bzzz! Motivation = Abschluss-Turbo!" }
  ],
  technik: [
    { e: "\u{1F4D0}", t: "Jetzt wird's technisch \u2013 genau messen!" },
    { e: "\u{1F41D}", t: "Bzzz! Sparren, Ziegel, alles notieren!" },
    { e: "\u{1F4F8}", t: "Fotos sind Gold wert f\xFCrs DC-Team!" }
  ],
  angebot: [
    { e: "\u{1F3C1}", t: "Fast geschafft \u2013 Checkliste abhaken!" },
    { e: "\u270D\uFE0F", t: "Unterschrift = Honig im Topf! \u{1F36F}" },
    { e: "\u{1F41D}", t: "Bzzz! Sauber abschlie\xDFen!" }
  ]
};
function ZaehlerOCR({ nr, label, data, u, camId }) {
  const nrKey = nr === 1 ? "zaehlerNr" : `zaehlerNr${nr}`;
  const photoKey = `zaehler${nr}Photo`;
  const scanKey = `zaehler${nr}Scanning`;
  const numbersKey = `zaehler${nr}Numbers`;
  const ocrKey = `zaehler${nr}OCR`;
  const demoKey = `zaehler${nr}Demo`;
  return /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "\u{1F4F7} ", label), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { position: "relative", flex: 1 } }, /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "text",
      value: data[nrKey] || "",
      onChange: (e) => u(nrKey, e.target.value),
      placeholder: "Foto scannen \u2192",
      style: { width: "100%", padding: "12px 16px", background: T.surface, border: `1.5px solid ${data[ocrKey] ? T.green : T.border}`, borderRadius: 10, color: T.text, fontSize: 15, fontFamily: font, outline: "none", boxSizing: "border-box" }
    }
  )), /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "file",
      accept: "image/*",
      capture: "environment",
      id: camId,
      style: { display: "none" },
      onChange: async (e) => {
        const file = e.target.files?.[0];
        if (!file) return;
        u(scanKey, true);
        u(photoKey, URL.createObjectURL(file));
        u(numbersKey, null);
        u(ocrKey, null);
        triggerGDriveUpload(file, photoKey, label, data, u);
        const runOCR = async (b, m) => {
          try {
            const r = await fetch("/api/ai-proxy", { method: "POST", headers: { "Content-Type": "application/json", }, body: JSON.stringify({ model: "claude-sonnet-4-20250514", max_tokens: 1e3, messages: [{ role: "user", content: [{ type: "image", source: { type: "base64", media_type: m, data: b } }, { type: "text", text: 'Foto eines Stromz\xE4hlers/Z\xE4hlerschranks. Lies ALLE sichtbaren Nummern ab. Pr\xFCfe auch ob ein APZ-Feld (Anschluss-/Pr\xFCfz\xE4hlerfeld nach VDE AR-N 4100) vorhanden/erkennbar ist. NUR JSON-Array: [{"label":"Beschreibung","value":"Nummer"}] \u2013 f\xFCge als letztes Element hinzu: {"label":"APZ-Feld","value":"vorhanden" oder "nicht erkennbar" oder "fehlt"}' }] }] }) });
            if (!r.ok) throw 0;
            const d = await r.json();
            const n = JSON.parse((d.content?.[0]?.text || "").replace(/```json|```/g, "").trim());
            if (Array.isArray(n) && n.length > 0) return n;
            throw 0;
          } catch (e2) {
            return null;
          }
        };
        try {
          const reader = new FileReader();
          reader.onload = async () => {
            const b = reader.result.split(",")[1];
            let n = await runOCR(b, file.type || "image/jpeg");
            if (!n) {
              await new Promise((r) => setTimeout(r, 1500));
              n = [{ label: "Z\xE4hlernummer", value: "198 2133 73" }, { label: "Eigentumsnummer", value: "1 DZG00 6046 5967" }, { label: "Z\xE4hlerstand", value: "13.983 kWh" }, { label: "APZ-Feld", value: "nicht erkennbar" }];
              u(demoKey, true);
            } else {
              u(demoKey, false);
            }
            u(numbersKey, n);
            u(scanKey, false);
          };
          reader.readAsDataURL(file);
        } catch (err) {
          u(scanKey, false);
        }
      }
    }
  ), /* @__PURE__ */ React.createElement("button", { onClick: () => document.getElementById(camId)?.click(), style: { width: 48, height: 48, borderRadius: 10, border: `1.5px solid ${data[ocrKey] ? T.green : BRAND.yellow}`, background: data[ocrKey] ? T.greenSoft : T.accentGlow, color: data[ocrKey] ? T.green : BRAND.yellow, fontSize: 20, cursor: "pointer", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data[scanKey] ? "\u23F3" : data[ocrKey] ? "\u2705" : "\u{1F4F7}")), data[scanKey] && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: BRAND.yellow, marginTop: 8, display: "flex", alignItems: "center", gap: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { animation: "spin 1s linear infinite", display: "inline-block" } }, "\u2699\uFE0F"), " KI scannt..."), data[photoKey] && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, borderRadius: 8, overflow: "hidden", border: `1px solid ${T.border}`, maxHeight: 80 } }, /* @__PURE__ */ React.createElement("img", { src: data[photoKey], alt: "", style: { width: "100%", height: 80, objectFit: "cover" } }), data[`${photoKey}_gd`] && /* @__PURE__ */ React.createElement("div", { style: { padding: "4px 8px", background: T.surface } }, /* @__PURE__ */ React.createElement(GDriveStatus, { status: data[`${photoKey}_gd`] }))), data[numbersKey]?.length > 0 && !data[scanKey] && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: BRAND.yellow, fontWeight: 600, marginBottom: 6 } }, "\u{1F916} Erkannte Nummern:"), data[numbersKey].map((n, i) => {
    const sel = data[nrKey] === n.value;
    const isAPZ = n.label === "APZ-Feld";
    const apzOk = isAPZ && n.value === "vorhanden";
    const apzBad = isAPZ && (n.value === "fehlt" || n.value === "nicht erkennbar");
    return isAPZ ? /* @__PURE__ */ React.createElement("div", { key: i, style: { padding: "10px 14px", borderRadius: 10, background: apzOk ? `${T.green}08` : `${T.red}08`, border: `2px solid ${apzOk ? T.green : T.red}`, marginBottom: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: apzOk ? T.green : T.red, fontWeight: 700, textTransform: "uppercase", letterSpacing: 0.5 } }, apzOk ? "\u2705" : "\u26A0\uFE0F", " APZ-Feld (VDE AR-N 4100)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: apzOk ? T.green : T.red, marginTop: 2 } }, n.value)), apzBad && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 22 } }, "\u{1F6A8}")), apzBad && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.red, marginTop: 6, lineHeight: 1.5 } }, "Z\xE4hlerschrank nicht VDE-konform! APZ-Feld nach VDE AR-N 4100 / TAR Niederspannung erforderlich. Nachr\xFCstung oder Z\xE4hlerschranktausch n\xF6tig.")) : /* @__PURE__ */ React.createElement("div", { key: i, onClick: () => {
      u(nrKey, n.value);
      u(ocrKey, true);
    }, style: { display: "flex", justifyContent: "space-between", padding: "8px 12px", borderRadius: 8, cursor: "pointer", background: sel ? T.greenSoft : T.surface, border: `1px solid ${sel ? T.green : T.border}`, marginBottom: 3 } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: sel ? T.green : T.textDim } }, n.label), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, color: sel ? T.green : T.text, fontWeight: 600, fontFamily: fontMono } }, n.value)), sel && /* @__PURE__ */ React.createElement("span", { style: { color: T.green } }, "\u2713"));
  }), data[demoKey] && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 4, fontStyle: "italic" } }, "\u24D8 Demo-Modus")));
}
function Section({ title, children, icon, accent }) {
  return /* @__PURE__ */ React.createElement("div", { style: {
    background: T.card,
    borderRadius: 14,
    padding: "20px 22px",
    border: `1px solid ${T.border}`,
    marginBottom: 16
  } }, title && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, marginBottom: 18 } }, icon && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18 } }, icon), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 15, fontWeight: 700, color: accent || T.text, letterSpacing: 0.3 } }, title)), children);
}
function AIHint({ text, color = BRAND.yellow }) {
  return /* @__PURE__ */ React.createElement("div", { style: {
    display: "flex",
    alignItems: "flex-start",
    gap: 10,
    padding: "12px 16px",
    background: `${color}10`,
    borderRadius: 10,
    border: `1px solid ${color}25`,
    marginTop: 12
  } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 16, flexShrink: 0, marginTop: 1 } }, "\u{1F916}"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, color, lineHeight: 1.5, fontWeight: 400 } }, text));
}
function PhotoTile({ label, icon, photoUrl, onCapture, onGallery, onRemove, hasAnalysis, note, required, gdStatus, onZoom, isVideo }) {
  const captured = !!photoUrl;
  return /* @__PURE__ */ React.createElement("div", { style: {
    flex: "1 1 calc(50% - 8px)",
    minWidth: 140,
    background: captured ? T.surface : T.surface,
    border: `2px ${captured ? "solid" : "dashed"} ${captured ? T.green : required ? `${T.red}60` : T.border}`,
    borderRadius: 14,
    overflow: "hidden",
    transition: "all 0.2s ease",
    position: "relative"
  } }, captured ? /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { width: "100%", height: 110, background: T.card, position: "relative" } }, typeof photoUrl === "string" && photoUrl.startsWith("blob:") ? /* @__PURE__ */ React.createElement(isVideo ? "div" : "img", Object.assign({ onClick: function(e) { e.stopPropagation(); if(onZoom) onZoom(photoUrl, isVideo); } }, isVideo ? { style: { width: "100%", height: "100%", position: "relative", cursor: "zoom-in" } } : { src: photoUrl, alt: label, style: { width: "100%", height: "100%", objectFit: "cover", cursor: "zoom-in" } }), isVideo ? React.createElement("img", { src: photoUrl, style: { width: "100%", height: "100%", objectFit: "cover" } }) : null) : /* @__PURE__ */ React.createElement("div", { style: { width: "100%", height: "100%", display: "flex", alignItems: "center", justifyContent: "center", background: `${T.green}12` } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 40 } }, "\u2705")), hasAnalysis && /* @__PURE__ */ React.createElement("div", { style: {
    position: "absolute",
    top: 6,
    right: 6,
    width: 24,
    height: 24,
    borderRadius: 8,
    background: BRAND.yellow,
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    fontSize: 13,
    fontWeight: 700,
    color: "#1a1a1a",
    boxShadow: "0 2px 8px rgba(0,0,0,0.3)"
  } }, "\u{1F916}"), /* @__PURE__ */ React.createElement("div", { style: {
    position: "absolute",
    bottom: 0,
    left: 0,
    right: 0,
    padding: "4px 8px",
    background: "linear-gradient(transparent, rgba(0,0,0,0.7))",
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center"
  } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 4 } }, /* @__PURE__ */ React.createElement("button", { onClick: (e) => {
    e.stopPropagation();
    onCapture();
  }, style: {
    padding: "3px 8px",
    borderRadius: 6,
    border: "none",
    cursor: "pointer",
    background: "rgba(255,255,255,0.2)",
    color: "#fff",
    fontSize: 10,
    fontFamily: font
  } }, "\u{1F4F7}"), /* @__PURE__ */ React.createElement("button", { onClick: (e) => {
    e.stopPropagation();
    onGallery();
  }, style: {
    padding: "3px 8px",
    borderRadius: 6,
    border: "none",
    cursor: "pointer",
    background: "rgba(255,255,255,0.2)",
    color: "#fff",
    fontSize: 10,
    fontFamily: font
  } }, "\u{1F5BC}\uFE0F")), /* @__PURE__ */ React.createElement("button", { onClick: (e) => {
    e.stopPropagation();
    onRemove();
  }, style: {
    padding: "3px 8px",
    borderRadius: 6,
    border: "none",
    cursor: "pointer",
    background: "rgba(239,68,68,0.4)",
    color: "#fff",
    fontSize: 10,
    fontFamily: font
  } }, "\u2715"))), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.green, fontWeight: 600, display: "flex", alignItems: "center", gap: 4 } }, /* @__PURE__ */ React.createElement("span", null, "\u2713"), " ", label), gdStatus && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 2 } }, /* @__PURE__ */ React.createElement(GDriveStatus, { status: gdStatus })))) : /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { padding: "16px 10px 8px", textAlign: "center" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 28 } }, icon), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, fontWeight: 500, marginTop: 6, lineHeight: 1.3 } }, label), note && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 3 } }, note), required && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.red, marginTop: 3 } }, "Pflicht *")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, padding: "6px 10px 12px", justifyContent: "center" } }, /* @__PURE__ */ React.createElement("button", { onClick: onCapture, style: {
    flex: 1,
    padding: "8px 4px",
    borderRadius: 8,
    border: `1px solid ${T.border}`,
    background: T.card,
    cursor: "pointer",
    color: T.text,
    fontSize: 11,
    fontWeight: 600,
    fontFamily: font,
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    gap: 4
  } }, "\u{1F4F7} Kamera"), /* @__PURE__ */ React.createElement("button", { onClick: onGallery, style: {
    flex: 1,
    padding: "8px 4px",
    borderRadius: 8,
    border: `1px solid ${T.border}`,
    background: T.card,
    cursor: "pointer",
    color: T.textSec,
    fontSize: 11,
    fontWeight: 600,
    fontFamily: font,
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    gap: 4
  } }, "\u{1F5BC}\uFE0F Galerie"))));
}
function StepKunde({ data, setData }) {
  const u = (k, v) => setData((d) => ({ ...d, [k]: v }));
  return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(Section, { title: "Kontaktdaten", icon: "\u{1F4CB}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Anrede",
      value: data.anrede || "",
      onChange: (v) => u("anrede", v),
      half: true,
      required: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Herr", label: "Herr" }, { value: "Frau", label: "Frau" }, { value: "Divers", label: "Divers" }]
    }
  ), /* @__PURE__ */ React.createElement(Input, { label: "Titel", value: data.titel || "", onChange: (v) => u("titel", v), placeholder: "Dr. / Prof.", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Vorname", value: data.vorname || "", onChange: (v) => u("vorname", v), placeholder: "Max", half: true, icon: "\u{1F464}", required: true }), /* @__PURE__ */ React.createElement(Input, { label: "Nachname", value: data.nachname || "", onChange: (v) => u("nachname", v), placeholder: "Mustermann", half: true, required: true }), /* @__PURE__ */ React.createElement(
    Input,
    {
      label: "Telefon",
      value: data.telefon || "",
      onChange: (v) => u("telefon", v),
      placeholder: "+49 521 ...",
      type: "tel",
      half: true,
      icon: "\u{1F4F1}",
      actionBtn: data.telefon?.trim() ? { label: "\u{1F4DE}", href: `tel:${data.telefon.replace(/\s/g, "")}` } : null
    }
  ), /* @__PURE__ */ React.createElement(
    Input,
    {
      label: "Mobil",
      value: data.mobil || "",
      onChange: (v) => u("mobil", v),
      placeholder: "0176 ...",
      type: "tel",
      half: true,
      icon: "\u{1F4F2}",
      required: true,
      actionBtn: data.mobil?.trim() ? { label: "\u{1F4DE}", href: `tel:${data.mobil.replace(/\s/g, "")}` } : null
    }
  ), /* @__PURE__ */ React.createElement(
    Input,
    {
      label: "E-Mail",
      value: data.email || "",
      onChange: (v) => u("email", v),
      placeholder: "max@beispiel.de",
      type: "email",
      half: true,
      icon: "\u2709\uFE0F",
      required: true,
      error: data.email && data.email.length > 3 ? validateEmail(data.email) : null,
      success: data.email && data.email.length > 4 && !validateEmail(data.email)
    }
  ), /* @__PURE__ */ React.createElement(Input, { label: "Geburtsdatum", value: data.geburtsdatum || "", onChange: (v) => {
    const raw = v.replace(/[^0-9]/g, "").substring(0, 8);
    let formatted = "";
    for (let i = 0; i < raw.length; i++) {
      if (i === 2 || i === 4) formatted += ".";
      formatted += raw[i];
    }
    u("geburtsdatum", formatted);
  }, placeholder: "TT.MM.JJJJ", half: true, icon: "\u{1F382}", required: true, inputMode: "numeric" })), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, fontSize: 11, color: T.textDim, display: "flex", alignItems: "center", gap: 4 } }, /* @__PURE__ */ React.createElement("span", { style: { color: T.red } }, "*"), " Pflichtfeld")), (data.mobilnr || data.telefon) && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, marginBottom: 14 } }, data.mobilnr && /* @__PURE__ */ React.createElement("a", { href: `tel:${data.mobilnr}`, style: {
    flex: 1,
    padding: "10px",
    borderRadius: 10,
    textDecoration: "none",
    textAlign: "center",
    background: `${T.green}10`,
    border: `1.5px solid ${T.green}25`,
    color: T.green,
    fontSize: 11,
    fontWeight: 600,
    fontFamily: font
  } }, "\u{1F4F1} Mobil: ", data.mobilnr), data.telefon && /* @__PURE__ */ React.createElement("a", { href: `tel:${data.telefon}`, style: {
    flex: 1,
    padding: "10px",
    borderRadius: 10,
    textDecoration: "none",
    textAlign: "center",
    background: T.surface,
    border: `1.5px solid ${T.border}`,
    color: T.text,
    fontSize: 11,
    fontWeight: 600,
    fontFamily: font
  } }, "\u{1F4DE} Festnetz: ", data.telefon), data.mobilnr && /* @__PURE__ */ React.createElement("a", { href: `https://wa.me/${(data.mobilnr || "").replace(/[^0-9]/g, "").replace(/^0/, "49")}`, target: "_blank", style: {
    padding: "10px 14px",
    borderRadius: 10,
    textDecoration: "none",
    textAlign: "center",
    background: "#25D366",
    color: "#fff",
    fontSize: 11,
    fontWeight: 600,
    fontFamily: font
  } }, "\u{1F4AC}")), /* @__PURE__ */ React.createElement(Section, { title: "Adresse", icon: "\u{1F4CD}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8, marginBottom: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { position: "relative", flex: 1 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "\u{1F50D} Adresse suchen"), /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "text",
      value: data._addrSearch || "",
      placeholder: "Adresse eingeben...",
      onChange: (e) => {
        const q = e.target.value;
        u("_addrSearch", q);
        if (q.length >= 3) {
          const demos = [
            { display: `${q}, 48485 Neuenkirchen`, strasse: q.split(",")[0].replace(/\s*\d+$/, "").trim(), hausnummer: (q.match(/\d+/) || [""])[0], plz: "48485", ort: "Neuenkirchen", lat: 52.237, lng: 7.368 },
            { display: `${q}, 33602 Bielefeld`, strasse: q.split(",")[0].replace(/\s*\d+$/, "").trim(), hausnummer: (q.match(/\d+/) || [""])[0], plz: "33602", ort: "Bielefeld", lat: 52.022, lng: 8.532 },
            { display: `${q}, 33100 Paderborn`, strasse: q.split(",")[0].replace(/\s*\d+$/, "").trim(), hausnummer: (q.match(/\d+/) || [""])[0], plz: "33100", ort: "Paderborn", lat: 51.719, lng: 8.757 }
          ];
          u("_addrSuggestions", demos);
        } else {
          u("_addrSuggestions", null);
        }
      },
      style: {
        width: "100%",
        padding: "14px 16px 14px 42px",
        background: T.surface,
        border: `1.5px solid ${data._addrApplied ? T.green : BRAND.yellow}40`,
        borderRadius: 12,
        color: T.text,
        fontSize: 15,
        fontFamily: font,
        outline: "none",
        boxSizing: "border-box"
      }
    }
  ), /* @__PURE__ */ React.createElement("span", { style: { position: "absolute", left: 14, top: 36, fontSize: 18 } }, "\u{1F4CD}"), data._addrApplied && /* @__PURE__ */ React.createElement("span", { style: { position: "absolute", right: 14, top: 36, fontSize: 16, color: T.green } }, "\u2713"), data._addrSuggestions && data._addrSuggestions.length > 0 && !data._addrApplied && /* @__PURE__ */ React.createElement("div", { style: {
    position: "absolute",
    top: "100%",
    left: 0,
    right: 0,
    zIndex: 50,
    marginTop: 4,
    background: T.card,
    borderRadius: 12,
    border: `1px solid ${T.border}`,
    boxShadow: "0 12px 40px rgba(0,0,0,0.5)",
    overflow: "hidden"
  } }, data._addrSuggestions.map((s, i) => /* @__PURE__ */ React.createElement(
    "div",
    {
      key: i,
      onClick: () => {
        const nb = getNetzbetreiber(s.plz);
        setData((d) => ({
          ...d,
          strasse: s.strasse,
          hausnummer: s.hausnummer,
          plz: s.plz,
          ort: s.ort,
          _addrSearch: s.display,
          _addrSuggestions: null,
          _addrApplied: true,
          _lat: s.lat,
          _lng: s.lng,
          ...nb && !d._nbManual ? { netzbetreiber: nb } : {}
        }));
      },
      style: {
        padding: "14px 16px",
        cursor: "pointer",
        borderBottom: `1px solid ${T.border}`,
        display: "flex",
        alignItems: "center",
        gap: 12,
        transition: "background 0.1s"
      },
      onMouseEnter: (e) => e.currentTarget.style.background = T.surface,
      onMouseLeave: (e) => e.currentTarget.style.background = "transparent"
    },
    /* @__PURE__ */ React.createElement("span", { style: { fontSize: 20, flexShrink: 0 } }, "\u{1F4CD}"),
    /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, color: T.text, fontWeight: 500 } }, s.display), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 2 } }, s.plz, " ", s.ort))
  )), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 16px", fontSize: 10, color: T.textDim, textAlign: "center", fontStyle: "italic" } }, "\u24D8 Demo \u2013 in der PWA mit Google API-Key echte Adress-Vorschl\xE4ge"))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", justifyContent: "flex-end" } }, /* @__PURE__ */ React.createElement("button", { onClick: async () => {
    if (!navigator.geolocation) {
      alert("Geolocation wird nicht unterst\xFCtzt");
      return;
    }
    u("_geoLoading", true);
    navigator.geolocation.getCurrentPosition(
      async (pos) => {
        const { latitude, longitude } = pos.coords;
        try {
          const resp = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}&addressdetails=1&accept-language=de`);
          const geo = await resp.json();
          const a = geo.address || {};
          const strasse = a.road || "";
          const hausnummer = a.house_number || "";
          const plz = a.postcode || "";
          const ort = a.city || a.town || a.village || a.municipality || "";
          const nb = getNetzbetreiber(plz);
          setData((d) => ({
            ...d,
            strasse,
            hausnummer,
            plz,
            ort,
            _lat: latitude,
            _lng: longitude,
            _addrSearch: `${strasse} ${hausnummer}, ${plz} ${ort}`.trim(),
            _addrApplied: true,
            _addrSuggestions: null,
            _geoLoading: false,
            ...nb && !d._nbManual ? { netzbetreiber: nb } : {}
          }));
        } catch (err) {
          setData((d) => ({
            ...d,
            _geoLoading: false,
            _lat: latitude,
            _lng: longitude,
            _addrSearch: `\u{1F4CD} ${latitude.toFixed(5)}, ${longitude.toFixed(5)}`
          }));
        }
      },
      (err) => {
        u("_geoLoading", false);
        alert("GPS-Zugriff verweigert.\nBitte Standort-Berechtigung in den Einstellungen aktivieren.");
      },
      { enableHighAccuracy: true, timeout: 1e4 }
    );
  }, style: {
    padding: "14px 16px",
    borderRadius: 12,
    border: `1.5px solid ${data._geoLoading ? `${BRAND.yellow}60` : `${T.blue}40`}`,
    background: data._geoLoading ? `${BRAND.yellow}10` : `${T.blue}10`,
    cursor: "pointer",
    display: "flex",
    flexDirection: "column",
    alignItems: "center",
    gap: 4,
    fontFamily: font,
    minWidth: 64
  } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 22, animation: data._geoLoading ? "spin 1s linear infinite" : "none", display: "inline-block" } }, data._geoLoading ? "\u23F3" : "\u{1F4E1}"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: data._geoLoading ? BRAND.yellow : T.blue, fontWeight: 600, whiteSpace: "nowrap" } }, data._geoLoading ? "Suche..." : "GPS")))), data._addrApplied && /* @__PURE__ */ React.createElement("div", { style: {
    padding: "8px 14px",
    background: T.greenSoft,
    borderRadius: 8,
    border: `1px solid ${T.green}25`,
    display: "flex",
    alignItems: "center",
    gap: 8,
    marginBottom: 12
  } }, /* @__PURE__ */ React.createElement("span", { style: { color: T.green } }, "\u2705"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: T.green } }, "Adresse \xFCbernommen"), /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => {
        u("_addrApplied", false);
        u("_addrSearch", "");
        u("_addrSuggestions", null);
        u("_lat", null);
        u("_lng", null);
      },
      style: { marginLeft: "auto", fontSize: 11, color: T.textDim, background: "none", border: "none", cursor: "pointer", textDecoration: "underline", fontFamily: font }
    },
    "\xC4ndern"
  )), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(Input, { label: "Stra\xDFe", value: data.strasse || "", onChange: (v) => u("strasse", v), placeholder: "Mor\xE4nenstra\xDFe", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Hausnummer", value: data.hausnummer || "", onChange: (v) => u("hausnummer", v), placeholder: "1", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "PLZ", value: data.plz || "", onChange: (v) => {
    u("plz", v);
    const nb = getNetzbetreiber(v);
    if (nb && !data._nbManual) u("netzbetreiber", nb);
    if (v.length >= 4 && !data._addrApplied) {
      const p2 = parseInt(v.substring(0, 2));
      const plzCoords = {
        10: [52.52, 13.4],
        12: [52.47, 13.44],
        13: [52.58, 13.4],
        20: [53.55, 9.99],
        21: [53.55, 9.95],
        22: [53.56, 10],
        23: [54.32, 10.14],
        24: [54.32, 10.13],
        25: [54, 9.43],
        26: [53.15, 8.22],
        27: [53.08, 8.81],
        28: [53.08, 8.81],
        29: [52.83, 9.45],
        30: [52.37, 9.74],
        31: [52.39, 9.77],
        32: [52, 8.53],
        33: [51.93, 8.57],
        34: [51.32, 9.5],
        35: [50.58, 8.67],
        36: [50.55, 9.68],
        37: [51.53, 9.93],
        38: [52.26, 10.52],
        39: [52.12, 11.63],
        40: [51.23, 6.78],
        41: [51.13, 6.79],
        42: [51.26, 7.17],
        44: [51.51, 7.47],
        45: [51.46, 6.98],
        46: [51.47, 6.85],
        47: [51.43, 6.76],
        48: [52, 7.63],
        49: [52.28, 8.05],
        50: [50.94, 6.96],
        51: [50.96, 7.02],
        52: [50.78, 6.08],
        53: [50.73, 7.1],
        54: [49.75, 6.64],
        55: [49.99, 8.27],
        56: [50.36, 7.6],
        57: [50.87, 7.73],
        58: [51.36, 7.47],
        59: [51.69, 7.82],
        60: [50.11, 8.68],
        61: [50.17, 8.64],
        63: [50.1, 8.77],
        64: [49.87, 8.65],
        65: [50.08, 8.24],
        66: [49.24, 7],
        67: [49.44, 8.45],
        68: [49.49, 8.47],
        69: [49.41, 8.69],
        70: [48.78, 9.18],
        71: [48.73, 9.12],
        72: [48.49, 9.21],
        73: [48.8, 9.8],
        74: [49.07, 9],
        75: [48.89, 8.7],
        76: [49, 8.4],
        77: [48.47, 7.95],
        78: [47.66, 9.18],
        79: [47.99, 7.85],
        80: [48.14, 11.58],
        81: [48.12, 11.6],
        82: [48.07, 11.5],
        83: [47.85, 12.13],
        84: [48.46, 12.17],
        85: [48.35, 11.79],
        86: [48.37, 10.9],
        87: [47.73, 10.32],
        88: [47.66, 9.48],
        89: [48.4, 9.99],
        90: [49.45, 11.08],
        91: [49.46, 11],
        92: [49.49, 11.78],
        93: [49.02, 12.1],
        94: [48.57, 13.47],
        95: [50.32, 11.94],
        96: [50.09, 11.05],
        97: [49.79, 9.94],
        98: [50.69, 10.93],
        99: [50.97, 11.03]
      };
      const coords = plzCoords[p2];
      if (coords) {
        u("_lat", coords[0]);
        u("_lng", coords[1]);
      }
    }
  }, placeholder: "48485", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Ort", value: data.ort || "", onChange: (v) => u("ort", v), placeholder: "Neuenkirchen", half: true })), data.strasse && data.plz && data.ort && (() => {
    const addr = `${data.strasse} ${data.hausnummer || ""}, ${data.plz} ${data.ort}`;
    const lat = data._lat || 52;
    const lng = data._lng || 8.5;
    return /* @__PURE__ */ React.createElement("div", { style: {
      marginTop: 14,
      borderRadius: 14,
      overflow: "hidden",
      border: `1px solid ${T.border}`,
      background: T.surface
    } }, /* @__PURE__ */ React.createElement("div", { style: { position: "relative", height: 120, background: `linear-gradient(135deg, ${T.card} 0%, ${T.surface} 100%)`, overflow: "hidden" } }, /* @__PURE__ */ React.createElement("svg", { width: "100%", height: "100%", viewBox: "0 0 400 120", style: { position: "absolute", inset: 0, opacity: 0.15 } }, Array.from({ length: 8 }).map((_, i) => /* @__PURE__ */ React.createElement("line", { key: i, x1: 50 * i, y1: "0", x2: 50 * i, y2: "120", stroke: T.textDim, strokeWidth: "0.5" })), Array.from({ length: 4 }).map((_, i) => /* @__PURE__ */ React.createElement("line", { key: `h${i}`, x1: "0", y1: 30 * i, x2: "400", y2: 30 * i, stroke: T.textDim, strokeWidth: "0.5" })), /* @__PURE__ */ React.createElement("circle", { cx: "200", cy: "60", r: "40", fill: "none", stroke: BRAND.yellow, strokeWidth: "1", opacity: "0.3" }), /* @__PURE__ */ React.createElement("circle", { cx: "200", cy: "60", r: "20", fill: "none", stroke: BRAND.yellow, strokeWidth: "1", opacity: "0.5" }), /* @__PURE__ */ React.createElement("circle", { cx: "200", cy: "60", r: "4", fill: BRAND.yellow, opacity: "0.8" })), /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", top: "50%", left: "50%", transform: "translate(-50%, -90%)", fontSize: 36, filter: "drop-shadow(0 2px 6px rgba(0,0,0,0.4))" } }, "\u{1F4CD}"), /* @__PURE__ */ React.createElement("div", { style: {
      position: "absolute",
      bottom: 8,
      left: 12,
      padding: "3px 10px",
      borderRadius: 6,
      background: "rgba(0,0,0,0.5)",
      backdropFilter: "blur(4px)",
      fontSize: 10,
      color: T.textDim,
      fontFamily: fontMono
    } }, lat.toFixed(3), "\xB0 N, ", lng.toFixed(3), "\xB0 E")), /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 600, color: T.text, marginBottom: 10 } }, "\u{1F4CD} ", addr), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement(
      "a",
      {
        href: `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(addr)}`,
        target: "_blank",
        rel: "noopener noreferrer",
        style: {
          flex: 1,
          padding: "10px",
          borderRadius: 10,
          border: "none",
          textAlign: "center",
          background: `linear-gradient(135deg, #4285F4, #34A853)`,
          color: "#fff",
          fontSize: 13,
          fontWeight: 700,
          fontFamily: font,
          textDecoration: "none",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          gap: 6
        }
      },
      "\u{1F5FA}\uFE0F Karte \xF6ffnen"
    ), /* @__PURE__ */ React.createElement(
      "a",
      {
        href: `https://www.google.com/maps/@${lat},${lng},18z/data=!3m1!1e1`,
        target: "_blank",
        rel: "noopener noreferrer",
        style: {
          flex: 1,
          padding: "10px",
          borderRadius: 10,
          border: `1.5px solid ${T.border}`,
          background: "transparent",
          color: T.textSec,
          textAlign: "center",
          fontSize: 13,
          fontWeight: 600,
          fontFamily: font,
          textDecoration: "none",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          gap: 6
        }
      },
      "\u{1F6F0}\uFE0F Satellit"
    )), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 8, textAlign: "center" } }, "\xD6ffnet Google Maps im Browser \u2013 Dachfl\xE4che, Verschattung & Kamine pr\xFCfen")));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Bankverbindung", icon: "\u{1F4B3}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(Input, { label: "IBAN", value: data.iban || "", onChange: (v) => {
    u("iban", v);
    const result = lookupIBAN(v);
    if (result) {
      u("bic", result.bic);
      u("bankName", result.bank);
      u("_ibanLookup", true);
    } else if (v.replace(/\s/g, "").length >= 12) {
      u("_ibanLookup", false);
    }
  }, placeholder: "DE89 3704 0044 0532 0130 00" }), (() => {
    const autoName = data.vorname && data.nachname ? `${data.vorname} ${data.nachname}` : "";
    const isAuto = autoName && (data.kontoinhaber || "") === autoName && !data._khManual;
    if (autoName && !data.kontoinhaber && !data._khManual) {
      setTimeout(() => u("kontoinhaber", autoName), 0);
    }
    return /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "Kontoinhaber"), !data._khManual ? /* @__PURE__ */ React.createElement("div", { style: {
      width: "100%",
      padding: "12px 16px",
      background: T.surface,
      border: `1.5px solid ${autoName ? T.green : T.border}`,
      borderRadius: 10,
      display: "flex",
      alignItems: "center",
      justifyContent: "space-between",
      boxSizing: "border-box",
      minHeight: 48
    } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 15, color: autoName ? T.text : T.textDim, fontFamily: font } }, autoName || "Bitte erst Vor-/Nachname eingeben"), autoName && /* @__PURE__ */ React.createElement(
      "button",
      {
        onClick: () => u("_khManual", true),
        style: { fontSize: 11, color: T.textDim, background: "none", border: "none", cursor: "pointer", fontFamily: font, textDecoration: "underline", flexShrink: 0, marginLeft: 8 }
      },
      "\xC4ndern"
    )) : /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(
      "input",
      {
        type: "text",
        value: data.kontoinhaber || "",
        onChange: (e) => u("kontoinhaber", e.target.value),
        placeholder: "Abweichender Kontoinhaber",
        style: {
          width: "100%",
          padding: "12px 16px",
          background: T.surface,
          border: `1.5px solid ${T.border}`,
          borderRadius: 10,
          color: T.text,
          fontSize: 15,
          fontFamily: font,
          outline: "none",
          boxSizing: "border-box"
        }
      }
    ), autoName && /* @__PURE__ */ React.createElement(
      "button",
      {
        onClick: () => {
          u("kontoinhaber", autoName);
          u("_khManual", false);
        },
        style: { marginTop: 4, fontSize: 11, color: BRAND.yellow, background: "none", border: "none", cursor: "pointer", fontFamily: font }
      },
      "\u2190 Zur\xFCck zu ",
      autoName
    )));
  })(), /* @__PURE__ */ React.createElement(Input, { label: "BIC", value: data.bic || "", onChange: (v) => u("bic", v), placeholder: "COBADEFFXXX", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Name der Bank", value: data.bankName || "", onChange: (v) => u("bankName", v), placeholder: "Wird aus IBAN ermittelt", half: true, icon: "\u{1F3E6}" })), data._ibanLookup && data.bankName && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6, marginTop: 8 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.green } }, "\u2705 Bank & BIC aus IBAN erkannt: ", /* @__PURE__ */ React.createElement("strong", null, data.bankName), " \xB7 ", data.bic)), data.iban && data.iban.replace(/\s/g, "").length >= 12 && !data._ibanLookup && !lookupIBAN(data.iban) && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 8 } }, "BLZ nicht in Datenbank \u2013 bitte BIC und Bank manuell eingeben"), !data.ibanApplied && /* @__PURE__ */ React.createElement("div", { style: {
    marginTop: 12,
    padding: "12px 16px",
    borderRadius: 10,
    border: `1.5px dashed ${BRAND.yellow}40`,
    background: T.accentGlow,
    display: "flex",
    alignItems: "center",
    gap: 12
  } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 20 } }, "\u{1F4B3}"), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 600, color: T.text } }, "EC-/Bankkarte scannen"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec } }, "IBAN automatisch von der Karte ablesen")), /* @__PURE__ */ React.createElement("button", { onClick: () => {
    const input = document.createElement("input");
    input.type = "file";
    input.accept = "image/*,video/*";
    input.capture = "environment";
    input.onchange = async (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      u("ibanScanning", true);
      u("ibanPhoto", URL.createObjectURL(file));
      triggerGDriveUpload(file, "ibanPhoto", "IBAN_Scan", data, u);
      const reader = new FileReader();
      reader.onload = async () => {
        const base64 = reader.result.split(",")[1];
        let result = null;
        try {
          const resp = await fetch("/api/ai-proxy", {
            method: "POST",
            headers: { "Content-Type": "application/json", },
            body: JSON.stringify({
              model: "claude-sonnet-4-20250514",
              max_tokens: 1e3,
              messages: [{
                role: "user",
                content: [
                  { type: "image", source: { type: "base64", media_type: file.type || "image/jpeg", data: base64 } },
                  { type: "text", text: `Dies ist ein Foto einer EC-Karte, Bankkarte oder Kontoauszug. Lies die Bankdaten ab. Antworte NUR als JSON:
{"iban":"IBAN mit Leerzeichen formatiert","bic":"BIC/SWIFT falls sichtbar, sonst leer","kontoinhaber":"Name falls sichtbar, sonst leer","bank":"Bankname falls erkennbar, sonst leer"}` }
                ]
              }]
            })
          });
          if (!resp.ok) throw new Error("API " + resp.status);
          const apiData = await resp.json();
          const txt = (apiData.content?.[0]?.text || "").trim();
          result = JSON.parse(txt.replace(/```json|```/g, "").trim());
        } catch (err) {
          await new Promise((r) => setTimeout(r, 1500));
          result = {
            iban: "DE89 3704 0044 0532 0130 00",
            bic: "COBADEFFXXX",
            kontoinhaber: data.vorname && data.nachname ? `${data.vorname} ${data.nachname}` : "Max Mustermann",
            bank: "Commerzbank"
          };
          u("ibanDemoMode", true);
        }
        u("ibanResult", result);
        u("ibanScanning", false);
      };
      reader.readAsDataURL(file);
    };
    input.click();
  }, style: {
    padding: "8px 16px",
    borderRadius: 8,
    border: "none",
    cursor: "pointer",
    background: `linear-gradient(135deg, ${BRAND.yellow}, ${BRAND.yellowDark})`,
    color: "#1a1a1a",
    fontSize: 12,
    fontWeight: 700,
    fontFamily: font,
    flexShrink: 0
  } }, "\u{1F4F7} Scannen")), data.ibanScanning && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, fontSize: 12, color: BRAND.yellow, display: "flex", alignItems: "center", gap: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { animation: "spin 1s linear infinite", display: "inline-block" } }, "\u2699\uFE0F"), " KI liest Bankdaten..."), data.ibanPhoto && !data.ibanScanning && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, borderRadius: 8, overflow: "hidden", border: `1px solid ${T.border}`, maxHeight: 80 } }, /* @__PURE__ */ React.createElement("img", { src: data.ibanPhoto, alt: "Bankkarte", style: { width: "100%", height: 80, objectFit: "cover" } })), data.ibanResult && !data.ibanScanning && !data.ibanApplied && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.green, fontWeight: 600, letterSpacing: 0.5, textTransform: "uppercase", marginBottom: 6 } }, "Erkannte Bankdaten"), /* @__PURE__ */ React.createElement("div", { style: {
    padding: "10px 14px",
    background: T.surface,
    borderRadius: 10,
    border: `1px solid ${T.border}`,
    marginBottom: 10,
    display: "grid",
    gridTemplateColumns: "1fr 1fr",
    gap: "4px 16px"
  } }, [
    data.ibanResult.iban && ["IBAN", data.ibanResult.iban],
    data.ibanResult.bic && ["BIC", data.ibanResult.bic],
    data.ibanResult.kontoinhaber && ["Inhaber", data.ibanResult.kontoinhaber],
    data.ibanResult.bank && ["Bank", data.ibanResult.bank]
  ].filter(Boolean).map(([k, v], i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { padding: "3px 0" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: T.textDim, textTransform: "uppercase" } }, k), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, color: T.text, fontWeight: 600, fontFamily: fontMono } }, v)))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement("button", { onClick: () => {
    const r = data.ibanResult;
    const updates = {};
    if (r.iban) updates.iban = r.iban;
    if (r.bic) updates.bic = r.bic;
    if (r.kontoinhaber) updates.kontoinhaber = r.kontoinhaber;
    if (r.bank) updates.bankName = r.bank;
    setData((d) => ({ ...d, ...updates, ibanApplied: true }));
  }, style: {
    flex: 2,
    padding: "10px",
    borderRadius: 8,
    border: "none",
    cursor: "pointer",
    background: `linear-gradient(135deg, ${T.green}, #059669)`,
    color: "#fff",
    fontSize: 13,
    fontWeight: 700,
    fontFamily: font
  } }, "\u2705 \xDCbernehmen"), /* @__PURE__ */ React.createElement("button", { onClick: () => {
    u("ibanResult", null);
    u("ibanPhoto", null);
  }, style: {
    flex: 1,
    padding: "10px",
    borderRadius: 8,
    border: `1.5px solid ${T.border}`,
    background: "transparent",
    color: T.textSec,
    fontSize: 13,
    fontFamily: font,
    cursor: "pointer"
  } }, "Verwerfen")), data.ibanDemoMode && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 6, fontStyle: "italic", textAlign: "center" } }, "\u24D8 Demo-Modus")), data.ibanApplied && /* @__PURE__ */ React.createElement("div", { style: {
    marginTop: 10,
    display: "flex",
    alignItems: "center",
    gap: 8,
    padding: "8px 12px",
    background: T.greenSoft,
    borderRadius: 8,
    border: `1px solid ${T.green}25`
  } }, /* @__PURE__ */ React.createElement("span", null, "\u2705"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: T.green } }, "Bankdaten \xFCbernommen"), /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => {
        u("ibanApplied", false);
        u("ibanResult", null);
        u("ibanPhoto", null);
      },
      style: { marginLeft: "auto", fontSize: 11, color: T.textDim, background: "none", border: "none", cursor: "pointer", textDecoration: "underline", fontFamily: font }
    },
    "Erneut scannen"
  ))), /* @__PURE__ */ React.createElement(Section, { title: "Netzanmeldung", icon: "\u26A1" }, (() => {
    const nbSuggestion = getNetzbetreiber(data.plz);
    const currentNB = data.netzbetreiber || "";
    const matchesSuggestion = nbSuggestion && currentNB === nbSuggestion;
    const isManual = data._nbManual;
    return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "\u{1F50C} Netzbetreiber"), !isManual ? /* @__PURE__ */ React.createElement("div", { style: {
      width: "100%",
      padding: "12px 16px",
      background: T.surface,
      border: `1.5px solid ${currentNB ? T.green : T.border}`,
      borderRadius: 10,
      display: "flex",
      alignItems: "center",
      justifyContent: "space-between",
      boxSizing: "border-box",
      minHeight: 48
    } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 15, color: currentNB ? T.text : T.textDim, fontFamily: font } }, currentNB || (nbSuggestion ? "Wird aus PLZ ermittelt..." : "Bitte zuerst PLZ eingeben")), /* @__PURE__ */ React.createElement(
      "button",
      {
        onClick: () => u("_nbManual", true),
        style: { fontSize: 11, color: T.textDim, background: "none", border: "none", cursor: "pointer", fontFamily: font, textDecoration: "underline", flexShrink: 0, marginLeft: 8 }
      },
      "\xC4ndern"
    )) : /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(
      "input",
      {
        type: "text",
        value: currentNB,
        onChange: (e) => u("netzbetreiber", e.target.value),
        placeholder: "Netzbetreiber manuell eingeben...",
        style: {
          width: "100%",
          padding: "12px 16px",
          background: T.surface,
          border: `1.5px solid ${T.border}`,
          borderRadius: 10,
          color: T.text,
          fontSize: 15,
          fontFamily: font,
          outline: "none",
          boxSizing: "border-box"
        }
      }
    ), nbSuggestion && /* @__PURE__ */ React.createElement(
      "button",
      {
        onClick: () => {
          u("netzbetreiber", nbSuggestion);
          u("_nbManual", false);
        },
        style: { marginTop: 6, fontSize: 11, color: BRAND.yellow, background: "none", border: "none", cursor: "pointer", fontFamily: font }
      },
      "\u2190 Zur\xFCck zu PLZ-Vorschlag: ",
      nbSuggestion
    )), !isManual && matchesSuggestion && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6, marginTop: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.green } }, "\u2705 Automatisch erkannt f\xFCr PLZ ", data.plz)), !isManual && nbSuggestion && !currentNB && /* @__PURE__ */ React.createElement(
      "button",
      {
        onClick: () => u("netzbetreiber", nbSuggestion),
        style: {
          marginTop: 8,
          width: "100%",
          padding: "10px 14px",
          borderRadius: 8,
          border: `1.5px solid ${BRAND.yellow}40`,
          background: T.accentGlow,
          color: BRAND.yellow,
          fontSize: 13,
          fontWeight: 600,
          cursor: "pointer",
          fontFamily: font,
          display: "flex",
          alignItems: "center",
          gap: 8
        }
      },
      /* @__PURE__ */ React.createElement("span", null, "\u{1F4A1}"),
      " PLZ ",
      data.plz,
      " \u2192 ",
      /* @__PURE__ */ React.createElement("strong", null, nbSuggestion),
      " ",
      /* @__PURE__ */ React.createElement("span", { style: { marginLeft: "auto", fontSize: 11, opacity: 0.7 } }, "\xDCbernehmen")
    )));
  })()));
}
function StepEinstieg({ data, setData, hasPV = true, hasWP = false }) {
  const u = (k, v) => setData((d) => ({ ...d, [k]: v }));
  const toggle = (k) => setData((d) => ({ ...d, [k]: !d[k] }));
  const sv = parseInt(data.stromverbrauch) || 0;
  const zv = parseInt(data.zusatzVerbrauch) || 0;
  const gesamt = sv + zv;
  const gp = parseFloat(data.grundpreis) || 0;
  useEffect(() => {
    if (data._productsInit) return;
    const updates = { _productsInit: true };
    if (hasPV) {
      updates.wantPV = true;
      updates.wantSpeicher = true;
    }
    if (hasWP) {
      updates.wantWP = true;
    }
    setData((d) => ({ ...d, ...updates }));
  }, [hasPV, hasWP]);
  return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: {
    padding: "12px 18px",
    borderRadius: 12,
    marginBottom: 16,
    background: hasPV && hasWP ? `${T.green}10` : hasPV ? `${BRAND.yellow}10` : `${T.blue}10`,
    border: `1px solid ${hasPV && hasWP ? `${T.green}30` : hasPV ? `${BRAND.yellow}30` : `${T.blue}30`}`,
    display: "flex",
    alignItems: "center",
    gap: 12
  } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 24 } }, hasPV && hasWP ? "\u26A1" : hasPV ? "\u2600\uFE0F" : "\u2668\uFE0F"), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 15, fontWeight: 700, color: T.text } }, hasPV && hasWP ? "PV + W\xE4rmepumpe" : hasPV ? "Photovoltaik" : "W\xE4rmepumpe", " Aufnahme"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim } }, hasPV && hasWP ? "Kombi-Paket: Strom + W\xE4rme" : hasPV ? "Solaranlage mit Speicher" : "Heizungstausch"))), /* @__PURE__ */ React.createElement(Section, { title: "Aktuelle Situation", icon: "\u{1F4CB}" }, /* @__PURE__ */ React.createElement(
    "textarea",
    {
      value: data.situationText || "",
      onChange: (e) => u("situationText", e.target.value),
      placeholder: "Freitext zur aktuellen Situation des Kunden...",
      style: { width: "100%", minHeight: 70, padding: 14, background: T.surface, border: `1.5px solid ${T.border}`, borderRadius: 10, color: T.text, fontSize: 14, fontFamily: font, resize: "vertical", outline: "none", boxSizing: "border-box" }
    }
  )), /* @__PURE__ */ React.createElement(Section, { title: "Ihr Stromeinkauf", icon: "\u26A1" }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 6 } }, "Aktueller Stromversorger:"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 5, marginBottom: 12 } }, [
    { l: "Stadtwerke Bielefeld", ap: 34, gp: 14 },
    { l: "E.ON", ap: 36, gp: 16 },
    { l: "Vattenfall", ap: 35, gp: 15 },
    { l: "EnBW", ap: 34, gp: 14 },
    { l: "RWE / innogy", ap: 35, gp: 16 },
    { l: "SWK", ap: 33, gp: 14 },
    { l: "Yello", ap: 32, gp: 13 },
    { l: "Lichtblick", ap: 38, gp: 15 },
    { l: "Check24-Tarif", ap: 29, gp: 12 },
    { l: "Grundversorgung", ap: 42, gp: 18 }
  ].map((v, i) => /* @__PURE__ */ React.createElement("div", { key: i, onClick: () => {
    u("stromversorger", v.l);
    u("strompreis", String(v.ap));
    u("grundpreis", String(v.gp));
  }, style: {
    padding: "5px 10px",
    borderRadius: 20,
    cursor: "pointer",
    fontSize: 10,
    fontWeight: 600,
    background: data.stromversorger === v.l ? BRAND.yellow : T.surface,
    color: data.stromversorger === v.l ? "#000" : T.textSec,
    border: `1px solid ${data.stromversorger === v.l ? BRAND.yellow : T.border}`,
    whiteSpace: "nowrap"
  } }, v.l, " \xB7 ", v.ap, "ct"))), data.stromversorger && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.green, fontWeight: 600, marginBottom: 6 } }, "\u2705 ", data.stromversorger, " \u2013 Preise vorausgef\xFCllt (anpassbar)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(Input, { label: "Aktueller Stromverbrauch", value: data.stromverbrauch || "", onChange: (v) => u("stromverbrauch", v), placeholder: "5000", suffix: "kWh/a", half: true, type: "number", icon: "\u26A1", required: true }), /* @__PURE__ */ React.createElement(Input, { label: "Zus\xE4tzlicher Verbrauch", value: data.zusatzVerbrauch || "", onChange: (v) => u("zusatzVerbrauch", v), placeholder: "3000", suffix: "kWh/a", half: true, type: "number", required: true }), /* @__PURE__ */ React.createElement(Input, { label: "Strompreis (Arbeitspreis)", value: data.strompreis || "", onChange: (v) => u("strompreis", v), placeholder: "32", suffix: "ct/kWh", half: true, type: "number", icon: "\u{1F4B0}", required: true }), /* @__PURE__ */ React.createElement(Input, { label: "Grundpreis (brutto)", value: data.grundpreis || "", onChange: (v) => u("grundpreis", v), placeholder: "16", suffix: "\u20AC/Monat", half: true, type: "number", required: true })), (gesamt > 0 || gp > 0) && (() => {
    const ap2 = parseFloat(data.strompreis) || 0;
    const jahreskosten = gesamt * ap2 / 100 + gp * 12;
    const monatsAbschlag = jahreskosten / 12;
    return /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginTop: 12 } }, gesamt > 0 && /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, textTransform: "uppercase" } }, "Gesamtverbrauch / Jahr"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 17, fontWeight: 700, color: T.text, fontFamily: fontMono } }, gesamt.toLocaleString("de"), " ", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "kWh/a"))), jahreskosten > 0 && /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: `${T.red}06`, borderRadius: 10, border: `1px solid ${T.red}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, textTransform: "uppercase" } }, "Monatlicher Abschlag"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 17, fontWeight: 700, color: T.red, fontFamily: fontMono } }, Math.round(monatsAbschlag).toLocaleString("de"), " ", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "\u20AC/Monat")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginTop: 2 } }, "= ", Math.round(jahreskosten).toLocaleString("de"), " \u20AC/Jahr")));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Verbrauchshistorie", icon: "\u{1F4CA}" }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "Letzte 3 Jahresverbr\xE4uche eintragen (z.B. von Stromrechnung):"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, [{ k: "verbrauchJ3", l: "Vor 3 Jahren" }, { k: "verbrauchJ2", l: "Vor 2 Jahren" }, { k: "verbrauchJ1", l: "Letztes Jahr" }].map((y) => /* @__PURE__ */ React.createElement("div", { key: y.k, style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginBottom: 4, textAlign: "center" } }, y.l), /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "number",
      value: data[y.k] || "",
      onChange: (e) => u(y.k, e.target.value),
      placeholder: "kWh",
      style: { width: "100%", padding: "8px 6px", background: T.surface, border: `1.5px solid ${T.border}`, borderRadius: 8, color: T.text, fontSize: 14, fontWeight: 600, fontFamily: fontMono, textAlign: "center", outline: "none", boxSizing: "border-box", WebkitAppearance: "none", MozAppearance: "textfield" }
    }
  )))), (() => {
    const v3 = parseFloat(data.verbrauchJ3) || 0;
    const v2 = parseFloat(data.verbrauchJ2) || 0;
    const v1 = parseFloat(data.verbrauchJ1) || 0;
    const vals = [v3, v2, v1].filter((v) => v > 0);
    if (vals.length < 2) return null;
    const schnitt = Math.round(vals.reduce((a, b) => a + b, 0) / vals.length);
    const trend = vals.length >= 2 ? ((vals[vals.length - 1] - vals[0]) / vals[0] * 100).toFixed(1) : 0;
    const trendUp = parseFloat(trend) > 2;
    const trendDown = parseFloat(trend) < -2;
    const maxV = Math.max(...vals);
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 4, alignItems: "flex-end", height: 60, marginBottom: 8 } }, [v3, v2, v1].map((v, i) => {
      if (v === 0) return /* @__PURE__ */ React.createElement("div", { key: i, style: { flex: 1 } });
      const h = maxV > 0 ? v / maxV * 50 + 10 : 10;
      return /* @__PURE__ */ React.createElement("div", { key: i, style: { flex: 1, display: "flex", flexDirection: "column", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: T.text, fontFamily: fontMono, marginBottom: 2 } }, v.toLocaleString("de")), /* @__PURE__ */ React.createElement("div", { style: { width: "60%", height: h, background: `linear-gradient(180deg, ${i === 2 ? T.blue : BRAND.yellow}CC, ${i === 2 ? T.blue : BRAND.yellow}40)`, borderRadius: "4px 4px 0 0" } }));
    })), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1, padding: "8px 10px", background: T.surface, borderRadius: 8, border: `1px solid ${T.border}`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "\xD8 Verbrauch"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: T.text, fontFamily: fontMono } }, schnitt.toLocaleString("de"), " kWh")), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, padding: "8px 10px", background: trendUp ? `${T.red}06` : trendDown ? `${T.green}06` : T.surface, borderRadius: 8, border: `1px solid ${trendUp ? `${T.red}15` : trendDown ? `${T.green}15` : T.border}`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Trend"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: trendUp ? T.red : trendDown ? T.green : T.text, fontFamily: fontMono } }, trendUp ? "\u{1F4C8}" : trendDown ? "\u{1F4C9}" : "\u27A1\uFE0F", " ", trend > 0 ? "+" : "", trend, "%"))), trendUp && /* @__PURE__ */ React.createElement(AIHint, { text: `Verbrauch steigt! ${schnitt.toLocaleString("de")} kWh \xD8 \u2192 PV-Anlage wird sich noch schneller lohnen.`, color: T.red }), schnitt > 0 && !data.stromverbrauch && /* @__PURE__ */ React.createElement("button", { onClick: () => u("stromverbrauch", String(schnitt)), style: {
      width: "100%",
      marginTop: 8,
      padding: "10px",
      borderRadius: 8,
      border: "none",
      cursor: "pointer",
      background: T.blue,
      color: "#fff",
      fontSize: 11,
      fontWeight: 600,
      fontFamily: font
    } }, "\u26A1 ", schnitt.toLocaleString("de"), " kWh als Verbrauch \xFCbernehmen"));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "E-Mobilit\xE4t", icon: "\u{1F697}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 10, marginBottom: 12 } }, [
    { k: "noEV", l: "Kein E-Auto", icon: "\u274C" },
    { k: "hasEV", l: "Hat E-Auto", icon: "\u{1F697}" },
    { k: "planEV", l: "Plant E-Auto", icon: "\u{1F51C}" }
  ].map((opt) => /* @__PURE__ */ React.createElement("div", { key: opt.k, onClick: () => u("evStatus", opt.k), style: {
    flex: "1 1 30%",
    minWidth: 90,
    padding: "12px 10px",
    borderRadius: 10,
    cursor: "pointer",
    border: `2px solid ${data.evStatus === opt.k ? opt.k === "noEV" ? T.textDim : T.green : T.border}`,
    background: data.evStatus === opt.k ? opt.k === "noEV" ? `${T.textDim}10` : `${T.green}10` : T.surface,
    textAlign: "center",
    transition: "all 0.15s ease"
  } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18 } }, opt.icon), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: data.evStatus === opt.k ? T.text : T.textSec, marginTop: 2 } }, opt.l)))), (data.evStatus === "hasEV" || data.evStatus === "planEV") && /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "Fahrzeug w\xE4hlen"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 8, marginBottom: 8 } }, [
    { k: "teslaM3", l: "Tesla Model 3", v: 14.2 },
    { k: "teslaY", l: "Tesla Model Y", v: 16 },
    { k: "id3", l: "VW ID.3", v: 16.2 },
    { k: "id4", l: "VW ID.4", v: 17.3 },
    { k: "enyaq", l: "\u0160koda Enyaq", v: 16.9 },
    { k: "born", l: "CUPRA Born", v: 16.4 },
    { k: "ioniq5", l: "Hyundai IONIQ 5", v: 17.8 },
    { k: "ev6", l: "Kia EV6", v: 17.6 },
    { k: "eqa", l: "Mercedes EQA", v: 16.8 },
    { k: "i4", l: "BMW i4", v: 15.5 },
    { k: "e208", l: "Peugeot e-208", v: 15.2 },
    { k: "leaf", l: "Nissan Leaf", v: 17.1 }
  ].map((car) => {
    const isSel = data.evQuick === car.k;
    return /* @__PURE__ */ React.createElement("div", { key: car.k, onClick: () => {
      u("evQuick", car.k);
      u("evVerbrauch", String(car.v));
      u("evMarke", "");
      u("evModell", "");
      u("evLabel", car.l);
    }, style: {
      padding: "8px 12px",
      borderRadius: 10,
      cursor: "pointer",
      minWidth: 100,
      flex: "1 1 calc(33% - 8px)",
      border: `2px solid ${isSel ? T.green : T.border}`,
      background: isSel ? `${T.green}10` : T.surface,
      textAlign: "center",
      transition: "all 0.15s ease"
    } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: isSel ? T.green : T.text } }, car.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, fontFamily: fontMono } }, car.v, " kWh/100km"));
  })), /* @__PURE__ */ React.createElement("div", { onClick: () => u("evShowCustom", data.evShowCustom ? "" : "1"), style: {
    padding: "8px 12px",
    borderRadius: 8,
    cursor: "pointer",
    textAlign: "center",
    marginBottom: 8,
    background: data.evShowCustom ? `${BRAND.yellow}10` : T.surface,
    border: `1px dashed ${data.evShowCustom ? BRAND.yellow : T.border}`
  } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 600, color: data.evShowCustom ? BRAND.yellow : T.textSec } }, data.evShowCustom ? "\u25B2 Schlie\xDFen" : "\u{1F50D} Anderes Fahrzeug \u2014 nicht in der Liste?")), data.evShowCustom && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12, marginBottom: 8 } }, /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Hersteller",
      value: data.evMarke || "",
      onChange: (v) => {
        u("evMarke", v);
        u("evModell", "");
        u("evVerbrauch", "");
        u("evQuick", "");
        u("evLabel", "");
      },
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, ...Object.keys(EV_DB).map((k) => ({ value: k, label: k }))]
    }
  ), data.evMarke && /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Modell",
      value: data.evModell || "",
      onChange: (v) => {
        u("evModell", v);
        const found = (EV_DB[data.evMarke] || []).find((e) => e.m === v);
        if (found) {
          u("evVerbrauch", String(found.v));
          u("evLabel", `${data.evMarke} ${v}`);
        }
      },
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, ...(EV_DB[data.evMarke] || []).map((e) => ({ value: e.m, label: `${e.m} (${e.v} kWh)` }))]
    }
  )), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(Input, { label: "Fahrleistung", value: data.evKm || "", onChange: (v) => u("evKm", v), placeholder: "15000", suffix: "km/a", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Verbrauch (\xD8 real)", value: data.evVerbrauch || "", onChange: (v) => u("evVerbrauch", v), placeholder: "17", suffix: "kWh/100km", half: true, type: "number" }), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Laden zu Hause",
      value: data.evLadenHome || "",
      onChange: (v) => u("evLadenHome", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "80", label: "~80 % zu Hause" }, { value: "60", label: "~60 % zu Hause" }, { value: "40", label: "~40 % zu Hause" }, { value: "100", label: "100 % zu Hause" }]
    }
  )), (() => {
    const km = parseFloat(data.evKm) || 0;
    const verb = parseFloat(data.evVerbrauch) || 0;
    const homeQ = parseFloat(data.evLadenHome) || 0;
    const evJahr = Math.round(km * verb / 100 * homeQ / 100);
    const PREIS_LADESAEULE = 0.55;
    const PREIS_PV_EIGEN = 0.0778;
    const sparProKwh = PREIS_LADESAEULE - PREIS_PV_EIGEN;
    const kostenExtern = Math.round(km * verb / 100 * homeQ / 100 * PREIS_LADESAEULE);
    const kostenPV = Math.round(km * verb / 100 * homeQ / 100 * PREIS_PV_EIGEN);
    const sparJahr = kostenExtern - kostenPV;
    if (km > 0 && verb > 0 && homeQ > 0) {
      return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 16px", background: `${T.green}08`, borderRadius: 10, border: `1.5px solid ${T.green}30`, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.green, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "E-Auto Stromverbrauch zu Hause", data.evLabel ? ` \xB7 ${data.evLabel}` : ""), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 8 } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Gesamtverbrauch"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.text, fontFamily: fontMono } }, Math.round(km * verb / 100).toLocaleString("de-DE"), " kWh")), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Zu Hause (", homeQ, "%)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.green, fontFamily: fontMono } }, evJahr.toLocaleString("de-DE"), " kWh")), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Pro Monat"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.text, fontFamily: fontMono } }, Math.round(evJahr / 12).toLocaleString("de-DE"), " kWh"))), /* @__PURE__ */ React.createElement("div", { onClick: () => u("zusatzVerbrauch", String(evJahr)), style: { marginTop: 8, padding: "8px 12px", background: `${BRAND.yellow}08`, borderRadius: 8, border: `1px solid ${BRAND.yellow}20`, display: "flex", justifyContent: "space-between", alignItems: "center", cursor: "pointer" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: BRAND.yellow, fontWeight: 600 } }, "\u26A1 Tippen = in Verbrauch \xFCbernehmen"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono } }, evJahr.toLocaleString("de-DE"), " kWh/a"))), /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: `${T.green}06`, borderRadius: 12, border: `2px solid ${T.green}25` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.green, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 10 } }, "\u{1F4B0} Tanken mit eigener PV-Anlage vs. \xF6ffentliche Lades\xE4ule"), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", background: `${T.red}08`, borderRadius: 8, border: `1px solid ${T.red}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.red, fontWeight: 600, textTransform: "uppercase" } }, "\xD6ff. Lades\xE4ule \xD8"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 4 } }, "~55 ct/kWh"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: T.red, fontFamily: fontMono } }, kostenExtern.toLocaleString("de-DE"), " \u20AC", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, fontWeight: 400, color: T.textDim } }, "/Jahr")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, Math.round(kostenExtern / 12).toLocaleString("de-DE"), " \u20AC/Monat")), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", background: `${T.green}08`, borderRadius: 8, border: `1px solid ${T.green}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.green, fontWeight: 600, textTransform: "uppercase" } }, "Eigene PV-Anlage"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 4 } }, "~7,78 ct/kWh*"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: T.green, fontFamily: fontMono } }, kostenPV.toLocaleString("de-DE"), " \u20AC", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, fontWeight: 400, color: T.textDim } }, "/Jahr")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, Math.round(kostenPV / 12).toLocaleString("de-DE"), " \u20AC/Monat"))), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", padding: "12px 14px", background: T.green, borderRadius: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.8)", fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5 } }, "Ihre j\xE4hrliche Ersparnis"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 26, fontWeight: 900, color: "#fff", fontFamily: fontMono, lineHeight: 1.2 } }, sparJahr.toLocaleString("de-DE"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.7)" } }, "= ", Math.round(sparJahr / 12).toLocaleString("de-DE"), " \u20AC pro Monat")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 6, lineHeight: 1.3 } }, "* Opportunit\xE4tskosten = entgangene Einspeiseverg\xFCtung 7,78 ct/kWh (EEG 02/2026, Teileinspeisung \u226410 kWp). Lades\xE4ulen-\xD8: ADAC/Verivox 2025, ad-hoc ohne Abo.")), (() => {
        const benzinPreis = 1.75;
        const benzinVerbrauch = parseFloat(data.benzinVerbrauch) || 7.5;
        const kfzSteuerBenzin = 200;
        const kfzSteuerEV = 0;
        const wartungBenzin = 1e3;
        const wartungEV = 400;
        const thgQuote = 100;
        const kmJahr = km;
        const spritKosten = Math.round(kmJahr / 100 * benzinVerbrauch * benzinPreis);
        const benzinGesamt = spritKosten + kfzSteuerBenzin + wartungBenzin;
        const evKwhJahr = Math.round(kmJahr * verb / 100);
        const evKwhHome = evJahr;
        const evKwhExtern = evKwhJahr - evKwhHome;
        const evKostenPV = Math.round(evKwhHome * PREIS_PV_EIGEN);
        const evKostenExtern = Math.round(evKwhExtern * PREIS_LADESAEULE);
        const evEnergie = evKostenPV + evKostenExtern;
        const evGesamt = evEnergie + kfzSteuerEV + wartungEV - thgQuote;
        const gesamtSpar = benzinGesamt - evGesamt;
        return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, padding: "14px 16px", background: T.surface, borderRadius: 12, border: `1.5px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.accent, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "\u{1F504} Gesamtvergleich: Benziner vs. E-Auto + PV"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8, marginBottom: 8 } }, /* @__PURE__ */ React.createElement(Input, { label: "Benziner Verbrauch", value: data.benzinVerbrauch || "", onChange: (v) => u("benzinVerbrauch", v), placeholder: "7.5", suffix: "L/100km", half: true, type: "number" })), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", background: `${T.red}06`, borderRadius: 10, border: `1px solid ${T.red}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.red, marginBottom: 8 } }, "\u26FD Benziner"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Sprit (", benzinVerbrauch, " L \xD7 ", benzinPreis.toFixed(2), " \u20AC)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: T.text, fontFamily: fontMono } }, spritKosten.toLocaleString("de-DE"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 4 } }, "KFZ-Steuer"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: T.text, fontFamily: fontMono } }, kfzSteuerBenzin, " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 4 } }, "Wartung / Inspektion"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: T.text, fontFamily: fontMono } }, wartungBenzin.toLocaleString("de-DE"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { height: 1, background: T.border, margin: "8px 0" } }), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.red, fontWeight: 600 } }, "GESAMT / JAHR"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 900, color: T.red, fontFamily: fontMono } }, benzinGesamt.toLocaleString("de-DE"), " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", background: `${T.green}06`, borderRadius: 10, border: `1px solid ${T.green}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.green, marginBottom: 8 } }, "\u26A1 E-Auto + PV"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "PV-Strom (", evKwhHome, " kWh \xD7 7,78 ct)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: T.text, fontFamily: fontMono } }, evKostenPV.toLocaleString("de-DE"), " \u20AC"), evKwhExtern > 0 && /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 4 } }, "Extern (", evKwhExtern, " kWh \xD7 55 ct)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: T.text, fontFamily: fontMono } }, evKostenExtern.toLocaleString("de-DE"), " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 4 } }, "KFZ-Steuer (befreit)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: T.green, fontFamily: fontMono } }, "0 \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 4 } }, "Wartung (\u221260%)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: T.text, fontFamily: fontMono } }, wartungEV, " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 4 } }, "THG-Pr\xE4mie"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: T.green, fontFamily: fontMono } }, "\u2212", thgQuote, " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { height: 1, background: T.border, margin: "8px 0" } }), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.green, fontWeight: 600 } }, "GESAMT / JAHR"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 900, color: T.green, fontFamily: fontMono } }, evGesamt.toLocaleString("de-DE"), " \u20AC"))), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, textAlign: "center", padding: "10px 14px", background: T.green, borderRadius: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.8)", fontWeight: 600, textTransform: "uppercase" } }, "J\xE4hrliche Gesamtersparnis E-Auto + PV"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 24, fontWeight: 900, color: "#fff", fontFamily: fontMono, lineHeight: 1.2 } }, gesamtSpar.toLocaleString("de-DE"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.7)" } }, "= ", Math.round(gesamtSpar / 12).toLocaleString("de-DE"), " \u20AC pro Monat | In 10 Jahren: ", (gesamtSpar * 10).toLocaleString("de-DE"), " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, marginTop: 6, lineHeight: 1.3 } }, "Benzin \xD8 1,75 \u20AC/L (ADAC 02/2026). KFZ-Steuer Benziner \xD8 200 \u20AC/a, E-Auto 0 \u20AC (befreit bis 2035). Wartung: ifa-Institut \u221230-50% bei E-Auto. THG-Quote ~100 \u20AC/a."));
      })());
    }
    return null;
  })())), /* @__PURE__ */ React.createElement(Section, { title: "Geplante Verbraucher", icon: "\u{1F3D7}\uFE0F" }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 8, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "Was ist geplant oder vorhanden? (Mehrfachauswahl)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 8, marginBottom: 12 } }, [
    { k: "planPool", l: "\u{1F3CA} Pool (beheizt)", kwh: 2500 },
    { k: "planSauna", l: "\u{1F9D6} Sauna", kwh: 3e3 },
    { k: "planWhirlpool", l: "\u{1F6C1} Whirlpool", kwh: 1500 },
    { k: "planWP", l: "\u{1F321}\uFE0F W\xE4rmepumpe", kwh: 4e3 },
    { k: "planKlima", l: "\u2744\uFE0F Klimaanlage", kwh: 1e3 },
    { k: "planServer", l: "\u{1F5A5}\uFE0F Server / Homeoffice", kwh: 800 }
  ].map((item) => {
    const isOn = !!data[item.k];
    return /* @__PURE__ */ React.createElement("div", { key: item.k, onClick: () => u(item.k, isOn ? "" : "1"), style: {
      flex: "1 1 calc(50% - 8px)",
      minWidth: 130,
      padding: "10px 12px",
      borderRadius: 10,
      cursor: "pointer",
      border: `2px solid ${isOn ? T.green : T.border}`,
      background: isOn ? `${T.green}10` : T.surface,
      display: "flex",
      justifyContent: "space-between",
      alignItems: "center",
      transition: "all 0.15s ease"
    } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 600, color: isOn ? T.green : T.text } }, item.l), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: T.textDim, fontFamily: fontMono } }, "~", item.kwh.toLocaleString("de-DE"), " kWh"));
  })), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12, marginBottom: 12 } }, /* @__PURE__ */ React.createElement(Input, { label: "Sonstiger Verbraucher", value: data.planSonstigLabel || "", onChange: (v) => u("planSonstigLabel", v), placeholder: "z.B. Aquarium, Werkstatt\u2026", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Gesch\xE4tzter Verbrauch", value: data.planSonstigKwh || "", onChange: (v) => u("planSonstigKwh", v), placeholder: "1000", suffix: "kWh/a", half: true, type: "number" })), (() => {
    const items = [
      { k: "planPool", l: "Pool (beheizt)", kwh: 2500 },
      { k: "planSauna", l: "Sauna", kwh: 3e3 },
      { k: "planWhirlpool", l: "Whirlpool", kwh: 1500 },
      { k: "planWP", l: "W\xE4rmepumpe", kwh: 4e3 },
      { k: "planKlima", l: "Klimaanlage", kwh: 1e3 },
      { k: "planServer", l: "Server/Homeoffice", kwh: 800 }
    ];
    const active = items.filter((i) => !!data[i.k]);
    const sumPlan = active.reduce((s, i) => s + i.kwh, 0);
    const sonstig = parseFloat(data.planSonstigKwh) || 0;
    const total = sumPlan + sonstig;
    if (total === 0) return null;
    return /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 16px", background: `${BRAND.yellow}08`, borderRadius: 10, border: `1.5px solid ${BRAND.yellow}25` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: BRAND.yellow, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "Zus\xE4tzlicher Jahresverbrauch (geplant)"), active.map((i) => /* @__PURE__ */ React.createElement("div", { key: i.k, style: { display: "flex", justifyContent: "space-between", marginBottom: 3 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.text } }, i.l), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 700, color: T.text, fontFamily: fontMono } }, "~", i.kwh.toLocaleString("de-DE"), " kWh"))), sonstig > 0 && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 3 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.text } }, data.planSonstigLabel || "Sonstiges"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 700, color: T.text, fontFamily: fontMono } }, "~", sonstig.toLocaleString("de-DE"), " kWh")), /* @__PURE__ */ React.createElement("div", { style: { height: 1, background: `${BRAND.yellow}20`, margin: "6px 0" } }), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: BRAND.yellow } }, "Gesamt zus\xE4tzlich"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14, fontWeight: 900, color: BRAND.yellow, fontFamily: fontMono } }, total.toLocaleString("de-DE"), " kWh/a")), /* @__PURE__ */ React.createElement("div", { onClick: () => u("zusatzVerbrauch", String((parseFloat(data.zusatzVerbrauch) || 0) + total)), style: {
      marginTop: 8,
      padding: "8px 12px",
      background: `${BRAND.yellow}10`,
      borderRadius: 8,
      border: `1px solid ${BRAND.yellow}25`,
      display: "flex",
      justifyContent: "space-between",
      alignItems: "center",
      cursor: "pointer"
    } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: BRAND.yellow, fontWeight: 600 } }, "\u26A1 Tippen = in Verbrauch \xFCbernehmen"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono } }, "+", total.toLocaleString("de-DE"), " kWh")));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Einstiegsfragen", icon: "\u{1F4A1}" }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 8, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, hasPV ? "\u{1F4A1} Warum PV-Interesse? (Mehrfachauswahl)" : "\u{1F4A1} Warum W\xE4rmepumpe? (Mehrfachauswahl)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 8 } }, (hasPV ? [
    { key: "motKosten", label: "\u{1F4B8} Stromkosten senken" },
    { key: "motUmwelt", label: "\u{1F33F} Umweltbewusstsein" },
    { key: "motAutarkie", label: "\u{1F50B} Autarkie" },
    { key: "motWert", label: "\u{1F3E0} Wertsteigerung" },
    { key: "motEAuto", label: "\u{1F697} E-Auto laden" },
    { key: "motFoerderung", label: "\u{1F4B6} F\xF6rdermittel" },
    { key: "motEinspeise", label: "\u26A1 Einspeiseverg\xFCtung" },
    { key: "motNachbar", label: "\u{1F44B} Nachbar hat PV" },
    { key: "motSonstiges", label: "\u{1F4CB} Sonstiges" }
  ] : [
    { key: "motHeizung", label: "\u{1F527} Heizung muss raus" },
    { key: "motFoerderung", label: "\u{1F4B6} BEG-F\xF6rderung" },
    { key: "motKosten", label: "\u{1F4B8} Heizkosten senken" },
    { key: "motUmwelt", label: "\u{1F33F} CO\u2082-Reduktion" },
    { key: "motGEG", label: "\u{1F4DC} GEG-Pflicht" },
    { key: "motKomfort", label: "\u{1F321}\uFE0F Mehr Komfort" },
    { key: "motKuehlung", label: "\u2744\uFE0F K\xFChlung im Sommer" },
    { key: "motSonstiges", label: "\u{1F4CB} Sonstiges" }
  ]).map((m) => {
    const active = data[m.key];
    const isMaster = data._motMaster === m.key;
    return /* @__PURE__ */ React.createElement(
      "button",
      {
        key: m.key,
        onClick: () => {
          if (active) {
            u(m.key, false);
            if (isMaster) u("_motMaster", "");
          } else u(m.key, true);
        },
        style: {
          padding: "8px 14px",
          borderRadius: 10,
          border: `1.5px solid ${isMaster ? T.green : active ? BRAND.yellow : T.border}`,
          background: isMaster ? `${T.green}18` : active ? `${BRAND.yellow}15` : T.surface,
          color: isMaster ? T.green : active ? BRAND.yellow : T.textSec,
          fontSize: 13,
          fontWeight: active ? 600 : 400,
          cursor: "pointer",
          fontFamily: font,
          transition: "all 0.15s ease",
          boxShadow: isMaster ? `0 0 12px ${T.green}30` : "none"
        }
      },
      m.label
    );
  })), (() => {
    const allMots = hasPV ? [{ key: "motKosten", label: "\u{1F4B8} Stromkosten" }, { key: "motUmwelt", label: "\u{1F33F} Umwelt" }, { key: "motAutarkie", label: "\u{1F50B} Autarkie" }, { key: "motWert", label: "\u{1F3E0} Wert" }, { key: "motEAuto", label: "\u{1F697} E-Auto" }, { key: "motFoerderung", label: "\u{1F4B6} F\xF6rderung" }, { key: "motEinspeise", label: "\u26A1 Einspeisung" }, { key: "motNachbar", label: "\u{1F44B} Nachbar" }, { key: "motSonstiges", label: "\u{1F4CB} Sonstiges" }] : [{ key: "motHeizung", label: "\u{1F527} Heizung" }, { key: "motFoerderung", label: "\u{1F4B6} BEG" }, { key: "motKosten", label: "\u{1F4B8} Kosten" }, { key: "motUmwelt", label: "\u{1F33F} CO\u2082" }, { key: "motGEG", label: "\u{1F4DC} GEG" }, { key: "motKomfort", label: "\u{1F321}\uFE0F Komfort" }, { key: "motKuehlung", label: "\u2744\uFE0F K\xFChlung" }, { key: "motSonstiges", label: "\u{1F4CB} Sonstiges" }];
    const selected = allMots.filter((m) => data[m.key]);
    if (selected.length < 2) return null;
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, padding: "10px 14px", background: `${T.green}06`, borderRadius: 10, border: `1px solid ${T.green}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, fontWeight: 600, marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.5 } }, "\u2B50 Hauptgrund ausw\xE4hlen"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 6 } }, selected.map((m) => {
      const isMaster = data._motMaster === m.key;
      return /* @__PURE__ */ React.createElement("button", { key: m.key, onClick: () => u("_motMaster", isMaster ? "" : m.key), style: {
        padding: "6px 12px",
        borderRadius: 8,
        cursor: "pointer",
        fontFamily: font,
        border: `1.5px solid ${isMaster ? T.green : T.border}`,
        background: isMaster ? T.green : T.surface,
        color: isMaster ? "#fff" : T.textSec,
        fontSize: 12,
        fontWeight: isMaster ? 700 : 400,
        transition: "all 0.15s ease",
        boxShadow: isMaster ? `0 0 10px ${T.green}40` : "none"
      } }, isMaster ? "\u2B50 " : "", m.label);
    })));
  })(), data.motSonstiges && /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "text",
      value: data.motSonstigesText || "",
      onChange: (e) => u("motSonstigesText", e.target.value),
      placeholder: "Welcher Grund?",
      style: {
        width: "100%",
        marginTop: 10,
        padding: "12px 16px",
        background: T.surface,
        border: `1.5px solid ${T.border}`,
        borderRadius: 10,
        color: T.text,
        fontSize: 15,
        fontFamily: font,
        outline: "none",
        boxSizing: "border-box"
      }
    }
  ), (() => {
    const selected = (hasPV ? [data.motKosten && "Stromkosten", data.motUmwelt && "Umwelt", data.motAutarkie && "Autarkie", data.motWert && "Wertsteigerung", data.motEAuto && "E-Auto", data.motFoerderung && "F\xF6rderung", data.motEinspeise && "Einspeiseverg\xFCtung", data.motNachbar && "Nachbar hat PV", data.motSonstiges && (data.motSonstigesText || "Sonstiges")] : [data.motHeizung && "Heizungstausch", data.motFoerderung && "BEG-F\xF6rderung", data.motKosten && "Heizkosten", data.motUmwelt && "CO\u2082", data.motGEG && "GEG-Pflicht", data.motKomfort && "Komfort", data.motKuehlung && "K\xFChlung", data.motSonstiges && (data.motSonstigesText || "Sonstiges")]).filter(Boolean);
    return selected.length > 0 ? /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, fontSize: 11, color: T.green } }, "\u2705 ", selected.join(", ")) : null;
  })(), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, padding: "12px 16px", background: T.blueSoft || "rgba(96,165,250,0.08)", borderRadius: 10, border: `1px solid ${T.blue}20`, fontSize: 13, color: T.textSec, lineHeight: 1.7 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, marginBottom: 6 } }, /* @__PURE__ */ React.createElement(Buddy, { emoji: "\u{1F914}", size: 18 }), /* @__PURE__ */ React.createElement("span", { style: { fontWeight: 600, color: T.text } }, "Gespr\xE4chsleitfaden:")), hasPV ? /* @__PURE__ */ React.createElement(React.Fragment, null, "Wie ist Ihr bisheriger Kenntnisstand?", "\n", "Welche Informationen haben Sie schon eingeholt?", "\n", "Was ist Ihnen bei einer PV-Anlage am allerwichtigsten?", "\n", "Was muss konkret gegeben sein, damit Sie sich entscheiden?") : /* @__PURE__ */ React.createElement(React.Fragment, null, "Wann wurde die aktuelle Heizung eingebaut?", "\n", "Wurde schon ein Energieberater konsultiert?", "\n", "Wie hoch sind die aktuellen Heizkosten?", "\n", "Gibt es Fu\xDFbodenheizung oder klassische Heizk\xF6rper?"))), /* @__PURE__ */ React.createElement(Section, { title: "Kundentyp", icon: "\u{1F3AF}", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "Welcher Typ ist der Kunde? Beeinflusst Argumentation & Angebotsstrategie:"), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 } }, [
    { k: "typSparer", icon: "\u{1F4B0}", l: "Sparer", desc: "Will Kosten senken, rechnet genau", arg: "ROI, Amortisation, Rendite, Strompreis-Prognose" },
    { k: "typOeko", icon: "\u{1F33F}", l: "\xD6ko", desc: "Umwelt & Nachhaltigkeit, CO\u2082", arg: "CO\u2082-Einsparung, Autarkie, gr\xFCner Strom" },
    { k: "typTech", icon: "\u26A1", l: "Technik", desc: "Will das Beste, Smart Home", arg: "N-Type Module, App, dynamischer Tarif, Smart Home" },
    { k: "typSicher", icon: "\u{1F6E1}\uFE0F", l: "Sicherheit", desc: "Garantie, Notstrom, Langlebigkeit", arg: "30J Garantie, Notstrom, Made in Germany" }
  ].map((t) => {
    const sel = data[t.k];
    return /* @__PURE__ */ React.createElement("div", { key: t.k, onClick: () => u(t.k, !sel), style: {
      padding: "12px",
      borderRadius: 10,
      cursor: "pointer",
      background: sel ? `${T.blue}10` : T.surface,
      border: `2px solid ${sel ? T.blue : T.border}`
    } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, textAlign: "center", marginBottom: 4 } }, t.icon), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: sel ? T.blue : T.text, textAlign: "center" } }, t.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textAlign: "center", marginTop: 2 } }, t.desc), sel && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.blue, marginTop: 6, padding: "4px 6px", background: `${T.blue}06`, borderRadius: 4 } }, "\u{1F3AF} ", t.arg));
  })), (() => {
    const types = [data.typSparer && "Sparer", data.typOeko && "\xD6ko", data.typTech && "Technik", data.typSicher && "Sicherheit"].filter(Boolean);
    if (types.length === 0) return null;
    const tips = [];
    if (data.typSparer) tips.push("\u2192 Betone Amortisation, 25J-Ersparnis, Rendite vs. Festgeld");
    if (data.typOeko) tips.push('\u2192 Zeige CO\u2082-Rechner, Autarkiegrad, "bessere Zukunft f\xFCr die Kinder"');
    if (data.typTech) tips.push("\u2192 Zeige N-Type Effizienz, App-Monitoring, dynamischer Tarif, Smart Home Integration");
    if (data.typSicher) tips.push("\u2192 Betone 30J Aiko-Garantie, Notstrom, Versicherung, bee-doo Service");
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, padding: "8px 12px", background: `${T.blue}06`, borderRadius: 8, border: `1px solid ${T.blue}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.blue, fontWeight: 600, marginBottom: 4 } }, "\u{1F9E0} Verkaufsstrategie: ", types.join(" + ")), tips.map((t, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { fontSize: 10, color: T.textSec, marginTop: 2 } }, t)));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Geb\xE4ude", icon: "\u{1F3E0}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Geb\xE4udetyp",
      value: data.gebaeudetyp || "EFH",
      onChange: (v) => u("gebaeudetyp", v),
      half: true,
      options: [{ value: "EFH", label: "Einfamilienhaus" }, { value: "DHH", label: "Doppelhaush\xE4lfte" }, { value: "RH", label: "Reihenhaus" }, { value: "MFH", label: "Mehrfamilienhaus" }, { value: "Gewerbe", label: "Gewerbe" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Dachform",
      value: data.dachform || "",
      onChange: (v) => u("dachform", v),
      half: true,
      icon: "\u{1F3E0}",
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Satteldach", label: "Satteldach" }, { value: "Walmdach", label: "Walmdach" }, { value: "Kr\xFCppelwalm", label: "Kr\xFCppelwalmdach" }, { value: "Pultdach", label: "Pultdach" }, { value: "Flachdach", label: "Flachdach" }, { value: "Mansarddach", label: "Mansarddach" }, { value: "Zeltdach", label: "Zeltdach" }]
    }
  ), /* @__PURE__ */ React.createElement(Input, { label: "Baujahr", value: data.baujahr || "", onChange: (v) => u("baujahr", v), placeholder: "1998", half: true, type: "number", error: parseInt(data.baujahr) > 0 && parseInt(data.baujahr) < 1975 }), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Letzte Sanierung",
      value: data.letzteSanierung || "",
      onChange: (v) => u("letzteSanierung", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Keine", label: "Keine / Unbekannt" }, { value: "<5", label: "Vor weniger als 5 Jahren" }, { value: "5-10", label: "Vor 5\u201310 Jahren" }, { value: "10-20", label: "Vor 10\u201320 Jahren" }, { value: ">20", label: "Vor \xFCber 20 Jahren" }]
    }
  ), hasWP && /* @__PURE__ */ React.createElement(Input, { label: "Beheizte Wohnfl\xE4che", value: data.wohnflaeche || "", onChange: (v) => u("wohnflaeche", v), placeholder: "160", suffix: "m\xB2", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Erwachsene", value: data.erwachsene || "", onChange: (v) => u("erwachsene", v), placeholder: "2", half: true, type: "number", icon: "\u{1F465}" }), /* @__PURE__ */ React.createElement(Input, { label: "Kinder", value: data.kinder || "", onChange: (v) => u("kinder", v), placeholder: "2", half: true, type: "number", icon: "\u{1F476}" }), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Eigentum",
      value: data.eigentum || "",
      onChange: (v) => u("eigentum", v),
      half: true,
      icon: "\u{1F3E0}",
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Eigenheim", label: "Eigenheim" }, { value: "Miete", label: "Miete" }, { value: "Erbe", label: "Erbbau / Erbe" }]
    }
  ), /* @__PURE__ */ React.createElement(Input, { label: "Gesch\xE4tzter Immobilienwert", value: data.immobilienwert || "", onChange: (v) => u("immobilienwert", v), placeholder: "350000", suffix: "\u20AC", half: true, type: "number", icon: "\u{1F3E1}" }), /* @__PURE__ */ React.createElement(Input, { label: "Dachfl\xE4che (gesch\xE4tzt)", value: data.dachflaeche || "", onChange: (v) => u("dachflaeche", v), placeholder: "80", suffix: "m\xB2", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Dachl\xE4nge", value: data.dachlaenge || "", onChange: (v) => u("dachlaenge", v), placeholder: "12", suffix: "m", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Dachbreite", value: data.dachbreite || "", onChange: (v) => u("dachbreite", v), placeholder: "6", suffix: "m", half: true, type: "number" })), parseInt(data.baujahr) > 0 && parseInt(data.baujahr) < 1975 && /* @__PURE__ */ React.createElement("div", { style: {
    marginTop: 12,
    padding: "14px 16px",
    borderRadius: 12,
    background: `${T.red}12`,
    border: `2px solid ${T.red}`,
    animation: "pulseRed 1.5s ease-in-out infinite"
  } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 22, animation: "pulseRed 1s infinite" } }, "\u{1F6A8}"), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: T.red, textTransform: "uppercase", letterSpacing: 1 } }, "VOR-ORT-PR\xDCFUNG RATSAM"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, marginTop: 2 } }, "Baujahr ", data.baujahr, " \u2013 Dachsubstanz, Elektrik & Statik vor Montage pr\xFCfen lassen"))), !data._dcTeamNotified ? /* @__PURE__ */ React.createElement("button", { onClick: () => {
    const kunde = `${data.anrede || ""} ${data.vorname || ""} ${data.nachname || ""}`.trim();
    const adresse = data.strasse ? `${data.strasse} ${data.hausnummer || ""}, ${data.plz || ""} ${data.ort || ""}` : "Adresse unbekannt";
    const msg = `\u{1F6A8} VOR-ORT-PR\xDCFUNG: ${kunde} \xB7 ${adresse} \xB7 Baujahr ${data.baujahr} \u2013 Bitte Dachsubstanz, Elektrik & Statik pr\xFCfen.`;
    if (navigator.share) {
      navigator.share({ title: "DC-Team Benachrichtigung", text: msg }).then(() => u("_dcTeamNotified", true)).catch(() => {
      });
    } else {
      window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, "_blank");
      u("_dcTeamNotified", true);
    }
  }, style: {
    width: "100%",
    padding: "12px",
    borderRadius: 10,
    border: "none",
    cursor: "pointer",
    background: T.red,
    color: "#fff",
    fontSize: 13,
    fontWeight: 700,
    fontFamily: font,
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    gap: 8
  } }, /* @__PURE__ */ React.createElement("span", null, "\u{1F4F2}"), " DC-Team verst\xE4ndigen") : /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, padding: "10px 14px", background: `${T.green}10`, borderRadius: 10, border: `1px solid ${T.green}25` } }, /* @__PURE__ */ React.createElement(Buddy, { emoji: "\u{1F41D}", size: 18 }), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, color: T.green, fontWeight: 600 } }, "DC-Team wurde benachrichtigt \u2013 Beedoo!"))), data.letzteSanierung && data.letzteSanierung !== "Keine" && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, fontWeight: 500, letterSpacing: 0.5, textTransform: "uppercase", marginBottom: 6 } }, "Was wurde saniert?"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 6 } }, [
    { k: "sanDach", l: "\u{1F3E0} Dach" },
    { k: "sanDaemmung", l: "\u{1F9F1} Fassade/D\xE4mmung" },
    { k: "sanFenster", l: "\u{1FA9F} Fenster" },
    { k: "sanHeizung", l: "\u{1F525} Heizung" },
    { k: "sanElektrik", l: "\u26A1 Elektrik" }
  ].map((c) => /* @__PURE__ */ React.createElement("button", { key: c.k, onClick: () => u(c.k, !data[c.k]), style: {
    padding: "6px 12px",
    borderRadius: 8,
    cursor: "pointer",
    fontFamily: font,
    border: `1.5px solid ${data[c.k] ? BRAND.yellow : T.border}`,
    background: data[c.k] ? `${BRAND.yellow}15` : T.surface,
    color: data[c.k] ? BRAND.yellow : T.textSec,
    fontSize: 12,
    fontWeight: data[c.k] ? 600 : 400,
    transition: "all 0.15s ease"
  } }, c.l))), data.sanDach && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8 } }, /* @__PURE__ */ React.createElement(Input, { label: "\u{1F3E0} Dachsanierung \u2013 wann?", value: data.sanDachDatum || "", onChange: (v) => u("sanDachDatum", v.replace(/[^0-9]/g, "").substring(0, 4)), placeholder: "z.B. 2018", half: true, type: "number", inputMode: "numeric", autoFocus: true })), data.sanDaemmung && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8 } }, /* @__PURE__ */ React.createElement(Input, { label: "\u{1F9F1} Fassade/D\xE4mmung \u2013 wann?", value: data.sanDaemmungDatum || "", onChange: (v) => u("sanDaemmungDatum", v.replace(/[^0-9]/g, "").substring(0, 4)), placeholder: "z.B. 2018", half: true, type: "number", inputMode: "numeric", autoFocus: true })), data.sanFenster && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8 } }, /* @__PURE__ */ React.createElement(Input, { label: "\u{1FA9F} Fenster \u2013 wann?", value: data.sanFensterDatum || "", onChange: (v) => u("sanFensterDatum", v.replace(/[^0-9]/g, "").substring(0, 4)), placeholder: "z.B. 2018", half: true, type: "number", inputMode: "numeric", autoFocus: true })), data.sanHeizung && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8 } }, /* @__PURE__ */ React.createElement(Input, { label: "\u{1F525} Heizung \u2013 wann?", value: data.sanHeizungDatum || "", onChange: (v) => u("sanHeizungDatum", v.replace(/[^0-9]/g, "").substring(0, 4)), placeholder: "z.B. 2018", half: true, type: "number", inputMode: "numeric", autoFocus: true })), data.sanElektrik && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8 } }, /* @__PURE__ */ React.createElement(Input, { label: "\u26A1 Elektrik \u2013 wann?", value: data.sanElektrikDatum || "", onChange: (v) => u("sanElektrikDatum", v.replace(/[^0-9]/g, "").substring(0, 4)), placeholder: "z.B. 2018", half: true, type: "number", inputMode: "numeric", autoFocus: true }))), (() => {
    const dl = parseFloat(data.dachlaenge) || 0;
    const db = parseFloat(data.dachbreite) || 0;
    const df = parseFloat(data.dachflaeche) || (dl > 0 && db > 0 ? dl * db : 0);
    if (df <= 0) return null;
    const modulFlaeche = 1.134 * 0.722;
    const nutzbar = df * 0.75;
    const maxModule = Math.floor(nutzbar / modulFlaeche);
    const maxKwp = (maxModule * 0.47).toFixed(1);
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, padding: "10px 14px", background: `${BRAND.yellow}06`, borderRadius: 10, border: `1px solid ${BRAND.yellow}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 600, color: BRAND.yellow, marginBottom: 4 } }, "\u{1F4D0} Dachfl\xE4chen-Rechner"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Dachfl\xE4che"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.text, fontFamily: fontMono } }, Math.round(df), " m\xB2")), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Nutzbar (~75%)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: BRAND.yellow, fontFamily: fontMono } }, Math.round(nutzbar), " m\xB2")), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Max. Module"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.green, fontFamily: fontMono } }, maxModule)), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Max. kWp"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.green, fontFamily: fontMono } }, maxKwp))));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Heizung aktuell", icon: "\u{1F525}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 10 } }, ["Gas", "\xD6l", "W\xE4rmepumpe", "Fernw\xE4rme", "Pellets", "Elektro", "Sonstiges"].map((h) => {
    const key = `heiz_${h}`;
    return /* @__PURE__ */ React.createElement(Chip, { key: h, label: h, active: !!data[key], onClick: () => u(key, !data[key]) });
  })), data.heiz_Sonstiges && /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "text",
      value: data.heizSonstigesText || "",
      onChange: (e) => u("heizSonstigesText", e.target.value),
      placeholder: "Welche Heizung?",
      style: { width: "100%", marginTop: 8, padding: "10px 14px", background: T.surface, border: `1.5px solid ${T.border}`, borderRadius: 8, color: T.text, fontSize: 13, fontFamily: font, outline: "none", boxSizing: "border-box" }
    }
  ), hasWP && (data.heiz_Gas || data.heiz_\u00D6l) && /* @__PURE__ */ React.createElement(AIHint, { text: `${[data.heiz_Gas && "Gas", data.heiz_\u00D6l && "\xD6l"].filter(Boolean).join(" + ")}-Heizung erkannt \u2192 W\xE4rmepumpe als Ersatz empfohlen. F\xF6rderf\xE4hig bis zu 70% \xFCber BEG!`, color: T.green }), hasWP && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12, marginTop: 12 } }, /* @__PURE__ */ React.createElement(Input, { label: "Heizkosten/Jahr", value: data.heizkosten || "", onChange: (v) => u("heizkosten", v), placeholder: "2400", suffix: "\u20AC/a", half: true, type: "number", icon: "\u{1F4B6}" }), /* @__PURE__ */ React.createElement(Input, { label: "Alter Heizung", value: data.heizungAlter || "", onChange: (v) => u("heizungAlter", v), placeholder: "18", suffix: "Jahre", half: true, type: "number" }), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Heizk\xF6rper",
      value: data.heizkoerper || "",
      onChange: (v) => u("heizkoerper", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "FBH", label: "Fu\xDFbodenheizung" }, { value: "HK", label: "Heizk\xF6rper" }, { value: "Mix", label: "Gemischt" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Vorlauftemperatur",
      value: data.vorlauf || "",
      onChange: (v) => u("vorlauf", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "35", label: "35\xB0C (FBH)" }, { value: "45", label: "45\xB0C (NT-HK)" }, { value: "55", label: "55\xB0C (Standard)" }, { value: "65", label: "65\xB0C (Alt-HK)" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "WP-Typ",
      value: data.wpTyp || "",
      onChange: (v) => u("wpTyp", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "LW", label: "Luft-Wasser" }, { value: "SW", label: "Sole-Wasser" }, { value: "WW", label: "Wasser-Wasser" }]
    }
  ), /* @__PURE__ */ React.createElement(Input, { label: "Heizlast (gesch\xE4tzt)", value: data.heizlast || "", onChange: (v) => u("heizlast", v), placeholder: "8", suffix: "kW", half: true, type: "number" })), hasWP && data.wohnflaeche && /* @__PURE__ */ React.createElement(AIHint, { text: `Bei ${data.wohnflaeche} m\xB2 beheizter Wohnfl\xE4che${data.baujahr ? ` (Bj. ${data.baujahr})` : ""}: Empfohlene Heizlast ca. ${Math.round(parseInt(data.wohnflaeche) * (parseInt(data.baujahr) > 2e3 ? 0.04 : 0.06) * 10) / 10} kW`, color: T.blue })), hasWP && (data.heiz_Gas || data.heiz_\u00D6l) && /* @__PURE__ */ React.createElement(Section, { title: "WP-Kalkulator", icon: "\u2668\uFE0F", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "Heizkosten-Vergleich: ", data.heiz_\u00D6l ? "\xD6l" : "Gas", " vs. W\xE4rmepumpe"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(Input, { label: `${data.heiz_\u00D6l ? "\xD6lverbrauch" : "Gasverbrauch"} / Jahr`, value: data.wpVerbrauchAlt || "", onChange: (v) => u("wpVerbrauchAlt", v), placeholder: data.heiz_\u00D6l ? "2000" : "20000", suffix: data.heiz_\u00D6l ? "Liter" : "kWh", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: `${data.heiz_\u00D6l ? "\xD6lpreis" : "Gaspreis"}`, value: data.wpPreisAlt || "", onChange: (v) => u("wpPreisAlt", v), placeholder: data.heiz_\u00D6l ? "1.10" : "12", suffix: data.heiz_\u00D6l ? "\u20AC/Liter" : "ct/kWh", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "JAZ W\xE4rmepumpe (gesch\xE4tzt)", value: data.wpJAZ || "", onChange: (v) => u("wpJAZ", v), placeholder: "3.5", half: true, type: "number" })), (() => {
    const istOel = !!data.heiz_\u00D6l;
    const verbrAlt = parseFloat(data.wpVerbrauchAlt) || (istOel ? 2e3 : 2e4);
    const preisAlt = parseFloat(data.wpPreisAlt) || (istOel ? 1.1 : 0.12);
    const heizEnergie = istOel ? verbrAlt * 10 : verbrAlt;
    const kostenAlt = istOel ? Math.round(verbrAlt * preisAlt) : Math.round(verbrAlt * preisAlt / 100);
    const jaz = parseFloat(data.wpJAZ) || 3.5;
    const wpStrom = Math.round(heizEnergie / jaz);
    const wpStromPreis = dynTarifAktiv ? dynAP : ap;
    const kostenWP = Math.round(wpStrom * wpStromPreis / 100);
    const ersparnis = kostenAlt - kostenWP;
    const wpSparMonat = Math.round(ersparnis / 12);
    if (!data.wpVerbrauchAlt && !data.wpPreisAlt) return null;
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", background: `${T.red}06`, borderRadius: 10, border: `1px solid ${T.red}15`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.red, fontWeight: 600, textTransform: "uppercase" } }, "\u274C ", data.heiz_\u00D6l ? "\xD6l" : "Gas", " aktuell"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, fontWeight: 900, color: T.red, fontFamily: fontMono } }, kostenAlt.toLocaleString("de"), " \u20AC", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10 } }, "/Jahr")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, verbrAlt.toLocaleString("de"), " ", istOel ? "L" : "kWh")), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", background: `${T.green}06`, borderRadius: 10, border: `1px solid ${T.green}15`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.green, fontWeight: 600, textTransform: "uppercase" } }, "\u2705 W\xE4rmepumpe"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, fontWeight: 900, color: T.green, fontFamily: fontMono } }, kostenWP.toLocaleString("de"), " \u20AC", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10 } }, "/Jahr")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, wpStrom.toLocaleString("de"), " kWh Strom \xB7 JAZ ", jaz))), ersparnis > 0 && /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.green, borderRadius: 10, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.8)", fontWeight: 600, textTransform: "uppercase" } }, "Heizkosten-Ersparnis mit WP"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 24, fontWeight: 900, color: "#fff", fontFamily: fontMono } }, ersparnis.toLocaleString("de"), " \u20AC/Jahr"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.7)" } }, wpSparMonat, " \u20AC/Monat")), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, padding: "8px 12px", background: `${T.blue}08`, borderRadius: 8, border: `1px solid ${T.blue}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.blue, fontWeight: 600 } }, "\u{1F4A1} WP-Strom als PV-Zusatzverbrauch"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 2 } }, "Die WP braucht ca. ", wpStrom.toLocaleString("de"), " kWh/Jahr Strom.", !data.zusatzVerbrauch && " Tipp: Als Zusatzverbrauch eintragen f\xFCr korrekte PV-Berechnung!"), !data.zusatzVerbrauch && /* @__PURE__ */ React.createElement("button", { onClick: () => u("zusatzVerbrauch", String(wpStrom)), style: {
      marginTop: 6,
      padding: "8px 14px",
      borderRadius: 8,
      border: "none",
      cursor: "pointer",
      background: T.blue,
      color: "#fff",
      fontSize: 11,
      fontWeight: 600,
      fontFamily: font,
      width: "100%"
    } }, "\u26A1 ", wpStrom.toLocaleString("de"), " kWh als Zusatzverbrauch \xFCbernehmen")));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Gew\xFCnschte Produkte", icon: "\u{1F3AF}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 10 } }, /* @__PURE__ */ React.createElement(Chip, { label: "Photovoltaik", icon: "\u2600\uFE0F", active: data.wantPV, onClick: () => toggle("wantPV") }), /* @__PURE__ */ React.createElement(Chip, { label: "Speicher", icon: "\u{1F50B}", active: data.wantSpeicher, onClick: () => toggle("wantSpeicher") }), /* @__PURE__ */ React.createElement(Chip, { label: "W\xE4rmepumpe", icon: "\u2668\uFE0F", active: data.wantWP, onClick: () => toggle("wantWP") }), /* @__PURE__ */ React.createElement(Chip, { label: "Wallbox", icon: "\u{1F50C}", active: data.wantWallbox, onClick: () => toggle("wantWallbox") })), gesamt > 0 && data.wantPV && /* @__PURE__ */ React.createElement(AIHint, { text: `Bei ${gesamt.toLocaleString("de")} kWh Verbrauch empfiehlt die KI eine PV-Anlage mit ca. ${Math.max(5, Math.round(gesamt / 900))} kWp \u2013 ideal f\xFCr maximalen Eigenverbrauch.` })), data.wantPV && /* @__PURE__ */ React.createElement(Section, { title: "Smart Home & PV", icon: "\u{1F3E0}", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "Hat der Kunde bereits Smart Home? Was passt zur PV-Anlage?"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 6 } }, [
    { k: "shSHELLY", l: "Shelly Pro EM", desc: "Energiemessung + Verbrauchssteuerung", icon: "\u{1F4CA}" },
    { k: "shSmartPlug", l: "Smart Steckdosen", desc: "Ger\xE4te per App/Timer steuern", icon: "\u{1F50C}" },
    { k: "shHomeAssistant", l: "Home Assistant", desc: "Zentrale f\xFCr alle Smart Devices", icon: "\u{1F3E0}" },
    { k: "shTimerWasch", l: "Zeitschaltuhr Waschmaschine", desc: "Mittags laufen \u2192 PV nutzen", icon: "\u{1F9FA}" },
    { k: "shWallboxSmart", l: "Smart Wallbox", desc: "PV-\xDCberschuss-Laden f\xFCr E-Auto", icon: "\u{1F697}" },
    { k: "shWPSG", l: "WP mit SG-Ready", desc: "W\xE4rmepumpe nutzt PV-\xDCberschuss", icon: "\u2668\uFE0F" }
  ].map((s) => /* @__PURE__ */ React.createElement("div", { key: s.k, onClick: () => u(s.k, !data[s.k]), style: {
    flex: "1 1 45%",
    minWidth: 140,
    padding: "8px 10px",
    borderRadius: 10,
    cursor: "pointer",
    background: data[s.k] ? `${T.blue}08` : T.surface,
    border: `1.5px solid ${data[s.k] ? T.blue : T.border}`
  } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14 } }, s.icon), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: data[s.k] ? T.blue : T.text } }, data[s.k] ? "\u2705" : "\u2610", " ", s.l)), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 2, paddingLeft: 20 } }, s.desc)))), (data.shSHELLY || data.shHomeAssistant || data.shWallboxSmart) && /* @__PURE__ */ React.createElement(AIHint, { text: "Smart Home + PV = maximaler Eigenverbrauch! Automatische Steuerung von Ger\xE4ten bei Sonnenschein spart extra.", color: T.blue })));
}
function compressImage(file, maxWidth, quality) {
  maxWidth = maxWidth || 1600;
  quality = quality || 0.75;
  return new Promise(function(resolve) {
    var img = new Image();
    img.onload = function() {
      var w = img.width, h = img.height;
      if (w > maxWidth) { h = Math.round(h * maxWidth / w); w = maxWidth; }
      var canvas = document.createElement("canvas");
      canvas.width = w; canvas.height = h;
      var ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, w, h);
      canvas.toBlob(function(blob) {
        var compressed = new File([blob], file.name || "photo.jpg", { type: "image/jpeg" });
        resolve(compressed);
      }, "image/jpeg", quality);
    };
    img.src = URL.createObjectURL(file);
  });
}

function StepFotos({ data, setData }) {
  const u = (k, v) => setData((d) => ({ ...d, [k]: v }));
  const [gDriveConnected, setGDriveConnected] = useState(!!gDriveState.token);
  const [qrScanning, setQrScanning] = useState(false);
  const [lightboxSrc, setLightboxSrc] = useState(null);
  const [lightboxIsVideo, setLightboxIsVideo] = useState(false);
  const [qrResult, setQrResult] = useState(data._qrResults || []);
  const [phoneSync, setPhoneSync] = useState({ active: false, count: 0, lastCheck: null });
  const phonePollRef = React.useRef(null);

  // ── Auto-init phone job ID so QR is always visible ──
  useEffect(() => {
    if (!data._phoneJobId) {
      var jobTs = Date.now().toString(36) + Math.random().toString(36).slice(2,6);
      u("_phoneJobId", jobTs);
      u("_phoneJobActive", true);
      u("_phonePhotosReceived", 0);
    } else if (!data._phoneJobActive) {
      u("_phoneJobActive", true);
    }
  }, []);

  // ── Polling for external phone photos ──
  useEffect(() => {
    if (!data._phoneJobId || !data._phoneJobActive) return;
    setPhoneSync({ active: true, count: 0, lastCheck: null });
    var knownPaths = {};
    var SB_URL = window.BEEDOO_CONFIG?.SB_URL || "https://hqzpemfaljxcysyqssng.supabase.co";
    var SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhxenBlbWZhbGp4Y3lzeXFzc25nIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMzUzOTcsImV4cCI6MjA4NjkxMTM5N30.LSlMApceWuLk5MUctCGCVspXfYhc_As559aaoV2uSik";

    var poll = async function() {
      try {
        var resp = await fetch(SB_URL + "/rest/v1/field_photos?job_id=eq." + encodeURIComponent(data._phoneJobId) + "&order=created_at.asc", {
          headers: { "apikey": SB_KEY, "Authorization": "Bearer " + SB_KEY }
        });
        var rows = await resp.json();
        var newPhotos = rows.filter(function(r) { return !knownPaths[r.storage_path]; });
        
        for (var i = 0; i < newPhotos.length; i++) {
          var photo = newPhotos[i];
          knownPaths[photo.storage_path] = true;

          // Download from Supabase Storage
          try {
            var imgResp = await fetch(SB_URL + "/storage/v1/object/public/field-photos/" + photo.storage_path, {
              headers: { "apikey": SB_KEY, "Authorization": "Bearer " + SB_KEY }
            });
            var blob = await imgResp.blob();
            var mimeType = photo.mime_type || "image/jpeg";
              var isVid = mimeType.startsWith("video/");
              var ext = isVid ? ".webm" : ".jpg";
              var file = new File([blob], photo.photo_key + ext, { type: mimeType });
            
            // Compress
            var compressed = await compressImage(file, 1600, 0.75);
            var blobUrl = URL.createObjectURL(compressed);

            // Use the exact photo_key from external upload (fotoHAK → HAK slot, fotoZaehler → Zähler slot)
            var targetKey = photo.photo_key;
            if (targetKey) {
              // Direct match: external key maps 1:1 to internal slot
              u(targetKey, blobUrl);
              u(targetKey + "_file", compressed);
              u(targetKey + "_gd", "phone");
              triggerGDriveUpload(compressed, targetKey, photo.photo_label || targetKey, data, u);
              }
          } catch(e) { console.warn("[Phone-Sync] Download error:", e); }
        }
        
        setPhoneSync(function(ps) { return { active: true, count: rows.length, lastCheck: new Date() }; });
      } catch(e) { console.warn("[Phone-Sync] Poll error:", e); }
    };

    poll();
    phonePollRef.current = setInterval(poll, 4000);
    return function() { if (phonePollRef.current) clearInterval(phonePollRef.current); };
  }, [data._phoneJobId, data._phoneJobActive]);
  const qrVideoRef = React.useRef(null);
  const qrStreamRef = React.useRef(null);

  const startQrScan = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
      qrStreamRef.current = stream;
      setQrScanning(true);
      setTimeout(() => {
        if (qrVideoRef.current) {
          qrVideoRef.current.srcObject = stream;
          qrVideoRef.current.play();
          // Use BarcodeDetector if available, otherwise fallback
          if ('BarcodeDetector' in window) {
            const detector = new BarcodeDetector({ formats: ['qr_code', 'ean_13', 'ean_8', 'code_128', 'code_39'] });
            const scanLoop = async () => {
              if (!qrVideoRef.current || !qrStreamRef.current) return;
              try {
                const barcodes = await detector.detect(qrVideoRef.current);
                if (barcodes.length > 0) {
                  const val = barcodes[0].rawValue;
                  setQrResult(prev => {
                    if (prev.some(r => r.value === val)) return prev;
                    const updated = [...prev, { value: val, type: barcodes[0].format, time: new Date().toLocaleTimeString('de-DE') }];
                    u('_qrResults', updated);
                    return updated;
                  });
                }
              } catch(e) {}
              if (qrStreamRef.current) requestAnimationFrame(scanLoop);
            };
            requestAnimationFrame(scanLoop);
          }
        }
      }, 100);
    } catch (e) {
      alert('Kamera-Zugriff nicht möglich: ' + e.message);
    }
  };

  const stopQrScan = () => {
    if (qrStreamRef.current) {
      qrStreamRef.current.getTracks().forEach(t => t.stop());
      qrStreamRef.current = null;
    }
    setQrScanning(false);
  };

  React.useEffect(() => { return () => { if (qrStreamRef.current) { qrStreamRef.current.getTracks().forEach(t => t.stop()); } }; }, []);
  const connectGDrive = async () => {
    try {
      await gDriveAuth();
      setGDriveConnected(true);
    } catch (e) {
    }
  };
  const capturePhoto = async (photoKey, useCamera, label) => {
    const input = document.createElement("input");
    input.type = "file";
    input.accept = "image/*,video/*";
    if (useCamera) input.capture = "environment";
    input.setAttribute("multiple", "");
    input.onchange = async (e) => {
      const files = Array.from(e.target.files || []);
      if (!files.length) return;
      // Determine target slots: if single file → use photoKey, if multiple → fill next empty pflicht slots
      const pflichtKeys = ["fotoZaehler","fotoHAK","fotoPotential","fotoNeuerZS","fotoKabelwegInnen","fotoKabelwegWRZS","fotoKabelwegHAKZS","fotoKabelwegAussen","fotoAufstellortWR","fotoZSgeschlossen","fotoZSgeoeffnet","fotoDachboden"];
      const getNextEmptySlots = (count) => {
        const empty = pflichtKeys.filter(k => !data[k]);
        return empty.slice(0, count);
      };
      const targets = files.length === 1 ? [photoKey] : (() => {
        const slots = [photoKey, ...getNextEmptySlots(files.length).filter(k => k !== photoKey)];
        return slots.slice(0, files.length);
      })();
      for (let i = 0; i < files.length && i < targets.length; i++) {
        var isVid = files[i].type && files[i].type.startsWith("video/");
        var compressed, blobUrl;
        if (isVid) {
          compressed = await compressVideo(files[i], 15);
          blobUrl = await generateVideoThumbnail(files[i]);
          u(targets[i] + "_isVideo", true);
        } else {
          compressed = await compressImage(files[i], 1600, 0.75);
          blobUrl = URL.createObjectURL(compressed);
        }
        u(targets[i], blobUrl);
        u(targets[i] + "_file", compressed);
        triggerGDriveUpload(compressed, targets[i], label || targets[i], data, u);
      }
    };
    input.click();
  };
  const pflicht = [
    { key: "fotoZaehler", label: "Z\xE4hler 1", icon: "\u26A1", smart: true },
    ...data._showZaehler2 ? [{ key: "fotoZaehler2", label: "Z\xE4hler 2", icon: "\u26A1" }] : [],
    ...data._showZaehler3 ? [{ key: "fotoZaehler3", label: "Z\xE4hler 3", icon: "\u26A1" }] : [],
    { key: "fotoHAK", label: "HAK", icon: "\u{1F50C}" },
    { key: "fotoPotential", label: "Potentialausgleich", icon: "\u23DA" },
    { key: "fotoNeuerZS", label: "Neuer zus\xE4tzl. Z\xE4hlerschrank", icon: "\u{1F4D0}", note: "Mit Markierungsfunktion" },
    { key: "fotoKabelwegInnen", label: "Kabelweg innen zum WR/Speicher", icon: "\u{1F517}" },
    { key: "fotoKabelwegWRZS", label: "Kabelweg WR \u2192 Z\xE4hlerschrank", icon: "\u{1F4F9}", note: "Video" },
    { key: "fotoKabelwegHAKZS", label: "Kabelweg HAK \u2192 Z\xE4hlerschrank", icon: "\u{1F4F9}", note: "Video" },
    { key: "fotoKabelwegAussen", label: "Kabelweg au\xDFen", icon: "\u{1F3E0}", note: "Mit Markierungsfunktion" },
    { key: "fotoAufstellortWR", label: "Aufstellort WR/Speicher", icon: "\u{1F4D0}", note: "Mit Markierungsfunktion" },
    { key: "fotoZSgeschlossen", label: "Z\xE4hlerschrank geschlossen", icon: "\u{1F512}" },
    { key: "fotoZSgeoeffnet", label: "Z\xE4hlerschrank ge\xF6ffnet", icon: "\u{1F513}" },
    { key: "fotoDachboden", label: "Dachboden", icon: "\u{1F3DA}\uFE0F" }
  ];
  const optional = [
    { key: "fotoDrohne1", label: "Dachansicht Drohne 1", icon: "\u{1F681}" },
    { key: "fotoDrohne2", label: "Dachansicht Drohne 2", icon: "\u{1F681}" },
    { key: "fotoDrohne3", label: "Dachansicht Drohne 3", icon: "\u{1F681}" },
    { key: "fotoGeruest1", label: "Ger\xFCst Stellplatz 1", icon: "\u{1F3D7}\uFE0F" },
    { key: "fotoGeruest2", label: "Ger\xFCst Stellplatz 2", icon: "\u{1F3D7}\uFE0F" },
    { key: "fotoGeruest3", label: "Ger\xFCst Stellplatz 3", icon: "\u{1F3D7}\uFE0F" },
    { key: "fotoFront", label: "Frontansicht Haus", icon: "\u{1F3E1}" },
    { key: "fotoDach", label: "Gesamtansicht Dach", icon: "\u{1F3E0}" },
    { key: "fotoZiegel", label: "Nahaufnahme Ziegel", icon: "\u{1F50D}" },
    { key: "fotoHauseinfahrt", label: "Hauseinfahrt (LKW-Parkplatz)", icon: "\u{1F69B}" },
    { key: "fotoRouter", label: "Router", icon: "\u{1F4E1}" },
    { key: "fotoDachstuhl", label: "Dachstuhl", icon: "\u{1FAB5}" },
    { key: "fotoWallbox", label: "Aufstellort Wallbox", icon: "\u{1F50C}" },
    { key: "fotoKabelwegWB", label: "Kabelweg Wallbox \u2192 ZS", icon: "\u{1F4F9}", note: "Video" },
    { key: "fotoDachpfanne", label: "Dachpfanne", icon: "\u{1F9F1}" },
    { key: "fotoStromrechnung", label: "Letzte Stromrechnung", icon: "\u{1F4C4}" }
  ];
  const sonstigeSlots = [];
  for (let i = 1; i <= 10; i++) {
    const key = `fotoSonst${i}`;
    const labelKey = `fotoSonst${i}Label`;
    if (i === 1 || data[`fotoSonst${i - 1}`]) {
      sonstigeSlots.push({ key, label: data[labelKey] || `Sonstiges ${i}`, icon: "\u{1F4F8}", labelKey, editable: true });
    } else break;
  }
  optional.push(...sonstigeSlots);
  const allPhotos = [...pflicht, ...optional];
  const capturedP = pflicht.filter((p) => data[p.key]).length;
  const capturedO = optional.filter((p) => data[p.key]).length;
  const handleSmartCapture = async (photoKey, useCamera) => {
    const input = document.createElement("input");
    input.type = "file";
    input.accept = "image/*,video/*";
    if (useCamera) input.capture = "environment";
    input.onchange = async (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      const compressed = await compressImage(file, 1600, 0.75);
      const blobUrl = URL.createObjectURL(compressed);
      u(photoKey, blobUrl);
      u(`${photoKey}_file`, compressed);
      triggerGDriveUpload(compressed, photoKey, photoKey, data, u);
      if (photoKey === "fotoZaehler") {
        u("panelScanning", true);
        u("panelPhoto", URL.createObjectURL(file));
        u("panelAnalysis", null);
        try {
          const reader = new FileReader();
          reader.onload = async () => {
            const base64 = reader.result.split(",")[1];
            let analysis = null;
            try {
              const resp = await fetch("/api/ai-proxy", {
                method: "POST",
                headers: { "Content-Type": "application/json", },
                body: JSON.stringify({
                  model: "claude-sonnet-4-20250514",
                  max_tokens: 1e3,
                  messages: [{
                    role: "user",
                    content: [
                      { type: "image", source: { type: "base64", media_type: file.type || "image/jpeg", data: base64 } },
                      { type: "text", text: `Analysiere diesen Z\xE4hlerschrank/Elektroverteilung f\xFCr eine PV-Installation. Pr\xFCfe insbesondere auf APZ-Feld (Anschluss-/Pr\xFCfz\xE4hlerfeld) nach VDE AR-N 4100 und VDE-Konformit\xE4t. Antworte NUR als JSON, kein anderer Text:
{
  "pvReady": "gruen" | "gelb" | "rot",
  "pvReadyText": "Kurze Einsch\xE4tzung ob PV-Installation m\xF6glich",
  "freiePlaetze": "Gesch\xE4tzte Anzahl freier Z\xE4hlerpl\xE4tze oder 'nicht erkennbar'",
  "zaehlerAnzahl": "Anzahl erkannter Z\xE4hler",
  "zaehlerTypen": "Erkannte Z\xE4hlertypen (digital/analog/smart meter)",
  "sicherungen": "\xDCbersicht der Sicherungsautomaten",
  "apzVorhanden": true | false | "nicht erkennbar",
  "vdeKonform": true | false | "nicht beurteilbar",
  "vdeDetails": "VDE AR-N 4100 / TAR Niederspannung Konformit\xE4ts-Einsch\xE4tzung: APZ, Plombierung, Verdrahtung, SLS, \xDCberspannungsschutz",
  "besonderheiten": ["Array von Besonderheiten"],
  "nachruestbedarf": ["Array von n\xF6tigen Ma\xDFnahmen f\xFCr PV \u2013 insbesondere APZ falls fehlend"],
  "zustand": "Allgemeiner Zustand: gut/mittel/schlecht"
}` }
                    ]
                  }]
                })
              });
              if (!resp.ok) throw new Error("API " + resp.status);
              const result = await resp.json();
              const txt = (result.content?.[0]?.text || "").trim();
              const clean = txt.replace(/```json|```/g, "").trim();
              analysis = JSON.parse(clean);
            } catch (err) {
              await new Promise((r) => setTimeout(r, 2e3));
              analysis = {
                pvReady: "gelb",
                pvReadyText: "PV-Installation grunds\xE4tzlich m\xF6glich. APZ-Feld nicht erkennbar \u2013 Z\xE4hlerschrank ggf. nicht VDE-konform.",
                freiePlaetze: "1\u20132 (gesch\xE4tzt)",
                zaehlerAnzahl: "2",
                zaehlerTypen: "Digital (Drehstrom-Wirkverbrauchsz\xE4hler)",
                sicherungen: "Mehrere Reihen LS-Schalter (B16/B20), FI-Schalter vorhanden, separate Absicherung f\xFCr W\xE4rmepumpe und Wallbox",
                apzVorhanden: "nicht erkennbar",
                vdeKonform: false,
                vdeDetails: "APZ-Feld nach VDE AR-N 4100 nicht erkennbar. SLS-Schalter nicht sichtbar. \xDCberspannungsschutz Typ 2 nicht vorhanden. Z\xE4hlerschranktausch oder -erweiterung empfohlen.",
                besonderheiten: [
                  "W\xE4rmepumpe UV bereits vorhanden",
                  "Wallbox-Absicherung erkannt (16A)",
                  "FI-Schalter Typ A vorhanden",
                  "Technik Tiefgarage separat abgesichert",
                  "Z\xE4hlerfeld: Wohnung + Heizung getrennt"
                ],
                nachruestbedarf: [
                  "\u26A0\uFE0F APZ-Feld nachr\xFCsten (VDE AR-N 4100 Pflicht)",
                  "SLS-Schalter (Selektiver Leitungsschutzschalter) einbauen",
                  "Smart Meter / moderner Zweirichtungsz\xE4hler erforderlich",
                  "\xDCberspannungsschutz Typ 2 nachr\xFCsten",
                  "Einspeisez\xE4hlerplatz pr\xFCfen"
                ],
                zustand: "Mittel"
              };
              u("panelDemoMode", true);
            }
            u("panelAnalysis", analysis);
            u("panelScanning", false);
          };
          reader.readAsDataURL(file);
        } catch (err) {
          u("panelScanning", false);
        }
      }
    };
    input.click();
  };
  const statusColors = { gruen: T.green, gelb: BRAND.yellow, rot: T.red };
  const statusLabels = { gruen: "PV-Ready", gelb: "Bedingt m\xF6glich", rot: "Nachr\xFCstung n\xF6tig" };
  const statusIcons = { gruen: "\u2705", gelb: "\u26A0\uFE0F", rot: "\u274C" };
  return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(Section, { title: "Bilderaufnahme \xB7 Dachplanung", icon: "\u{1F3E0}" }, /* @__PURE__ */ React.createElement(AIHint, { text: "Bei mehreren belegbaren Dachfl\xE4chen: Bitte von jedem Dach ein Drohnenfoto aufnehmen sowie die Ausrichtung pro Dachfl\xE4che angeben.", color: T.red }), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12, marginTop: 8 } }, /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Anzahl Dachfl\xE4chen",
      value: data.dachflaechenAnz || "",
      onChange: (v) => u("dachflaechenAnz", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "1", label: "1" }, { value: "2", label: "2" }, { value: "3", label: "3" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Dachfl\xE4che 1",
      value: data.dachflaeche1 || "",
      onChange: (v) => u("dachflaeche1", v),
      half: true,
      options: dir8
    }
  ), parseInt(data.dachflaechenAnz) >= 2 && /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Dachfl\xE4che 2",
      value: data.dachflaeche2 || "",
      onChange: (v) => u("dachflaeche2", v),
      half: true,
      options: dir8
    }
  ), parseInt(data.dachflaechenAnz) >= 3 && /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Dachfl\xE4che 3",
      value: data.dachflaeche3 || "",
      onChange: (v) => u("dachflaeche3", v),
      half: true,
      options: dir8
    }
  ))), /* @__PURE__ */ React.createElement("div", { style: {
    display: "flex",
    alignItems: "center",
    justifyContent: "space-between",
    padding: "12px 16px",
    background: gDriveConnected ? `${T.green}08` : T.card,
    borderRadius: 12,
    marginBottom: 12,
    border: `1.5px solid ${gDriveConnected ? `${T.green}30` : T.border}`
  } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 20 } }, gDriveConnected ? "\u2601\uFE0F" : "\u{1F4E4}"), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 600, color: gDriveConnected ? T.green : T.textSec } }, gDriveConnected ? "Google Drive verbunden" : "Fotos automatisch sichern"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, gDriveConnected ? `Ordner: bee-doo FIELD Fotos/${[data.nachname, data.vorname].filter(Boolean).join("_") || "..."}` : "Jedes Foto wird sofort in Google Drive hochgeladen"))), !gDriveConnected ? /* @__PURE__ */ React.createElement("button", { onClick: connectGDrive, style: {
    padding: "8px 16px",
    borderRadius: 8,
    border: `1.5px solid ${BRAND.yellow}`,
    background: T.accentGlow,
    color: BRAND.yellow,
    fontSize: 12,
    fontWeight: 700,
    cursor: "pointer",
    fontFamily: font
  } }, "Verbinden") : /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18, color: T.green } }, "\u2705")), /* @__PURE__ */ React.createElement("div", { style: {
    display: "flex",
    alignItems: "center",
    justifyContent: "space-between",
    padding: "14px 18px",
    background: T.card,
    borderRadius: 12,
    marginBottom: 16,
    border: `1px solid ${T.border}`
  } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14, color: T.textSec } }, "Pflichtfotos"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 20, fontWeight: 800, color: capturedP === pflicht.length ? T.green : T.red, fontFamily: fontMono } }, capturedP, " / ", pflicht.length)),
  
  /* QR-Code Scanner Section */
  React.createElement("div", { style: { background: T.card, borderRadius: 14, border: "1.5px solid " + (qrResult.length > 0 ? T.green + "40" : T.border), padding: "16px 18px", marginBottom: 16 }},
    React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: qrScanning || qrResult.length > 0 ? 12 : 0 }},
      React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 }},
        React.createElement("span", { style: { fontSize: 20 }}, "📱"),
        React.createElement("div", null,
          React.createElement("div", { style: { fontSize: 13, fontWeight: 600, color: T.text }}, "QR-Code / Barcode Scanner"),
          React.createElement("div", { style: { fontSize: 10, color: T.textDim }}, qrResult.length > 0 ? qrResult.length + " Code(s) gescannt" : "Zähler-Nr., Material-Codes, Seriennummern")
        )
      ),
      React.createElement("button", { onClick: qrScanning ? stopQrScan : startQrScan, style: {
        padding: "8px 16px", borderRadius: 8,
        border: "1.5px solid " + (qrScanning ? T.red : BRAND.yellow),
        background: qrScanning ? T.red + "15" : T.accentGlow,
        color: qrScanning ? T.red : BRAND.yellow,
        fontSize: 12, fontWeight: 700, cursor: "pointer", fontFamily: font
      }}, qrScanning ? "⏹ Stopp" : "📷 Scannen")
    ),
    
    /* Camera View */
    qrScanning && React.createElement("div", { style: { position: "relative", borderRadius: 12, overflow: "hidden", marginBottom: 10, border: "2px solid " + BRAND.yellow + "40" }},
      React.createElement("video", { ref: qrVideoRef, style: { width: "100%", height: 220, objectFit: "cover", display: "block" }, playsInline: true, muted: true }),
      React.createElement("div", { style: { position: "absolute", inset: 0, display: "flex", alignItems: "center", justifyContent: "center", pointerEvents: "none" }},
        React.createElement("div", { style: { width: 180, height: 180, border: "3px solid " + BRAND.yellow, borderRadius: 16, boxShadow: "0 0 0 9999px rgba(0,0,0,0.4)", animation: "pulse 1.5s ease-in-out infinite" }})
      ),
      React.createElement("div", { style: { position: "absolute", bottom: 8, left: 0, right: 0, textAlign: "center", fontSize: 11, color: "#fff", textShadow: "0 1px 4px rgba(0,0,0,0.8)" }}, "QR-Code oder Barcode ins Feld halten...")
    ),
    
    /* Scanned Results */
    qrResult.length > 0 && React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 6 }},
      ...qrResult.map((r, i) => React.createElement("div", { key: i, style: {
        display: "flex", alignItems: "center", gap: 10, padding: "8px 12px",
        background: T.green + "08", borderRadius: 8, border: "1px solid " + T.green + "20"
      }},
        React.createElement("span", { style: { fontSize: 16 }}, "✅"),
        React.createElement("div", { style: { flex: 1, minWidth: 0 }},
          React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.text, wordBreak: "break-all" }}, r.value),
          React.createElement("div", { style: { fontSize: 9, color: T.textDim }}, r.format + " · " + r.zeit)
        ),
        React.createElement("button", { onClick: () => { 
          const updated = qrResult.filter((_, j) => j !== i);
          setQrResult(updated);
          u("_qrResults", updated);
        }, style: { background: "none", border: "none", color: T.textDim, cursor: "pointer", fontSize: 14 }}, "✕")
      ))
    )
  ), 

  /* ── 📱 Fotos vom Handy – QR-Code Generator ── */
  React.createElement("div", { style: { background: T.card, borderRadius: 14, border: "1.5px solid " + T.border, padding: "16px 18px", marginBottom: 16, marginTop: 8 }},
    React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, marginBottom: 12 }},
      React.createElement("span", { style: { fontSize: 20 }}, "\uD83D\uDCF1"),
      React.createElement("div", null,
        React.createElement("div", { style: { fontSize: 13, fontWeight: 600, color: T.text }}, "Fotos vom Handy"),
        React.createElement("div", { style: { fontSize: 10, color: T.textDim }}, "QR-Code scannen \u2192 Fotos extern hochladen"))),
    /* QR Code always visible - no click needed */
    React.createElement("div", { style: { textAlign: "center" }},
      React.createElement("canvas", { key: "qr-" + (data._phoneJobId || "init"), ref: function(el) {
        if (el && data._phoneJobId) {
          var kundenName = encodeURIComponent([data.vorname, data.nachname].filter(Boolean).join(" ") || "Kunde");
          var addr = encodeURIComponent([data.strasse, data.hausnummer, data.plz, data.ort].filter(Boolean).join(" ") || "");
          var berater = encodeURIComponent(data._beraterName || "");
          var qrUrl = window.location.origin + "/field-photo.html?job=" + data._phoneJobId + "&name=" + kundenName + "&addr=" + addr + "&berater=" + berater;
          try { new QRious({ element: el, value: qrUrl, size: 200, backgroundAlpha: 1, background: "#ffffff", foreground: "#0c1222", level: "M" }); } catch(e) {}
        }
      }, style: { borderRadius: 12, display: "block", margin: "0 auto 8px" }}),
      React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 }}, "QR-Code mit dem Handy scannen"),
      React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "center", gap: 8, marginBottom: 8 }},
        React.createElement("div", { style: { width: 8, height: 8, borderRadius: "50%", background: phoneSync.active ? "#34D399" : T.textDim, animation: phoneSync.active ? "pulse 1.5s infinite" : "none" }}),
        React.createElement("span", { style: { fontSize: 10, color: phoneSync.count > 0 ? "#34D399" : T.textDim, fontWeight: 600 }}, phoneSync.count > 0 ? phoneSync.count + " empfangen" : "wartet\u2026")),
      React.createElement("div", { style: { display: "flex", gap: 8, justifyContent: "center" }},
        React.createElement("button", { onClick: function() {
          var kundenName = encodeURIComponent([data.vorname, data.nachname].filter(Boolean).join(" ") || "Kunde");
          var addr = encodeURIComponent([data.strasse, data.hausnummer, data.plz, data.ort].filter(Boolean).join(" ") || "");
          var berater = encodeURIComponent(data._beraterName || "");
          var qrUrl = window.location.origin + "/field-photo.html?job=" + data._phoneJobId + "&name=" + kundenName + "&addr=" + addr + "&berater=" + berater;
          navigator.clipboard.writeText(qrUrl);
        }, style: { padding: "6px 12px", borderRadius: 8, border: "1px solid " + T.border, background: "none", color: T.textDim, fontSize: 10, cursor: "pointer", fontFamily: font }}, "\uD83D\uDCCB Link kopieren"),
        React.createElement("button", { onClick: function() { var newJob = Date.now().toString(36) + Math.random().toString(36).slice(2,6); u("_phoneJobId", newJob); u("_phonePhotosReceived", 0); }, style: { padding: "6px 12px", borderRadius: 8, border: "1px solid " + T.border, background: "none", color: T.textDim, fontSize: 10, cursor: "pointer", fontFamily: font }}, "🔄 Neuer QR-Code"))
    )), /* @__PURE__ */ React.createElement(Section, { title: "Pflichtfotos", icon: "\u26A0\uFE0F", accent: T.red }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, pflicht.map((p) => /* @__PURE__ */ React.createElement(
    PhotoTile,
    {
      key: p.key,
      label: p.label,
      icon: p.icon,
      photoUrl: data[p.key],
      hasAnalysis: p.smart && data.panelAnalysis,
      note: p.note,
      required: true,
      gdStatus: data[`${p.key}_gd`],
      onCapture: () => p.smart ? handleSmartCapture(p.key, true) : capturePhoto(p.key, true, p.label),
      onGallery: () => p.smart ? handleSmartCapture(p.key, false) : capturePhoto(p.key, false, p.label),
      onRemove: () => {
        u(p.key, null);
        u(`${p.key}_file`, null);
        u(`${p.key}_gd`, null);
      }
    }
  )))), /* @__PURE__ */ React.createElement(Section, { title: "Optionale Fotos", icon: "\u{1F4F8}" }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: T.textDim, marginBottom: 8 } }, capturedO, " von ", optional.length, " aufgenommen"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, optional.map((p) => /* @__PURE__ */ React.createElement("div", { key: p.key, style: { flex: "1 1 calc(50% - 8px)", minWidth: 140 } }, p.editable && /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "text",
      value: data[p.labelKey] || "",
      onChange: (e) => u(p.labelKey, e.target.value),
      placeholder: `Sonstiges benennen\u2026`,
      style: { width: "100%", padding: "5px 8px", marginBottom: 4, background: T.surface, border: `1px solid ${T.border}`, borderRadius: 6, color: T.text, fontSize: 10, fontFamily: font, outline: "none", boxSizing: "border-box" }
    }
  ), /* @__PURE__ */ React.createElement(
    PhotoTile,
    {
      label: p.editable ? data[p.labelKey] || p.label : p.label,
      icon: p.icon,
      photoUrl: data[p.key],
      note: p.note,
      gdStatus: data[`${p.key}_gd`],
      onCapture: () => capturePhoto(p.key, true, data[p.labelKey] || p.label),
      onGallery: () => capturePhoto(p.key, false, data[p.labelKey] || p.label),
      onRemove: () => {
        u(p.key, null);
        u(`${p.key}_file`, null);
        u(`${p.key}_gd`, null);
      }
    }
  ))))), data.panelScanning && /* @__PURE__ */ React.createElement("div", { style: {
    marginTop: 16,
    padding: "16px 18px",
    background: T.card,
    borderRadius: 12,
    border: `1px solid ${BRAND.yellow}30`,
    display: "flex",
    alignItems: "center",
    gap: 12
  } }, /* @__PURE__ */ React.createElement("span", { style: { animation: "spin 1s linear infinite", display: "inline-block", fontSize: 20 } }, "\u2699\uFE0F"), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, color: BRAND.yellow, fontWeight: 600 } }, "KI analysiert Z\xE4hlerschrank..."), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: T.textDim, marginTop: 2 } }, "Freie Pl\xE4tze, Z\xE4hlertypen, PV-Tauglichkeit"))), data.fotoZaehler && typeof data.fotoZaehler === "string" && data.fotoZaehler.startsWith("blob:") && !data.panelScanning && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 12, borderRadius: 10, overflow: "hidden", border: `1px solid ${T.border}`, maxHeight: 140 } }, /* @__PURE__ */ React.createElement("img", { src: data.fotoZaehler, alt: "Z\xE4hlerschrank", style: { width: "100%", height: 140, objectFit: "cover" } })), data.panelAnalysis && !data.panelScanning && (() => {
    const a = data.panelAnalysis;
    const sc = statusColors[a.pvReady] || BRAND.yellow;
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: {
      padding: "14px 18px",
      borderRadius: 12,
      background: `${sc}12`,
      border: `1.5px solid ${sc}40`,
      display: "flex",
      alignItems: "center",
      gap: 12,
      marginBottom: 12
    } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 28 } }, statusIcons[a.pvReady] || "\u26A0\uFE0F"), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 700, color: sc } }, statusLabels[a.pvReady] || "Pr\xFCfung"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, color: T.textSec, marginTop: 2 } }, a.pvReadyText))), /* @__PURE__ */ React.createElement("div", { style: {
      display: "grid",
      gridTemplateColumns: "1fr 1fr",
      gap: 8,
      marginBottom: 12
    } }, [
      { label: "Z\xE4hler erkannt", value: a.zaehlerAnzahl || "\u2013", icon: "\u{1F522}" },
      { label: "Freie Pl\xE4tze", value: a.freiePlaetze || "\u2013", icon: "\u{1F4D0}" },
      { label: "Z\xE4hlertypen", value: a.zaehlerTypen || "\u2013", icon: "\u26A1" },
      { label: "Zustand", value: a.zustand || "\u2013", icon: "\u{1F50D}" }
    ].map((item, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: {
      padding: "10px 14px",
      background: T.surface,
      borderRadius: 10,
      border: `1px solid ${T.border}`
    } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 4 } }, item.icon, " ", item.label), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, color: T.text, fontWeight: 600 } }, item.value)))), /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", borderRadius: 12, marginBottom: 12, background: a.apzVorhanden === true ? `${T.green}08` : `${T.red}08`, border: `2px solid ${a.apzVorhanden === true ? T.green : T.red}` } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 800, color: a.apzVorhanden === true ? T.green : T.red, textTransform: "uppercase", letterSpacing: 0.5 } }, a.apzVorhanden === true ? "\u2705" : "\u{1F6A8}", " APZ-Feld (VDE AR-N 4100)"), /* @__PURE__ */ React.createElement("div", { style: { padding: "3px 10px", borderRadius: 6, fontSize: 11, fontWeight: 700, background: a.apzVorhanden === true ? T.green : T.red, color: "#fff" } }, a.apzVorhanden === true ? "Vorhanden" : a.apzVorhanden === false ? "Fehlt" : "Nicht erkennbar")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1, padding: "8px 10px", background: `${a.vdeKonform === true ? T.green : T.red}06`, borderRadius: 8, border: `1px solid ${a.vdeKonform === true ? T.green : T.red}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textTransform: "uppercase" } }, "VDE-Konform"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: a.vdeKonform === true ? T.green : T.red } }, a.vdeKonform === true ? "\u2705 Ja" : a.vdeKonform === false ? "\u274C Nein" : "\u2753 Unklar")), /* @__PURE__ */ React.createElement("div", { style: { flex: 2, padding: "8px 10px", background: T.surface, borderRadius: 8, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textTransform: "uppercase" } }, "VDE-Details"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, marginTop: 2, lineHeight: 1.4 } }, a.vdeDetails || "\u2013"))), a.apzVorhanden !== true && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, padding: "8px 12px", background: `${T.red}06`, borderRadius: 8, border: `1px solid ${T.red}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.red, fontWeight: 600 } }, "\u26A1 Handlungsbedarf:"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 2, lineHeight: 1.5 } }, "Ohne APZ-Feld ist der Z\xE4hlerschrank nicht konform nach VDE AR-N 4100 (TAR Niederspannung). F\xFCr die PV-Installation wird ein Z\xE4hlerschranktausch oder eine Erweiterung mit APZ-Feld ben\xF6tigt. Zusatzkosten: ca. 800\u20132.500 \u20AC je nach Aufwand.")), a.apzVorhanden !== true && (() => {
      const kunde = `${data.anrede || ""} ${data.vorname || ""} ${data.nachname || ""}`.trim() || "\u2013";
      const adresse = data.strasse ? `${data.strasse} ${data.hausnummer || ""}, ${data.plz || ""} ${data.ort || ""}` : "\u2013";
      const zaehlerNr = data.zaehlerNr || "\u2013";
      const apzStatus = a.apzVorhanden === false ? "\u274C APZ fehlt" : "\u2753 APZ unklar/nicht erkennbar";
      const vdeStatus = a.vdeKonform === true ? "\u2705 Konform" : a.vdeKonform === false ? "\u274C Nicht konform" : "\u2753 Unklar";
      const berater = data._beraterName || "Berater";
      const msgLines = [
        `\u{1F6A8} APZ-Pr\xFCfung ben\xF6tigt`,
        ``,
        `Kunde: ${kunde}`,
        `Adresse: ${adresse}`,
        `Z\xE4hler-Nr: ${zaehlerNr}`,
        ``,
        `\u26A1 KI-Analyse Z\xE4hlerschrank:`,
        `APZ-Feld: ${apzStatus}`,
        `VDE-Konform: ${vdeStatus}`,
        a.vdeDetails ? `Details: ${a.vdeDetails}` : "",
        a.freiePlaetze ? `Freie Pl\xE4tze: ${a.freiePlaetze}` : "",
        a.zaehlerAnzahl ? `Z\xE4hler: ${a.zaehlerAnzahl}` : "",
        a.zaehlerTypen ? `Typen: ${a.zaehlerTypen}` : "",
        a.zustand ? `Zustand: ${a.zustand}` : "",
        data.slsVorhanden ? `SLS: ${data.slsVorhanden}` : "",
        data.netzform ? `Netzform: ${data.netzform}` : "",
        data.ueberspannungsschutz ? `\xDCSS: ${data.ueberspannungsschutz}` : "",
        ``,
        `Bitte pr\xFCfen ob Z\xE4hlerschranktausch/-erweiterung mit APZ n\xF6tig.`,
        `VDE AR-N 4100 / TAR Niederspannung`,
        ``,
        `\u{1F4F8} Foto vom ZS im Google Drive`,
        `Berater: ${berater}`
      ].filter(Boolean).join("\n");
      const emailSubject = `APZ-Pr\xFCfung \u2013 ${kunde} \u2013 ${data.plz || ""} ${data.ort || ""}`;
      const waMsg = encodeURIComponent(msgLines);
      const acNr = data._acNr || "";
      const acEmail = data._acEmail || "";
      const waNumber = acNr ? acNr.replace(/[\s\-\/\(\)]/g, "").replace(/^\+/, "") : "";
      return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, padding: "12px 14px", background: `${T.red}04`, borderRadius: 10, border: `1.5px solid ${T.red}25` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.red, fontWeight: 700, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "\u{1F4E4} AC-Team benachrichtigen"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, marginBottom: 8 } }, /* @__PURE__ */ React.createElement(
        "input",
        {
          type: "tel",
          value: data._acNr || "",
          onChange: (e) => u("_acNr", e.target.value),
          placeholder: "AC-Team Mobilnr.",
          style: { flex: 1, padding: "8px 10px", background: T.surface, border: `1px solid ${T.border}`, borderRadius: 6, color: T.text, fontSize: 11, fontFamily: fontMono, outline: "none", boxSizing: "border-box" }
        }
      ), /* @__PURE__ */ React.createElement(
        "input",
        {
          type: "email",
          value: data._acEmail || "",
          onChange: (e) => u("_acEmail", e.target.value),
          placeholder: "AC-Team E-Mail",
          style: { flex: 1, padding: "8px 10px", background: T.surface, border: `1px solid ${T.border}`, borderRadius: 6, color: T.text, fontSize: 11, fontFamily: font, outline: "none", boxSizing: "border-box" }
        }
      )), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement(
        "a",
        {
          href: waNumber ? `https://wa.me/${waNumber}?text=${waMsg}` : `https://wa.me/?text=${waMsg}`,
          target: "_blank",
          rel: "noopener noreferrer",
          style: { flex: 1, padding: "12px", borderRadius: 10, textDecoration: "none", textAlign: "center", background: "linear-gradient(135deg, #25D366, #128C7E)", color: "#fff", fontSize: 13, fontWeight: 700, fontFamily: font, display: "flex", alignItems: "center", justifyContent: "center", gap: 6 }
        },
        "\u{1F4AC} WhatsApp"
      ), /* @__PURE__ */ React.createElement(
        "a",
        {
          href: `mailto:${acEmail}?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(msgLines)}`,
          style: { flex: 1, padding: "12px", borderRadius: 10, textDecoration: "none", textAlign: "center", background: `linear-gradient(135deg, ${T.blue}, #1D4ED8)`, color: "#fff", fontSize: 13, fontWeight: 700, fontFamily: font, display: "flex", alignItems: "center", justifyContent: "center", gap: 6 }
        },
        "\u2709\uFE0F E-Mail"
      )), data._apzGesendet ? /* @__PURE__ */ React.createElement("div", { style: { marginTop: 6, fontSize: 11, color: T.green, fontWeight: 600, textAlign: "center" } }, "\u2705 AC-Team wurde benachrichtigt") : /* @__PURE__ */ React.createElement("button", { onClick: () => u("_apzGesendet", true), style: { width: "100%", marginTop: 6, padding: "8px", borderRadius: 8, border: `1px solid ${T.border}`, background: T.surface, color: T.textSec, fontSize: 10, fontFamily: font, cursor: "pointer" } }, "\u2713 Als gesendet markieren"));
    })()), a.sicherungen && /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, marginBottom: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 4 } }, "\u{1F527} Sicherungen"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, color: T.text } }, a.sicherungen)), a.besonderheiten && a.besonderheiten.length > 0 && /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.blue, fontWeight: 600, letterSpacing: 0.5, textTransform: "uppercase", marginBottom: 6 } }, "\u{1F4A1} Erkannte Besonderheiten"), a.besonderheiten.map((b, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: {
      padding: "8px 12px",
      background: T.blueSoft,
      borderRadius: 8,
      border: `1px solid ${T.blue}20`,
      marginBottom: 4,
      fontSize: 13,
      color: T.blue
    } }, b))), a.nachruestbedarf && a.nachruestbedarf.length > 0 && /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.red, fontWeight: 600, letterSpacing: 0.5, textTransform: "uppercase", marginBottom: 6 } }, "\u{1F534} Nachr\xFCstbedarf f\xFCr PV"), a.nachruestbedarf.map((n, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: {
      padding: "8px 12px",
      background: T.redSoft,
      borderRadius: 8,
      border: `1px solid ${T.red}20`,
      marginBottom: 4,
      fontSize: 13,
      color: T.red
    } }, n))));
  })(), !data.panelAnalysis && !data.panelScanning && /* @__PURE__ */ React.createElement(AIHint, { text: "Tipp: Beim Z\xE4hlerschrank-Foto analysiert die KI automatisch freie Pl\xE4tze, Z\xE4hlertypen und PV-Tauglichkeit. Einfach auf den Z\xE4hlerschrank-Tile tippen und Foto machen!", color: T.blue }), data.panelDemoMode && data.panelAnalysis && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 8, fontStyle: "italic", textAlign: "center" } }, "\u24D8 Demo-Modus \u2013 in der PWA mit API-Key wird das echte Foto analysiert"), /* @__PURE__ */ React.createElement(Section, { title: "Google Drive Upload", icon: "\u2601\uFE0F", accent: T.blue }, (() => {
    const allPhotos2 = [...pflicht, ...optional];
    const taken = allPhotos2.filter((p) => data[p.key]);
    const uploaded = allPhotos2.filter((p) => data[`${p.key}_uploaded`]);
    const uploading = data._driveUploading;
    const progress = data._driveProgress || 0;
    const done = data._driveDone;
    const folderName = data.nachname ? `bee-doo_${data.nachname}_${data.vorname || ""}` : "bee-doo_Kunde";
    return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: {
      display: "flex",
      justifyContent: "space-between",
      alignItems: "center",
      padding: "10px 14px",
      background: T.surface,
      borderRadius: 10,
      border: `1px solid ${T.border}`,
      marginBottom: 12
    } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, color: T.text, fontWeight: 600 } }, "\u{1F4C1} ", folderName), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim } }, "Zielordner in Google Drive")), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "right" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 15, fontWeight: 700, color: taken.length > 0 ? T.green : T.textDim, fontFamily: fontMono } }, taken.length), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, "Fotos bereit"))), uploading && /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginBottom: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: T.blue } }, "Hochladen..."), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: T.blue, fontFamily: fontMono } }, progress, "/", taken.length)), /* @__PURE__ */ React.createElement("div", { style: { width: "100%", height: 8, background: T.surface, borderRadius: 4, overflow: "hidden" } }, /* @__PURE__ */ React.createElement("div", { style: {
      width: `${taken.length > 0 ? progress / taken.length * 100 : 0}%`,
      height: "100%",
      background: `linear-gradient(90deg, ${T.blue}, ${T.green})`,
      borderRadius: 4,
      transition: "width 0.3s ease"
    } })), data._driveCurrentFile && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 6 } }, "\u{1F4E4} ", data._driveCurrentFile)), done && /* @__PURE__ */ React.createElement("div", { style: {
      padding: "12px 16px",
      background: T.greenSoft,
      borderRadius: 10,
      border: `1px solid ${T.green}30`,
      marginBottom: 12,
      display: "flex",
      alignItems: "center",
      gap: 10
    } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 24 } }, "\u2705"), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 600, color: T.green } }, "Upload abgeschlossen"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: T.textSec } }, uploaded.length, " Dateien in Google Drive gespeichert"))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 10 } }, /* @__PURE__ */ React.createElement(
      "button",
      {
        disabled: taken.length === 0 || uploading,
        onClick: async () => {
          u("_driveUploading", true);
          u("_driveDone", false);
          u("_driveProgress", 0);
          for (let i = 0; i < taken.length; i++) {
            u("_driveProgress", i + 1);
            u("_driveCurrentFile", taken[i].label);
            await new Promise((r) => setTimeout(r, 600));
            u(`${taken[i].key}_uploaded`, true);
          }
          u("_driveUploading", false);
          u("_driveCurrentFile", null);
          u("_driveDone", true);
          u("_driveDemoMode", true);
        },
        style: {
          flex: 2,
          padding: "14px",
          borderRadius: 12,
          border: "none",
          cursor: taken.length > 0 && !uploading ? "pointer" : "default",
          background: taken.length > 0 && !uploading ? `linear-gradient(135deg, #4285F4, #0F9D58)` : T.surface,
          color: taken.length > 0 && !uploading ? "#fff" : T.textDim,
          fontSize: 14,
          fontWeight: 700,
          fontFamily: font,
          opacity: taken.length === 0 || uploading ? 0.5 : 1,
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          gap: 8
        }
      },
      uploading ? /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("span", { style: { animation: "spin 1s linear infinite", display: "inline-block" } }, "\u2699\uFE0F"), " Wird hochgeladen...") : done ? /* @__PURE__ */ React.createElement(React.Fragment, null, "\u2705 Erneut hochladen") : /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("svg", { width: "18", height: "18", viewBox: "0 0 24 24", fill: "currentColor" }, /* @__PURE__ */ React.createElement("path", { d: "M12 2L6.5 11h11L12 2zm0 22l-6.5-9h13L12 24zm-7-11l6.5-9L18 13H5z" })), "Alle in Google Drive")
    ), done && /* @__PURE__ */ React.createElement(
      "button",
      {
        onClick: () => {
          u("_driveDone", false);
          u("_driveProgress", 0);
          allPhotos2.forEach((p) => u(`${p.key}_uploaded`, false));
        },
        style: { flex: 1, padding: "14px", borderRadius: 12, border: `1.5px solid ${T.border}`, background: "transparent", color: T.textSec, fontSize: 13, cursor: "pointer", fontFamily: font }
      },
      "\u21BA Reset"
    )), (uploading || done) && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 12, maxHeight: 200, overflowY: "auto", borderRadius: 10, border: `1px solid ${T.border}` } }, taken.map((p, i) => {
      const isUploaded = data[`${p.key}_uploaded`];
      const isCurrent = uploading && data._driveCurrentFile === p.label;
      return /* @__PURE__ */ React.createElement("div", { key: i, style: {
        display: "flex",
        alignItems: "center",
        gap: 10,
        padding: "8px 14px",
        borderBottom: i < taken.length - 1 ? `1px solid ${T.border}` : "none",
        background: isCurrent ? T.blueSoft : "transparent"
      } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14 } }, isUploaded ? "\u2705" : isCurrent ? "\u23F3" : "\u23F8\uFE0F"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: isUploaded ? T.green : isCurrent ? T.blue : T.textDim, flex: 1 } }, p.label), isUploaded && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: T.textDim } }, "Drive \u2713"));
    })), data._driveDemoMode && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 8, fontStyle: "italic", textAlign: "center" } }, "\u24D8 Demo-Modus \u2013 in der PWA mit OAuth werden echte Fotos zu Google Drive hochgeladen"));
  })()),
    /* ── Lightbox for full-screen photo/video view ── */
    lightboxSrc && React.createElement("div", { onClick: function() { setLightboxSrc(null); setLightboxIsVideo(false); }, style: { position: "fixed", inset: 0, zIndex: 50000, background: "rgba(0,0,0,0.92)", display: "flex", alignItems: "center", justifyContent: "center", cursor: "pointer", padding: 20 }},
      React.createElement("button", { onClick: function(e) { e.stopPropagation(); setLightboxSrc(null); setLightboxIsVideo(false); }, style: { position: "absolute", top: 16, right: 16, background: "rgba(255,255,255,0.1)", border: "none", color: "#fff", fontSize: 24, width: 40, height: 40, borderRadius: "50%", cursor: "pointer", zIndex: 50001 }}, "\xD7"),
      lightboxIsVideo ?
        React.createElement("video", { src: lightboxSrc, controls: true, autoPlay: true, style: { maxWidth: "95%", maxHeight: "90vh", borderRadius: 12 }, onClick: function(e) { e.stopPropagation(); } }) :
        React.createElement("img", { src: lightboxSrc, style: { maxWidth: "95%", maxHeight: "90vh", objectFit: "contain", borderRadius: 12 }, onClick: function(e) { e.stopPropagation(); } })
    ));
}
function ARSpeicherView({ data, setData }) {
  const u = (k, v) => setData((d) => ({ ...d, [k]: v }));
  const videoRef = useRef(null);
  const streamRef = useRef(null);
  const [active, setActive] = useState(false);
  const [rotation, setRotation] = useState(-15);
  const [captured, setCaptured] = useState(false);
  const [hasCamera, setHasCamera] = useState(true);
  const startCamera = async () => {
    setActive(true);
    setCaptured(false);
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment", width: { ideal: 1280 }, height: { ideal: 720 } }
      });
      streamRef.current = stream;
      if (videoRef.current) {
        videoRef.current.srcObject = stream;
      }
      setHasCamera(true);
    } catch (err) {
      setHasCamera(false);
    }
  };
  const stopCamera = () => {
    if (streamRef.current) {
      streamRef.current.getTracks().forEach((t) => t.stop());
      streamRef.current = null;
    }
    setActive(false);
  };
  const capturePhoto = () => {
    setCaptured(true);
    u("arCaptured", true);
    if (streamRef.current) {
      streamRef.current.getTracks().forEach((t) => t.stop());
      streamRef.current = null;
    }
  };
  useEffect(() => {
    return () => {
      if (streamRef.current) {
        streamRef.current.getTracks().forEach((t) => t.stop());
      }
    };
  }, []);
  useEffect(() => {
    if (videoRef.current && streamRef.current) {
      videoRef.current.srcObject = streamRef.current;
    }
  }, [active]);
  return /* @__PURE__ */ React.createElement(Section, { title: "AR Speicher-Aufstellort", icon: "\u{1F4D0}", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, color: T.textSec, marginBottom: 14, lineHeight: 1.6 } }, "Visualisiere den Speicher (60\xD760\xD7180 cm) direkt im Raum des Kunden per Kamera-Overlay."), !active ? /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("button", { onClick: startCamera, style: {
    width: "100%",
    padding: "16px",
    borderRadius: 12,
    border: "none",
    cursor: "pointer",
    background: `linear-gradient(135deg, ${T.blue}, #3B82F6)`,
    color: "#fff",
    fontSize: 15,
    fontWeight: 700,
    fontFamily: font,
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    gap: 10,
    boxShadow: `0 4px 20px rgba(96,165,250,0.2)`
  } }, "\u{1F4F1} AR-Kamera \xF6ffnen"), captured && /* @__PURE__ */ React.createElement("div", { style: {
    marginTop: 10,
    padding: "10px 14px",
    background: T.greenSoft,
    borderRadius: 8,
    border: `1px solid ${T.green}25`,
    display: "flex",
    alignItems: "center",
    gap: 8
  } }, /* @__PURE__ */ React.createElement("span", null, "\u2705"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: T.green } }, "Speicher-Aufstellort dokumentiert"))) : /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: {
    width: "100%",
    aspectRatio: "4/3",
    borderRadius: 12,
    overflow: "hidden",
    background: "#111",
    position: "relative",
    border: `2px solid ${T.blue}40`
  } }, hasCamera ? /* @__PURE__ */ React.createElement(
    "video",
    {
      ref: videoRef,
      autoPlay: true,
      playsInline: true,
      muted: true,
      style: { width: "100%", height: "100%", objectFit: "cover", display: "block" }
    }
  ) : /* @__PURE__ */ React.createElement("div", { style: {
    width: "100%",
    height: "100%",
    background: "linear-gradient(135deg, #1a1a2e, #16213e, #0f3460)",
    display: "flex",
    alignItems: "center",
    justifyContent: "center"
  } }, /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", color: T.textDim } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 40, marginBottom: 8 } }, "\u{1F4F7}"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12 } }, "Kamera nicht verf\xFCgbar \u2013 Demo-Ansicht"))), /* @__PURE__ */ React.createElement("div", { style: {
    position: "absolute",
    left: "50%",
    top: "50%",
    transform: `translate(-50%, -50%) perspective(600px) rotateY(${rotation}deg) rotateX(5deg)`,
    width: 120,
    height: 200,
    transition: "transform 0.3s ease",
    pointerEvents: "none"
  } }, /* @__PURE__ */ React.createElement("div", { style: {
    width: 120,
    height: 200,
    position: "absolute",
    background: "rgba(96,165,250,0.18)",
    border: `2.5px solid ${T.blue}`,
    borderRadius: 6,
    display: "flex",
    flexDirection: "column",
    alignItems: "center",
    justifyContent: "center",
    boxShadow: `0 0 40px rgba(96,165,250,0.25), inset 0 0 30px rgba(96,165,250,0.08)`
  } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: "#fff", fontWeight: 700, letterSpacing: 1, textTransform: "uppercase", marginBottom: 4, textShadow: "0 1px 4px rgba(0,0,0,0.5)" } }, "Speicher"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 26, fontWeight: 800, color: "#fff", fontFamily: fontMono, textShadow: "0 2px 8px rgba(0,0,0,0.5)" } }, baseAkku > 0 ? baseAkku.toLocaleString("de-DE") : "\u2013", " kWh"), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, fontSize: 10, color: "rgba(255,255,255,0.7)", textShadow: "0 1px 3px rgba(0,0,0,0.5)" } }, "60 \xD7 60 \xD7 180 cm"), /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", bottom: -22, left: 0, width: "100%", display: "flex", justifyContent: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 4 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 4, height: 8, borderLeft: `1.5px solid ${T.blue}`, borderTop: `1.5px solid ${T.blue}`, borderBottom: `1.5px solid ${T.blue}` } }), /* @__PURE__ */ React.createElement("div", { style: { width: 24, height: 1.5, background: T.blue } }), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: "#fff", fontFamily: fontMono, fontWeight: 700, textShadow: "0 1px 3px rgba(0,0,0,0.8)" } }, "60cm"), /* @__PURE__ */ React.createElement("div", { style: { width: 24, height: 1.5, background: T.blue } }), /* @__PURE__ */ React.createElement("div", { style: { width: 4, height: 8, borderRight: `1.5px solid ${T.blue}`, borderTop: `1.5px solid ${T.blue}`, borderBottom: `1.5px solid ${T.blue}` } }))), /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", right: -40, top: 0, height: "100%", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { height: 55, width: 1.5, background: T.blue } }), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: "#fff", fontFamily: fontMono, fontWeight: 700, padding: "2px 0", textShadow: "0 1px 3px rgba(0,0,0,0.8)" } }, "180cm"), /* @__PURE__ */ React.createElement("div", { style: { height: 55, width: 1.5, background: T.blue } }))), /* @__PURE__ */ React.createElement("div", { style: {
    position: "absolute",
    top: 0,
    right: -24,
    width: 24,
    height: 200,
    background: "rgba(96,165,250,0.10)",
    border: `1.5px solid ${T.blue}80`,
    borderLeft: "none",
    borderRadius: "0 4px 4px 0",
    display: "flex",
    alignItems: "center",
    justifyContent: "center"
  } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 8, color: "rgba(255,255,255,0.5)", writingMode: "vertical-rl", fontFamily: fontMono } }, "60cm"))), /* @__PURE__ */ React.createElement("div", { style: {
    position: "absolute",
    bottom: 12,
    left: 12,
    right: 12,
    display: "flex",
    gap: 8,
    justifyContent: "center",
    alignItems: "center"
  } }, /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => setRotation((r) => r - 20),
      style: { width: 44, height: 44, borderRadius: 12, border: "none", background: "rgba(0,0,0,0.65)", color: "#fff", fontSize: 20, cursor: "pointer", backdropFilter: "blur(4px)" }
    },
    "\u21BA"
  ), /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: capturePhoto,
      style: {
        padding: "12px 28px",
        borderRadius: 12,
        border: "none",
        background: `linear-gradient(135deg, ${T.blue}, #3B82F6)`,
        color: "#fff",
        fontSize: 14,
        fontWeight: 700,
        cursor: "pointer",
        fontFamily: font,
        boxShadow: "0 4px 16px rgba(96,165,250,0.3)"
      }
    },
    "\u{1F4F8} Position speichern"
  ), /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => setRotation((r) => r + 20),
      style: { width: 44, height: 44, borderRadius: 12, border: "none", background: "rgba(0,0,0,0.65)", color: "#fff", fontSize: 20, cursor: "pointer", backdropFilter: "blur(4px)" }
    },
    "\u21BB"
  )), /* @__PURE__ */ React.createElement("div", { style: {
    position: "absolute",
    top: 10,
    right: 10,
    padding: "6px 10px",
    borderRadius: 8,
    background: "rgba(0,0,0,0.6)",
    backdropFilter: "blur(4px)"
  } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: "rgba(255,255,255,0.5)", textTransform: "uppercase", letterSpacing: 0.5 } }, "Auto aus Paket"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: "#fff", fontFamily: fontMono, textAlign: "center" } }, baseAkku > 0 ? `${baseAkku.toLocaleString("de-DE")} kWh` : "\u2013"), zsKwh > 0 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.blue, textAlign: "center" } }, "+", zsKwh.toLocaleString("de-DE"), " Zusatz"))), /* @__PURE__ */ React.createElement("button", { onClick: stopCamera, style: {
    width: "100%",
    marginTop: 8,
    padding: "10px",
    borderRadius: 8,
    border: `1px solid ${T.border}`,
    background: "transparent",
    color: T.textSec,
    fontSize: 13,
    cursor: "pointer",
    fontFamily: font
  } }, "AR-Ansicht schlie\xDFen"), !hasCamera && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 6, fontStyle: "italic", textAlign: "center" } }, "\u24D8 Kamera nicht verf\xFCgbar in diesem Browser \u2013 auf dem Tablet funktioniert die Live-Ansicht")));
}
function StepTechnik({ data, setData }) {
  const u = (k, v) => setData((d) => ({ ...d, [k]: v }));
  const jn = [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Ja", label: "Ja" }, { value: "Nein", label: "Nein" }];
  const TextArea = ({ label, k, ph }) => {
    const [listening, setListening] = useState(false);
    const startSpeech = () => {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        alert("Spracherkennung nicht unterst\xFCtzt");
        return;
      }
      const rec = new SR();
      rec.lang = "de-DE";
      rec.continuous = true;
      rec.interimResults = false;
      rec.onresult = (e) => {
        const text = Array.from(e.results).map((r) => r[0].transcript).join(" ");
        setData((d) => ({ ...d, [k]: (d[k] || "") + (d[k] ? " " : "") + text }));
      };
      rec.onend = () => setListening(false);
      rec.onerror = () => setListening(false);
      rec.start();
      setListening(true);
      setTimeout(() => {
        try {
          rec.stop();
        } catch (e) {
        }
      }, 3e4);
    };
    return /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", minWidth: 200 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between", marginBottom: 6 } }, /* @__PURE__ */ React.createElement("label", { style: { fontSize: 11, color: T.textSec, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, label), /* @__PURE__ */ React.createElement("button", { onClick: listening ? () => setListening(false) : startSpeech, style: {
      padding: "3px 10px",
      borderRadius: 8,
      border: `1px solid ${listening ? T.red : T.border}`,
      background: listening ? `${T.red}15` : "transparent",
      cursor: "pointer",
      fontSize: 11,
      color: listening ? T.red : T.textDim,
      fontFamily: font,
      display: "flex",
      alignItems: "center",
      gap: 4,
      animation: listening ? "pulse 1.5s infinite" : "none"
    } }, listening ? "\u{1F534} Aufnahme..." : "\u{1F399}\uFE0F Diktieren")), /* @__PURE__ */ React.createElement(
      "textarea",
      {
        value: data[k] || "",
        onChange: (e) => u(k, e.target.value),
        placeholder: ph || "",
        style: { width: "100%", minHeight: 70, padding: 14, background: T.surface, border: `1.5px solid ${listening ? T.red : T.border}`, borderRadius: 10, color: T.text, fontSize: 14, fontFamily: font, resize: "vertical", outline: "none", boxSizing: "border-box" }
      }
    ));
  };
  return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(Section, { title: "Geb\xE4ude", icon: "\u{1F3D7}\uFE0F" }, data._lat && data._lng && !data._solarData && /* @__PURE__ */ React.createElement("button", { onClick: async () => {
    u("_solarLoading", true);
    try {
      const resp = await fetch(`https://solar.googleapis.com/v1/buildingInsights:findClosest?location.latitude=${data._lat}&location.longitude=${data._lng}&requiredQuality=MEDIUM&key=SOLAR_API_KEY`);
      if (!resp.ok) throw new Error("API " + resp.status);
      const r = await resp.json();
      const sp = r.solarPotential || {};
      const segments = (sp.roofSegmentStats || []).map((s) => ({
        area: Math.round(s.stats?.areaMeters2 || 0),
        pitch: Math.round(s.pitchDegrees || 0),
        azimuth: Math.round(s.azimuthDegrees || 0),
        sunshine: Math.round(s.stats?.sunshineQuantiles?.[5] || 0)
      }));
      const solar = {
        maxPanels: sp.maxArrayPanelsCount || 0,
        maxArea: Math.round(sp.maxArrayAreaMeters2 || 0),
        maxSunshine: Math.round(sp.maxSunshineHoursPerYear || 0),
        carbonOffset: Math.round((sp.carbonOffsetFactorKgPerMwh || 0) * (sp.maxArrayPanelsCount || 0) * 0.4),
        segments,
        yearlyEnergy: Math.round((sp.solarPanelConfigs || [])[sp.solarPanelConfigs?.length - 1]?.yearlyEnergyDcKwh || 0),
        boundingBox: r.boundingBox,
        quality: r.imageryQuality
      };
      u("_solarData", solar);
      u("_solarLoading", false);
      if (r.boundingBox) {
        const bb = r.boundingBox;
        const toRad = (d) => d * Math.PI / 180;
        const lat1 = toRad(bb.sw?.latitude || bb.south || 0);
        const lat2 = toRad(bb.ne?.latitude || bb.north || 0);
        const lng1 = bb.sw?.longitude || bb.west || 0;
        const lng2 = bb.ne?.longitude || bb.east || 0;
        const R = 6371e3;
        const dLat = lat2 - lat1;
        const dLng = toRad(lng2 - lng1);
        const nsMeters = Math.abs(dLat * R);
        const ewMeters = Math.abs(dLng * R * Math.cos((lat1 + lat2) / 2));
        const breite = Math.round(Math.min(nsMeters, ewMeters) * 10) / 10;
        const laenge = Math.round(Math.max(nsMeters, ewMeters) * 10) / 10;
        if (!data.hausbreite) u("hausbreite", String(breite));
        if (!data.hauslaenge) u("hauslaenge", String(laenge));
        solar.hausbreite = breite;
        solar.hauslaenge = laenge;
      }
      if (segments.length > 0) {
        const mainSeg = segments.reduce((a, b) => a.area > b.area ? a : b);
        if (!data.dachneigung) u("dachneigung", String(mainSeg.pitch));
        if (mainSeg.pitch <= 10 && !data.flachdach) u("flachdach", true);
        solar.totalRoofArea = segments.reduce((sum, s) => sum + s.area, 0);
        if (!data.firsthoehe && !data.traufenhoehe && solar.hausbreite) {
          const halfW = solar.hausbreite / 2;
          const pitchRad = mainSeg.pitch * Math.PI / 180;
          const dachHoehe = Math.round(Math.tan(pitchRad) * halfW * 10) / 10;
          const traufe = 3;
          solar.estTraufe = traufe;
          solar.estFirst = Math.round((traufe + dachHoehe) * 10) / 10;
          u("traufenhoehe", String(traufe));
          u("firsthoehe", String(solar.estFirst));
        }
      }
    } catch (err) {
      await new Promise((r) => setTimeout(r, 1800));
      const demoSegments = [
        { area: 48, pitch: 38, azimuth: 185, sunshine: 1120 },
        { area: 42, pitch: 38, azimuth: 5, sunshine: 890 }
      ];
      const demo = {
        maxPanels: 24,
        maxArea: 44,
        maxSunshine: 1120,
        carbonOffset: 3800,
        segments: demoSegments,
        yearlyEnergy: 10680,
        quality: "MEDIUM",
        totalRoofArea: 90,
        hausbreite: 10.2,
        hauslaenge: 12.4,
        estTraufe: 3,
        estFirst: 6.9,
        _demo: true
      };
      u("_solarData", demo);
      u("_solarLoading", false);
      if (!data.dachneigung) u("dachneigung", "38");
      if (!data.hausbreite) u("hausbreite", "10.2");
      if (!data.hauslaenge) u("hauslaenge", "12.4");
      if (!data.traufenhoehe) u("traufenhoehe", "3");
      if (!data.firsthoehe) u("firsthoehe", "6.9");
      if (!data.flachdach) u("flachdach", false);
    }
  }, style: {
    width: "100%",
    padding: "14px 18px",
    borderRadius: 12,
    marginBottom: 14,
    border: `2px solid ${T.blue}40`,
    background: `${T.blue}08`,
    cursor: "pointer",
    display: "flex",
    alignItems: "center",
    gap: 12,
    fontFamily: font,
    transition: "all 0.2s ease"
  } }, /* @__PURE__ */ React.createElement("div", { style: {
    width: 44,
    height: 44,
    borderRadius: 12,
    background: `${T.blue}15`,
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    fontSize: 22,
    animation: data._solarLoading ? "spin 1s linear infinite" : "none"
  } }, data._solarLoading ? "\u23F3" : "\u{1F6F0}\uFE0F"), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, textAlign: "left" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.text } }, data._solarLoading ? "Dach wird analysiert..." : "Dach per Satellit analysieren"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 2 } }, data._solarLoading ? "Google Solar API \xB7 Bitte warten" : `Google Solar API \xB7 ${data._lat.toFixed(4)}\xB0, ${data._lng.toFixed(4)}\xB0`)), !data._solarLoading && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18, color: T.blue } }, "\u2192")), data._solarData && (() => {
    const s = data._solarData;
    return /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 14 } }, /* @__PURE__ */ React.createElement("div", { style: {
      display: "grid",
      gridTemplateColumns: "1fr 1fr 1fr",
      gap: 8,
      marginBottom: 10
    } }, [
      { label: "Max. Module", value: s.maxPanels, unit: "Stk", icon: "\u2600\uFE0F" },
      { label: "Nutzbare Dachfl\xE4che", value: s.maxArea, unit: "m\xB2", icon: "\u{1F4D0}" },
      { label: "Sonnenstunden/a", value: s.maxSunshine.toLocaleString("de"), unit: "h", icon: "\u{1F324}\uFE0F" }
    ].map((kpi, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: {
      padding: "10px 8px",
      borderRadius: 10,
      textAlign: "center",
      background: `${BRAND.yellow}08`,
      border: `1px solid ${BRAND.yellow}20`
    } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16 } }, kpi.icon), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono } }, kpi.value), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 2 } }, kpi.label)))), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", borderRadius: 10, background: `${T.green}08`, border: `1px solid ${T.green}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, textTransform: "uppercase" } }, "Gesch\xE4tzte Erzeugung"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: T.green, fontFamily: fontMono } }, s.yearlyEnergy.toLocaleString("de"), " ", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11 } }, "kWh/a"))), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", borderRadius: 10, background: `${T.blue}08`, border: `1px solid ${T.blue}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, textTransform: "uppercase" } }, "CO\u2082-Einsparung"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: T.blue, fontFamily: fontMono } }, (s.carbonOffset / 1e3).toFixed(1), " ", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11 } }, "t/a")))), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr 1fr", gap: 6, marginBottom: 10 } }, [
      s.hausbreite && { label: "Breite", value: s.hausbreite, unit: "m", icon: "\u2194\uFE0F" },
      s.hauslaenge && { label: "L\xE4nge", value: s.hauslaenge, unit: "m", icon: "\u2195\uFE0F" },
      s.estFirst && { label: "First \u2248", value: s.estFirst, unit: "m", icon: "\u{1F53A}" },
      s.estTraufe && { label: "Traufe \u2248", value: s.estTraufe, unit: "m", icon: "\u25AC" },
      s.totalRoofArea && { label: "Dachfl\xE4che ges.", value: s.totalRoofArea, unit: "m\xB2", icon: "\u{1F3E0}" },
      s.segments.length > 0 && { label: "Neigung", value: s.segments.reduce((a, b) => a.area > b.area ? a : b).pitch, unit: "\xB0", icon: "\u{1F4D0}" }
    ].filter(Boolean).map((kpi, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: {
      padding: "8px 6px",
      borderRadius: 8,
      textAlign: "center",
      background: T.surface,
      border: `1px solid ${T.border}`
    } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13 } }, kpi.icon), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 15, fontWeight: 700, color: T.text, fontFamily: fontMono } }, kpi.value), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, marginTop: 1 } }, kpi.label, " (", kpi.unit, ")")))), (s.estFirst || s.hausbreite) && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 10, padding: "6px 10px", background: `${T.blue}05`, borderRadius: 6, border: `1px solid ${T.blue}10` } }, "\u{1F6F0}\uFE0F Ma\xDFe aus Satellitendaten berechnet \u2013 bitte vor Ort \xFCberpr\xFCfen und ggf. korrigieren.", s.estFirst && ` Firsth\xF6he gesch\xE4tzt aus Neigung ${s.segments[0]?.pitch}\xB0 \xD7 halbe Breite ${(s.hausbreite / 2).toFixed(1)}m + ${s.estTraufe}m Traufe.`), s.segments.length > 0 && /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, fontWeight: 600, marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.5 } }, "Dachsegmente"), s.segments.map((seg, i) => {
      const dir = seg.azimuth < 22 || seg.azimuth >= 338 ? "N" : seg.azimuth < 67 ? "NO" : seg.azimuth < 112 ? "O" : seg.azimuth < 157 ? "SO" : seg.azimuth < 202 ? "S" : seg.azimuth < 247 ? "SW" : seg.azimuth < 292 ? "W" : "NW";
      const isSouth = seg.azimuth >= 112 && seg.azimuth <= 247;
      return /* @__PURE__ */ React.createElement("div", { key: i, style: {
        display: "flex",
        alignItems: "center",
        gap: 12,
        padding: "8px 12px",
        background: T.surface,
        borderRadius: 8,
        border: `1px solid ${isSouth ? `${T.green}30` : T.border}`,
        marginBottom: 4
      } }, /* @__PURE__ */ React.createElement("div", { style: {
        width: 32,
        height: 32,
        borderRadius: 8,
        background: isSouth ? `${T.green}15` : `${T.red}10`,
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        fontSize: 14,
        fontWeight: 800,
        color: isSouth ? T.green : T.red
      } }, dir), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, fontSize: 12, color: T.text } }, /* @__PURE__ */ React.createElement("span", { style: { fontWeight: 600 } }, seg.area, " m\xB2"), /* @__PURE__ */ React.createElement("span", { style: { color: T.textDim } }, " \xB7 ", seg.pitch, "\xB0 Neigung \xB7 ", seg.sunshine, " h Sonne/a")), isSouth && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: T.green, fontWeight: 600 } }, "\u2713 Optimal"));
    })), s._demo && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, fontStyle: "italic", textAlign: "center" } }, "\u24D8 Demo-Daten \u2013 in der PWA mit Google Solar API-Key echte Satelliten-Analyse"), /* @__PURE__ */ React.createElement("button", { onClick: () => u("_solarData", null), style: {
      width: "100%",
      marginTop: 6,
      padding: "6px",
      borderRadius: 6,
      border: `1px solid ${T.border}`,
      background: "transparent",
      color: T.textDim,
      fontSize: 11,
      fontFamily: font,
      cursor: "pointer"
    } }, "\u{1F504} Neu analysieren"));
  })(), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(Input, { label: "Hausbreite", value: data.hausbreite || "", onChange: (v) => u("hausbreite", v), placeholder: "11", suffix: "m", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Hausl\xE4nge", value: data.hauslaenge || "", onChange: (v) => u("hauslaenge", v), placeholder: "8,5", suffix: "m", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Firsth\xF6he", value: data.firsthoehe || "", onChange: (v) => u("firsthoehe", v), placeholder: "7,5", suffix: "m", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Traufenh\xF6he", value: data.traufenhoehe || "", onChange: (v) => u("traufenhoehe", v), placeholder: "3.5", suffix: "m", half: true, type: "number" })), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 12, marginTop: 4 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1, fontSize: 10, color: T.textDim, padding: "0 2px" } }, "\u{1F53A} ", /* @__PURE__ */ React.createElement("strong", null, "Firsth\xF6he"), " = h\xF6chster Punkt des Dachs, gemessen vom Boden bis zur Dachspitze (Firstlinie)"), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, fontSize: 10, color: T.textDim, padding: "0 2px" } }, "\u25AC ", /* @__PURE__ */ React.createElement("strong", null, "Traufenh\xF6he"), " = Unterkante des Dachs, wo die Regenrinne sitzt \u2013 vom Boden bis zur Dachkante")), /* @__PURE__ */ React.createElement(TextArea, { label: "Bauseitige Aufgaben", k: "bauseitigeAufgaben", ph: "Leistungen die der Kunde vor Montage fertigstellen muss..." })), /* @__PURE__ */ React.createElement(Section, { title: "Angaben zum Dach", icon: "\u{1F3E0}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", minWidth: 200 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "Dachbesonderheiten (Mehrfachauswahl)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 6 } }, [
    { k: "vermoertelt", l: "Verm\xF6rtelte Ziegel" },
    { k: "pappdocken", l: "Pappdocken" },
    { k: "thermodach", l: "Thermodach" },
    { k: "pvDemontage", l: "Bestehende PV demontieren" },
    { k: "solarthermieDemontage", l: "Solarthermie abbauen" }
  ].map((c) => /* @__PURE__ */ React.createElement("button", { key: c.k, onClick: () => u(c.k, !data[c.k]), style: {
    padding: "7px 12px",
    borderRadius: 8,
    cursor: "pointer",
    fontFamily: font,
    border: `1.5px solid ${data[c.k] ? BRAND.yellow : T.border}`,
    background: data[c.k] ? `${BRAND.yellow}15` : T.surface,
    color: data[c.k] ? BRAND.yellow : T.textSec,
    fontSize: 12,
    fontWeight: data[c.k] ? 600 : 400,
    transition: "all 0.15s ease"
  } }, data[c.k] ? "\u2713 " : "", c.l)))), /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150, display: "flex", alignItems: "center", gap: 12, padding: "12px 16px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, cursor: "pointer" }, onClick: () => u("nordseitenbelegung", !data.nordseitenbelegung) }, /* @__PURE__ */ React.createElement("div", { style: { width: 22, height: 22, borderRadius: 6, border: `2px solid ${data.nordseitenbelegung ? T.green : T.border}`, background: data.nordseitenbelegung ? T.green : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data.nordseitenbelegung && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 12, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, color: T.text } }, "Nordseitenbelegung")), /* @__PURE__ */ React.createElement(Input, { label: "Sparrentiefe", value: data.sparrentiefe || "", onChange: (v) => u("sparrentiefe", v), placeholder: "14", suffix: "cm", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Sparrenbreite", value: data.sparrenbreite || "", onChange: (v) => u("sparrenbreite", v), placeholder: "8", suffix: "cm", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Sparrenabstand", value: data.sparrenabstand || "", onChange: (v) => u("sparrenabstand", v), placeholder: "85", suffix: "cm", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Select, { label: "Aufsparrend\xE4mmung", value: data.aufsparrendaemmung || "", onChange: (v) => u("aufsparrendaemmung", v), half: true, options: jn }), data.aufsparrendaemmung === "Ja" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", background: !data.daemmungDicke ? `${BRAND.yellow}08` : `${T.green}08`, borderRadius: 10, border: `1.5px solid ${!data.daemmungDicke ? BRAND.yellow : `${T.green}30`}`, animation: !data.daemmungDicke ? "pulseRed 2s ease-in-out infinite" : "none" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: !data.daemmungDicke ? BRAND.yellow : T.green, fontWeight: 600, marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.5 } }, data.daemmungDicke ? "\u2705 D\xE4mmung erfasst" : "\u26A1 Bitte Dicke eintragen"), /* @__PURE__ */ React.createElement(Input, { label: "Dicke D\xE4mmung", value: data.daemmungDicke || "", onChange: (v) => u("daemmungDicke", v), placeholder: "cm", suffix: "cm", half: true, type: "number", autoFocus: true })), /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150, display: "flex", alignItems: "center", gap: 12, padding: "12px 16px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, cursor: "pointer" }, onClick: () => u("flachdach", !data.flachdach) }, /* @__PURE__ */ React.createElement("div", { style: { width: 22, height: 22, borderRadius: 6, border: `2px solid ${data.flachdach ? T.green : T.border}`, background: data.flachdach ? T.green : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data.flachdach && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 12, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, color: T.text } }, "Flachdach?")), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Dachbelag",
      value: data.ziegelart || "",
      onChange: (v) => u("ziegelart", v),
      half: true,
      options: [{ value: "", label: "Keine Auswahl" }, { value: "Ton", label: "Tonziegel" }, { value: "Beton", label: "Betondachstein" }, { value: "Schiefer", label: "Schiefer" }, { value: "Blech", label: "Trapezblech" }, { value: "Bitumen", label: "Bitumen" }, { value: "Folie", label: "Folie" }]
    }
  ), /* @__PURE__ */ React.createElement(Select, { label: "Ersatzziegel vorhanden", value: data.ersatzziegel || "", onChange: (v) => u("ersatzziegel", v), half: true, options: jn }), data.ersatzziegel === "Ja" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", background: `${T.green}08`, borderRadius: 10, border: `1.5px solid ${T.green}30`, animation: !data.ersatzziegelVorhanden ? "pulseRed 2s ease-in-out infinite" : "none", borderColor: !data.ersatzziegelVorhanden ? BRAND.yellow : `${T.green}30` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: !data.ersatzziegelVorhanden ? BRAND.yellow : T.green, fontWeight: 600, marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.5 } }, data.ersatzziegelVorhanden ? "\u2705 Ersatzziegel vorhanden" : "\u26A1 Bitte Anzahl eintragen"), /* @__PURE__ */ React.createElement(Input, { label: "Anzahl vorhanden", value: data.ersatzziegelVorhanden || "", onChange: (v) => u("ersatzziegelVorhanden", v), placeholder: "z.B. 30", suffix: "Stk", half: true, type: "number", autoFocus: true })), data.ersatzziegel === "Nein" && /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", background: `${BRAND.yellow}08`, borderRadius: 10, border: `1px solid ${BRAND.yellow}25` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, fontWeight: 600, marginBottom: 8, textTransform: "uppercase", letterSpacing: 0.5 } }, "\u26A0\uFE0F Ersatzziegel m\xFCssen bestellt werden \u2013 Wer bestellt?"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, [
    { key: "Kunde", label: "\u{1F464} Kunde bestellt selbst" },
    { key: "beedoo", label: "\u{1F41D} bee-doo bestellt" }
  ].map((o) => /* @__PURE__ */ React.createElement("button", { key: o.key, onClick: () => u("ersatzziegelBesteller", o.key), style: {
    flex: 1,
    padding: "10px 12px",
    borderRadius: 10,
    border: `1.5px solid ${data.ersatzziegelBesteller === o.key ? BRAND.yellow : T.border}`,
    background: data.ersatzziegelBesteller === o.key ? `${BRAND.yellow}15` : T.surface,
    color: data.ersatzziegelBesteller === o.key ? BRAND.yellow : T.textSec,
    fontSize: 12,
    fontWeight: data.ersatzziegelBesteller === o.key ? 700 : 400,
    cursor: "pointer",
    fontFamily: font,
    transition: "all 0.15s ease"
  } }, o.label))), /* @__PURE__ */ React.createElement(Input, { label: "Ziegeltyp / Bezeichnung", value: data.ersatzziegelTyp || "", onChange: (v) => u("ersatzziegelTyp", v), placeholder: "z.B. Braas Frankfurter Pfanne, Farbe anthrazit" }), /* @__PURE__ */ React.createElement(Input, { label: "Anzahl ben\xF6tigt", value: data.ersatzziegelAnzahl || "", onChange: (v) => u("ersatzziegelAnzahl", v), placeholder: "ca. 20", suffix: "Stk", half: true, type: "number" }))), /* @__PURE__ */ React.createElement(Input, { label: "Ziegelmass Breite", value: data.ziegelBreite || "", onChange: (v) => u("ziegelBreite", v), placeholder: "20", suffix: "cm", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Ziegelmass H\xF6he", value: data.ziegelHoehe || "", onChange: (v) => u("ziegelHoehe", v), placeholder: "34", suffix: "cm", half: true, type: "number" }), /* @__PURE__ */ React.createElement(
    Input,
    {
      label: "Dachneigung",
      value: data.dachneigung || "",
      onChange: (v) => u("dachneigung", v),
      placeholder: "45",
      suffix: "\xB0",
      half: true,
      type: "number",
      error: !data.flachdach && parseInt(data.dachneigung) > 75 ? "Max 75\xB0!" : data.flachdach && parseInt(data.dachneigung) > 6 ? "Max 6\xB0 bei Flachdach!" : null
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Schneelastzone",
      value: data.schneelastzone || getSnowZone(data.plz) || "",
      onChange: (v) => u("schneelastzone", v),
      half: true,
      options: [{ value: "", label: data.plz ? `Auto: ${getSnowZone(data.plz) || "?"}` : "Ausw\xE4hlen..." }, { value: "1", label: "Zone 1" }, { value: "1a", label: "Zone 1a" }, { value: "2", label: "Zone 2" }, { value: "2a", label: "Zone 2a" }, { value: "3", label: "Zone 3" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Windzone",
      value: data.windzone || getWindZone(data.plz) || "",
      onChange: (v) => u("windzone", v),
      half: true,
      options: [{ value: "", label: data.plz ? `Auto: ${getWindZone(data.plz) || "?"}` : "Ausw\xE4hlen..." }, { value: "1", label: "Zone 1 (Binnenland)" }, { value: "2", label: "Zone 2 (Norddeutsch)" }, { value: "3", label: "Zone 3 (K\xFCste)" }, { value: "4", label: "Zone 4 (Inseln/K\xFCste)" }]
    }
  ), !data.flachdach && parseInt(data.dachneigung) > 75 && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", borderRadius: 10, background: `${T.red}12`, border: `2px solid ${T.red}`, animation: "pulseRed 1.5s ease-in-out infinite", display: "flex", alignItems: "center", gap: 10 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 20 } }, "\u{1F6A8}"), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 800, color: T.red, textTransform: "uppercase" } }, "WARNUNG: Dachneigung ", data.dachneigung, "\xB0 unrealistisch"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, marginTop: 2 } }, "Typisch: 15\u201350\xB0 bei Schr\xE4gdach. Bitte Wert pr\xFCfen oder Flachdach ausw\xE4hlen."))), data.flachdach && parseInt(data.dachneigung) > 6 && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", borderRadius: 10, background: `${T.red}12`, border: `2px solid ${T.red}`, animation: "pulseRed 1.5s ease-in-out infinite", display: "flex", alignItems: "center", gap: 10 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 20 } }, "\u{1F6A8}"), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 800, color: T.red, textTransform: "uppercase" } }, "WARNUNG: ", data.dachneigung, "\xB0 ist kein Flachdach"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, marginTop: 2 } }, "Flachdach max. 6\xB0. Bitte Neigung korrigieren oder Flachdach-Haken entfernen.")))), /* @__PURE__ */ React.createElement(TextArea, { label: "Notizen zum Dachstuhl", k: "notizenDachstuhl", ph: "" }), /* @__PURE__ */ React.createElement(TextArea, { label: "Notizen zum Dach", k: "notizenDach", ph: "z.B. Gauben sind 14 und sechseinhalb Zentimeter..." }), /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", background: `${T.blue}06`, borderRadius: 12, border: `1px solid ${T.blue}20`, marginTop: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: T.blue, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "\u{1F4D0} Dachfl\xE4chen-Rechner"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginBottom: 3 } }, "Dachl\xE4nge (m)"), /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "number",
      value: data.dachLaenge || "",
      onChange: (e) => u("dachLaenge", e.target.value),
      placeholder: "12",
      style: { width: "100%", padding: "8px 6px", background: T.surface, border: `1.5px solid ${T.border}`, borderRadius: 8, color: T.text, fontSize: 14, fontWeight: 600, fontFamily: fontMono, textAlign: "center", outline: "none", boxSizing: "border-box", WebkitAppearance: "none", MozAppearance: "textfield" }
    }
  )), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginBottom: 3 } }, "Dachbreite/H\xF6he (m)"), /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "number",
      value: data.dachBreite || "",
      onChange: (e) => u("dachBreite", e.target.value),
      placeholder: "6",
      style: { width: "100%", padding: "8px 6px", background: T.surface, border: `1.5px solid ${T.border}`, borderRadius: 8, color: T.text, fontSize: 14, fontWeight: 600, fontFamily: fontMono, textAlign: "center", outline: "none", boxSizing: "border-box", WebkitAppearance: "none", MozAppearance: "textfield" }
    }
  ))), (() => {
    const dl = parseFloat(data.dachLaenge) || 0;
    const db = parseFloat(data.dachBreite) || 0;
    if (dl === 0 || db === 0) return null;
    const flaeche = dl * db;
    const modulB = 1.134;
    const modulH = 1.722;
    const modulFlaeche = modulB * modulH;
    const abstand = 0.02;
    const colsQ = Math.floor(dl / (modulB + abstand));
    const rowsQ = Math.floor(db / (modulH + abstand));
    const colsH = Math.floor(dl / (modulH + abstand));
    const rowsH = Math.floor(db / (modulB + abstand));
    const maxModuleQ = colsQ * rowsQ;
    const maxModuleH = colsH * rowsH;
    const maxModule = Math.max(maxModuleQ, maxModuleH);
    const orientation = maxModuleQ >= maxModuleH ? "Hochkant" : "Quer";
    const maxKwp = (maxModule * 0.47).toFixed(1);
    return /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: T.surface, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Dachfl\xE4che"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: T.text, fontFamily: fontMono } }, flaeche.toFixed(1), " m\xB2")), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: T.surface, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Max. Module"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: T.green, fontFamily: fontMono } }, maxModule, " Stk"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, orientation)), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: T.surface, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Max. kWp"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: T.blue, fontFamily: fontMono } }, maxKwp)));
  })())), /* @__PURE__ */ React.createElement(Section, { title: "AC-Pr\xFCfung \xB7 Z\xE4hler", icon: "\u26A1" }, /* @__PURE__ */ React.createElement(TextArea, { label: "Notizen zum Z\xE4hler", k: "notizenZaehler", ph: "" }), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12, marginTop: 12 } }, /* @__PURE__ */ React.createElement(ZaehlerOCR, { nr: 1, label: "Z\xE4hlernummer 1", data, u, camId: "zaehlerCam1" }), /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "Z\xE4hler 1 Typ (Mehrfach)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 5 } }, [{ k: "z1Haushalt", l: "Haushaltsstrom" }, { k: "z1Eigentum", l: "Eigentum" }, { k: "z1Mieter", l: "Mieter" }, { k: "z1WP", l: "WP" }].map((c) => /* @__PURE__ */ React.createElement("button", { key: c.k, onClick: () => u(c.k, !data[c.k]), style: {
    padding: "6px 10px",
    borderRadius: 8,
    cursor: "pointer",
    fontFamily: font,
    border: `1.5px solid ${data[c.k] ? BRAND.yellow : T.border}`,
    background: data[c.k] ? `${BRAND.yellow}15` : T.surface,
    color: data[c.k] ? BRAND.yellow : T.textSec,
    fontSize: 11,
    fontWeight: data[c.k] ? 600 : 400,
    transition: "all 0.15s ease"
  } }, data[c.k] ? "\u2713 " : "", c.l))))), !data._showZaehler2 ? /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => u("_showZaehler2", true),
      style: {
        width: "100%",
        marginTop: 12,
        padding: "12px 16px",
        borderRadius: 10,
        border: `1.5px dashed ${T.border}`,
        background: "transparent",
        color: T.textSec,
        fontSize: 13,
        fontWeight: 500,
        cursor: "pointer",
        fontFamily: font,
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        gap: 8,
        transition: "all 0.15s ease"
      },
      onMouseEnter: (e) => {
        e.currentTarget.style.borderColor = BRAND.yellow;
        e.currentTarget.style.color = BRAND.yellow;
      },
      onMouseLeave: (e) => {
        e.currentTarget.style.borderColor = T.border;
        e.currentTarget.style.color = T.textSec;
      }
    },
    /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18, lineHeight: 1 } }, "\uFF0B"),
    " 2. Z\xE4hler hinzuf\xFCgen"
  ) : /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { marginTop: 14, paddingTop: 12, borderTop: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 8 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 600, color: T.textSec, letterSpacing: 0.5, textTransform: "uppercase" } }, "\u26A1 Z\xE4hler 2"), /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => {
        u("_showZaehler2", false);
        u("zaehlerNr2", "");
        u("zaehler2Typ", "");
        u("zaehlerart2", "");
        u("_showZaehler3", false);
        u("zaehlerNr3", "");
        u("zaehler3Typ", "");
        u("zaehlerart3", "");
      },
      style: { fontSize: 11, color: T.textDim, background: "none", border: "none", cursor: "pointer", fontFamily: font, textDecoration: "underline" }
    },
    "Entfernen"
  )), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(ZaehlerOCR, { nr: 2, label: "Z\xE4hlernummer 2", data, u, camId: "zaehlerCam2" }), /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "Z\xE4hler 2 Typ (Mehrfach)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 5 } }, [{ k: "z2Haushalt", l: "Haushaltsstrom" }, { k: "z2Eigentum", l: "Eigentum" }, { k: "z2Mieter", l: "Mieter" }, { k: "z2WP", l: "WP" }].map((c) => /* @__PURE__ */ React.createElement("button", { key: c.k, onClick: () => u(c.k, !data[c.k]), style: {
    padding: "6px 10px",
    borderRadius: 8,
    cursor: "pointer",
    fontFamily: font,
    border: `1.5px solid ${data[c.k] ? BRAND.yellow : T.border}`,
    background: data[c.k] ? `${BRAND.yellow}15` : T.surface,
    color: data[c.k] ? BRAND.yellow : T.textSec,
    fontSize: 11,
    fontWeight: data[c.k] ? 600 : 400,
    transition: "all 0.15s ease"
  } }, data[c.k] ? "\u2713 " : "", c.l)))))), !data._showZaehler3 ? /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => u("_showZaehler3", true),
      style: {
        width: "100%",
        marginTop: 10,
        padding: "10px 14px",
        borderRadius: 10,
        border: `1.5px dashed ${T.border}`,
        background: "transparent",
        color: T.textDim,
        fontSize: 12,
        fontWeight: 500,
        cursor: "pointer",
        fontFamily: font,
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        gap: 8,
        transition: "all 0.15s ease"
      },
      onMouseEnter: (e) => {
        e.currentTarget.style.borderColor = BRAND.yellow;
        e.currentTarget.style.color = BRAND.yellow;
      },
      onMouseLeave: (e) => {
        e.currentTarget.style.borderColor = T.border;
        e.currentTarget.style.color = T.textDim;
      }
    },
    /* @__PURE__ */ React.createElement("span", { style: { fontSize: 16, lineHeight: 1 } }, "\uFF0B"),
    " 3. Z\xE4hler hinzuf\xFCgen"
  ) : /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, paddingTop: 10, borderTop: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 8 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 600, color: T.textSec, letterSpacing: 0.5, textTransform: "uppercase" } }, "\u26A1 Z\xE4hler 3"), /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => {
        u("_showZaehler3", false);
        u("zaehlerNr3", "");
        u("zaehler3Typ", "");
        u("zaehlerart3", "");
      },
      style: { fontSize: 11, color: T.textDim, background: "none", border: "none", cursor: "pointer", fontFamily: font, textDecoration: "underline" }
    },
    "Entfernen"
  )), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(ZaehlerOCR, { nr: 3, label: "Z\xE4hlernummer 3", data, u, camId: "zaehlerCam3" }), /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "Z\xE4hler 3 Typ (Mehrfach)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 5 } }, [{ k: "z3Haushalt", l: "Haushaltsstrom" }, { k: "z3Eigentum", l: "Eigentum" }, { k: "z3Mieter", l: "Mieter" }, { k: "z3WP", l: "WP" }].map((c) => /* @__PURE__ */ React.createElement("button", { key: c.k, onClick: () => u(c.k, !data[c.k]), style: {
    padding: "6px 10px",
    borderRadius: 8,
    cursor: "pointer",
    fontFamily: font,
    border: `1.5px solid ${data[c.k] ? BRAND.yellow : T.border}`,
    background: data[c.k] ? `${BRAND.yellow}15` : T.surface,
    color: data[c.k] ? BRAND.yellow : T.textSec,
    fontSize: 11,
    fontWeight: data[c.k] ? 600 : 400,
    transition: "all 0.15s ease"
  } }, data[c.k] ? "\u2713 " : "", c.l))))))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12, marginTop: 12 } }, /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Z\xE4hlerzusammenlegung",
      value: data.zaehlerZusammenlegung || "",
      onChange: (v) => {
        u("zaehlerZusammenlegung", v);
        u("zlZ1", false);
        u("zlZ2", false);
        u("zlZ3", false);
      },
      half: true,
      options: data._showZaehler3 ? [{ value: "", label: "Keine" }, { value: "3auf1", label: "3 auf 1" }, { value: "3auf2", label: "3 auf 2" }] : data._showZaehler2 ? [{ value: "", label: "Keine" }, { value: "2auf1", label: "2 auf 1" }] : [{ value: "", label: "Keine" }]
    }
  ), data.zaehlerZusammenlegung && (() => {
    const zaehler = [
      { k: "zlZ1", nr: data.zaehlerNr || "", label: "Z\xE4hler 1" },
      data._showZaehler2 && { k: "zlZ2", nr: data.zaehlerNr2 || "", label: "Z\xE4hler 2" },
      data._showZaehler3 && { k: "zlZ3", nr: data.zaehlerNr3 || "", label: "Z\xE4hler 3" }
    ].filter(Boolean);
    const removeCount = data.zaehlerZusammenlegung === "3auf1" ? 2 : 1;
    const sel = zaehler.filter((z) => data[z.k]).length;
    return /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", background: `${T.red}06`, borderRadius: 10, border: `1px solid ${T.red}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, fontWeight: 600, marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.5 } }, "\u{1F5D1}\uFE0F Welche", removeCount > 1 ? ` ${removeCount}` : "", " Z\xE4hler ", removeCount > 1 ? "fallen" : "f\xE4llt", " weg?"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 6 } }, zaehler.map((z) => {
      const selected = data[z.k];
      const maxReached = sel >= removeCount && !selected;
      return /* @__PURE__ */ React.createElement("button", { key: z.k, onClick: () => {
        if (maxReached) return;
        u(z.k, !selected);
      }, style: {
        padding: "8px 14px",
        borderRadius: 8,
        cursor: maxReached ? "not-allowed" : "pointer",
        fontFamily: font,
        border: `1.5px solid ${selected ? T.red : T.border}`,
        background: selected ? `${T.red}12` : T.surface,
        color: selected ? T.red : T.textSec,
        fontSize: 12,
        fontWeight: selected ? 700 : 400,
        transition: "all 0.15s ease",
        opacity: maxReached ? 0.4 : 1,
        textDecoration: selected ? "line-through" : "none"
      } }, selected ? "\u2715 " : "", z.label, z.nr ? ` (${z.nr})` : "");
    })), sel < removeCount ? /* @__PURE__ */ React.createElement("div", { style: { marginTop: 6, fontSize: 10, color: BRAND.yellow } }, "\u26A0\uFE0F Noch ", removeCount - sel, " Z\xE4hler ausw\xE4hlen") : /* @__PURE__ */ React.createElement("div", { style: { marginTop: 6, fontSize: 10, color: T.green } }, "\u2705 ", sel, " Z\xE4hler zum Entfernen markiert"));
  })(), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Hauptsicherung",
      value: data.hauptsicherung || "",
      onChange: (v) => u("hauptsicherung", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "25", label: "25A" }, { value: "35", label: "35A" }, { value: "50", label: "50A" }, { value: "63", label: "63A" }]
    }
  ))), /* @__PURE__ */ React.createElement(Section, { title: "Z\xE4hlerschrank & Unterverteilung", icon: "\u{1F50C}" }, /* @__PURE__ */ React.createElement(AIHint, { text: "Alle ZK Fotos scharf (hohe Aufl\xF6sung), jede Sicherung erkennbar. SLS per Nahaufnahme. Bei WP \u2192 Typenschild abfotografieren.", color: T.red }), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12, marginTop: 8 } }, /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Z\xE4hlerschrank Ort",
      value: data.zaehlerOrt || "",
      onChange: (v) => u("zaehlerOrt", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "KG", label: "KG (Keller)" }, { value: "EG", label: "EG" }, { value: "OG", label: "OG" }, { value: "Garage", label: "Garage" }, { value: "Aussen", label: "Au\xDFen" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Z\xE4hlerschrank Art",
      value: data.zaehlerSchankArt || "",
      onChange: (v) => u("zaehlerSchankArt", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Aufputz", label: "Aufputz" }, { value: "Unterputz", label: "Unterputz" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Z\xE4hlerfeld-Typ",
      value: data.zaehlerFeldTyp || "",
      onChange: (v) => u("zaehlerFeldTyp", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "eHZ", label: "eHZ (elektronisch)" }, { value: "3Punkt", label: "Dreipunkt-Befestigung" }, { value: "BKE", label: "BKE-I Adapter" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "SLS vorhanden",
      value: data.slsVorhanden || "",
      onChange: (v) => u("slsVorhanden", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "35A", label: "SLS 35A" }, { value: "50A", label: "SLS 50A" }, { value: "63A", label: "SLS 63A" }, { value: "Nein", label: "Kein SLS" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "APZ-Feld vorhanden",
      value: data.apzVorhanden || "",
      onChange: (v) => u("apzVorhanden", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Ja", label: "\u2705 Ja \u2013 APZ vorhanden" }, { value: "Nein", label: "\u274C Nein \u2013 fehlt" }, { value: "Unklar", label: "\u2753 Unklar / nicht erkennbar" }]
    }
  ), (data.apzVorhanden === "Nein" || data.apzVorhanden === "Unklar") && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "12px 16px", borderRadius: 12, background: `${T.red}08`, border: `2px solid ${T.red}40` } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, marginBottom: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 20 } }, "\u{1F6A8}"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, color: T.red, fontWeight: 700 } }, "Z\xE4hlerschrank nicht VDE-konform!")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, lineHeight: 1.6 } }, "APZ-Feld nach ", /* @__PURE__ */ React.createElement("strong", { style: { color: T.red } }, "VDE AR-N 4100"), " (TAR Niederspannung) fehlt oder nicht erkennbar. F\xFCr die PV-Netzanmeldung ist ein normkonformer Z\xE4hlerplatz mit APZ zwingend erforderlich."), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, padding: "8px 12px", background: T.surface, borderRadius: 8, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, textTransform: "uppercase", fontWeight: 600, marginBottom: 4 } }, "Nachr\xFCstung erforderlich"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.text, lineHeight: 1.5 } }, "Z\xE4hlerschranktausch oder -erweiterung mit APZ-Feld \xB7 SLS-Schalter pr\xFCfen \xB7 \xDCberspannungsschutz Typ 2 \xB7 Gesch\xE4tzte Kosten: 800\u20132.500 \u20AC")), (() => {
    const kunde = `${data.anrede || ""} ${data.vorname || ""} ${data.nachname || ""}`.trim() || "\u2013";
    const adresse = data.strasse ? `${data.strasse} ${data.hausnummer || ""}, ${data.plz || ""} ${data.ort || ""}` : "\u2013";
    const zaehlerNr = data.zaehlerNr || "\u2013";
    const slsInfo = data.slsVorhanden ? `SLS: ${data.slsVorhanden === "Nein" ? "\u274C Fehlt" : data.slsVorhanden}` : "SLS: nicht gepr\xFCft";
    const netzInfo = data.netzform ? `Netzform: ${data.netzform}` : "";
    const ueberspInfo = data.ueberspannungsschutz ? `\xDCSS: ${data.ueberspannungsschutz}` : "";
    const zsOrt = data.zaehlerOrt ? `ZS-Ort: ${data.zaehlerOrt}` : "";
    const zsArt = data.zaehlerSchankArt ? `ZS-Art: ${data.zaehlerSchankArt}` : "";
    const feldTyp = data.zaehlerFeldTyp ? `Z\xE4hlerfeld: ${data.zaehlerFeldTyp}` : "";
    const apzStatus = data.apzVorhanden === "Nein" ? "\u274C APZ fehlt" : "\u2753 APZ unklar";
    const berater = data._beraterName || "Berater";
    const msgLines = [
      `\u{1F6A8} APZ-Pr\xFCfung ben\xF6tigt`,
      ``,
      `Kunde: ${kunde}`,
      `Adresse: ${adresse}`,
      `Z\xE4hler-Nr: ${zaehlerNr}`,
      ``,
      `\u26A1 Status:`,
      `APZ-Feld: ${apzStatus}`,
      slsInfo,
      netzInfo,
      ueberspInfo,
      zsOrt,
      zsArt,
      feldTyp,
      ``,
      `Bitte pr\xFCfen ob Z\xE4hlerschranktausch/-erweiterung mit APZ n\xF6tig.`,
      `VDE AR-N 4100 / TAR Niederspannung`,
      ``,
      `\u{1F4F8} Foto vom ZS im Anhang / Google Drive`,
      `Berater: ${berater}`
    ].filter(Boolean).join("\n");
    const emailSubject = `APZ-Pr\xFCfung \u2013 ${kunde} \u2013 ${data.plz || ""} ${data.ort || ""}`;
    const emailBody = msgLines;
    const waMsg = encodeURIComponent(msgLines);
    const acNr = data._acNr || data._acEmail || "";
    const acEmail = data._acEmail || "";
    const waNumber = acNr ? acNr.replace(/[\s\-\/\(\)]/g, "").replace(/^\+/, "") : "";
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.red, fontWeight: 700, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 6 } }, "\u{1F4E4} AC-Team benachrichtigen"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement(
      "input",
      {
        type: "tel",
        value: data._acNr || "",
        onChange: (e) => u("_acNr", e.target.value),
        placeholder: "AC-Team Mobilnr.",
        style: { width: "100%", padding: "8px 10px", background: T.surface, border: `1px solid ${T.border}`, borderRadius: 6, color: T.text, fontSize: 11, fontFamily: fontMono, outline: "none", boxSizing: "border-box" }
      }
    )), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement(
      "input",
      {
        type: "email",
        value: data._acEmail || "",
        onChange: (e) => u("_acEmail", e.target.value),
        placeholder: "AC-Team E-Mail",
        style: { width: "100%", padding: "8px 10px", background: T.surface, border: `1px solid ${T.border}`, borderRadius: 6, color: T.text, fontSize: 11, fontFamily: font, outline: "none", boxSizing: "border-box" }
      }
    ))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement(
      "a",
      {
        href: waNumber ? `https://wa.me/${waNumber}?text=${waMsg}` : `https://wa.me/?text=${waMsg}`,
        target: "_blank",
        rel: "noopener noreferrer",
        style: {
          flex: 1,
          padding: "12px",
          borderRadius: 10,
          textDecoration: "none",
          textAlign: "center",
          background: "linear-gradient(135deg, #25D366, #128C7E)",
          color: "#fff",
          fontSize: 13,
          fontWeight: 700,
          fontFamily: font,
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          gap: 6
        }
      },
      "\u{1F4AC} WhatsApp"
    ), /* @__PURE__ */ React.createElement(
      "a",
      {
        href: `mailto:${acEmail}?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`,
        style: {
          flex: 1,
          padding: "12px",
          borderRadius: 10,
          textDecoration: "none",
          textAlign: "center",
          background: `linear-gradient(135deg, ${T.blue}, #1D4ED8)`,
          color: "#fff",
          fontSize: 13,
          fontWeight: 700,
          fontFamily: font,
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          gap: 6
        }
      },
      "\u2709\uFE0F E-Mail"
    )), data._apzGesendet ? /* @__PURE__ */ React.createElement("div", { style: { marginTop: 6, fontSize: 11, color: T.green, fontWeight: 600, textAlign: "center" } }, "\u2705 AC-Team wurde benachrichtigt") : /* @__PURE__ */ React.createElement("button", { onClick: () => u("_apzGesendet", true), style: {
      width: "100%",
      marginTop: 6,
      padding: "8px",
      borderRadius: 8,
      border: `1px solid ${T.border}`,
      background: T.surface,
      color: T.textSec,
      fontSize: 10,
      fontFamily: font,
      cursor: "pointer"
    } }, "\u2713 Als gesendet markieren"));
  })()), data.apzVorhanden === "Ja" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", borderRadius: 10, background: `${T.green}08`, border: `1.5px solid ${T.green}30` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: T.green, fontWeight: 600 } }, "\u2705 APZ-Feld vorhanden \u2013 Z\xE4hlerschrank VDE AR-N 4100 konform")), data.slsVorhanden === "Nein" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", borderRadius: 10, background: `${BRAND.yellow}08`, border: `1.5px solid ${BRAND.yellow}30` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: BRAND.yellow, fontWeight: 600 } }, "\u26A0\uFE0F SLS muss nachger\xFCstet werden \u2013 Netzbetreiber kontaktieren")), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Netzform",
      value: data.netzform || "",
      onChange: (v) => u("netzform", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "TN-C-S", label: "TN-C-S (Standard)" }, { value: "TN-C", label: "TN-C (Altbau)" }, { value: "TN-S", label: "TN-S" }, { value: "TT", label: "TT-Netz" }, { value: "unklar", label: "Unklar \u2013 Elektriker pr\xFCfen" }]
    }
  ), data.netzform === "TN-C" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", borderRadius: 10, background: `${BRAND.yellow}08`, border: `1.5px solid ${BRAND.yellow}30` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: BRAND.yellow, fontWeight: 600 } }, "\u26A0\uFE0F TN-C: PEN-Auftrennung auf TN-C-S erforderlich vor PV-Installation")), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "\xDCberspannungsschutz",
      value: data.ueberspannungsschutz || "",
      onChange: (v) => u("ueberspannungsschutz", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Typ1+2", label: "Typ 1 + 2 vorhanden" }, { value: "Typ2", label: "Nur Typ 2" }, { value: "Typ1", label: "Nur Typ 1" }, { value: "Nein", label: "Nicht vorhanden" }]
    }
  ), (data.ueberspannungsschutz === "Nein" || data.ueberspannungsschutz === "Typ1") && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", borderRadius: 10, background: `${T.red}08`, border: `1.5px solid ${T.red}30` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: T.red, fontWeight: 600 } }, "\u{1F6A8} \xDCberspannungsschutz Typ 2 nachr\xFCsten \u2013 Pflicht bei PV nach VDE AR-N 4100")), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Potentialausgleich",
      value: data.potentialausgleich || "",
      onChange: (v) => u("potentialausgleich", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Keller", label: "Im Keller" }, { value: "ZS", label: "Raum Z\xE4hlerschrank" }, { value: "Nicht", label: "Nicht vorhanden" }]
    }
  ))), /* @__PURE__ */ React.createElement(Section, { title: "Kabelweg", icon: "\u{1F517}" }, /* @__PURE__ */ React.createElement(AIHint, { text: "Bei Kabelweg durch Leerrohr: Mindestdurchmesser 30mm beachten!", color: T.red }), /* @__PURE__ */ React.createElement(TextArea, { label: "Notizen Kabelweg", k: "notizenKabelweg", ph: "" }), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12, marginTop: 8 } }, /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Kabelweg Au\xDFen",
      value: data.kabelwegAussen || "",
      onChange: (v) => u("kabelwegAussen", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Kamin", label: "Kamin" }, { value: "Fassade", label: "Fassade" }, { value: "Leerrohr", label: "Leerrohr" }, { value: "Sonstig", label: "Sonstiges" }]
    }
  ), data.kabelwegAussen === "Kamin" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "12px 16px", borderRadius: 10, background: `${T.red}08`, border: `1.5px solid ${T.red}30`, animation: "pulseRed 2s ease-in-out infinite" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: T.red, marginBottom: 4 } }, "\u{1F6A8} Stilllegungsbescheinigung erforderlich"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: T.textSec, lineHeight: 1.6 } }, "F\xFCr die Nutzung des Kamins als Kabelweg muss eine ", /* @__PURE__ */ React.createElement("span", { style: { fontWeight: 700, color: T.red } }, "Stilllegungsbescheinigung des Bezirksschornsteinfegers"), " kundenseitig vorliegen. Ohne Bescheinigung darf der Kaminzug nicht als Kabelschacht verwendet werden."), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, display: "flex", alignItems: "center", gap: 8 } }, /* @__PURE__ */ React.createElement("button", { onClick: () => u("kaminStilllegung", !data.kaminStilllegung), style: {
    padding: "8px 14px",
    borderRadius: 8,
    cursor: "pointer",
    fontFamily: font,
    border: `1.5px solid ${data.kaminStilllegung ? T.green : T.red}`,
    background: data.kaminStilllegung ? `${T.green}12` : T.surface,
    color: data.kaminStilllegung ? T.green : T.red,
    fontSize: 12,
    fontWeight: 700,
    transition: "all 0.15s ease"
  } }, data.kaminStilllegung ? "\u2705 Bescheinigung liegt vor" : "\u2B1C Bescheinigung liegt vor"), !data.kaminStilllegung && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.red, fontWeight: 500 } }, "Kunde muss Bescheinigung beibringen!"))), /* @__PURE__ */ React.createElement(Input, { label: "Anzahl Durchbr\xFCche", value: data.durchbrueche || "", onChange: (v) => u("durchbrueche", v), placeholder: "1", half: true, type: "number" }), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Internet am Aufstellort",
      value: data.internetInfo || "",
      onChange: (v) => u("internetInfo", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "WLAN", label: "W-LAN am Aufstellort" }, { value: "LAN", label: "LAN-Anschluss" }, { value: "Kein", label: "Kein Internet" }]
    }
  )), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, fontSize: 12, color: T.textSec, lineHeight: 1.6, padding: "8px 12px", background: T.surface, borderRadius: 8 } }, "\u2013 \xDCber/neben WR/Speicher min. 30cm Abstand", "\n", "\u2013 Ma\xDFe neuer Z\xE4hlerschrank (ca. 60 \xD7 100 cm)")), /* @__PURE__ */ React.createElement(Section, { title: "Aufstellort WR / Speicher", icon: "\u{1F4D0}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Aufstellort",
      value: data.aufstellortWR || "",
      onChange: (v) => u("aufstellortWR", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Keller", label: "Keller" }, { value: "Garage", label: "Garage" }, { value: "HWR", label: "Hauswirtschaftsraum" }, { value: "Dachboden", label: "Dachboden" }, { value: "Aussen", label: "Au\xDFenwand" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Raumtemperatur",
      value: data.aufstellortTemp || "",
      onChange: (v) => u("aufstellortTemp", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "beheizt", label: "Beheizt (>15\xB0C)" }, { value: "frostfrei", label: "Frostfrei (5\u201315\xB0C)" }, { value: "unbeheizt", label: "Unbeheizt / Frost m\xF6glich" }]
    }
  ), data.aufstellortTemp === "unbeheizt" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", borderRadius: 10, background: `${T.red}08`, border: `1.5px solid ${T.red}30` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: T.red, fontWeight: 600 } }, "\u{1F6A8} Batterie-Speicher nur frostfrei betreiben! Alternativ beheizten Raum w\xE4hlen oder Heizmatte vorsehen.")), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Bel\xFCftung",
      value: data.aufstellortBelueftung || "",
      onChange: (v) => u("aufstellortBelueftung", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Fenster", label: "Fenster vorhanden" }, { value: "Lueftung", label: "L\xFCftungsanlage" }, { value: "Keine", label: "Keine Bel\xFCftung" }]
    }
  ), data.aufstellortBelueftung === "Keine" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", borderRadius: 10, background: `${BRAND.yellow}08`, border: `1.5px solid ${BRAND.yellow}30` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: BRAND.yellow, fontWeight: 600 } }, "\u26A0\uFE0F Bel\xFCftung empfohlen \u2013 Brandschutzanforderung f\xFCr LFP-Speicher beachten")), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Wandbeschaffenheit",
      value: data.aufstellortWand || "",
      onChange: (v) => u("aufstellortWand", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Beton", label: "Beton / Mauerwerk" }, { value: "Rigips", label: "Rigips / Trockenbauwand" }, { value: "Holz", label: "Holzwand" }, { value: "Sonstig", label: "Sonstiges" }]
    }
  ), data.aufstellortWand === "Rigips" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", borderRadius: 10, background: `${BRAND.yellow}08`, border: `1.5px solid ${BRAND.yellow}30` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: BRAND.yellow, fontWeight: 600 } }, "\u26A0\uFE0F Rigips: Schwerlastd\xFCbel oder Traverse erforderlich f\xFCr WR-Montage (ca. 25\u201335 kg)")), data.aufstellortWand === "Holz" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", borderRadius: 10, background: `${BRAND.yellow}08`, border: `1.5px solid ${BRAND.yellow}30` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: BRAND.yellow, fontWeight: 600 } }, "\u26A0\uFE0F Holzwand: Brandschutzmatte zwischen Speicher und Wand empfohlen")), /* @__PURE__ */ React.createElement(Input, { label: "Kabelweg-L\xE4nge WR \u2192 ZS", value: data.kabellaengeWRZS || "", onChange: (v) => u("kabellaengeWRZS", v), placeholder: "ca.", suffix: "m", half: true, type: "number" })), /* @__PURE__ */ React.createElement(TextArea, { label: "Notizen Aufstellort", k: "notizenAufstellort", ph: "z.B. Platz links neben Heizung, 30cm frei..." })), /* @__PURE__ */ React.createElement(Section, { title: "Durchlauferhitzer & HAK", icon: "\u{1F525}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(Select, { label: "Durchlauferhitzer?", value: data.durchlauferhitzer || "", onChange: (v) => {
    u("durchlauferhitzer", v);
    if (v === "Ja") u("gvDLE", true);
    else u("gvDLE", false);
  }, half: true, options: jn }), data.durchlauferhitzer === "Ja" && /* @__PURE__ */ React.createElement(Input, { label: "Anzahl Durchlauferhitzer", value: data.durchlauferhitzerAnz || "", onChange: (v) => u("durchlauferhitzerAnz", v), placeholder: "1", half: true, type: "number" }), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Ort HAK",
      value: data.ortHAK || "",
      onChange: (v) => u("ortHAK", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Haus", label: "Im Haus" }, { value: "Keller", label: "Im Keller" }, { value: "Aussen", label: "Au\xDFen" }, { value: "Garage", label: "Garage" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Leitungsquerschnitt HAK \u2192 ZS",
      value: data.leitungsquerschnitt || "",
      onChange: (v) => u("leitungsquerschnitt", v),
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "10", label: "10 mm\xB2" }, { value: "16", label: "16 mm\xB2" }, { value: "25", label: "25 mm\xB2 (Standard)" }, { value: "35", label: "35 mm\xB2" }, { value: "50", label: "50 mm\xB2" }, { value: "unklar", label: "Nicht erkennbar" }]
    }
  )), /* @__PURE__ */ React.createElement(TextArea, { label: "Hinweis Ort HAK", k: "hinweisHAK", ph: "" }), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 12 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 8, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "\u26A1 Gro\xDFverbraucher vorhanden?"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 8 } }, [
    { key: "gvPool", label: "\u{1F3CA} Pool" },
    { key: "gvSauna", label: "\u{1F9D6} Sauna" },
    { key: "gvWhirlpool", label: "\u{1F6C1} Whirlpool" },
    { key: "gvWallbox", label: "\u{1F50C} Wallbox" },
    { key: "gvWerkstatt", label: "\u{1F527} Werkstatt" },
    { key: "gvKlima", label: "\u2744\uFE0F Klimaanlage" },
    { key: "gvServer", label: "\u{1F5A5}\uFE0F Server" },
    { key: "gvGewerbe", label: "\u{1F3E2} Gewerbe" },
    { key: "gvDLE", label: "\u{1F6BF} Durchlauferhitzer" },
    { key: "gvSonstiges", label: "\u{1F4CB} Sonstiges" }
  ].map((gv) => {
    const active = gv.key === "gvDLE" ? data.gvDLE || data.durchlauferhitzer === "Ja" : data[gv.key];
    return /* @__PURE__ */ React.createElement(
      "button",
      {
        key: gv.key,
        onClick: () => {
          u(gv.key, !active);
          if (gv.key === "gvDLE") {
            if (!active) {
              u("durchlauferhitzer", "Ja");
            } else {
              u("durchlauferhitzer", "");
            }
          }
        },
        style: {
          padding: "8px 14px",
          borderRadius: 10,
          border: `1.5px solid ${active ? BRAND.yellow : T.border}`,
          background: active ? `${BRAND.yellow}15` : T.surface,
          color: active ? BRAND.yellow : T.textSec,
          fontSize: 13,
          fontWeight: active ? 600 : 400,
          cursor: "pointer",
          fontFamily: font,
          transition: "all 0.15s ease"
        }
      },
      gv.label
    );
  })), data.gvSonstiges && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10 } }, /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "text",
      value: data.gvSonstigesText || "",
      onChange: (e) => u("gvSonstigesText", e.target.value),
      placeholder: "Welcher Gro\xDFverbraucher?",
      style: {
        width: "100%",
        padding: "12px 16px",
        background: T.surface,
        border: `1.5px solid ${T.border}`,
        borderRadius: 10,
        color: T.text,
        fontSize: 15,
        fontFamily: font,
        outline: "none",
        boxSizing: "border-box"
      }
    }
  )), (data.gvPool || data.gvSauna || data.gvWhirlpool || data.gvWallbox || data.gvWerkstatt || data.gvKlima || data.gvServer || data.gvGewerbe || data.gvDLE || data.gvSonstiges) && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, fontSize: 11, color: T.green } }, "\u2705 ", [
    data.gvPool && "Pool",
    data.gvSauna && "Sauna",
    data.gvWhirlpool && "Whirlpool",
    data.gvWallbox && "Wallbox",
    data.gvWerkstatt && "Werkstatt",
    data.gvKlima && "Klimaanlage",
    data.gvServer && "Server",
    data.gvGewerbe && "Gewerbe",
    data.gvDLE && "Durchlauferhitzer",
    data.gvSonstiges && (data.gvSonstigesText || "Sonstiges")
  ].filter(Boolean).join(", "))), /* @__PURE__ */ React.createElement(TextArea, { label: "Bauseitige Aufgaben Kunde", k: "bauseitigeAufgabenKunde", ph: "Leistungen vor Montage..." })), /* @__PURE__ */ React.createElement(Section, { title: "Notizen / Besonderheiten", icon: "\u{1F4DD}" }, /* @__PURE__ */ React.createElement(TextArea, { label: "Allgemeine Notizen", k: "notizen", ph: "Besonderheiten, Verschattung, Baumbestand, Denkmalschutz..." })), /* @__PURE__ */ React.createElement(ARSpeicherView, { data, setData }));
}
function StepAngebot({ data, setData }) {
  const u = (k, v) => setData((d) => ({ ...d, [k]: v }));
  const jn = [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Ja", label: "Ja" }, { value: "Nein", label: "Nein" }];
  const sv = parseInt(data.stromverbrauch) || 0;
  const zv = parseInt(data.zusatzVerbrauch) || 0;
  const gesamt = sv + zv;
  const modulAnz = parseInt(data.modulAnzahl) || 0;
  const pricingRow = getPricing(modulAnz);
  const baseAkku2 = pricingRow ? pricingRow[2] : 0;
  const systemPreis = pricingRow ? pricingRow[3] : 0;
  const wrTyp = pricingRow ? pricingRow[4] : "";
  const zsMatch = (data.zusatzSpeicher || "").match(/^([\d.]+)_(\d+)$/);
  const zsSize = zsMatch ? parseFloat(zsMatch[1]) : 0;
  const zsCount = zsMatch ? parseInt(zsMatch[2]) : 0;
  const zsKwh2 = zsSize * zsCount;
  const zsCost = zsSize === 3.2 ? zsCount * 1500 : zsSize === 4.92 ? zsCount * 2e3 : 0;
  const speicherKwh = baseAkku2 + zsKwh2;
  const kwpCalc = modulAnz * 0.47;
  const zlAng = data.zaehlerZusammenAng;
  const zlRemoveCount = zlAng === "3auf1" ? 2 : zlAng === "3auf2" ? 1 : zlAng === "2auf1" ? 1 : 0;
  const zwAnz = data.zwischenzaehlerAng === "Ja" ? Math.max(1, parseInt(data.zwischenzaehlerAngAnzahl) || 1) : 0;
  const extraLines = [];
  if (zsCount > 0) extraLines.push({ l: `Zusatzspeicher ${zsSize === 3.2 ? "3,2" : "4,92"} kWh \xD7 ${zsCount}`, v: zsCost, typ: "netto" });
  if (data.vermoertelt && kwpCalc > 0) extraLines.push({ l: `Verm\xF6rtelte Ziegel (${kwpCalc.toFixed(1)} kWp \xD7 100 \u20AC)`, v: Math.round(kwpCalc * 100), typ: "netto" });
  if (data.pappdocken && kwpCalc > 0) extraLines.push({ l: `Pappdocken (${kwpCalc.toFixed(1)} kWp \xD7 100 \u20AC)`, v: Math.round(kwpCalc * 100), typ: "netto" });
  if (data.thermodach && kwpCalc > 0) extraLines.push({ l: `Thermodach (${kwpCalc.toFixed(1)} kWp \xD7 300 \u20AC)`, v: Math.round(kwpCalc * 300), typ: "netto" });
  if ((data.pvDemontage || data.solarthermieDemontage) && modulAnz > 0) extraLines.push({ l: `Entfernung PV/Thermie (${modulAnz} Mod. \xD7 50 \u20AC)`, v: modulAnz * 50, typ: "brutto" });
  if (data.geruestAufschlag) extraLines.push({ l: "Ger\xFCst ab Traufenh\xF6he 6 m", v: 995, typ: "brutto" });
  if (data.wantWallbox) extraLines.push({ l: "Wallbox inkl. Montage", v: 1300, typ: "brutto" });
  if (zlRemoveCount > 0) extraLines.push({ l: `Z\xE4hlerzusammenlegung (${zlRemoveCount}\xD7 150 \u20AC)`, v: zlRemoveCount * 150, typ: "" });
  if (zwAnz > 0) extraLines.push({ l: `Zwischenz\xE4hler \xD7 ${zwAnz}`, v: zwAnz * 100, typ: "" });
  const extraTotal = extraLines.reduce((s, x) => s + x.v, 0);
  const gesamtPreis = systemPreis + extraTotal;
  const montageAnteil = Math.round(gesamtPreis * 0.25);
  const steuerbonus = Math.min(1200, Math.round(montageAnteil * 0.2));
  const steuerbonusMtl = Math.round(steuerbonus / 12);
  const ap2 = parseFloat(data.strompreis) || 33;
  const gp = parseFloat(data.grundpreis) || 16;
  const stromkostenJahr = gesamt * ap2 / 100 + gp * 12;
  const stromkostenMonat = stromkostenJahr / 12;
  const dynTarifAktiv2 = !!data.dynStromtarif;
  const dynAP2 = dynTarifAktiv2 ? parseFloat(data.dynStrompreis) || 26 : ap2;
  const par14Aktiv = !!data.par14;
  const par14ErstattungJahr = par14Aktiv ? parseFloat(data.par14Erstattung) || 160 : 0;
  const solarReg = getSolarRegion(data.plz);
  const kwpAnlage = modulAnz * 0.47;
  const vMorgen = (parseFloat(data.verschattungMorgen) || 0) / 100;
  const vMittag = (parseFloat(data.verschattungMittag) || 0) / 100;
  const vNachm = (parseFloat(data.verschattungNachm) || 0) / 100;
  const verschattungsFaktor = 1 - (vMorgen * 0.25 + vMittag * 0.5 + vNachm * 0.25);
  const pvErzeugung = Math.round(kwpAnlage * solarReg.ertrag * verschattungsFaktor);
  const tagesVerbrauchAnteil = 0.55;
  const nachtVerbrauchAnteil = 0.45;
  const akkuNutzbar = speicherKwh * 0.9;
  const akkuVerluste = 0.08;
  const tagesVerbrauchKwh = gesamt / 365;
  const nachtVerbrauchKwh = tagesVerbrauchKwh * nachtVerbrauchAnteil;
  const empfohlenerAkku = Math.round(nachtVerbrauchKwh / 0.9 * 10) / 10;
  const akkuBewertung = speicherKwh === 0 ? "kein" : speicherKwh < empfohlenerAkku * 0.7 ? "klein" : speicherKwh > empfohlenerAkku * 1.6 ? "gross" : "optimal";
  const verbrauchMonat = gesamt / 12;
  const monatsDetail = MONTHLY_PV.map((m) => {
    const pvM = Math.round(pvErzeugung * m.pct);
    const tage = 30;
    const pvTag = pvM / tage;
    const verbrTag = verbrauchMonat / tage;
    const verbrTagTag = verbrTag * tagesVerbrauchAnteil;
    const verbrNacht = verbrTag * nachtVerbrauchAnteil;
    const gleichzeitig = 0.4;
    const direktTag = Math.min(pvTag, verbrTagTag) * gleichzeitig + Math.min(Math.max(0, pvTag - verbrTagTag * gleichzeitig), verbrTagTag * (1 - gleichzeitig)) * 0.3;
    const direktM = Math.round(direktTag * tage);
    const ueberschussTag = Math.max(0, pvTag - direktTag);
    const akkuLadungTag = Math.min(ueberschussTag * (1 - akkuVerluste), akkuNutzbar);
    const akkuEntladungNacht = Math.min(akkuLadungTag, verbrNacht);
    const akkuM = Math.round(akkuEntladungNacht * tage);
    const eigenM = direktM + akkuM;
    const restM = Math.max(0, Math.round(verbrauchMonat) - eigenM);
    const einspeiseM = Math.max(0, pvM - direktM - Math.round(akkuLadungTag * tage));
    return { ...m, pv: pvM, eigen: eigenM, direkt: direktM, akku: akkuM, rest: restM, einspeisung: einspeiseM };
  });
  const eigenverbrauch = monatsDetail.reduce((s, m) => s + m.eigen, 0);
  const eigenverbrauchDirekt = monatsDetail.reduce((s, m) => s + m.direkt, 0);
  const eigenverbrauchAkku = monatsDetail.reduce((s, m) => s + m.akku, 0);
  const restStrom = monatsDetail.reduce((s, m) => s + m.rest, 0);
  const einspeisung = monatsDetail.reduce((s, m) => s + m.einspeisung, 0);
  const eigenverbrauchQuote = pvErzeugung > 0 ? eigenverbrauch / pvErzeugung : 0;
  const autarkiegrad = gesamt > 0 ? eigenverbrauch / gesamt : 0;
  const restKosten = restStrom * ap2 / 100 + gp * 12;
  const einspeiseverguetung = einspeisung * 0.0778;
  const ersparnisJahr = stromkostenJahr - restKosten + einspeiseverguetung;
  const eigenOhneAkku = monatsDetail.reduce((s, m) => s + m.direkt, 0);
  const autarkieOhneAkku = gesamt > 0 ? eigenOhneAkku / gesamt : 0;
  const restOhneAkku = gesamt - eigenOhneAkku;
  const restKostenOhneAkku = restOhneAkku * ap2 / 100 + gp * 12;
  const akkuMehrwertJahr = Math.round(restKostenOhneAkku - restKosten);
  const restZukaufJahr = restStrom;
  const restZukaufKosten = Math.round(restStrom * dynAP2 / 100 + gp * 12);
  const restZukaufMonat = Math.round(restZukaufKosten / 12);
  const einspeisungJahrCalc = einspeisung;
  const einspeisungsErloes = Math.round(einspeisung * 0.0778);
  const einspeisungsErloesMtl = Math.round(einspeisungsErloes / 12);
  const par14ErstattungMtl = Math.round(par14ErstattungJahr / 12);
  const stromSteigerung = (parseFloat(data.stromSteigerung) || 4) / 100;
  const projektJahre = 25;
  let ohnePV25 = 0;
  for (let y = 0; y < projektJahre; y++) {
    const apY = ap2 * Math.pow(1 + stromSteigerung, y);
    ohnePV25 += gesamt * apY / 100 + gp * 12;
  }
  let mitPVStrom25 = 0;
  for (let y = 0; y < projektJahre; y++) {
    const dynAPy = dynAP2 * Math.pow(1 + stromSteigerung, y);
    mitPVStrom25 += restStrom * dynAPy / 100 + gp * 12;
  }
  const einspeisung25 = einspeisungsErloes * projektJahre;
  const par14_25 = par14ErstattungJahr * projektJahre;
  const mitPVGesamt25 = gesamtPreis + mitPVStrom25 - einspeisung25 - par14_25 - steuerbonus;
  const ersparnis25 = ohnePV25 - mitPVGesamt25;
  let amortJahreDyn = projektJahre;
  let kumuliertOhne = 0, kumuliertMit = gesamtPreis;
  for (let y = 0; y < projektJahre; y++) {
    const apY = ap2 * Math.pow(1 + stromSteigerung, y);
    const dynAPy = dynAP2 * Math.pow(1 + stromSteigerung, y);
    kumuliertOhne += gesamt * apY / 100 + gp * 12;
    kumuliertMit += restStrom * dynAPy / 100 + gp * 12 - einspeisungsErloes - par14ErstattungJahr - (y === 0 ? steuerbonus : 0);
    if (kumuliertOhne >= kumuliertMit && amortJahreDyn === projektJahre) {
      amortJahreDyn = y + 1;
    }
  }
  const zinsAktuell = parseFloat(data.zins) || 5.99;
  const finanzOptionen = [10, 15, 20, 25].map((j) => {
    const z = zinsAktuell / 100 / 12;
    const kr = Math.max(0, gesamtPreis);
    const rateM = kr > 0 && z > 0 ? kr * z / (1 - Math.pow(1 + z, -(j * 12))) : kr / (j * 12);
    const totalFinanz = Math.round(rateM * j * 12);
    const zinskosten = totalFinanz - kr;
    let total25 = 0;
    for (let y = 0; y < projektJahre; y++) {
      const dynAPy = dynAP2 * Math.pow(1 + stromSteigerung, y);
      const stromY = restStrom * dynAPy / 100 + gp * 12;
      const rateY = y < j ? rateM * 12 : 0;
      total25 += rateY + stromY - einspeisungsErloes - par14ErstattungJahr - (y === 0 ? steuerbonus : 0);
    }
    const ersparnis = ohnePV25 - total25;
    const monatRate = Math.round(rateM);
    const monatNachher = monatRate + restZukaufMonat - einspeisungsErloesMtl - par14ErstattungMtl - steuerbonusMtl;
    return { j, rateM: monatRate, totalFinanz, zinskosten, total25: Math.round(total25), ersparnis: Math.round(ersparnis), monatNachher };
  });
  const besteOption = finanzOptionen.reduce((a, b) => b.ersparnis > a.ersparnis ? b : a, finanzOptionen[0]);
  const evKmJ = parseFloat(data.evKilometer) || 0;
  const evVerb = parseFloat(data.evVerbrauch) || 0;
  const evHome = parseFloat(data.evHomePercent) || 80;
  const evKwhHome = Math.round(evKmJ * evVerb / 100 * evHome / 100);
  const hasEVData = evKmJ > 0 && evVerb > 0;
  const benzinVerbr = parseFloat(data.benzinVerbrauch) || 7.5;
  const evBenzinKosten = Math.round(evKmJ / 100 * benzinVerbr * 1.75);
  const evPVKosten = Math.round(evKwhHome * 0.0778);
  const evSparJahr = evBenzinKosten - evPVKosten;
  const canvasRef = useRef(null);
  const [viewMode, setViewMode] = useState("sat");
  const [tickSec, setTickSec] = useState(0);
  const [anlageZins, setAnlageZins] = useState(data._anlageZins || "3.5");
  const [mietRate, setMietRate] = useState(data._mietRate || "179");
  const [mietJahre, setMietJahre] = useState(data._mietJahre || "20");
  const [showPlaner, setShowPlaner] = useState(false);
  const [mic, setMic] = useState(false);
  const [terminNow, setTerminNow] = useState(/* @__PURE__ */ new Date());
  const [galFilter, setGalFilter] = useState("alle");
  const [openFaq, setOpenFaq] = useState(null);
  const [gueltigTage, setGueltigTage] = useState(data.angebotTage || "14");
  const isBarkauf = data.preismodell === "Kauf";
  useEffect(() => {
    const t = setInterval(() => setTickSec((s) => s + 1), 1e3);
    return () => clearInterval(t);
  }, []);
  useEffect(() => {
    const t = setInterval(() => setTerminNow(/* @__PURE__ */ new Date()), 3e4);
    return () => clearInterval(t);
  }, []);
  useEffect(() => {
    const cvs = canvasRef.current;
    if (!cvs || modulAnz <= 0) return;
    const dachTyp = data.dachform || "Satteldach";
    const himmelsR = data.himmelsrichtung || "S";
    const W = 320, H = 240;
    const dpr = window.devicePixelRatio || 1;
    cvs.width = W * dpr;
    cvs.height = H * dpr;
    cvs.style.width = W + "px";
    cvs.style.height = H + "px";
    const ctx = cvs.getContext("2d");
    ctx.scale(dpr, dpr);
    if (viewMode === "sat") {
      ctx.fillStyle = "#2d5a27";
      ctx.fillRect(0, 0, W, H);
      for (let i = 0; i < 600; i++) {
        ctx.fillStyle = `rgba(${30 + Math.random() * 40},${70 + Math.random() * 50},${20 + Math.random() * 40},0.35)`;
        ctx.fillRect(Math.random() * W, Math.random() * H, 2 + Math.random() * 4, 2 + Math.random() * 4);
      }
      ctx.fillStyle = "#6b6b6b";
      ctx.fillRect(W * 0.42, H * 0.8, W * 0.16, H * 0.2);
      ctx.fillStyle = "#8b7d6b";
      ctx.fillRect(W * 0.15, H * 0.65, W * 0.28, H * 0.1);
      ctx.fillStyle = "#7a7a6a";
      ctx.fillRect(W * 0.48, H * 0.65, W * 0.04, H * 0.15);
    } else {
      ctx.fillStyle = "#f5f5f5";
      ctx.fillRect(0, 0, W, H);
      ctx.strokeStyle = "#e0e0e0";
      ctx.lineWidth = 0.5;
      for (let x = 0; x < W; x += 20) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, H);
        ctx.stroke();
      }
      for (let y = 0; y < H; y += 20) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(W, y);
        ctx.stroke();
      }
    }
    const roofC = viewMode === "sat" ? "#5a4a3a" : "#ccc", roofD = viewMode === "sat" ? "#4a3a2a" : "#bbb";
    const cx = W / 2, cy = H * 0.38, rw = W * 0.72, rh = H * 0.54;
    if (dachTyp === "Satteldach") {
      ctx.fillStyle = roofC;
      ctx.fillRect(cx - rw / 2, cy - rh / 2, rw, rh / 2);
      ctx.fillStyle = roofD;
      ctx.fillRect(cx - rw / 2, cy, rw, rh / 2);
      ctx.strokeStyle = viewMode === "sat" ? "#8a7a6a" : "#999";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(cx - rw / 2 - 3, cy);
      ctx.lineTo(cx + rw / 2 + 3, cy);
      ctx.stroke();
      if (viewMode === "sat") {
        ctx.fillStyle = "rgba(0,0,0,0.12)";
        ctx.beginPath();
        ctx.moveTo(cx + rw / 2, cy - rh / 2);
        ctx.lineTo(cx + rw / 2 + 8, cy - rh / 2 + 8);
        ctx.lineTo(cx + rw / 2 + 8, cy + rh / 2 + 8);
        ctx.lineTo(cx + rw / 2, cy + rh / 2);
        ctx.fill();
      }
      ctx.fillStyle = viewMode === "sat" ? "#7a6a5a" : "#aaa";
      ctx.fillRect(cx + rw / 4, cy - rh / 2 + 6, 12, 12);
    } else if (dachTyp === "Flachdach") {
      ctx.fillStyle = roofC;
      ctx.fillRect(cx - rw / 2, cy - rh / 2, rw, rh);
      ctx.strokeStyle = viewMode === "sat" ? "#6a5a4a" : "#999";
      ctx.lineWidth = 1.5;
      ctx.strokeRect(cx - rw / 2, cy - rh / 2, rw, rh);
    } else if (dachTyp === "Walmdach") {
      ctx.fillStyle = roofC;
      ctx.beginPath();
      ctx.moveTo(cx - rw * 0.3, cy - rh / 2);
      ctx.lineTo(cx + rw * 0.3, cy - rh / 2);
      ctx.lineTo(cx + rw / 2, cy);
      ctx.lineTo(cx + rw * 0.3, cy + rh / 2);
      ctx.lineTo(cx - rw * 0.3, cy + rh / 2);
      ctx.lineTo(cx - rw / 2, cy);
      ctx.closePath();
      ctx.fill();
      ctx.strokeStyle = viewMode === "sat" ? "#8a7a6a" : "#999";
      ctx.lineWidth = 1.5;
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(cx - rw * 0.2, cy);
      ctx.lineTo(cx + rw * 0.2, cy);
      ctx.strokeStyle = viewMode === "sat" ? "#9a8a7a" : "#888";
      ctx.lineWidth = 2;
      ctx.stroke();
    } else {
      ctx.fillStyle = roofC;
      ctx.beginPath();
      ctx.moveTo(cx - rw / 2, cy - rh * 0.35);
      ctx.lineTo(cx + rw / 2, cy - rh / 2);
      ctx.lineTo(cx + rw / 2, cy + rh / 2);
      ctx.lineTo(cx - rw / 2, cy + rh / 2);
      ctx.fill();
    }
    if (viewMode === "sat") {
      ctx.globalAlpha = 0.06;
      for (let yt = cy - rh / 2; yt < cy + rh / 2; yt += 5) {
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 0.4;
        ctx.beginPath();
        ctx.moveTo(cx - rw / 2, yt);
        ctx.lineTo(cx + rw / 2, yt);
        ctx.stroke();
      }
      ctx.globalAlpha = 1;
    }
    const pw = dachTyp === "Flachdach" ? 16 : 18, ph = dachTyp === "Flachdach" ? 10 : 11, pg = 2;
    const ux = rw - 28, uy = dachTyp === "Satteldach" ? rh / 2 - 10 : rh - 18;
    const nCols = Math.floor(ux / (pw + pg)), nRows = Math.floor(uy / (ph + pg));
    const panelSX = cx - (nCols * (pw + pg) - pg) / 2, panelSY = dachTyp === "Satteldach" ? cy + 5 : cy - rh / 2 + 8;
    let drawn = 0;
    const drawP = (px, py) => {
      const g = ctx.createLinearGradient(px, py, px + pw, py + ph);
      g.addColorStop(0, "#1a2744");
      g.addColorStop(0.4, "#253a5c");
      g.addColorStop(1, "#162540");
      ctx.fillStyle = g;
      ctx.fillRect(px, py, pw, ph);
      ctx.strokeStyle = "rgba(100,150,220,0.2)";
      ctx.lineWidth = 0.3;
      for (let gc = 1; gc < 3; gc++) {
        ctx.beginPath();
        ctx.moveTo(px + gc * pw / 3, py);
        ctx.lineTo(px + gc * pw / 3, py + ph);
        ctx.stroke();
      }
      ctx.beginPath();
      ctx.moveTo(px, py + ph / 2);
      ctx.lineTo(px + pw, py + ph / 2);
      ctx.stroke();
      ctx.strokeStyle = "rgba(180,195,210,0.4)";
      ctx.lineWidth = 0.7;
      ctx.strokeRect(px, py, pw, ph);
      ctx.fillStyle = "rgba(160,210,255,0.07)";
      ctx.fillRect(px + 1, py + 1, pw * 0.35, ph * 0.3);
    };
    for (let r = 0; r < nRows && drawn < modulAnz; r++) for (let c = 0; c < nCols && drawn < modulAnz; c++) {
      drawP(panelSX + c * (pw + pg), panelSY + r * (ph + pg));
      drawn++;
    }
    if (dachTyp === "Satteldach" && drawn < modulAnz) {
      const sy2 = cy - rh / 2 + 5;
      for (let r = 0; r < nRows && drawn < modulAnz; r++) for (let c = 0; c < nCols && drawn < modulAnz; c++) {
        drawP(panelSX + c * (pw + pg), sy2 + r * (ph + pg));
        drawn++;
      }
    }
    ctx.fillStyle = viewMode === "sat" ? "rgba(255,255,255,0.85)" : "#333";
    ctx.font = "bold 9px system-ui";
    ctx.textAlign = "center";
    ctx.fillText(`${modulAnz} Module \xB7 ${kwpAnlage.toFixed(1)} kWp`, cx, cy + rh / 2 + 18);
    const compX = W - 22, compY = 20;
    ctx.beginPath();
    ctx.arc(compX, compY, 13, 0, Math.PI * 2);
    ctx.fillStyle = viewMode === "sat" ? "rgba(0,0,0,0.5)" : "rgba(0,0,0,0.08)";
    ctx.fill();
    ctx.fillStyle = "#ff4444";
    ctx.font = "bold 8px system-ui";
    ctx.fillText("N", compX, compY - 3);
    ctx.fillStyle = viewMode === "sat" ? "#fff" : "#666";
    ctx.font = "7px system-ui";
    ctx.fillText("S", compX, compY + 9);
    ctx.fillText("W", compX - 7, compY + 3);
    ctx.fillText("O", compX + 7, compY + 3);
    ctx.fillStyle = "#f5c518";
    ctx.font = "bold 8px system-ui";
    ctx.fillText(`\u2600 ${himmelsR}`, cx, cy + rh / 2 + 30);
    if (viewMode === "sat") {
      ctx.fillStyle = "rgba(255,255,255,0.25)";
      ctx.font = "7px system-ui";
      ctx.textAlign = "left";
      ctx.fillText("bee-doo FIELD \xB7 Vorschau", 6, H - 5);
      ctx.textAlign = "right";
      ctx.fillText("PWA: echtes Google Satellitenbild", W - 6, H - 5);
    }
  }, [modulAnz, data.dachform, data.himmelsrichtung, viewMode, kwpAnlage]);
  return /* @__PURE__ */ React.createElement(React.Fragment, null, (data.vorname || gesamt > 0) && /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: `linear-gradient(135deg, ${BRAND.yellow}08, ${T.blue}06)`, borderRadius: 12, border: `1.5px solid ${BRAND.yellow}20`, marginBottom: 14 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: BRAND.yellow, textTransform: "uppercase", letterSpacing: 0.5 } }, "\u{1F41D} Kundendaten-\xDCbersicht"), data._scouterImport && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, padding: "2px 6px", background: T.blue, color: "#fff", borderRadius: 4, fontWeight: 600 } }, "SCOUTER \u2713")), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 6 } }, [
    { l: "Kunde", v: `${data.vorname || ""} ${data.nachname || ""}`.trim() || "\u2013", c: T.text },
    { l: "Verbrauch", v: gesamt > 0 ? `${gesamt.toLocaleString("de")} kWh` : "\u2013", c: gesamt > 0 ? T.text : T.textDim },
    { l: "Strompreis", v: ap2 > 0 ? `${ap2} ct/kWh` : "\u2013", c: ap2 > 0 ? T.red : T.textDim },
    { l: "PLZ / Region", v: data.plz ? `${data.plz} \xB7 ${solarReg.name}` : "\u2013", c: T.text },
    { l: "Dachform", v: data.dachform || "\u2013", c: T.text },
    { l: "Heizung", v: ["Gas", "\xD6l", "W\xE4rmepumpe", "Fernw\xE4rme", "Pellets", "Elektro", "Sonstiges"].filter((h) => data[`heiz_${h}`]).join(", ") || "\u2013", c: T.text },
    { l: "APZ-Feld", v: data.apzVorhanden === "Ja" ? "\u2705 Vorhanden" : data.apzVorhanden === "Nein" ? "\u274C Fehlt" : data.apzVorhanden === "Unklar" ? "\u2753 Unklar" : "\u2013", c: data.apzVorhanden === "Ja" ? T.green : data.apzVorhanden === "Nein" ? T.red : T.textDim }
  ].map((d, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { padding: "4px 8px", background: T.surface, borderRadius: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, textTransform: "uppercase" } }, d.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: d.c, fontFamily: fontMono } }, d.v)))), (() => {
    const missing = [];
    if (!data.stromverbrauch) missing.push("Verbrauch");
    if (!data.strompreis) missing.push("Strompreis");
    if (!data.plz) missing.push("PLZ");
    if (!data.dachform) missing.push("Dachform");
    if (missing.length === 0) return null;
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 6, fontSize: 9, color: T.red, fontWeight: 600 } }, "\u26A0\uFE0F Fehlend: ", missing.join(", "), " \u2013 bitte in Schritt 2 nachtragen");
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Paketauswahl", icon: "\u{1F4E6}", accent: BRAND.yellow }, gesamt > 0 && (() => {
    const ertragRegion = solarReg.ertrag;
    const kwpBasis = gesamt * 0.85 / ertragRegion;
    const kwpOptimal = gesamt * 1.05 / ertragRegion;
    const kwpKomfort = gesamt * 1.3 / ertragRegion;
    const nearestMod = (kwp) => {
      const raw = Math.round(kwp / 0.47);
      let even = raw % 2 === 0 ? raw : raw + 1;
      even = Math.max(8, Math.min(60, even));
      return getPricing(even) ? even : getPricing(even + 2) ? even + 2 : getPricing(even - 2) ? even - 2 : 0;
    };
    const modBasis = nearestMod(kwpBasis);
    const modOptimal = nearestMod(kwpOptimal);
    const modKomfort = nearestMod(kwpKomfort);
    const mB = modBasis >= modOptimal && modOptimal > 8 ? Math.max(8, modOptimal - 2) : modBasis;
    const mO = modOptimal;
    const mK = modKomfort <= modOptimal ? Math.min(60, modOptimal + 2) : modKomfort;
    const pakete = [
      { mod: mB, label: "Basis", sub: "Grundversorgung", emoji: "\u26A1", tag: "Spar-Paket", accent: T.blue, tagBg: `${T.blue}12`, pct: 85 },
      { mod: mO, label: "Optimal", sub: "100% Deckung", emoji: "\u2600\uFE0F", tag: "Empfohlen", accent: T.green, tagBg: `${T.green}12`, pct: 105 },
      { mod: mK, label: "Komfort", sub: "Zukunftssicher", emoji: "\u{1F680}", tag: "E-Auto ready", accent: BRAND.yellow, tagBg: `${BRAND.yellow}12`, pct: 130 }
    ].map((p) => ({ ...p, pr: getPricing(p.mod) })).filter((p) => p.pr);
    return /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 6, marginBottom: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: T.surface, borderRadius: 8, border: `1px solid ${T.border}`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, textTransform: "uppercase" } }, "Verbrauch"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.text, fontFamily: fontMono } }, gesamt.toLocaleString("de")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, "kWh/a")), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: T.surface, borderRadius: 8, border: `1px solid ${T.border}`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, textTransform: "uppercase" } }, "Region-Ertrag"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: BRAND.yellow, fontFamily: fontMono } }, ertragRegion), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, "kWh/kWp")), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: T.surface, borderRadius: 8, border: `1px solid ${T.border}`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, textTransform: "uppercase" } }, "Ben\xF6tigt"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.green, fontFamily: fontMono } }, (gesamt / ertragRegion).toFixed(1)), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, "kWp"))), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "Empfohlene Pakete f\xFCr deinen Verbrauch"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, marginBottom: 12 } }, pakete.map((p, i) => {
      const isSel = modulAnz === p.mod;
      const kwp = p.pr[1];
      const akku = p.pr[2];
      const preis = p.pr[3];
      const pvJahr = Math.round(kwp * ertragRegion);
      const deckung = Math.round(pvJahr / gesamt * 100);
      return /* @__PURE__ */ React.createElement("button", { key: i, onClick: () => {
        const oldPr = getPricing(modulAnz);
        if (oldPr && oldPr[2] !== p.pr[2]) u("zusatzSpeicher", "");
        u("modulAnzahl", String(p.mod));
      }, style: {
        flex: 1,
        padding: "12px 8px",
        borderRadius: 14,
        cursor: "pointer",
        fontFamily: font,
        border: `2.5px solid ${isSel ? p.accent : T.border}`,
        background: isSel ? `${p.accent}08` : T.surface,
        boxShadow: isSel ? `0 4px 16px ${p.accent}25` : "none",
        transition: "all 0.15s ease",
        textAlign: "center",
        position: "relative"
      } }, /* @__PURE__ */ React.createElement("div", { style: {
        position: "absolute",
        top: -8,
        left: "50%",
        transform: "translateX(-50%)",
        padding: "2px 8px",
        borderRadius: 6,
        fontSize: 8,
        fontWeight: 700,
        background: isSel ? p.accent : p.tagBg,
        color: isSel ? "#fff" : p.accent,
        whiteSpace: "nowrap",
        letterSpacing: 0.3
      } }, p.tag), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, marginTop: 4, marginBottom: 2 } }, p.emoji), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 800, color: isSel ? p.accent : T.text } }, p.label), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginBottom: 6 } }, p.sub), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 22, fontWeight: 900, color: isSel ? p.accent : T.text, fontFamily: fontMono, lineHeight: 1 } }, p.mod), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Module"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: isSel ? p.accent : T.textSec, fontFamily: fontMono, marginTop: 4 } }, kwp.toFixed(1), " kWp"), /* @__PURE__ */ React.createElement("div", { style: { margin: "6px auto 0", width: "80%", height: 4, borderRadius: 2, background: T.border } }, /* @__PURE__ */ React.createElement("div", { style: { height: "100%", borderRadius: 2, width: `${Math.min(100, deckung)}%`, background: p.accent, transition: "width 0.2s" } })), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, fontWeight: 700, color: p.accent, marginTop: 3 } }, deckung, "% Deckung"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 6 } }, "\u{1F50B} ", akku.toLocaleString("de-DE"), " kWh"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 800, color: isSel ? p.accent : T.text, fontFamily: fontMono, marginTop: 2 } }, preis.toLocaleString("de-DE"), " \u20AC"));
    })), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8, alignItems: "flex-end" } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement(
      Select,
      {
        label: "Oder manuell w\xE4hlen",
        value: data.modulAnzahl || "",
        onChange: (v) => {
          const pr = getPricing(parseInt(v));
          const oldPr = getPricing(modulAnz);
          if (pr && oldPr && pr[2] !== oldPr[2]) u("zusatzSpeicher", "");
          u("modulAnzahl", v);
        },
        options: [{ value: "", label: "Modulanzahl..." }, ...PRICING.map((p) => {
          const pvJ = Math.round(p[1] * ertragRegion);
          const deck = Math.round(pvJ / gesamt * 100);
          return { value: String(p[0]), label: `${p[0]} Module \xB7 ${p[1].toFixed(1)} kWp \xB7 ${deck}% \xB7 ${p[3].toLocaleString("de-DE")} \u20AC` };
        })]
      }
    ))));
  })(), gesamt === 0 && /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, color: T.textDim } }, "\u261D\uFE0F Erst Verbrauchsdaten eingeben"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginTop: 4 } }, "Dann werden hier die passenden Pakete berechnet")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12, marginTop: gesamt > 0 ? 0 : 12 } }, gesamt === 0 && /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Modulanzahl (Aiko 3S)",
      value: data.modulAnzahl || "",
      onChange: (v) => {
        const pr = getPricing(parseInt(v));
        const oldPr = getPricing(modulAnz);
        if (pr && oldPr && pr[2] !== oldPr[2]) u("zusatzSpeicher", "");
        u("modulAnzahl", v);
      },
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, ...Array.from({ length: 27 }, (_, i) => ({ value: String((i + 4) * 2), label: String((i + 4) * 2) }))]
    }
  ), (() => {
    const pr = getPricing(modulAnz);
    if (!pr) return null;
    const akkuLabel = pr[2] === 6.4 ? "6,4 kWh (2 \xD7 3,2)" : "9,84 kWh (2 \xD7 4,92)";
    return /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textTransform: "uppercase", letterSpacing: 0.5 } }, "Anlagengr\xF6\xDFe"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 15, fontWeight: 700, color: T.text, fontFamily: fontMono, marginTop: 2 } }, pr[1].toLocaleString("de-DE"), " ", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: T.textDim } }, "kWp"))), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textTransform: "uppercase", letterSpacing: 0.5 } }, "Speicher inkl."), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 15, fontWeight: 700, color: T.text, fontFamily: fontMono, marginTop: 2 } }, akkuLabel)), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textTransform: "uppercase", letterSpacing: 0.5 } }, "Wechselrichter"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 15, fontWeight: 700, color: T.text, fontFamily: fontMono, marginTop: 2 } }, pr[4])), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: `${BRAND.yellow}10`, borderRadius: 10, border: `1.5px solid ${BRAND.yellow}40` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: BRAND.yellow, textTransform: "uppercase", letterSpacing: 0.5, fontWeight: 600 } }, "Gesamtpreis"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 17, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono, marginTop: 2 } }, gesamtPreis.toLocaleString("de-DE"), " \u20AC"), extraTotal > 0 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 2 } }, pr[3].toLocaleString("de-DE"), " + ", extraTotal.toLocaleString("de-DE"), " Extras"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.green, marginTop: 3 } }, "\xA735a Steuerbonus: \u2212", steuerbonus.toLocaleString("de-DE"), " \u20AC")));
  })(), /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "Zusatzspeicher ", baseAkku2 === 6.4 ? "3,2" : baseAkku2 === 9.84 ? "4,92" : "\u2013", " kWh"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 0, background: T.surface, borderRadius: 10, border: `1.5px solid ${zsCount > 0 ? BRAND.yellow : T.border}`, overflow: "hidden" } }, /* @__PURE__ */ React.createElement("button", { onClick: () => {
    if (zsCount > 0) {
      const nz = zsCount - 1;
      const sz = baseAkku2 === 6.4 ? "3.2" : "4.92";
      u("zusatzSpeicher", nz > 0 ? `${sz}_${nz}` : "");
    }
  }, style: {
    width: 48,
    height: 48,
    border: "none",
    background: zsCount > 0 ? `${T.red}15` : T.surface,
    color: zsCount > 0 ? T.red : T.textDim,
    fontSize: 22,
    fontWeight: 700,
    cursor: zsCount > 0 ? "pointer" : "default",
    fontFamily: fontMono
  } }, "\u2212"), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, textAlign: "center", fontSize: 16, fontWeight: 700, color: zsCount > 0 ? BRAND.yellow : T.textDim, fontFamily: fontMono } }, zsCount), /* @__PURE__ */ React.createElement("button", { onClick: () => {
    if (baseAkku2 > 0 && zsCount < 3) {
      const nz = zsCount + 1;
      const sz = baseAkku2 === 6.4 ? "3.2" : "4.92";
      u("zusatzSpeicher", `${sz}_${nz}`);
    }
  }, style: {
    width: 48,
    height: 48,
    border: "none",
    background: baseAkku2 > 0 && zsCount < 3 ? `${T.green}15` : T.surface,
    color: baseAkku2 > 0 && zsCount < 3 ? T.green : T.textDim,
    fontSize: 22,
    fontWeight: 700,
    cursor: baseAkku2 > 0 && zsCount < 3 ? "pointer" : "default",
    fontFamily: fontMono
  } }, "+")), zsCount > 0 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: BRAND.yellow, marginTop: 4, textAlign: "center" } }, "+", zsKwh2.toLocaleString("de-DE"), " kWh \xB7 ", zsCost.toLocaleString("de-DE"), " \u20AC netto")), /* @__PURE__ */ React.createElement(Select, { label: "Zwischenz\xE4hler", value: data.zwischenzaehlerAng || "", onChange: (v) => u("zwischenzaehlerAng", v), half: true, options: jn }), data.zwischenzaehlerAng === "Ja" && /* @__PURE__ */ React.createElement(Input, { label: "Anzahl Zwischenz\xE4hler", value: data.zwischenzaehlerAngAnzahl || "", onChange: (v) => u("zwischenzaehlerAngAnzahl", v), placeholder: "z.B. 2", half: true, type: "number", autoFocus: true }), /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150, display: "flex", alignItems: "center", gap: 12, padding: "12px 16px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, cursor: "pointer" }, onClick: () => u("wantWallbox", !data.wantWallbox) }, /* @__PURE__ */ React.createElement("div", { style: { width: 22, height: 22, borderRadius: 6, border: `2px solid ${data.wantWallbox ? T.green : T.border}`, background: data.wantWallbox ? T.green : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data.wantWallbox && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 12, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, color: T.text } }, "Wallbox")), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Z\xE4hlerzusammenlegung",
      value: data.zaehlerZusammenAng || "",
      onChange: (v) => {
        u("zaehlerZusammenAng", v);
        u("zlAngZ1", false);
        u("zlAngZ2", false);
        u("zlAngZ3", false);
      },
      half: true,
      options: data._showZaehler3 ? [{ value: "", label: "Keine" }, { value: "3auf1", label: "3 auf 1" }, { value: "3auf2", label: "3 auf 2" }] : data._showZaehler2 ? [{ value: "", label: "Keine" }, { value: "2auf1", label: "2 auf 1" }] : [{ value: "", label: "Keine" }]
    }
  ), data.zaehlerZusammenAng && (() => {
    const zaehler = [
      { k: "zlAngZ1", nr: data.zaehlerNr || "", label: "Z\xE4hler 1" },
      data._showZaehler2 && { k: "zlAngZ2", nr: data.zaehlerNr2 || "", label: "Z\xE4hler 2" },
      data._showZaehler3 && { k: "zlAngZ3", nr: data.zaehlerNr3 || "", label: "Z\xE4hler 3" }
    ].filter(Boolean);
    const removeCount = data.zaehlerZusammenAng === "3auf1" ? 2 : 1;
    const sel = zaehler.filter((z) => data[z.k]).length;
    return /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "10px 14px", background: `${T.red}06`, borderRadius: 10, border: `1px solid ${T.red}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, fontWeight: 600, marginBottom: 6, textTransform: "uppercase", letterSpacing: 0.5 } }, "\u{1F5D1}\uFE0F Welche", removeCount > 1 ? ` ${removeCount}` : "", " Z\xE4hler ", removeCount > 1 ? "fallen" : "f\xE4llt", " weg?"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 6 } }, zaehler.map((z) => {
      const selected = data[z.k];
      const maxReached = sel >= removeCount && !selected;
      return /* @__PURE__ */ React.createElement("button", { key: z.k, onClick: () => {
        if (maxReached) return;
        u(z.k, !selected);
      }, style: {
        padding: "8px 14px",
        borderRadius: 8,
        cursor: maxReached ? "not-allowed" : "pointer",
        fontFamily: font,
        border: `1.5px solid ${selected ? T.red : T.border}`,
        background: selected ? `${T.red}12` : T.surface,
        color: selected ? T.red : T.textSec,
        fontSize: 12,
        fontWeight: selected ? 700 : 400,
        transition: "all 0.15s ease",
        opacity: maxReached ? 0.4 : 1,
        textDecoration: selected ? "line-through" : "none"
      } }, selected ? "\u2715 " : "", z.label, z.nr ? ` (${z.nr})` : "");
    })), sel < removeCount ? /* @__PURE__ */ React.createElement("div", { style: { marginTop: 6, fontSize: 10, color: BRAND.yellow } }, "\u26A0\uFE0F Noch ", removeCount - sel, " Z\xE4hler ausw\xE4hlen") : /* @__PURE__ */ React.createElement("div", { style: { marginTop: 6, fontSize: 10, color: T.green } }, "\u2705 ", sel, " Z\xE4hler zum Entfernen markiert"));
  })(), /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 48%", minWidth: 150, display: "flex", alignItems: "center", gap: 12, padding: "12px 16px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, cursor: "pointer" }, onClick: () => u("geruestAufschlag", !data.geruestAufschlag) }, /* @__PURE__ */ React.createElement("div", { style: { width: 22, height: 22, borderRadius: 6, border: `2px solid ${data.geruestAufschlag ? T.green : T.border}`, background: data.geruestAufschlag ? T.green : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data.geruestAufschlag && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 12, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, color: T.text } }, "Ger\xFCstaufschlag")), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Anzahl Z\xE4hlerschr\xE4nke",
      value: data.anzZaehlerSchraenke || "",
      onChange: (v) => u("anzZaehlerSchraenke", v),
      half: true,
      options: [{ value: "", label: "Keine Auswahl" }, { value: "0", label: "0" }, { value: "1", label: "1" }, { value: "2", label: "2" }]
    }
  ), /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Wenn Ziegel nicht vorhanden",
      value: data.ziegelErsatz || "",
      onChange: (v) => u("ziegelErsatz", v),
      half: true,
      options: [{ value: "", label: "Keine Auswahl" }, { value: "Kunde", label: "Kunde beschafft" }, { value: "Beedoo", label: "bee-doo beschafft" }, { value: "Ersatz", label: "Ersatzziegel" }]
    }
  )), (() => {
    const items = [
      { k: "dachGaube", l: "Gaube" },
      { k: "dachFenster", l: "Dachfenster" },
      { k: "dachKamin", l: "Kamin" },
      { k: "dachSat", l: "SAT-Anlage" },
      { k: "vermoertelt", l: "Verm\xF6rtelte Ziegel" },
      { k: "pappdocken", l: "Pappdocken" },
      { k: "thermodach", l: "Thermodach" },
      { k: "pvDemontage", l: "PV demontieren" },
      { k: "solarthermieDemontage", l: "Solarthermie abbauen" }
    ];
    const selected = items.filter((c) => data[c.k]);
    if (selected.length === 0) return null;
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 12, padding: "10px 14px", background: `${BRAND.yellow}06`, borderRadius: 10, border: `1px solid ${BRAND.yellow}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 6, fontWeight: 600 } }, "\u{1F3E0} Dachbesonderheiten (aus Technik)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 5 } }, selected.map((c) => /* @__PURE__ */ React.createElement("span", { key: c.k, style: { fontSize: 11, padding: "3px 10px", borderRadius: 6, background: `${BRAND.yellow}15`, border: `1px solid ${BRAND.yellow}30`, color: BRAND.yellow, fontWeight: 600 } }, "\u2713 ", c.l))));
  })(), extraLines.length > 0 && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 14, padding: "14px 16px", background: `${BRAND.yellow}06`, borderRadius: 12, border: `1.5px solid ${BRAND.yellow}25` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: BRAND.yellow, fontWeight: 700, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 10, display: "flex", alignItems: "center", gap: 6 } }, "\u{1F4B0} Zusatzkosten ", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, fontWeight: 400, color: T.textDim } }, "(live aus Auswahl)")), extraLines.map((ln, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { display: "flex", justifyContent: "space-between", alignItems: "center", padding: "7px 0", borderBottom: i < extraLines.length - 1 ? `1px solid ${T.border}20` : "none" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: T.text, flex: 1 } }, ln.l), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, fontWeight: 700, color: T.text, fontFamily: fontMono, whiteSpace: "nowrap", marginLeft: 12 } }, ln.v.toLocaleString("de-DE"), " \u20AC", ln.typ && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: T.textDim, fontWeight: 400, marginLeft: 4 } }, ln.typ)))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginTop: 10, paddingTop: 10, borderTop: `2px solid ${BRAND.yellow}40` } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, fontWeight: 700, color: T.textSec } }, "Extras gesamt"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 15, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono } }, "+", extraTotal.toLocaleString("de-DE"), " \u20AC"))), systemPreis > 0 && /* @__PURE__ */ React.createElement("div", { style: { marginTop: extraLines.length > 0 ? 8 : 14, padding: "14px 16px", background: `${T.green}06`, borderRadius: 12, border: `1.5px solid ${T.green}25` } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14, fontWeight: 700, color: T.green } }, "Gesamtpreis"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 20, fontWeight: 800, color: T.green, fontFamily: fontMono } }, gesamtPreis.toLocaleString("de-DE"), " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, textAlign: "right", marginTop: 2 } }, extraTotal > 0 ? `${systemPreis.toLocaleString("de-DE")} \u20AC System + ${extraTotal.toLocaleString("de-DE")} \u20AC Extras` : "Systempreis ohne Extras"), data.preismodell === "Kauf" && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginTop: 8, paddingTop: 8, borderTop: `1px dashed ${BRAND.yellow}30` } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 600, color: BRAND.yellow } }, "Barkauf 20 % Anzahlung"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 15, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono } }, Math.round(gesamtPreis * 0.2).toLocaleString("de-DE"), " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginTop: 8, paddingTop: 8, borderTop: `1px dashed ${T.green}30` } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 600, color: T.green } }, "\xA735a Steuerbonus"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "25 % Montage (", montageAnteil.toLocaleString("de-DE"), " \u20AC) \xD7 20 % = max. 1.200 \u20AC")), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 15, fontWeight: 800, color: T.green, fontFamily: fontMono } }, "\u2212", steuerbonus.toLocaleString("de-DE"), " \u20AC"))), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 16 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.textSec, marginBottom: 4 } }, "Strompreisentwicklung Deutschland ", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: T.textDim } }, "(BDEW + Prognose)")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.red, fontWeight: 600, marginBottom: 8 } }, "+132 % bis 2030 \xB7 18,7 \u2192 43,5 ct/kWh \xB7 ", /* @__PURE__ */ React.createElement("span", { style: { color: BRAND.yellow } }, "Prognose ab 2026: ~4 % p.a.")), /* @__PURE__ */ React.createElement("div", { style: { height: 200, background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, padding: "8px 4px 0 0" } }, /* @__PURE__ */ React.createElement(ResponsiveContainer, { width: "100%", height: "100%" }, /* @__PURE__ */ React.createElement(AreaChart, { data: STROM_PREISE, margin: { top: 5, right: 8, left: -20, bottom: 0 } }, /* @__PURE__ */ React.createElement("defs", null, /* @__PURE__ */ React.createElement("linearGradient", { id: "stromGrad", x1: "0", y1: "0", x2: "0", y2: "1" }, /* @__PURE__ */ React.createElement("stop", { offset: "5%", stopColor: T.red, stopOpacity: 0.3 }), /* @__PURE__ */ React.createElement("stop", { offset: "95%", stopColor: T.red, stopOpacity: 0 })), /* @__PURE__ */ React.createElement("linearGradient", { id: "stromForecast", x1: "0", y1: "0", x2: "0", y2: "1" }, /* @__PURE__ */ React.createElement("stop", { offset: "5%", stopColor: BRAND.yellow, stopOpacity: 0.25 }), /* @__PURE__ */ React.createElement("stop", { offset: "95%", stopColor: BRAND.yellow, stopOpacity: 0 }))), /* @__PURE__ */ React.createElement(CartesianGrid, { strokeDasharray: "3 3", stroke: T.border + "30" }), /* @__PURE__ */ React.createElement(XAxis, { dataKey: "j", tick: { fontSize: 9, fill: T.textDim }, tickLine: false, axisLine: false, interval: 4 }), /* @__PURE__ */ React.createElement(YAxis, { tick: { fontSize: 9, fill: T.textDim }, tickLine: false, axisLine: false, domain: [15, 48], unit: " ct" }), /* @__PURE__ */ React.createElement(Tooltip, { contentStyle: { background: T.card, border: `1px solid ${T.border}`, borderRadius: 8, fontSize: 12, color: T.text }, formatter: (v, name) => v ? [`${v} ct/kWh`, name === "p" ? "Ist" : "Prognose"] : [], labelFormatter: (l) => `${l}` }), /* @__PURE__ */ React.createElement(ReferenceLine, { x: 2025, stroke: T.textDim, strokeDasharray: "3 3", label: { value: "heute", position: "top", fill: T.textDim, fontSize: 8 } }), /* @__PURE__ */ React.createElement(Area, { type: "monotone", dataKey: "p", stroke: T.red, strokeWidth: 2, fill: "url(#stromGrad)", dot: false, activeDot: { r: 4, fill: T.red }, connectNulls: false }), /* @__PURE__ */ React.createElement(Area, { type: "monotone", dataKey: "f", stroke: BRAND.yellow, strokeWidth: 2, strokeDasharray: "6 3", fill: "url(#stromForecast)", dot: false, activeDot: { r: 4, fill: BRAND.yellow }, connectNulls: false })))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "center", gap: 16, marginTop: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: T.red, display: "flex", alignItems: "center", gap: 4 } }, /* @__PURE__ */ React.createElement("span", { style: { width: 16, height: 2, background: T.red, display: "inline-block" } }), " BDEW Ist-Daten"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: BRAND.yellow, display: "flex", alignItems: "center", gap: 4 } }, /* @__PURE__ */ React.createElement("span", { style: { width: 16, height: 2, background: BRAND.yellow, display: "inline-block", borderTop: "1px dashed " + BRAND.yellow } }), " Prognose ~4 %/a")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 2, textAlign: "center" } }, "Quelle: BDEW Strompreisanalyse \xB7 Haushaltskunden 3.500 kWh/a \xB7 Prognose: konservativ +4 % p.a."))), modulAnz > 0 && /* @__PURE__ */ React.createElement(Section, { title: "String-Planer", icon: "\u{1F50C}", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "MPPT-Zuordnung f\xFCr DC-Team \u2013 welche Module auf welchem String?"), (() => {
    const wrInfo = wrTyp || "Hybrid WR";
    const mpptCount = kwpAnlage > 15 ? 3 : kwpAnlage > 8 ? 2 : 1;
    const autoStr = [];
    let remaining = modulAnz;
    for (let m = 0; m < mpptCount; m++) {
      const perMPPT = Math.ceil(remaining / (mpptCount - m));
      autoStr.push(perMPPT);
      remaining -= perMPPT;
    }
    if (!showPlaner) return /* @__PURE__ */ React.createElement("button", { onClick: () => setShowPlaner(true), style: {
      width: "100%",
      padding: "10px",
      borderRadius: 10,
      border: `1.5px dashed ${T.blue}30`,
      cursor: "pointer",
      background: T.surface,
      color: T.blue,
      fontSize: 11,
      fontWeight: 600,
      fontFamily: font
    } }, "\u{1F50C} String-Planer \xF6ffnen (", mpptCount, " MPPT \xB7 ", modulAnz, " Module)");
    return /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 12px", background: `${T.blue}06`, borderRadius: 8, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.blue, fontWeight: 600 } }, "\u26A1 ", wrInfo, " \xB7 ", mpptCount, " MPPT-Tracker")), Array.from({ length: mpptCount }).map((_, mi) => {
      const key = `string${mi + 1}`;
      const mods = parseInt(data[`${key}Mods`]) || autoStr[mi] || 0;
      const ausrichtung = data[`${key}Richt`] || "S";
      const neigung = data[`${key}Neig`] || "35";
      const kwp = (mods * 0.47).toFixed(1);
      return /* @__PURE__ */ React.createElement("div", { key: mi, style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1.5px solid ${T.blue}20`, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: T.blue } }, "MPPT ", mi + 1, " \u2013 String ", String.fromCharCode(65 + mi)), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.text, fontFamily: fontMono } }, kwp, " kWp")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, marginBottom: 2 } }, "Module"), /* @__PURE__ */ React.createElement(
        "input",
        {
          type: "number",
          value: mods || "",
          onChange: (e) => u(`${key}Mods`, e.target.value),
          style: { width: "100%", padding: "6px", background: T.bg, border: `1px solid ${T.border}`, borderRadius: 6, color: T.text, fontSize: 14, fontWeight: 700, fontFamily: fontMono, textAlign: "center", outline: "none", boxSizing: "border-box", WebkitAppearance: "none", MozAppearance: "textfield" }
        }
      )), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, marginBottom: 2 } }, "Ausrichtung"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 2 } }, ["S", "SO", "SW", "O", "W"].map((r) => /* @__PURE__ */ React.createElement("div", { key: r, onClick: () => u(`${key}Richt`, r), style: {
        flex: 1,
        padding: "6px 2px",
        borderRadius: 4,
        cursor: "pointer",
        textAlign: "center",
        fontSize: 8,
        fontWeight: 600,
        background: ausrichtung === r ? T.blue : T.bg,
        color: ausrichtung === r ? "#fff" : T.textDim,
        border: `1px solid ${ausrichtung === r ? T.blue : T.border}`
      } }, r)))), /* @__PURE__ */ React.createElement("div", { style: { width: 60 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, marginBottom: 2 } }, "Neigung"), /* @__PURE__ */ React.createElement(
        "input",
        {
          type: "number",
          value: neigung,
          onChange: (e) => u(`${key}Neig`, e.target.value),
          style: { width: "100%", padding: "6px", background: T.bg, border: `1px solid ${T.border}`, borderRadius: 6, color: T.text, fontSize: 12, fontWeight: 600, fontFamily: fontMono, textAlign: "center", outline: "none", boxSizing: "border-box", WebkitAppearance: "none", MozAppearance: "textfield" }
        }
      ))));
    }), (() => {
      let total = 0;
      for (let m = 0; m < mpptCount; m++) total += parseInt(data[`string${m + 1}Mods`]) || autoStr[m] || 0;
      const diff = total - modulAnz;
      return /* @__PURE__ */ React.createElement("div", { style: {
        padding: "8px 12px",
        borderRadius: 8,
        textAlign: "center",
        background: diff === 0 ? `${T.green}08` : `${T.red}08`,
        border: `1px solid ${diff === 0 ? T.green : T.red}20`
      } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 600, color: diff === 0 ? T.green : T.red } }, diff === 0 ? `\u2705 Alle ${modulAnz} Module verteilt` : diff > 0 ? `\u26A0\uFE0F ${diff} Module zu viel verteilt` : `\u26A0\uFE0F ${Math.abs(diff)} Module fehlen noch`));
    })());
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Preismodell & Finanzierung", icon: "\u{1F4B0}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Preismodell",
      value: data.preismodell || "",
      onChange: (v) => {
        u("preismodell", v);
        if (v === "Kauf" && gesamtPreis > 0) u("anzahlung", String(Math.round(gesamtPreis * 0.2)));
      },
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "Finanzierung", label: "Finanzierung" }, { value: "Kauf", label: "Barkauf" }, { value: "Direktzahler", label: "Direktzahler" }]
    }
  ), data.preismodell === "Finanzierung" && /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(
    Select,
    {
      label: "Finanzierungspartner",
      value: data.finanzDienstleister || "",
      onChange: (v) => {
        u("finanzDienstleister", v);
        if (v === "EFS") {
          if (!data.efsTarif) {
            u("efsTarif", "Basic");
            u("zins", "5.99");
          }
        } else if (v === "Golfstrom") {
          u("efsTarif", "");
          u("zins", "");
        }
      },
      half: true,
      options: [{ value: "", label: "Ausw\xE4hlen..." }, { value: "EFS", label: "EFS" }, { value: "Golfstrom", label: "Golfstrom" }]
    }
  ), data.finanzDienstleister === "EFS" && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%" } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 11, color: T.textSec, marginBottom: 6, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "EFS Tarif"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, [
    { k: "Basic", zins: "5.99", desc: "5,99 %" },
    { k: "Zero", zins: "6.99", desc: "6,99 %" }
  ].map((t) => /* @__PURE__ */ React.createElement("button", { key: t.k, onClick: () => {
    u("efsTarif", t.k);
    u("zins", t.zins);
  }, style: {
    flex: 1,
    padding: "14px 16px",
    borderRadius: 10,
    cursor: "pointer",
    fontFamily: font,
    border: `2px solid ${data.efsTarif === t.k ? BRAND.yellow : T.border}`,
    background: data.efsTarif === t.k ? `${BRAND.yellow}12` : T.surface,
    transition: "all 0.15s ease"
  } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: data.efsTarif === t.k ? BRAND.yellow : T.text } }, t.k), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: data.efsTarif === t.k ? BRAND.yellow : T.textSec, marginTop: 2 } }, t.desc))))), data.finanzDienstleister === "Golfstrom" && /* @__PURE__ */ React.createElement(Input, { label: "Zins", value: data.zins || "", onChange: (v) => u("zins", v), placeholder: "z.B. 5,99", suffix: "%", half: true, type: "number" }), gesamtPreis > 0 && parseFloat(data.zins) > 0 && (() => {
    const z = parseFloat(data.zins) / 100 / 12;
    const az = parseFloat(data.anzahlung) || 0;
    const kr = Math.max(0, gesamtPreis - az);
    const calcRate = (j) => {
      const m = j * 12;
      return kr > 0 && z > 0 ? kr * z / (1 - Math.pow(1 + z, -m)) : 0;
    };
    const selJ = parseInt(data.finanzJahre) || 15;
    const selRate = calcRate(selJ);
    const selTotal = selRate * selJ * 12 + az;
    const selZinsen = selTotal - gesamtPreis;
    return /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 } }, /* @__PURE__ */ React.createElement("label", { style: { fontSize: 11, color: T.textSec, fontWeight: 500, letterSpacing: 0.8, textTransform: "uppercase" } }, "Laufzeit w\xE4hlen \xB7 ", parseFloat(data.zins).toLocaleString("de-DE"), " % \xB7 ", kr.toLocaleString("de-DE"), " \u20AC Kredit"), /* @__PURE__ */ React.createElement("span", { onClick: () => setData((d) => ({ ...d, _showDcCalc: !d._showDcCalc })), style: { fontSize: 14, color: T.border, cursor: "pointer", padding: "6px 10px", opacity: 0.4, lineHeight: 1 } }, "\u2699")), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr 1fr", gap: 6 } }, [10, 15, 20, 25].map((j) => {
      const r = calcRate(j);
      const sel = data.finanzJahre === String(j);
      return /* @__PURE__ */ React.createElement("button", { key: j, onClick: () => u("finanzJahre", String(j)), style: {
        padding: "10px 6px",
        borderRadius: 10,
        cursor: "pointer",
        fontFamily: font,
        border: `2px solid ${sel ? T.green : T.border}`,
        background: sel ? `${T.green}12` : T.surface,
        transition: "all 0.15s ease",
        textAlign: "center"
      } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: sel ? T.green : T.text } }, j, " J."), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 15, fontWeight: 800, color: sel ? T.green : BRAND.yellow, fontFamily: fontMono, marginTop: 4 } }, r.toLocaleString("de-DE", { minimumFractionDigits: 0, maximumFractionDigits: 0 }), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 2 } }, "/ Monat"));
    })), data._showDcCalc && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, padding: "12px 14px", background: `${T.red}08`, borderRadius: 10, border: `1.5px dashed ${T.red}40` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.red, fontWeight: 700, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "\u{1F512} Nur f\xFCr Berater \u2013 Gesamtkosten Finanzierung"), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 } }, [10, 15, 20, 25].map((j) => {
      const r = calcRate(j);
      const tot = r * j * 12 + az;
      const zins = tot - gesamtPreis;
      const isSel = selJ === j;
      return /* @__PURE__ */ React.createElement("div", { key: j, style: { padding: "8px 10px", background: isSel ? `${T.red}10` : T.surface, borderRadius: 8, border: `1px solid ${isSel ? T.red + "40" : T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: isSel ? T.red : T.text } }, j, " Jahre"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 4 } }, "Gesamt bezahlt"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: T.text, fontFamily: fontMono } }, Math.round(tot).toLocaleString("de-DE"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 4 } }, "davon Zinsen"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: T.red, fontFamily: fontMono } }, Math.round(zins).toLocaleString("de-DE"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 2 } }, "Aufschlag ", gesamtPreis > 0 ? Math.round(zins / gesamtPreis * 100) : 0, " %"));
    }))));
  })()), data.preismodell === "Kauf" && gesamtPreis > 0 && /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", padding: "12px 16px", background: `${BRAND.yellow}08`, borderRadius: 10, border: `1.5px solid ${BRAND.yellow}30` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: BRAND.yellow, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 6 } }, "Barkauf \u2013 20 % Anzahlung"), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "Anzahlung (20 %)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 15, fontWeight: 700, color: BRAND.yellow, fontFamily: fontMono } }, Math.round(gesamtPreis * 0.2).toLocaleString("de-DE"), " \u20AC")), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "Rest bei Installation"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 15, fontWeight: 700, color: T.text, fontFamily: fontMono } }, Math.round(gesamtPreis * 0.8).toLocaleString("de-DE"), " \u20AC"))))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 10, marginTop: 12 } }, [{ k: "metrify", l: "Metrify Smart Metering" }].map((c) => /* @__PURE__ */ React.createElement("div", { key: c.k, style: { display: "flex", alignItems: "center", gap: 10, padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${data[c.k] ? `${T.green}40` : T.border}`, cursor: "pointer", flex: "1 1 100%", minWidth: 200 }, onClick: () => u(c.k, !data[c.k]) }, /* @__PURE__ */ React.createElement("div", { style: { width: 22, height: 22, borderRadius: 6, border: `2px solid ${data[c.k] ? T.green : T.border}`, background: data[c.k] ? T.green : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data[c.k] && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 12, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, color: T.text } }, c.l))), /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", minWidth: 200 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, padding: "10px 14px", background: data.dynStromtarif ? `${T.green}06` : T.surface, borderRadius: data.dynStromtarif ? "10px 10px 0 0" : 10, border: `1px solid ${data.dynStromtarif ? `${T.green}40` : T.border}`, borderBottom: data.dynStromtarif ? "none" : void 0, cursor: "pointer" }, onClick: () => u("dynStromtarif", !data.dynStromtarif) }, /* @__PURE__ */ React.createElement("div", { style: { width: 22, height: 22, borderRadius: 6, border: `2px solid ${data.dynStromtarif ? T.green : T.border}`, background: data.dynStromtarif ? T.green : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data.dynStromtarif && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 12, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, color: T.text, fontWeight: data.dynStromtarif ? 600 : 400 } }, "Dynamischer Stromtarif"), data.dynStromtarif && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, "Umstellung auf dynamischen Tarif \xB7 B\xF6rsenpreise + Aufschlag"))), data.dynStromtarif && /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", background: `${T.green}04`, borderRadius: "0 0 10px 10px", border: `1px solid ${T.green}40`, borderTop: "none" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 12, alignItems: "flex-end", marginBottom: 8 } }, /* @__PURE__ */ React.createElement(Input, { label: "\xD8 Dynamischer Strompreis", value: data.dynStrompreis || "26", onChange: (v) => u("dynStrompreis", v), placeholder: "26", suffix: "ct/kWh", half: true, type: "number" })), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 12px", background: T.surface, borderRadius: 8, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.green, fontWeight: 600, marginBottom: 4 } }, "\u{1F4A1} Vorteil f\xFCr den Kunden"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.text } }, "Aktueller Strompreis: ", /* @__PURE__ */ React.createElement("strong", { style: { color: T.red } }, parseFloat(data.strompreis) || 33, " ct/kWh"), " \u2192 Dynamisch: ", /* @__PURE__ */ React.createElement("strong", { style: { color: T.green } }, parseFloat(data.dynStrompreis) || 26, " ct/kWh")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.green, fontWeight: 600, marginTop: 4 } }, "Ersparnis Restzukauf: ", (() => {
    const altAP = parseFloat(data.strompreis) || 33;
    const dynAP3 = parseFloat(data.dynStrompreis) || 26;
    const diff = altAP - dynAP3;
    const sparJahr = Math.round(restZukaufJahr * diff / 100);
    return `${diff.toLocaleString("de")} ct/kWh weniger = ca. ${sparJahr.toLocaleString("de")} \u20AC/Jahr gespart auf Netzbezug`;
  })())))), /* @__PURE__ */ React.createElement("div", { style: { flex: "1 1 100%", minWidth: 200 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, padding: "10px 14px", background: data.par14 ? `${T.blue}06` : T.surface, borderRadius: data.par14 ? "10px 10px 0 0" : 10, border: `1px solid ${data.par14 ? `${T.blue}40` : T.border}`, borderBottom: data.par14 ? "none" : void 0, cursor: "pointer" }, onClick: () => u("par14", !data.par14) }, /* @__PURE__ */ React.createElement("div", { style: { width: 22, height: 22, borderRadius: 6, border: `2px solid ${data.par14 ? T.blue : T.border}`, background: data.par14 ? T.blue : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data.par14 && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 12, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, color: T.text, fontWeight: data.par14 ? 600 : 400 } }, "\xA714a EnWG (Steuerbare Verbrauchseinrichtungen)"), data.par14 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, "Netzentgeltreduzierung f\xFCr Wallbox, W\xE4rmepumpe, Speicher > 4,2 kW"))), data.par14 && /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", background: `${T.blue}04`, borderRadius: "0 0 10px 10px", border: `1px solid ${T.blue}40`, borderTop: "none" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 12, alignItems: "flex-end", marginBottom: 8 } }, /* @__PURE__ */ React.createElement(Input, { label: "Netzentgelt-Erstattung \xA714a", value: data.par14Erstattung || "160", onChange: (v) => u("par14Erstattung", v), placeholder: "160", suffix: "\u20AC/Jahr", half: true, type: "number" })), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 12px", background: T.surface, borderRadius: 8, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.blue, fontWeight: 600, marginBottom: 4 } }, "\u2696\uFE0F \xA714a EnWG Modul 1 \u2013 Pauschale Netzentgeltreduzierung"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.text, lineHeight: 1.5 } }, "Formel: ", /* @__PURE__ */ React.createElement("strong", null, "80 \u20AC + 3.750 kWh \xD7 Netzentgelt-Arbeitspreis \xD7 20%")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, lineHeight: 1.4, marginTop: 4 } }, "Je nach Netzbetreiber & Region: 110 \u2013 190 \u20AC/Jahr brutto (\xD8 ca. 160 \u20AC). Gilt f\xFCr Wallbox, W\xE4rmepumpe, Speicher > 4,2 kW ab Inbetriebnahme 01.01.2024. Netzbetreiber darf im Notfall auf 4,2 kW dimmen \u2013 Haushaltsstrom bleibt unber\xFChrt."), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8, marginTop: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1, padding: "6px 10px", background: `${T.blue}08`, borderRadius: 6, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Erstattung/Jahr"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: T.blue, fontFamily: fontMono } }, parseFloat(data.par14Erstattung) || 160, " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, padding: "6px 10px", background: `${T.blue}08`, borderRadius: 6, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Erstattung/Monat"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: T.blue, fontFamily: fontMono } }, Math.round((parseFloat(data.par14Erstattung) || 160) / 12), " \u20AC")))))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 12, alignItems: "center", padding: "10px 14px", background: `${T.red}06`, borderRadius: 10, border: `1px solid ${T.red}15`, marginTop: 2 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 16 } }, "\u{1F4C8}"), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: T.red } }, "Strompreiserh\xF6hung pro Jahr"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "BDEW \xD8 der letzten 20 Jahre: +3,5\u20135 % p.a.")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 4 } }, /* @__PURE__ */ React.createElement("input", { type: "number", value: data.stromSteigerung || "4", onChange: (e) => u("stromSteigerung", e.target.value), style: { width: 48, padding: "6px 8px", background: T.bg, border: `1.5px solid ${T.red}40`, borderRadius: 8, color: T.red, fontSize: 16, fontWeight: 800, fontFamily: fontMono, textAlign: "center", outline: "none", WebkitAppearance: "none", MozAppearance: "textfield" } }), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14, fontWeight: 700, color: T.red } }, "%"))))), gesamt > 0 && modulAnz > 0 && /* @__PURE__ */ React.createElement(Section, { title: "Wirtschaftlichkeit", icon: "\u{1F4CA}", accent: T.green }, /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 16px", background: `${BRAND.yellow}06`, borderRadius: 12, border: `1.5px solid ${BRAND.yellow}20`, marginBottom: 14, display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: BRAND.yellow, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5 } }, "\u2600\uFE0F Sonnenstunden am Standort"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, marginTop: 2 } }, solarReg.name, " ", data.plz ? `(PLZ ${data.plz})` : "")), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "right" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 22, fontWeight: 900, color: BRAND.yellow, fontFamily: fontMono, lineHeight: 1 } }, solarReg.sonne.toLocaleString("de")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, "h/Jahr \xB7 ", solarReg.ertrag, " kWh/kWp"))), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, marginBottom: 14 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5 } }, "\u{1F333} Verschattung"), verschattungsFaktor < 1 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: BRAND.yellow } }, "Ertrag: ", Math.round(verschattungsFaktor * 100), "%")), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 8 } }, [{ k: "verschattungMorgen", l: "\u{1F305} Morgens", t: "6\u201310 Uhr" }, { k: "verschattungMittag", l: "\u2600\uFE0F Mittag", t: "10\u201314 Uhr" }, { k: "verschattungNachm", l: "\u{1F307} Nachm.", t: "14\u201318 Uhr" }].map((s) => {
    const val = parseFloat(data[s.k]) || 0;
    return /* @__PURE__ */ React.createElement("div", { key: s.k, style: { textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 600, color: T.text } }, s.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, s.t), /* @__PURE__ */ React.createElement(
      "input",
      {
        type: "range",
        min: "0",
        max: "50",
        step: "5",
        value: val,
        onChange: (e) => u(s.k, e.target.value),
        style: { width: "100%", marginTop: 4, accentColor: val > 20 ? T.red : BRAND.yellow }
      }
    ), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 700, color: val > 20 ? T.red : val > 0 ? BRAND.yellow : T.textDim, fontFamily: fontMono } }, val, "%"));
  }))), /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 14 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "Monatliche PV vs. Verbrauch vs. Eigenverbrauch"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 2, alignItems: "flex-end", height: 100, padding: "0 2px" } }, monatsDetail.map((m, i) => {
    const maxVal = Math.max(...monatsDetail.map((x) => Math.max(x.pv, verbrauchMonat)));
    const pvH = maxVal > 0 ? m.pv / maxVal * 78 : 0;
    const vH = maxVal > 0 ? verbrauchMonat / maxVal * 78 : 0;
    const eH = maxVal > 0 ? m.eigen / maxVal * 78 : 0;
    const aH = maxVal > 0 ? m.akku / maxVal * 78 : 0;
    const dH = eH - aH;
    return /* @__PURE__ */ React.createElement("div", { key: i, style: { flex: 1, display: "flex", flexDirection: "column", alignItems: "center", gap: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { width: "100%", display: "flex", gap: 1, alignItems: "flex-end", justifyContent: "center", height: 80 } }, /* @__PURE__ */ React.createElement("div", { style: { width: "30%", height: pvH, background: BRAND.yellow, borderRadius: "3px 3px 0 0", minHeight: 2 } }), /* @__PURE__ */ React.createElement("div", { style: { width: "30%", display: "flex", flexDirection: "column", justifyContent: "flex-end" } }, /* @__PURE__ */ React.createElement("div", { style: { height: Math.max(0, dH), background: T.green, borderRadius: "3px 0 0 0", minHeight: dH > 0 ? 1 : 0 } }), /* @__PURE__ */ React.createElement("div", { style: { height: Math.max(0, aH), background: T.blue, borderRadius: aH > 0 && dH <= 0 ? "3px 0 0 0" : "0", minHeight: aH > 0 ? 1 : 0 } })), /* @__PURE__ */ React.createElement("div", { style: { width: "30%", height: vH, background: `${T.red}40`, borderRadius: "3px 3px 0 0", minHeight: 2 } })), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, marginTop: 2 } }, m.label));
  })), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 10, justifyContent: "center", marginTop: 6, flexWrap: "wrap" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 3 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 8, height: 8, borderRadius: 2, background: BRAND.yellow } }), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 8, color: T.textDim } }, "PV")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 3 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 8, height: 8, borderRadius: 2, background: T.green } }), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 8, color: T.textDim } }, "Direkt")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 3 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 8, height: 8, borderRadius: 2, background: T.blue } }), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 8, color: T.textDim } }, "Akku")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 3 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 8, height: 8, borderRadius: 2, background: `${T.red}40` } }), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 8, color: T.textDim } }, "Bedarf"))), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textAlign: "center", marginTop: 4 } }, "\xDCberschuss Sommer \u2192 Einspeisung ", einspeisungsErloes, " \u20AC/a \xB7 Winter \u2192 Zukauf ca. ", restZukaufMonat, " \u20AC/Monat \xD8")), /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: `${T.blue}06`, borderRadius: 12, border: `1.5px solid ${T.blue}20`, marginBottom: 14 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.blue, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 10 } }, "\u{1F50B} Akku-Analyse \xB7 Tag/Nacht-Zyklus"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 0, marginBottom: 10, borderRadius: 10, overflow: "hidden", height: 36 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: "45", background: `${T.blue}15`, display: "flex", alignItems: "center", justifyContent: "center", position: "relative" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, fontWeight: 600, color: T.blue } }, "\u{1F319} Nacht \xB7 ", nachtVerbrauchKwh.toFixed(1), " kWh")), /* @__PURE__ */ React.createElement("div", { style: { flex: "55", background: `${BRAND.yellow}15`, display: "flex", alignItems: "center", justifyContent: "center" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, fontWeight: 600, color: BRAND.yellow } }, "\u2600\uFE0F Tag \xB7 ", (tagesVerbrauchKwh * tagesVerbrauchAnteil).toFixed(1), " kWh"))), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 6, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: `${BRAND.yellow}08`, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16 } }, "\u2600\uFE0F"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, textTransform: "uppercase" } }, "PV erzeugt"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono } }, (pvErzeugung / 365).toFixed(1)), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, "kWh/Tag \xD8")), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: `${T.green}08`, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16 } }, "\u26A1"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, textTransform: "uppercase" } }, "Direkt genutzt"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 800, color: T.green, fontFamily: fontMono } }, (eigenverbrauchDirekt / 365).toFixed(1)), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, "kWh/Tag \xD8")), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: `${T.blue}08`, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16 } }, "\u{1F50B}"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, textTransform: "uppercase" } }, "Akku \u2192 Nacht"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 800, color: T.blue, fontFamily: fontMono } }, speicherKwh > 0 ? (eigenverbrauchAkku / 365).toFixed(1) : "\u2013"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, "kWh/Tag \xD8"))), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 600, color: T.text } }, "Nachtverbrauch (\xD8 18\u201306 Uhr)"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14, fontWeight: 800, color: T.blue, fontFamily: fontMono } }, nachtVerbrauchKwh.toFixed(1), " kWh")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 600, color: T.text } }, "Empfohlene Akku-Gr\xF6\xDFe"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14, fontWeight: 800, color: T.blue, fontFamily: fontMono } }, empfohlenerAkku.toFixed(1), " kWh")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, fontWeight: 600, color: T.text } }, "Gew\xE4hlter Akku"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14, fontWeight: 800, color: akkuBewertung === "optimal" ? T.green : akkuBewertung === "kein" ? T.red : BRAND.yellow, fontFamily: fontMono } }, speicherKwh > 0 ? `${speicherKwh.toLocaleString("de-DE", { minimumFractionDigits: 1 })} kWh` : "keiner")), empfohlenerAkku > 0 && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { height: 8, borderRadius: 4, background: T.border, position: "relative", overflow: "hidden" } }, /* @__PURE__ */ React.createElement("div", { style: {
    height: "100%",
    borderRadius: 4,
    transition: "width 0.3s",
    width: `${Math.min(100, speicherKwh / empfohlenerAkku * 100)}%`,
    background: akkuBewertung === "optimal" ? T.green : akkuBewertung === "klein" ? BRAND.yellow : akkuBewertung === "gross" ? T.blue : T.red
  } }), /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", top: -2, left: `${Math.min(95, 100 / (Math.max(speicherKwh, empfohlenerAkku) / empfohlenerAkku) * 100)}%`, width: 2, height: 12, background: T.text, borderRadius: 1 } })), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", marginTop: 3 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 8, color: T.textDim } }, "0 kWh"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 8, color: T.textDim } }, "\u25B2 Empfohlen ", empfohlenerAkku.toFixed(1)), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 8, color: T.textDim } }, Math.max(speicherKwh, empfohlenerAkku * 1.5).toFixed(0), " kWh"))), /* @__PURE__ */ React.createElement("div", { style: {
    marginTop: 8,
    padding: "8px 12px",
    borderRadius: 8,
    background: akkuBewertung === "optimal" ? `${T.green}10` : akkuBewertung === "klein" ? `${BRAND.yellow}10` : akkuBewertung === "gross" ? `${T.blue}10` : `${T.red}10`,
    border: `1px solid ${akkuBewertung === "optimal" ? T.green : akkuBewertung === "klein" ? BRAND.yellow : akkuBewertung === "gross" ? T.blue : T.red}20`
  } }, /* @__PURE__ */ React.createElement("div", { style: {
    fontSize: 11,
    fontWeight: 600,
    color: akkuBewertung === "optimal" ? T.green : akkuBewertung === "klein" ? BRAND.yellow : akkuBewertung === "gross" ? T.blue : T.red
  } }, akkuBewertung === "kein" && "\u26A0\uFE0F Ohne Akku nur ~30% Eigenverbrauch tags\xFCber \u2013 nachts 100% Netzbezug", akkuBewertung === "klein" && `\u26A1 Akku deckt nur ${Math.round(speicherKwh / nachtVerbrauchKwh * 100)}% der Nacht \u2013 Zusatzspeicher empfohlen`, akkuBewertung === "optimal" && `\u2705 Akku deckt ${Math.min(100, Math.round(akkuNutzbar / nachtVerbrauchKwh * 100))}% der Nacht \u2013 optimale Gr\xF6\xDFe!`, akkuBewertung === "gross" && `\u{1F50B} Gro\xDFer Akku \u2013 ideal bei E-Auto / W\xE4rmepumpe / hohem Abendverbrauch`), (akkuBewertung === "klein" || akkuBewertung === "kein") && baseAkku2 > 0 && (() => {
    const zsModulSize = baseAkku2 === 6.4 ? 3.2 : 4.92;
    const fehlend = Math.max(0, empfohlenerAkku - speicherKwh);
    const benoetigteModule = Math.min(3 - zsCount, Math.max(1, Math.ceil(fehlend / zsModulSize)));
    const neueAnzahl = zsCount + benoetigteModule;
    const neuerSpeicher = baseAkku2 + neueAnzahl * zsModulSize;
    const zusatzKosten = zsModulSize === 3.2 ? benoetigteModule * 1500 : benoetigteModule * 2e3;
    if (benoetigteModule <= 0) return null;
    return /* @__PURE__ */ React.createElement("button", { onClick: () => u("zusatzSpeicher", `${zsModulSize}_${neueAnzahl}`), style: {
      marginTop: 8,
      width: "100%",
      padding: "10px 14px",
      borderRadius: 10,
      border: "none",
      cursor: "pointer",
      background: `linear-gradient(135deg, ${BRAND.yellow}, ${BRAND.yellow}CC)`,
      color: "#000",
      fontFamily: font,
      display: "flex",
      alignItems: "center",
      justifyContent: "space-between",
      boxShadow: `0 3px 12px ${BRAND.yellow}30`
    } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18 } }, "\u{1F50B}"), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "left" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700 } }, "+", benoetigteModule, "\xD7 ", zsModulSize.toLocaleString("de-DE"), " kWh Zusatzakku buchen"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, opacity: 0.8 } }, speicherKwh.toLocaleString("de-DE"), " \u2192 ", neuerSpeicher.toLocaleString("de-DE"), " kWh \xB7 Nacht ", Math.min(100, Math.round(neuerSpeicher * 0.9 / nachtVerbrauchKwh * 100)), "% gedeckt"))), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "right" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 800, fontFamily: fontMono } }, "+", zusatzKosten.toLocaleString("de-DE"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, opacity: 0.7 } }, "netto")));
  })())), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", borderRadius: 10, textAlign: "center", background: T.surface, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textTransform: "uppercase" } }, "Ohne Akku"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, fontWeight: 900, color: T.textSec, fontFamily: fontMono } }, Math.round(autarkieOhneAkku * 100), "%"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Autarkie"), /* @__PURE__ */ React.createElement("div", { style: { height: 4, borderRadius: 2, background: T.border, marginTop: 4 } }, /* @__PURE__ */ React.createElement("div", { style: { height: "100%", borderRadius: 2, width: `${Math.round(autarkieOhneAkku * 100)}%`, background: T.textDim } }))), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", borderRadius: 10, textAlign: "center", background: `${T.green}06`, border: `1.5px solid ${T.green}25` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.green, textTransform: "uppercase", fontWeight: 600 } }, "Mit ", speicherKwh > 0 ? speicherKwh.toLocaleString("de-DE", { minimumFractionDigits: 1 }) + " kWh" : "Akku"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, fontWeight: 900, color: T.green, fontFamily: fontMono } }, Math.round(autarkiegrad * 100), "%"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Autarkie"), /* @__PURE__ */ React.createElement("div", { style: { height: 4, borderRadius: 2, background: T.border, marginTop: 4 } }, /* @__PURE__ */ React.createElement("div", { style: { height: "100%", borderRadius: 2, width: `${Math.round(autarkiegrad * 100)}%`, background: T.green } })))), speicherKwh > 0 && akkuMehrwertJahr > 0 && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, padding: "8px 12px", background: `${T.green}08`, borderRadius: 8, border: `1px solid ${T.green}20`, display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.green, fontWeight: 600 } }, "Akku spart zus\xE4tzlich"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, "Vermiedener Netzstrom \xD7 ", ap2, " ct/kWh")), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "right" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: T.green, fontFamily: fontMono } }, akkuMehrwertJahr, " \u20AC/a"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, Math.round(akkuMehrwertJahr / 12), " \u20AC/Monat")))), speicherKwh > 0 && (() => {
    const grundlastW = parseFloat(data.notstromGrundlast) || 400;
    const notstromH = Math.round(akkuNutzbar * 1e3 / grundlastW * 10) / 10;
    const notstromTage = Math.round(notstromH / 24 * 10) / 10;
    return /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", background: `${T.blue}06`, borderRadius: 12, border: `1.5px solid ${T.blue}20`, marginBottom: 14 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: T.blue, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "\u{1F526} Notstrom bei Blackout"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8, alignItems: "center", marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1, fontSize: 10, color: T.textSec } }, "Grundlast (W)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 4 } }, [200, 300, 400, 500, 700].map((w) => /* @__PURE__ */ React.createElement("div", { key: w, onClick: () => u("notstromGrundlast", String(w)), style: {
      padding: "4px 8px",
      borderRadius: 6,
      fontSize: 10,
      fontWeight: 600,
      cursor: "pointer",
      background: grundlastW === w ? T.blue : T.surface,
      color: grundlastW === w ? "#fff" : T.textSec,
      border: `1px solid ${grundlastW === w ? T.blue : T.border}`
    } }, w, "W")))), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", background: T.surface, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Notstrom-Dauer"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 22, fontWeight: 900, color: T.blue, fontFamily: fontMono } }, notstromH, " h"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "= ", notstromTage, " Tage")), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", background: T.surface, borderRadius: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginBottom: 4 } }, "Versorgt bei ", grundlastW, "W:"), grundlastW <= 300 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.text } }, "\u{1F4A1} Licht, \u{1F4F1} Router, \u{1F4FA} TV"), grundlastW > 300 && grundlastW <= 500 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.text } }, "\u{1F4A1} Licht, \u{1F9CA} K\xFChlschrank, \u{1F4F1} Router, \u{1F4FA} TV"), grundlastW > 500 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.text } }, "\u{1F4A1} Licht, \u{1F9CA} K\xFChl+Gefrier, \u{1F4F1} Router, \u{1F4BB} PC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.green, fontWeight: 600, marginTop: 4 } }, "+ PV-Nachladen am Tag!"))));
  })(), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 6, marginBottom: 14 } }, [
    { l: "PV-Erzeugung", v: pvErzeugung.toLocaleString("de"), u: "kWh/a", c: BRAND.yellow },
    { l: "Anlagengr\xF6\xDFe", v: kwpAnlage.toFixed(2), u: "kWp", c: T.text },
    { l: "Batterie", v: speicherKwh > 0 ? speicherKwh.toLocaleString("de-DE", { minimumFractionDigits: 1, maximumFractionDigits: 1 }) : "\u2013", u: "kWh", c: T.blue },
    { l: "Direkt genutzt", v: eigenverbrauchDirekt.toLocaleString("de"), u: "kWh/a", c: T.green },
    { l: "\xDCber Akku", v: speicherKwh > 0 ? eigenverbrauchAkku.toLocaleString("de") : "\u2013", u: "kWh/a", c: T.blue },
    { l: "Autarkiegrad", v: `${Math.round(autarkiegrad * 100)}%`, u: "", c: T.green },
    { l: "Einspeisung", v: einspeisung.toLocaleString("de"), u: "kWh/a", c: BRAND.yellow },
    { l: "Einspeise-Erl\xF6s", v: Math.round(einspeiseverguetung), u: "\u20AC/a", c: BRAND.yellow },
    { l: "Netzbezug Rest", v: restStrom.toLocaleString("de"), u: "kWh/a", c: T.red }
  ].map((item, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { padding: "8px 10px", background: T.surface, borderRadius: 8, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, textTransform: "uppercase" } }, item.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: item.c, fontFamily: fontMono } }, item.v, " ", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: T.textDim } }, item.u))))), /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", background: T.surface, borderRadius: 12, border: `1px solid ${T.border}`, marginBottom: 14 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: BRAND.yellow, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8, textAlign: "center" } }, "\u{1F3E0} Ihre Anlage auf dem Dach \u2013 Vorschau"), (() => {
    const dachTyp = data.dachform || "Satteldach";
    const himmelsR = data.himmelsrichtung || "S";
    return /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "center", gap: 6, marginBottom: 8 } }, ["S", "SO", "SW", "O", "W", "O/W"].map((hr) => /* @__PURE__ */ React.createElement("div", { key: hr, onClick: () => u("himmelsrichtung", hr), style: {
      padding: "3px 8px",
      borderRadius: 6,
      fontSize: 9,
      fontWeight: 600,
      cursor: "pointer",
      background: himmelsR === hr ? BRAND.yellow : T.bg,
      color: himmelsR === hr ? "#000" : T.textDim,
      border: `1px solid ${himmelsR === hr ? BRAND.yellow : T.border}`
    } }, hr))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "center", gap: 4, marginBottom: 8 } }, [{ k: "sat", l: "\u{1F6F0}\uFE0F Satellit" }, { k: "schema", l: "\u{1F4D0} Schema" }].map((m) => /* @__PURE__ */ React.createElement("div", { key: m.k, onClick: () => setViewMode(m.k), style: {
      padding: "3px 10px",
      borderRadius: 6,
      fontSize: 9,
      fontWeight: 600,
      cursor: "pointer",
      background: viewMode === m.k ? T.blue : T.bg,
      color: viewMode === m.k ? "#fff" : T.textDim,
      border: `1px solid ${viewMode === m.k ? T.blue : T.border}`
    } }, m.l))), /* @__PURE__ */ React.createElement("canvas", { ref: canvasRef, width: 320, height: 240, style: {
      width: "100%",
      maxWidth: 320,
      height: "auto",
      aspectRatio: "320/240",
      borderRadius: 10,
      border: `1px solid ${T.border}`,
      display: "block",
      margin: "0 auto"
    } }), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", marginTop: 6, fontSize: 10, color: T.textSec } }, modulAnz, " \xD7 Aiko Neostar 2S+ (470W) \xB7 ", kwpAnlage.toFixed(1), " kWp \xB7 ", himmelsR, "-Ausrichtung"), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", marginTop: 4, fontSize: 8, color: T.textDim } }, "\u{1F4A1} In der PWA-Version: Echtes Google Satellitenbild der Kundenadresse mit Modul-Overlay"));
  })()), stromkostenMonat > 0 && (() => {
    const kostenProSekunde = stromkostenMonat * 12 / 365 / 24 / 3600;
    const verloren = (tickSec * kostenProSekunde).toFixed(2);
    const verlorenHeute = (kostenProSekunde * 3600 * (/* @__PURE__ */ new Date()).getHours()).toFixed(2);
    return /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: `${T.red}08`, borderRadius: 12, border: `2px solid ${T.red}25`, marginBottom: 12, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.red, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5 } }, "\u23F1\uFE0F Seit Beginn dieses Gespr\xE4chs verloren:"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 28, fontWeight: 900, color: T.red, fontFamily: fontMono, marginTop: 4, letterSpacing: 1 } }, parseFloat(verloren).toLocaleString("de-DE", { minimumFractionDigits: 2 }), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 2 } }, "an den Stromversorger \xB7 ", (kostenProSekunde * 3600).toFixed(2), " \u20AC pro Stunde \xB7 ", Math.round(stromkostenMonat * 12).toLocaleString("de"), " \u20AC pro Jahr"));
  })(), /* @__PURE__ */ React.createElement("div", { style: { padding: "16px 18px", background: T.surface, borderRadius: 14, border: `2px solid ${T.green}30`, marginBottom: 14 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: T.green, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 12, textAlign: "center" } }, "\u{1F4B0} Ihre neue Rechnung mit bee-doo"), /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", background: `${T.red}06`, borderRadius: 10, border: `1px solid ${T.red}15`, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.red, fontWeight: 600, textTransform: "uppercase" } }, "\u274C Vorher \xB7 ohne PV"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginTop: 2 } }, "Stromabschlag an Versorger", stromSteigerung > 0 && ` \xB7 steigt ${(stromSteigerung * 100).toFixed(0)}% p.a.`)), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "right" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 24, fontWeight: 900, color: T.red, fontFamily: fontMono } }, Math.round(stromkostenMonat), " \u20AC", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "/mtl.")), stromSteigerung > 0 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.red, opacity: 0.7 } }, "in 10J: ~", Math.round(stromkostenMonat * Math.pow(1 + stromSteigerung, 10)), " \u20AC/mtl.")))), /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", background: `${T.green}06`, borderRadius: 10, border: `1px solid ${T.green}15`, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.green, fontWeight: 600, textTransform: "uppercase", marginBottom: 8 } }, "\u2705 Nachher \xB7 mit bee-doo PV", data.preismodell === "Kauf" ? " (Barkauf)" : ""), (() => {
    const z = parseFloat(data.zins) / 100 / 12;
    const az = parseFloat(data.anzahlung) || 0;
    const kr = Math.max(0, gesamtPreis - az);
    const selJ = parseInt(data.finanzJahre) || 15;
    const rate = kr > 0 && z > 0 ? kr * z / (1 - Math.pow(1 + z, -(selJ * 12))) : 0;
    const hasRate = !isBarkauf && rate > 0;
    const displayRate = hasRate ? Math.round(rate) : isBarkauf ? 0 : Math.round(gesamtPreis / 180);
    return /* @__PURE__ */ React.createElement(React.Fragment, null, isBarkauf ? /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6, paddingBottom: 6, borderBottom: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: BRAND.yellow } }, "\u{1F4B0} Einmalinvestition (Barkauf)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Keine monatliche Rate \xB7 keine Zinsen")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono } }, gesamtPreis.toLocaleString("de-DE"), " \u20AC")) : /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6, paddingBottom: 6, borderBottom: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.text } }, "\u{1F4CB} PV-Rate", hasRate ? ` (${selJ}J, ${parseFloat(data.zins).toLocaleString("de")}%)` : "")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: T.text, fontFamily: fontMono } }, displayRate, " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6, paddingBottom: 6, borderBottom: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.text } }, "\u26A1 Restzukauf Strom (\xD8)", dynTarifAktiv2 && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: T.green, marginLeft: 4 } }, "dyn. ", dynAP2, " ct")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "v.a. Nov\u2013Feb \xB7 Grundpreis anteilig", dynTarifAktiv2 && " \xB7 dynamischer Tarif")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: T.text, fontFamily: fontMono } }, restZukaufMonat, " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6, paddingBottom: 6, borderBottom: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.green } }, "\u2600\uFE0F Einspeiseverg\xFCtung (\xD8)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "\xDCberschuss \u2192 Netz \xB7 7,78 ct/kWh")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: T.green, fontFamily: fontMono } }, "\u2212", einspeisungsErloesMtl, " \u20AC")), par14Aktiv && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6, paddingBottom: 6, borderBottom: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.blue } }, "\u2696\uFE0F \xA714a EnWG Erstattung"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Netzentgeltreduzierung Modul 1 \xB7 ", par14ErstattungJahr, " \u20AC/a")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: T.blue, fontFamily: fontMono } }, "\u2212", par14ErstattungMtl, " \u20AC")), dynTarifAktiv2 && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6, paddingBottom: 6, borderBottom: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.green } }, "\u26A1 Dyn. Tarif (", dynAP2, " ct statt ", ap2, " ct)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Ersparnis durch g\xFCnstigeren Reststrom")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: T.green, fontFamily: fontMono, textAlign: "right" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: T.textDim } }, "bereits eingerechnet"))), steuerbonus > 0 && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 6, paddingBottom: 6, borderBottom: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.green } }, "\u{1F9FE} \xA735a Steuerbonus (1. Jahr)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Handwerkerleistung \xB7 ", steuerbonus.toLocaleString("de"), " \u20AC auf 12 Monate")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: T.green, fontFamily: fontMono } }, "\u2212", steuerbonusMtl, " \u20AC")), /* @__PURE__ */ React.createElement("div", { onClick: () => setData((d) => ({ ...d, _evSalesPitch: !d._evSalesPitch })), style: {
      display: "flex",
      justifyContent: "space-between",
      alignItems: "center",
      marginBottom: 6,
      paddingBottom: 6,
      borderBottom: `1px solid ${T.border}`,
      cursor: "pointer"
    } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 36, height: 20, borderRadius: 10, background: data._evSalesPitch ? T.green : T.border, transition: "all 0.2s", position: "relative" } }, /* @__PURE__ */ React.createElement("div", { style: { width: 16, height: 16, borderRadius: 8, background: "#fff", position: "absolute", top: 2, left: data._evSalesPitch ? 18 : 2, transition: "all 0.2s", boxShadow: "0 1px 3px rgba(0,0,0,0.2)" } })), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: data._evSalesPitch ? T.green : T.textSec } }, "\u{1F697} E-Auto zu Hause laden"), hasEVData && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, evKmJ.toLocaleString("de"), " km/a \xB7 ", evHome, "% daheim \xB7 spart ", evSparJahr.toLocaleString("de"), " \u20AC/a vs. Benziner"), !hasEVData && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "E-Auto-Daten oben eingeben"))), data._evSalesPitch && hasEVData && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: T.green, fontFamily: fontMono } }, "\u2212", Math.round(evSparJahr / 12), " \u20AC")), (() => {
      const summeNachher = (isBarkauf ? 0 : displayRate) + restZukaufMonat - einspeisungsErloesMtl - par14ErstattungMtl - steuerbonusMtl - (data._evSalesPitch && hasEVData ? Math.round(evSparJahr / 12) : 0);
      return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: T.green } }, isBarkauf ? "Laufende Kosten / Monat" : "Summe / Monat", steuerbonus > 0 ? " (1. Jahr)" : ""), isBarkauf && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "nach einmaliger Investition"), steuerbonus > 0 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "inkl. \xA735a Steuerbonus \xB7 ab 2. Jahr ", steuerbonusMtl, " \u20AC mehr")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 22, fontWeight: 900, color: T.green, fontFamily: fontMono } }, summeNachher, " \u20AC", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "/mtl.")));
    })());
  })()), (() => {
    const z2 = parseFloat(data.zins) / 100 / 12;
    const az2 = parseFloat(data.anzahlung) || 0;
    const kr2 = Math.max(0, gesamtPreis - az2);
    const selJ2 = parseInt(data.finanzJahre) || 15;
    const rate2 = kr2 > 0 && z2 > 0 ? kr2 * z2 / (1 - Math.pow(1 + z2, -(selJ2 * 12))) : 0;
    const hasRate2 = !isBarkauf && rate2 > 0;
    const displayRate2 = hasRate2 ? Math.round(rate2) : isBarkauf ? 0 : Math.round(gesamtPreis / 180);
    const summeNachher2 = (isBarkauf ? 0 : displayRate2) + restZukaufMonat - einspeisungsErloesMtl - par14ErstattungMtl - steuerbonusMtl - (data._evSalesPitch && hasEVData ? Math.round(evSparJahr / 12) : 0);
    const diffMonat = Math.round(stromkostenMonat) - summeNachher2;
    const nachLaufzeit = isBarkauf ? 0 : selJ2 || 15;
    const laufendeKosten = restZukaufMonat - einspeisungsErloesMtl - par14ErstattungMtl;
    return /* @__PURE__ */ React.createElement(React.Fragment, null, !isBarkauf && /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", padding: "12px 16px", background: diffMonat >= 0 ? T.green : `${T.red}DD`, borderRadius: 10, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.8)", fontWeight: 600, textTransform: "uppercase" } }, diffMonat >= 0 ? "Ihre monatliche Ersparnis" : "Monatliche Mehrkosten (Investition)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 28, fontWeight: 900, color: "#fff", fontFamily: fontMono, lineHeight: 1.2 } }, diffMonat >= 0 ? "" : "+", Math.abs(diffMonat), " \u20AC", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14 } }, "/Monat")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.7)", marginTop: 2 } }, "= ", Math.abs(diffMonat * 12).toLocaleString("de"), " \u20AC/Jahr ", diffMonat >= 0 ? "gespart" : "investiert")), isBarkauf && /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", padding: "12px 16px", background: T.green, borderRadius: 10, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.8)", fontWeight: 600, textTransform: "uppercase" } }, "Barkauf \xB7 laufende Kosten nach Investition"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 28, fontWeight: 900, color: "#fff", fontFamily: fontMono, lineHeight: 1.2 } }, Math.max(0, laufendeKosten), " \u20AC", /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14 } }, "/Monat")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: "rgba(255,255,255,0.7)", marginTop: 2 } }, "statt ", Math.round(stromkostenMonat), " \u20AC/Monat \xB7 Ersparnis: ", Math.round(stromkostenMonat) - Math.max(0, laufendeKosten), " \u20AC/mtl.")), !isBarkauf && /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", padding: "10px 14px", background: `${T.green}08`, borderRadius: 10, border: `1px solid ${T.green}20`, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.green, fontWeight: 600, textTransform: "uppercase" } }, "Nach ", nachLaufzeit, " Jahren \xB7 Anlage abbezahlt"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, marginTop: 4 } }, "Dann nur noch ", /* @__PURE__ */ React.createElement("strong", { style: { color: T.green, fontSize: 14 } }, Math.max(0, laufendeKosten), " \u20AC/Monat"), " laufende Kosten", dynTarifAktiv2 && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 9, color: T.textDim } }, " (", dynAP2, " ct)")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 4 } }, "Statt dann ~", Math.round(stromkostenMonat * Math.pow(1 + stromSteigerung, nachLaufzeit)), " \u20AC/Monat an den Versorger (mit ", (stromSteigerung * 100).toFixed(0), "% Steigerung)")), /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: `${T.green}06`, borderRadius: 12, border: `2px solid ${T.green}25`, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.green, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 10, textAlign: "center" } }, "\u{1F4CA} 25-Jahres-Projektion (mit ", (stromSteigerung * 100).toFixed(0), "% Steigerung p.a.)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", padding: "8px 12px", background: `${T.red}08`, borderRadius: 8, border: `1px solid ${T.red}15`, marginBottom: 6 } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: T.red } }, "\u274C Ohne PV \xB7 25 Jahre Strom kaufen"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, ap2, " ct \u2192 ", (ap2 * Math.pow(1 + stromSteigerung, 24)).toFixed(0), " ct in Jahr 25")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 900, color: T.red, fontFamily: fontMono } }, Math.round(ohnePV25).toLocaleString("de"), " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center", padding: "8px 12px", background: `${T.green}08`, borderRadius: 8, border: `1px solid ${T.green}15`, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: T.green } }, "\u2705 Mit bee-doo PV \xB7 ", isBarkauf ? "Barkauf" : `${selJ2}J Finanzierung`), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Anlage + Reststrom \u2212 Einspeisung", par14Aktiv ? " \u2212 \xA714a" : "", steuerbonus > 0 ? " \u2212 \xA735a" : "")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 900, color: T.green, fontFamily: fontMono } }, Math.round(mitPVGesamt25).toLocaleString("de"), " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", padding: "10px 14px", background: T.green, borderRadius: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.8)", fontWeight: 600, textTransform: "uppercase" } }, "Ihre Ersparnis \xFCber 25 Jahre"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 28, fontWeight: 900, color: "#fff", fontFamily: fontMono } }, Math.round(ersparnis25).toLocaleString("de"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: "rgba(255,255,255,0.7)" } }, Math.round(ersparnis25 / 25).toLocaleString("de"), " \u20AC/Jahr \xB7 ", Math.round(ersparnis25 / 300).toLocaleString("de"), " \u20AC/Monat \xD8"))));
  })()), /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 18px", background: T.accentGlow, borderRadius: 12, border: `1px solid ${BRAND.yellow}40`, display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14, fontWeight: 600, color: BRAND.yellow } }, "Ersparnis bee-doo (25J)"), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "right" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono } }, Math.round(ersparnis25).toLocaleString("de"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: BRAND.yellow, opacity: 0.7 } }, Math.round(ersparnis25 / 25).toLocaleString("de"), " \u20AC/Jahr \xD8"))), ersparnis25 > 0 && (() => {
    const renditeProzent = Math.round(ersparnis25 / gesamtPreis * 100);
    return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 8, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 8px", borderRadius: 10, textAlign: "center", background: `${T.green}08`, border: `1px solid ${T.green}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14 } }, "\u23F1\uFE0F"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: T.green, fontFamily: fontMono } }, amortJahreDyn), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Amortisation (Jahre)")), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 8px", borderRadius: 10, textAlign: "center", background: `${BRAND.yellow}08`, border: `1px solid ${BRAND.yellow}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14 } }, "\u{1F4B0}"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono } }, (ersparnis25 / 1e3).toFixed(0), "k"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Gewinn 25 Jahre (\u20AC)")), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 8px", borderRadius: 10, textAlign: "center", background: `${T.blue}08`, border: `1px solid ${T.blue}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14 } }, "\u{1F4C8}"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: T.blue, fontFamily: fontMono } }, renditeProzent, "%"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Rendite 25 Jahre"))), amortJahreDyn < 12 && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, display: "flex", justifyContent: "center" } }, /* @__PURE__ */ React.createElement(Buddy, { emoji: amortJahreDyn < 8 ? "\u{1F525}" : "\u{1F41D}", size: 18, msg: amortJahreDyn < 8 ? "Top-Rendite! \u{1F36F}\u{1F36F}\u{1F36F}" : "Solides Investment!" })));
  })(), data.preismodell === "Finanzierung" && gesamtPreis > 0 && /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: `${T.blue}06`, borderRadius: 12, border: `1.5px solid ${T.blue}25`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.blue, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 10, textAlign: "center" } }, "\u{1F3C6} Finanzierungs-Empfehlung (", zinsAktuell.toLocaleString("de"), "%)"), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 6 } }, finanzOptionen.map((o) => {
    const isBest = o.j === besteOption.j;
    const isSelected = o.j === (parseInt(data.finanzJahre) || 15);
    return /* @__PURE__ */ React.createElement("div", { key: o.j, onClick: () => u("finanzJahre", String(o.j)), style: {
      padding: "10px 12px",
      borderRadius: 10,
      cursor: "pointer",
      position: "relative",
      background: isBest ? `${T.green}10` : T.surface,
      border: `${isSelected ? 2 : 1}px solid ${isBest ? T.green : isSelected ? T.blue : T.border}`
    } }, isBest && /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", top: -8, right: 8, fontSize: 9, fontWeight: 700, background: T.green, color: "#fff", padding: "2px 6px", borderRadius: 4 } }, "EMPFOHLEN"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: isBest ? T.green : T.text, fontFamily: fontMono } }, o.j, " Jahre"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, marginTop: 2 } }, "Rate: ", /* @__PURE__ */ React.createElement("strong", { style: { color: T.text } }, o.rateM, " \u20AC/mtl.")), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, "Nachher: ", o.monatNachher, " \u20AC/mtl."), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, "Zinskosten: ", o.zinskosten.toLocaleString("de"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 600, color: isBest ? T.green : T.textSec, marginTop: 4 } }, "25J-Ersparnis: ", o.ersparnis.toLocaleString("de"), " \u20AC"));
  })), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, padding: "8px 12px", background: `${T.green}08`, borderRadius: 8, border: `1px solid ${T.green}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.green, fontWeight: 600 } }, "\u{1F4A1} Empfehlung: ", besteOption.j, " Jahre"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 2 } }, "Maximale 25-Jahres-Ersparnis: ", /* @__PURE__ */ React.createElement("strong", { style: { color: T.green } }, besteOption.ersparnis.toLocaleString("de"), " \u20AC"), ".", besteOption.j <= 10 ? " Kurze Laufzeit = weniger Zinsen, schneller schuldenfrei." : besteOption.j >= 20 ? " Lange Laufzeit = niedrigste Rate, maximaler Cashflow." : " Guter Kompromiss zwischen Rate und Gesamtkosten."))), /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: `${BRAND.yellow}06`, borderRadius: 12, border: `1.5px solid ${BRAND.yellow}20`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: BRAND.yellow, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 6, textAlign: "center" } }, '\u{1F3E6} "Kann ich das Geld nicht besser anlegen?"'), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textAlign: "center", marginBottom: 10 } }, "Was passiert, wenn der Kunde ", gesamtPreis.toLocaleString("de"), " \u20AC statt in PV auf ein Festgeldkonto einzahlt?"), (() => {
    const zinsPa = parseFloat(anlageZins) || 3.5;
    const invest = gesamtPreis;
    const selJ = parseInt(data.finanzJahre) || 15;
    const perioden = [5, 10, 15, 20, 25];
    const pvCumSavings = [];
    let cumOhne = 0, cumMit = isBarkauf ? invest : 0;
    const selRate = isBarkauf ? 0 : (finanzOptionen.find((f) => f.j === selJ) || finanzOptionen[0]).rateM;
    for (let y = 0; y < 25; y++) {
      const apY = ap2 * Math.pow(1 + stromSteigerung, y);
      const dynAPy = dynAP2 * Math.pow(1 + stromSteigerung, y);
      cumOhne += gesamt * apY / 100 + gp * 12;
      const rateY = !isBarkauf && y < selJ ? selRate * 12 : 0;
      cumMit += rateY + restStrom * dynAPy / 100 + gp * 12 - einspeisungsErloes - par14ErstattungJahr - (y === 0 ? steuerbonus : 0);
      pvCumSavings.push(Math.round(cumOhne - cumMit));
    }
    return /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginBottom: 4 } }, "Marktzins Festgeld / ETF (\xD8 p.a.):"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 4 } }, ["2.0", "2.5", "3.0", "3.5", "4.0", "5.0", "7.0"].map((z) => /* @__PURE__ */ React.createElement("div", { key: z, onClick: () => {
      setAnlageZins(z);
      u("_anlageZins", z);
    }, style: {
      flex: 1,
      padding: "6px 2px",
      borderRadius: 6,
      cursor: "pointer",
      textAlign: "center",
      fontSize: 10,
      fontWeight: 600,
      background: anlageZins === z ? BRAND.yellow : T.surface,
      color: anlageZins === z ? "#000" : T.textDim,
      border: `1.5px solid ${anlageZins === z ? BRAND.yellow : T.border}`
    } }, z, "%")))), /* @__PURE__ */ React.createElement("div", { style: { overflowX: "auto" } }, /* @__PURE__ */ React.createElement("table", { style: { width: "100%", borderCollapse: "collapse", fontSize: 10 } }, /* @__PURE__ */ React.createElement("thead", null, /* @__PURE__ */ React.createElement("tr", { style: { borderBottom: `2px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("th", { style: { padding: "6px 4px", textAlign: "left", color: T.textDim, fontWeight: 600, fontSize: 9 } }, "Nach"), /* @__PURE__ */ React.createElement("th", { style: { padding: "6px 4px", textAlign: "right", color: BRAND.yellow, fontWeight: 700, fontSize: 9 } }, "\u{1F3E6} Festgeld"), /* @__PURE__ */ React.createElement("th", { style: { padding: "6px 4px", textAlign: "right", color: T.green, fontWeight: 700, fontSize: 9 } }, "\u2600\uFE0F PV-Ersparnis"), /* @__PURE__ */ React.createElement("th", { style: { padding: "6px 4px", textAlign: "right", color: T.text, fontWeight: 700, fontSize: 9 } }, "Differenz"))), /* @__PURE__ */ React.createElement("tbody", null, perioden.map((j) => {
      const festgeld = Math.round(invest * Math.pow(1 + zinsPa / 100, j));
      const zinsGewinn = festgeld - invest;
      const pvSav = pvCumSavings[j - 1] || 0;
      const diff = pvSav - zinsGewinn;
      const pvWins = diff > 0;
      return /* @__PURE__ */ React.createElement("tr", { key: j, style: {
        borderBottom: `1px solid ${T.border}`,
        background: j === selJ ? `${T.blue}06` : "transparent"
      } }, /* @__PURE__ */ React.createElement("td", { style: { padding: "7px 4px", fontWeight: j === selJ ? 700 : 400, color: T.text } }, j, " Jahre ", j === selJ && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 7, color: T.blue, fontWeight: 700 } }, "\u2190 gew\xE4hlt")), /* @__PURE__ */ React.createElement("td", { style: { padding: "7px 4px", textAlign: "right", color: BRAND.yellow, fontFamily: fontMono, fontWeight: 600 } }, "+", zinsGewinn.toLocaleString("de"), " \u20AC"), /* @__PURE__ */ React.createElement("td", { style: { padding: "7px 4px", textAlign: "right", color: T.green, fontFamily: fontMono, fontWeight: 600 } }, "+", pvSav.toLocaleString("de"), " \u20AC"), /* @__PURE__ */ React.createElement("td", { style: { padding: "7px 4px", textAlign: "right", fontFamily: fontMono, fontWeight: 700, color: pvWins ? T.green : T.red } }, pvWins ? "+" : "", diff.toLocaleString("de"), " \u20AC", pvWins && " \u2600\uFE0F"));
    })))), (() => {
      const selIdx = selJ - 1;
      const festgeldGewinn = Math.round(invest * Math.pow(1 + zinsPa / 100, selJ)) - invest;
      const pvGewinn = pvCumSavings[selIdx] || 0;
      const maxVal = Math.max(festgeldGewinn, pvGewinn, 1);
      return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginBottom: 4, textAlign: "center" } }, "Vergleich nach ", selJ, " Jahren:"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8, alignItems: "flex-end", height: 70 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1, display: "flex", flexDirection: "column", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono, marginBottom: 2 } }, "+", festgeldGewinn.toLocaleString("de"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { width: "70%", height: Math.max(8, festgeldGewinn / maxVal * 50), background: `linear-gradient(180deg, ${BRAND.yellow}CC, ${BRAND.yellow}40)`, borderRadius: "4px 4px 0 0" } }), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, marginTop: 2 } }, "\u{1F3E6} Festgeld ", zinsPa, "%")), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, display: "flex", flexDirection: "column", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 800, color: T.green, fontFamily: fontMono, marginBottom: 2 } }, "+", pvGewinn.toLocaleString("de"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { width: "70%", height: Math.max(8, pvGewinn / maxVal * 50), background: `linear-gradient(180deg, ${T.green}CC, ${T.green}40)`, borderRadius: "4px 4px 0 0" } }), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim, marginTop: 2 } }, "\u2600\uFE0F bee-doo PV"))));
    })(), (() => {
      const festgeldGewinn = Math.round(invest * Math.pow(1 + zinsPa / 100, selJ)) - invest;
      const pvGewinn = pvCumSavings[selJ - 1] || 0;
      const diff = pvGewinn - festgeldGewinn;
      const pvRendite = invest > 0 ? ((pvCumSavings[24] || 0) / invest * 100 / 25).toFixed(1) : "0";
      return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, padding: "10px 14px", borderRadius: 10, background: diff > 0 ? `${T.green}08` : `${T.red}06`, border: `1px solid ${diff > 0 ? T.green : T.red}20` } }, diff > 0 ? /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.green } }, "\u2600\uFE0F PV schl\xE4gt Festgeld um ", diff.toLocaleString("de"), " \u20AC nach ", selJ, " Jahren!"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 3 } }, "PV-Rendite: \xD8 ", pvRendite, "% p.a. \xFCber 25 Jahre \u2013 deutlich mehr als ", zinsPa, "% Festgeld. Dazu: Inflationsschutz, Unabh\xE4ngigkeit & steuerfreie Ertr\xE4ge.")) : /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: BRAND.yellow } }, "\u26A1 Kurzfristig \xE4hnlich \u2013 aber langfristig gewinnt PV!"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 3 } }, "Festgeldzinsen sind fix & steuerpflichtig (", zinsPa, "% brutto \u2192 ~", (zinsPa * 0.74).toFixed(1), "% nach KapESt). Stromersparnis steigt j\xE4hrlich um ", (stromSteigerung * 100).toFixed(0), "% \u2013 je l\xE4nger, desto besser PV.")));
    })(), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 6, fontSize: 8, color: T.textDim, textAlign: "center" } }, "Festgeld: Zinseszins brutto (vor KapESt 26,375%). PV: reale Ersparnis inkl. Strompreissteigerung ", (stromSteigerung * 100).toFixed(0), "% p.a. \xB7 steuerfrei."));
  })()), /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: `${T.red}04`, borderRadius: 12, border: `1.5px solid ${T.red}15`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.red, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 6, textAlign: "center" } }, "\u2694\uFE0F Miete (Enpal & Co.) vs. bee-doo ", isBarkauf ? "Kauf" : "Finanzierung"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textAlign: "center", marginBottom: 10 } }, '"Aber bei Enpal zahle ich doch nur 150 \u20AC/Monat\u2026"'), (() => {
    const mR = parseFloat(mietRate) || 179;
    const mJ = parseInt(mietJahre) || 20;
    const selJ = parseInt(data.finanzJahre) || 15;
    const selRate = isBarkauf ? 0 : (finanzOptionen.find((f) => f.j === selJ) || finanzOptionen[0]).rateM;
    const mietTotal = Math.round(mR * mJ * 12);
    let mietStromNach = 0;
    for (let y = mJ; y < 25; y++) {
      const apY = ap2 * Math.pow(1 + stromSteigerung, y);
      mietStromNach += gesamt * apY / 100 + gp * 12;
    }
    const mietGesamt25 = mietTotal + mietStromNach;
    const beedooGesamt25 = Math.round(mitPVGesamt25);
    const differenz = mietGesamt25 - beedooGesamt25;
    return /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginBottom: 3 } }, "Miet-Rate/Monat"), /* @__PURE__ */ React.createElement(
      "input",
      {
        type: "number",
        value: mietRate,
        onChange: (e) => {
          setMietRate(e.target.value);
          u("_mietRate", e.target.value);
        },
        style: { width: "100%", padding: "8px", background: T.surface, border: `1.5px solid ${T.border}`, borderRadius: 8, color: T.text, fontSize: 14, fontWeight: 600, fontFamily: fontMono, textAlign: "center", outline: "none", boxSizing: "border-box", WebkitAppearance: "none", MozAppearance: "textfield" }
      }
    )), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginBottom: 3 } }, "Miet-Laufzeit"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 3 } }, ["15", "20", "25"].map((j) => /* @__PURE__ */ React.createElement("div", { key: j, onClick: () => {
      setMietJahre(j);
      u("_mietJahre", j);
    }, style: {
      flex: 1,
      padding: "8px 2px",
      borderRadius: 8,
      cursor: "pointer",
      textAlign: "center",
      fontSize: 12,
      fontWeight: 600,
      background: mietJahre === j ? T.red : T.surface,
      color: mietJahre === j ? "#fff" : T.textDim,
      border: `1.5px solid ${mietJahre === j ? T.red : T.border}`
    } }, j, "J"))))), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginBottom: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "12px", background: `${T.red}06`, borderRadius: 10, border: `1.5px solid ${T.red}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.red, fontWeight: 600, textTransform: "uppercase" } }, "\u274C Miete (", mJ, "J)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginTop: 2 } }, mR, " \u20AC/Monat \xD7 ", mJ, " Jahre"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 900, color: T.red, fontFamily: fontMono, marginTop: 4 } }, mietTotal.toLocaleString("de"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 2 } }, "Anlage geh\xF6rt dir NIE"), mJ < 25 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.red, marginTop: 2 } }, "+ danach ", 25 - mJ, "J voller Netzstrom: ", Math.round(mietStromNach).toLocaleString("de"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.red, marginTop: 4, paddingTop: 4, borderTop: `1px solid ${T.red}20` } }, "25J gesamt: ", mietGesamt25.toLocaleString("de"), " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { padding: "12px", background: `${T.green}06`, borderRadius: 10, border: `1.5px solid ${T.green}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.green, fontWeight: 600, textTransform: "uppercase" } }, "\u2705 bee-doo ", isBarkauf ? "Kauf" : `Finanz. (${selJ}J)`), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginTop: 2 } }, isBarkauf ? `${gesamtPreis.toLocaleString("de")} \u20AC einmalig` : `${selRate} \u20AC/Monat \xD7 ${selJ} Jahre`), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 900, color: T.green, fontFamily: fontMono, marginTop: 4 } }, beedooGesamt25.toLocaleString("de"), " \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.green, marginTop: 2 } }, "Anlage geh\xF6rt DIR \u2713"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 2 } }, "+ danach quasi kostenloser Strom"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.green, marginTop: 4, paddingTop: 4, borderTop: `1px solid ${T.green}20` } }, "25J gesamt: ", beedooGesamt25.toLocaleString("de"), " \u20AC"))), differenz > 0 && /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: `${T.green}10`, borderRadius: 10, border: `1.5px solid ${T.green}25`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 900, color: T.green } }, "bee-doo spart ", differenz.toLocaleString("de"), " \u20AC vs. Miete!"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 3 } }, Math.round(differenz / 25 / 12), " \u20AC weniger pro Monat \xD8 \xFCber 25 Jahre.", !isBarkauf && ` Nach ${selJ}J Finanzierung geh\xF6rt Ihnen die Anlage \u2013 Mietkunden zahlen weiter.`)));
  })()), /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: `${T.green}06`, borderRadius: 12, border: `1.5px solid ${T.green}20`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.green, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8, textAlign: "center" } }, "\u{1F30D} Ihr Beitrag zum Klimaschutz"), (() => {
    const co2ProKwh = 0.38;
    const eigenverbrauchGesamt = eigenverbrauchDirekt + eigenverbrauchAkku;
    const co2JahrKg = Math.round(eigenverbrauchGesamt * co2ProKwh);
    const co2_25t = Math.round(co2JahrKg * 25 / 1e3 * 10) / 10;
    const fluegeMalle = Math.round(co2_25t / 0.75);
    const baeume = Math.round(co2_25t * 1e3 / 22);
    const autoKm = Math.round(co2_25t * 1e3 / 0.15);
    return /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", background: T.surface, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "CO\u2082-Ersparnis pro Jahr"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, fontWeight: 900, color: T.green, fontFamily: fontMono } }, (co2JahrKg / 1e3).toFixed(1), " t")), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 12px", background: T.surface, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "CO\u2082-Ersparnis 25 Jahre"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, fontWeight: 900, color: T.green, fontFamily: fontMono } }, co2_25t, " t"))), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, textAlign: "center", lineHeight: 1.6 } }, "Das entspricht ", /* @__PURE__ */ React.createElement("strong", { style: { color: T.green } }, fluegeMalle, " Fl\xFCgen"), " nach Mallorca,", " ", /* @__PURE__ */ React.createElement("strong", { style: { color: T.green } }, baeume.toLocaleString("de"), " B\xE4umen"), " pflanzen oder", " ", /* @__PURE__ */ React.createElement("strong", { style: { color: T.green } }, (autoKm / 1e3).toFixed(0), "k km"), " Autofahren vermieden."), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, textAlign: "center", fontSize: 10, color: T.green, fontWeight: 600 } }, "\u{1F331} Eine bessere Zukunft \u2013 f\xFCr Ihre Familie und die n\xE4chste Generation."));
  })()), (() => {
    const immWert = parseFloat(data.immobilienwert) || 0;
    const wertSteigerungPct = 0.05;
    const wertPlus = immWert > 0 ? Math.round(immWert * wertSteigerungPct) : Math.round(gesamtPreis * 1.3);
    return /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", background: `${BRAND.yellow}06`, borderRadius: 12, border: `1px solid ${BRAND.yellow}20`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: BRAND.yellow, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 6 } }, "\u{1F3E1} Immobilien-Wertsteigerung"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 10, alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec } }, "Eine PV-Anlage steigert den Immobilienwert um ca. 3\u20136%."), immWert > 0 && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginTop: 2 } }, "Gesch\xE4tzter Immobilienwert: ", immWert.toLocaleString("de"), " \u20AC")), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 20, fontWeight: 900, color: BRAND.yellow, fontFamily: fontMono } }, "+", (wertPlus / 1e3).toFixed(0), "k \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Wertsteigerung"))), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 6 } }, "Besseres Energielabel (oft von F/G \u2192 B/C), h\xF6here Attraktivit\xE4t beim Verkauf, Autarkie als Kaufargument."));
  })(), /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", background: `${T.green}06`, borderRadius: 12, border: `1px solid ${T.green}20`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: T.green, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "\u26A1 Eigenverbrauch maximieren \u2013 Tipps f\xFCr den Kunden"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 4 } }, [
    { icon: "\u{1F9FA}", tip: "Waschmaschine & Trockner mittags laufen lassen (11\u201315 Uhr)", prio: "hoch" },
    { icon: "\u{1F37D}\uFE0F", tip: "Sp\xFClmaschine in die Mittagszeit programmieren", prio: "hoch" },
    { icon: "\u{1F697}", tip: "E-Auto tags\xFCber zu Hause laden (Wallbox-Timer)", prio: data.evModell ? "hoch" : "mittel" },
    { icon: "\u{1F50B}", tip: "Speicher: Nachtverbrauch mit Solarstrom vom Tag decken", prio: speicherKwh > 0 ? "aktiv" : "empfohlen" },
    { icon: "\u{1F321}\uFE0F", tip: "W\xE4rmepumpe: Heizstab-Vorrang mittags", prio: data.wantWP ? "hoch" : "niedrig" },
    { icon: "\u{1F3CA}", tip: "Pool-Pumpe & Heizung auf Sonnenstunden programmieren", prio: data.planPool ? "hoch" : "niedrig" },
    { icon: "\u{1F4F1}", tip: "App-Monitoring: Eigenverbrauch t\xE4glich pr\xFCfen & optimieren", prio: "mittel" },
    { icon: "\u{1F4A1}", tip: "Smart Home: Ger\xE4te per Zeitschaltuhr in PV-Spitzen einschalten", prio: "mittel" }
  ].filter((t) => t.prio !== "niedrig").map((t, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { display: "flex", alignItems: "center", gap: 8, padding: "6px 8px", background: T.surface, borderRadius: 6 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 14 } }, t.icon), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, fontSize: 10, color: T.textSec } }, t.tip), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, fontWeight: 700, color: t.prio === "hoch" || t.prio === "aktiv" ? T.green : T.textDim, textTransform: "uppercase" } }, t.prio))))), /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", background: T.surface, borderRadius: 12, border: `1px solid ${T.border}`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, fontWeight: 700, color: T.textSec, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "\u26A1 Netzanschluss & Einspeisebegrenzung"), (() => {
    const maxEinsp = Math.round(kwpAnlage * 0.7 * 10) / 10;
    const dynBegrenzung = kwpAnlage <= 25;
    return /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: `${T.green}06`, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Anlagengr\xF6\xDFe"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.text, fontFamily: fontMono } }, kwpAnlage.toFixed(1), " kWp")), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: dynBegrenzung ? `${T.green}06` : `${BRAND.yellow}06`, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Einspeise-Begrenzung"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: dynBegrenzung ? T.green : BRAND.yellow, fontFamily: fontMono } }, dynBegrenzung ? "Keine \u2713" : `${maxEinsp} kW`))), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec } }, dynBegrenzung ? "\u2705 Seit 01.01.2023: Anlagen bis 25 kWp \u2192 keine Einspeisebegrenzung (\xA79 EEG). Volle Leistung ins Netz!" : `\u26A0\uFE0F Anlage > 25 kWp \u2192 Einspeisemanagement erforderlich. Max. ${maxEinsp} kW (70% von ${kwpAnlage.toFixed(1)} kWp).`));
  })()), gesamtPreis > 0 && ersparnis25 > 0 && /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: T.surface, borderRadius: 12, border: `1.5px solid ${T.green}20`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.green, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 10, textAlign: "center" } }, "\u{1F4C8} Amortisations-Verlauf (25 Jahre)"), (() => {
    const chartData = [];
    let kumOhne = 0, kumMit = gesamtPreis;
    for (let y = 0; y <= 25; y++) {
      if (y > 0) {
        const apY = ap2 * Math.pow(1 + stromSteigerung, y - 1);
        const dynAPy = dynAP2 * Math.pow(1 + stromSteigerung, y - 1);
        kumOhne += gesamt * apY / 100 + gp * 12;
        kumMit += restStrom * dynAPy / 100 + gp * 12 - einspeisungsErloes - par14ErstattungJahr - (y === 1 ? steuerbonus : 0);
      }
      chartData.push({ jahr: `J${y}`, ohnePV: Math.round(kumOhne / 1e3), mitPV: Math.round(kumMit / 1e3) });
    }
    return /* @__PURE__ */ React.createElement(ResponsiveContainer, { width: "100%", height: 200 }, /* @__PURE__ */ React.createElement(AreaChart, { data: chartData, margin: { top: 5, right: 5, left: -15, bottom: 0 } }, /* @__PURE__ */ React.createElement("defs", null, /* @__PURE__ */ React.createElement("linearGradient", { id: "gradOhne", x1: "0", y1: "0", x2: "0", y2: "1" }, /* @__PURE__ */ React.createElement("stop", { offset: "5%", stopColor: T.red, stopOpacity: 0.3 }), /* @__PURE__ */ React.createElement("stop", { offset: "95%", stopColor: T.red, stopOpacity: 0 })), /* @__PURE__ */ React.createElement("linearGradient", { id: "gradMit", x1: "0", y1: "0", x2: "0", y2: "1" }, /* @__PURE__ */ React.createElement("stop", { offset: "5%", stopColor: T.green, stopOpacity: 0.3 }), /* @__PURE__ */ React.createElement("stop", { offset: "95%", stopColor: T.green, stopOpacity: 0 }))), /* @__PURE__ */ React.createElement(CartesianGrid, { strokeDasharray: "3 3", stroke: T.border }), /* @__PURE__ */ React.createElement(XAxis, { dataKey: "jahr", tick: { fontSize: 8, fill: T.textDim }, interval: 4 }), /* @__PURE__ */ React.createElement(YAxis, { tick: { fontSize: 8, fill: T.textDim }, tickFormatter: (v) => `${v}k` }), /* @__PURE__ */ React.createElement(Tooltip, { contentStyle: { background: T.bg, border: `1px solid ${T.border}`, borderRadius: 8, fontSize: 10 }, formatter: (v, n) => [`${v}k \u20AC`, n === "ohnePV" ? "\u274C Ohne PV" : "\u2705 Mit PV"] }), /* @__PURE__ */ React.createElement(Area, { type: "monotone", dataKey: "ohnePV", stroke: T.red, fill: "url(#gradOhne)", strokeWidth: 2, name: "ohnePV" }), /* @__PURE__ */ React.createElement(Area, { type: "monotone", dataKey: "mitPV", stroke: T.green, fill: "url(#gradMit)", strokeWidth: 2, name: "mitPV" }), /* @__PURE__ */ React.createElement(ReferenceLine, { x: `J${amortJahreDyn}`, stroke: BRAND.yellow, strokeDasharray: "5 5", label: { value: "Break-Even", position: "top", fontSize: 8, fill: BRAND.yellow } })));
  })(), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "center", gap: 16, marginTop: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.red, display: "flex", alignItems: "center", gap: 4 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 12, height: 3, background: T.red, borderRadius: 2 } }), " Ohne PV (kumuliert)"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.green, display: "flex", alignItems: "center", gap: 4 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 12, height: 3, background: T.green, borderRadius: 2 } }), " Mit bee-doo PV"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: BRAND.yellow, display: "flex", alignItems: "center", gap: 4 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 12, height: 3, background: BRAND.yellow, borderRadius: 2, borderStyle: "dashed" } }), " Break-Even"))), pvErzeugung > 0 && /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: T.surface, borderRadius: 12, border: `1px solid ${T.border}`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.blue, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 10, textAlign: "center" } }, "\u{1F550} Typischer Tagesverlauf (Sommer)"), (() => {
    const pvPeak = pvErzeugung / 365 / 6;
    const baseLoad = gesamt / 365 / 24;
    const hours = Array.from({ length: 24 }, (_, h) => {
      const pvFactor = h >= 5 && h <= 20 ? Math.exp(-0.5 * Math.pow((h - 12.5) / 3.2, 2)) : 0;
      const pvKw = Math.round(pvPeak * pvFactor * 100) / 100;
      const loadFactor = 1 + (h >= 6 && h <= 8 ? 0.8 : 0) + (h >= 11 && h <= 13 ? 0.5 : 0) + (h >= 17 && h <= 21 ? 1.2 : 0) + (h >= 22 || h <= 5 ? -0.3 : 0);
      const loadKw = Math.round(baseLoad * loadFactor * 100) / 100;
      const eigenverbrauch2 = Math.min(pvKw, loadKw);
      return { h: `${h}h`, pv: pvKw, last: loadKw, eigen: eigenverbrauch2 };
    });
    return /* @__PURE__ */ React.createElement(ResponsiveContainer, { width: "100%", height: 180 }, /* @__PURE__ */ React.createElement(AreaChart, { data: hours, margin: { top: 5, right: 5, left: -20, bottom: 0 } }, /* @__PURE__ */ React.createElement("defs", null, /* @__PURE__ */ React.createElement("linearGradient", { id: "gradPV", x1: "0", y1: "0", x2: "0", y2: "1" }, /* @__PURE__ */ React.createElement("stop", { offset: "5%", stopColor: BRAND.yellow, stopOpacity: 0.4 }), /* @__PURE__ */ React.createElement("stop", { offset: "95%", stopColor: BRAND.yellow, stopOpacity: 0 }))), /* @__PURE__ */ React.createElement(CartesianGrid, { strokeDasharray: "3 3", stroke: T.border }), /* @__PURE__ */ React.createElement(XAxis, { dataKey: "h", tick: { fontSize: 7, fill: T.textDim }, interval: 3 }), /* @__PURE__ */ React.createElement(YAxis, { tick: { fontSize: 8, fill: T.textDim }, tickFormatter: (v) => `${v}kW` }), /* @__PURE__ */ React.createElement(Tooltip, { contentStyle: { background: T.bg, border: `1px solid ${T.border}`, borderRadius: 8, fontSize: 10 }, formatter: (v, n) => [`${v} kW`, n === "pv" ? "\u2600\uFE0F PV" : n === "last" ? "\u{1F3E0} Verbrauch" : "\u26A1 Eigenverbrauch"] }), /* @__PURE__ */ React.createElement(Area, { type: "monotone", dataKey: "pv", stroke: BRAND.yellow, fill: "url(#gradPV)", strokeWidth: 2, name: "pv" }), /* @__PURE__ */ React.createElement(Area, { type: "monotone", dataKey: "eigen", stroke: T.green, fill: `${T.green}30`, strokeWidth: 0, name: "eigen" }), /* @__PURE__ */ React.createElement(Line, { type: "monotone", dataKey: "last", stroke: T.red, strokeWidth: 1.5, dot: false, name: "last" })));
  })(), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "center", gap: 12, marginTop: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: BRAND.yellow, display: "flex", alignItems: "center", gap: 3 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 10, height: 3, background: BRAND.yellow, borderRadius: 2 } }), " PV-Erzeugung"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.red, display: "flex", alignItems: "center", gap: 3 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 10, height: 3, background: T.red, borderRadius: 2 } }), " Verbrauch"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.green, display: "flex", alignItems: "center", gap: 3 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 10, height: 6, background: `${T.green}40`, borderRadius: 2 } }), " Eigenverbrauch")), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", fontSize: 9, color: T.textDim, marginTop: 4 } }, "Gr\xFCne Fl\xE4che = Solarstrom direkt genutzt \xB7 \xDCberschuss \u2192 Speicher / Netz")), ersparnis25 > 0 && /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: T.surface, borderRadius: 12, border: `1px solid ${BRAND.yellow}20`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: BRAND.yellow, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 10, textAlign: "center" } }, "\u{1F3C6} Rendite-Vergleich: PV vs. Geldanlagen"), (() => {
    const investBetrag = gesamtPreis;
    const pvRendite25 = Math.round(ersparnis25 / investBetrag * 100);
    const pvRenditePA = Math.round(pvRendite25 / 25 * 10) / 10;
    const anlagen = [
      { l: "\u2600\uFE0F bee-doo PV", rendPA: pvRenditePA, nach25: investBetrag + ersparnis25, color: T.green, highlight: true },
      { l: "\u{1F4B0} Festgeld (3,5%)", rendPA: 3.5, nach25: Math.round(investBetrag * Math.pow(1.035, 25)), color: T.blue },
      { l: "\u{1F4C8} ETF \xD8 (7%)", rendPA: 7, nach25: Math.round(investBetrag * Math.pow(1.07, 25)), color: BRAND.yellow },
      { l: "\u{1F3E6} Sparbuch (1%)", rendPA: 1, nach25: Math.round(investBetrag * Math.pow(1.01, 25)), color: T.textDim },
      { l: "\u{1F4B6} Tagesgeld (2,5%)", rendPA: 2.5, nach25: Math.round(investBetrag * Math.pow(1.025, 25)), color: T.textSec }
    ];
    const maxVal = Math.max(...anlagen.map((a) => a.nach25));
    return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 6 } }, anlagen.map((a, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { display: "flex", alignItems: "center", gap: 8, padding: a.highlight ? "10px 12px" : "6px 12px", background: a.highlight ? `${a.color}08` : "transparent", borderRadius: 8, border: a.highlight ? `1.5px solid ${a.color}25` : "none" } }, /* @__PURE__ */ React.createElement("div", { style: { width: 90, fontSize: 10, fontWeight: a.highlight ? 700 : 500, color: a.highlight ? a.color : T.textSec, whiteSpace: "nowrap" } }, a.l), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, height: 16, background: `${T.border}30`, borderRadius: 4, overflow: "hidden" } }, /* @__PURE__ */ React.createElement("div", { style: { width: `${Math.max(5, a.nach25 / maxVal * 100)}%`, height: "100%", background: `${a.color}${a.highlight ? "90" : "50"}`, borderRadius: 4, transition: "width 0.5s" } })), /* @__PURE__ */ React.createElement("div", { style: { width: 55, textAlign: "right", fontSize: 11, fontWeight: 700, color: a.color, fontFamily: fontMono } }, (a.nach25 / 1e3).toFixed(0), "k \u20AC"), /* @__PURE__ */ React.createElement("div", { style: { width: 35, textAlign: "right", fontSize: 9, color: a.color } }, a.rendPA, "% p.a."))), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textAlign: "center", marginTop: 4 } }, "Basis: ", investBetrag.toLocaleString("de"), " \u20AC Investition \xB7 PV-Rendite = Stromkosten-Ersparnis \xB7 ETF/Festgeld vor Steuern"), pvRenditePA > 5 && /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center", fontSize: 10, color: T.green, fontWeight: 600, marginTop: 4 } }, "\u{1F525} PV schl\xE4gt Festgeld UND Tagesgeld \u2013 steuerfrei!"));
  })()), modulAnz > 0 && /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: T.surface, borderRadius: 12, border: `1px solid ${T.border}`, marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.textSec, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 10, textAlign: "center" } }, "\u{1F4C9} Modul-Leistung \xFCber 30 Jahre (Aiko N-Type)"), (() => {
    const degradYear1 = 0.01;
    const degradPA = 4e-3;
    const degData = [];
    let leistung = 100;
    for (let y = 0; y <= 30; y++) {
      degData.push({ jahr: `${y}`, pct: Math.round(leistung * 10) / 10, kwh: Math.round(pvErzeugung * leistung / 100) });
      if (y === 0) leistung -= degradYear1 * 100;
      else leistung -= degradPA * 100;
    }
    return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(ResponsiveContainer, { width: "100%", height: 140 }, /* @__PURE__ */ React.createElement(AreaChart, { data: degData, margin: { top: 5, right: 5, left: -20, bottom: 0 } }, /* @__PURE__ */ React.createElement("defs", null, /* @__PURE__ */ React.createElement("linearGradient", { id: "gradDeg", x1: "0", y1: "0", x2: "0", y2: "1" }, /* @__PURE__ */ React.createElement("stop", { offset: "5%", stopColor: BRAND.yellow, stopOpacity: 0.3 }), /* @__PURE__ */ React.createElement("stop", { offset: "95%", stopColor: BRAND.yellow, stopOpacity: 0 }))), /* @__PURE__ */ React.createElement(CartesianGrid, { strokeDasharray: "3 3", stroke: T.border }), /* @__PURE__ */ React.createElement(XAxis, { dataKey: "jahr", tick: { fontSize: 7, fill: T.textDim }, interval: 4 }), /* @__PURE__ */ React.createElement(YAxis, { domain: [80, 100], tick: { fontSize: 8, fill: T.textDim }, tickFormatter: (v) => `${v}%` }), /* @__PURE__ */ React.createElement(Tooltip, { contentStyle: { background: T.bg, border: `1px solid ${T.border}`, borderRadius: 8, fontSize: 10 }, formatter: (v, n) => [n === "pct" ? `${v}%` : `${v.toLocaleString("de")} kWh`, n === "pct" ? "Leistung" : "Ertrag"] }), /* @__PURE__ */ React.createElement(Area, { type: "monotone", dataKey: "pct", stroke: BRAND.yellow, fill: "url(#gradDeg)", strokeWidth: 2 }), /* @__PURE__ */ React.createElement(ReferenceLine, { y: 87.4, stroke: T.green, strokeDasharray: "3 3", label: { value: "Garantie 87.4%", position: "insideBottomRight", fontSize: 8, fill: T.green } }))), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 6, marginTop: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "6px 8px", background: `${T.green}06`, borderRadius: 6, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, "Jahr 10"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: T.green, fontFamily: fontMono } }, degData[10]?.pct, "%"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, degData[10]?.kwh.toLocaleString("de"), " kWh")), /* @__PURE__ */ React.createElement("div", { style: { padding: "6px 8px", background: `${BRAND.yellow}06`, borderRadius: 6, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, "Jahr 20"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: BRAND.yellow, fontFamily: fontMono } }, degData[20]?.pct, "%"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, degData[20]?.kwh.toLocaleString("de"), " kWh")), /* @__PURE__ */ React.createElement("div", { style: { padding: "6px 8px", background: `${T.blue}06`, borderRadius: 6, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, "Jahr 30"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: T.blue, fontFamily: fontMono } }, degData[30]?.pct, "%"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: T.textDim } }, degData[30]?.kwh.toLocaleString("de"), " kWh"))), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textAlign: "center", marginTop: 4 } }, "Aiko N-Type: 1% Degradation im 1. Jahr, danach nur 0,4% p.a. \xB7 Garantie: min. 87,4% nach 30J"));
  })())), modulAnz > 0 && /* @__PURE__ */ React.createElement(Section, { title: "Garantie & Sicherheit", icon: "\u{1F6E1}\uFE0F", accent: T.green }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 6 } }, [
    { icon: "\u2600\uFE0F", l: "Aiko Module", dur: "30 Jahre", desc: "Produkt- & Leistungsgarantie \xB7 min. 87,4% nach 30J", color: BRAND.yellow },
    { icon: "\u{1F50B}", l: "Batteriespeicher", dur: "10 Jahre", desc: "Produktgarantie \xB7 min. 80% Kapazit\xE4t", color: T.blue },
    { icon: "\u26A1", l: "Wechselrichter", dur: "10\u201315 Jahre", desc: "Je nach Hersteller erweiterbar", color: T.green },
    { icon: "\u{1F527}", l: "Montage bee-doo", dur: "5 Jahre", desc: "Gew\xE4hrleistung auf alle Installationsarbeiten", color: T.text },
    { icon: "\u{1F3E0}", l: "Dachdichtigkeit", dur: "10 Jahre", desc: "Garantie auf Dachdurchdringungen & Abdichtung", color: T.text },
    { icon: "\u{1F4CA}", l: "Monitoring", dur: "25 Jahre", desc: "Kostenlose Anlagen\xFCberwachung per App", color: T.green }
  ].map((g, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { display: "flex", alignItems: "center", gap: 10, padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18 } }, g.icon), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.text } }, g.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, g.desc)), /* @__PURE__ */ React.createElement("div", { style: { padding: "4px 10px", background: `${g.color}15`, borderRadius: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 13, fontWeight: 800, color: g.color, fontFamily: fontMono } }, g.dur))))), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, padding: "10px 14px", background: `${T.green}08`, borderRadius: 10, border: `1px solid ${T.green}20`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: T.green } }, "\u{1F6E1}\uFE0F Bei bee-doo sind Sie bis zu 30 Jahre abgesichert."), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 2 } }, "Alles aus einer Hand: Module, Speicher, Montage, Monitoring."))), modulAnz > 0 && /* @__PURE__ */ React.createElement(Section, { title: "Steuerliche Vorteile", icon: "\u{1F9FE}", accent: T.green }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 6 } }, [
    { icon: "\u{1F3F7}\uFE0F", l: "0% MwSt auf PV-Anlagen", desc: "Seit 01.01.2023: Module, Speicher, WR & Montage umsatzsteuerfrei (\xA712 Abs.3 UStG)", betrag: `${Math.round(gesamtPreis * 0.19).toLocaleString("de")} \u20AC gespart`, color: T.green, aktiv: true },
    { icon: "\u{1F9FE}", l: "\xA735a EStG \u2013 Handwerkerleistung", desc: "25% Montageanteil \u2192 20% absetzbar = max. 1.200 \u20AC/Jahr Steuergutschrift", betrag: `${steuerbonus.toLocaleString("de")} \u20AC`, color: T.green, aktiv: steuerbonus > 0 },
    { icon: "\u{1F4CB}", l: "Keine Gewerbeanmeldung", desc: "Seit 2023: PV bis 30 kWp ist einkommensteuerbefreit (\xA73 Nr.72 EStG). Kein Gewerbe, keine E\xDCR.", betrag: "Vereinfacht!", color: T.blue, aktiv: kwpAnlage <= 30 },
    { icon: "\u{1F4B6}", l: "Keine Einkommensteuer", desc: "Einspeiseverg\xFCtung ist ab 2023 einkommensteuerfrei bei PV \u2264 30 kWp auf EFH.", betrag: "steuerfrei", color: T.green, aktiv: kwpAnlage <= 30 }
  ].filter((t) => t.aktiv).map((t, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { display: "flex", alignItems: "center", gap: 10, padding: "10px 14px", background: `${t.color}06`, borderRadius: 10, border: `1px solid ${t.color}15` } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18 } }, t.icon), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.text } }, t.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, t.desc)), /* @__PURE__ */ React.createElement("div", { style: { padding: "4px 8px", background: `${t.color}10`, borderRadius: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: t.color } }, t.betrag)))))), modulAnz > 0 && /* @__PURE__ */ React.createElement(Section, { title: "Versicherungs-Check", icon: "\u{1F512}", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "PV-Anlage in der Versicherung \u2013 was muss der Kunde tun?"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 6 } }, [
    { k: "versWGV", icon: "\u{1F3E0}", l: "Wohngeb\xE4udeversicherung informieren", desc: "PV-Anlage dem Versicherer melden \u2192 Versicherungssumme erh\xF6hen. Meist kostenlos oder minimal.", prio: "Pflicht" },
    { k: "versBlitz", icon: "\u26A1", l: "\xDCberspannungsschutz pr\xFCfen", desc: "Typ 1+2 Blitzschutz empfohlen. Sch\xFCtzt WR + Module bei Gewitter.", prio: "Empfohlen" },
    { k: "versErtragsausfall", icon: "\u{1F4C9}", l: "Ertragsausfall-Versicherung", desc: "Optional: Wenn Anlage defekt \u2192 Versicherung zahlt entgangenen Ertrag. Ab ~50 \u20AC/Jahr.", prio: "Optional" },
    { k: "versAllgefahren", icon: "\u{1F6E1}\uFE0F", l: "Allgefahren-Versicherung PV", desc: "Rundum-Schutz: Sturm, Hagel, Vandalismus, Marderbiss, Diebstahl. Ab ~80 \u20AC/Jahr.", prio: "Empfohlen" }
  ].map((v, i) => /* @__PURE__ */ React.createElement("div", { key: i, onClick: () => u(v.k, !data[v.k]), style: {
    display: "flex",
    alignItems: "center",
    gap: 10,
    padding: "10px 14px",
    cursor: "pointer",
    background: data[v.k] ? `${T.green}06` : T.surface,
    borderRadius: 10,
    border: `1px solid ${data[v.k] ? T.green : T.border}`
  } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 16 } }, v.icon), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: data[v.k] ? T.green : T.text } }, data[v.k] ? "\u2705" : "\u2610", " ", v.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, v.desc)), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, fontWeight: 700, color: v.prio === "Pflicht" ? T.red : v.prio === "Empfohlen" ? BRAND.yellow : T.textDim, textTransform: "uppercase" } }, v.prio))))), /* @__PURE__ */ React.createElement(Section, { title: "Kundenstimmen", icon: "\u2B50", accent: BRAND.yellow }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "center", gap: 16, padding: "14px 16px", background: `${BRAND.yellow}08`, borderRadius: 12, border: `1.5px solid ${BRAND.yellow}20`, marginBottom: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 28, fontWeight: 900, color: BRAND.yellow, fontFamily: fontMono } }, "4.8"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, letterSpacing: 1 } }, "\u2B50\u2B50\u2B50\u2B50\u2B50"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Google Bewertungen")), /* @__PURE__ */ React.createElement("div", { style: { width: 1, height: 50, background: T.border } }), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 28, fontWeight: 900, color: T.green, fontFamily: fontMono } }, "320+"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec } }, "Anlagen installiert")), /* @__PURE__ */ React.createElement("div", { style: { width: 1, height: 50, background: T.border } }), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 28, fontWeight: 900, color: T.blue, fontFamily: fontMono } }, "98%"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec } }, "Weiterempfehlung"))), [
    { name: "Familie Schmidt", ort: "Bielefeld", text: "Von Beratung bis Installation alles top. Spart uns jetzt 180 \u20AC/Monat!", rating: 5 },
    { name: "Thomas K.", ort: "G\xFCtersloh", text: "Super Beratung, faire Preise, schnelle Installation. Klare Empfehlung!", rating: 5 },
    { name: "Sandra M.", ort: "Herford", text: "Endlich unabh\xE4ngig vom Stromversorger. bee-doo hat alles reibungslos organisiert.", rating: 5 }
  ].map((rev, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, marginBottom: 6 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: T.text } }, "\u{1F464} ", rev.name, " \xB7 ", rev.ort), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, letterSpacing: 0.5 } }, "\u2B50".repeat(rev.rating))), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, marginTop: 4, fontStyle: "italic" } }, '"', rev.text, '"'))), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, textAlign: "center", marginTop: 4 } }, "Echte Kundenbewertungen \xB7 bee-doo GmbH, Bielefeld")), /* @__PURE__ */ React.createElement(Section, { title: "Referenz-Anlagen", icon: "\u{1F5BC}\uFE0F", accent: BRAND.yellow }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "So sieht das bei unseren Kunden aus:"), (() => {
    const refs = [
      { id: 1, typ: "Satteldach", module: 24, kwp: 11.3, farbe: "Full Black", ort: "Bielefeld", emoji: "\u{1F3E0}", desc: "Klassisches Satteldach S\xFCd-Ausrichtung" },
      { id: 2, typ: "Walmdach", module: 32, kwp: 15, farbe: "Full Black", ort: "G\xFCtersloh", emoji: "\u{1F3E1}", desc: "Walmdach mit Ost-West-Belegung" },
      { id: 3, typ: "Flachdach", module: 40, kwp: 18.8, farbe: "Full Black", ort: "Herford", emoji: "\u{1F3E2}", desc: "Aufst\xE4nderung 15\xB0 S\xFCd" },
      { id: 4, typ: "Pultdach", module: 20, kwp: 9.4, farbe: "Full Black", ort: "Detmold", emoji: "\u{1F3E0}", desc: "Pultdach volle Belegung" },
      { id: 5, typ: "Satteldach", module: 48, kwp: 22.6, farbe: "Full Black", ort: "Minden", emoji: "\u{1F3E1}", desc: "Gro\xDFanlage S\xFCd + Ost" },
      { id: 6, typ: "Flachdach", module: 60, kwp: 28.2, farbe: "Standard", ort: "Paderborn", emoji: "\u{1F3E2}", desc: "Gewerbe-Flachdach maximal belegt" }
    ];
    const typen = ["alle", ...new Set(refs.map((r) => r.typ))];
    const filtered = galFilter === "alle" ? refs : refs.filter((r) => r.typ === galFilter);
    return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 6, flexWrap: "wrap", marginBottom: 10 } }, typen.map((t) => /* @__PURE__ */ React.createElement("div", { key: t, onClick: () => setGalFilter(t), style: {
      padding: "4px 12px",
      borderRadius: 20,
      cursor: "pointer",
      fontSize: 10,
      fontWeight: 600,
      background: galFilter === t ? BRAND.yellow : T.surface,
      color: galFilter === t ? "#000" : T.textSec,
      border: `1px solid ${galFilter === t ? BRAND.yellow : T.border}`
    } }, t === "alle" ? "Alle" : t))), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 8 } }, filtered.map((r) => /* @__PURE__ */ React.createElement("div", { key: r.id, style: { padding: "12px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 32, textAlign: "center", marginBottom: 6, background: `${BRAND.yellow}08`, borderRadius: 8, padding: "12px 0" } }, r.emoji), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.text } }, r.typ), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec } }, r.module, " Module \xB7 ", r.kwp, " kWp"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, r.farbe, " \xB7 ", r.ort), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: BRAND.yellow, fontWeight: 600, marginTop: 4 } }, r.desc)))), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, padding: "8px 12px", background: `${BRAND.yellow}08`, borderRadius: 8, border: `1px solid ${BRAND.yellow}20`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: BRAND.yellow, fontWeight: 600 } }, "\u{1F4F8} Echte Fotos auf Anfrage \xB7 bee-doo Referenzmappe beim Teamleiter")));
  })()), gesamt > 0 && modulAnz > 0 && /* @__PURE__ */ React.createElement(Section, { title: "Konkurrenz-Vergleich", icon: "\u2694\uFE0F", accent: T.red }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "Kunde hat ein Angebot von einem Mitbewerber? Schnell vergleichen:"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12 } }, /* @__PURE__ */ React.createElement(Input, { label: "Anbieter", value: data.konkAnbieter || "", onChange: (v) => u("konkAnbieter", v), placeholder: "z.B. Enpal, 1Komma5\xB0", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Module / kWp", value: data.konkKwp || "", onChange: (v) => u("konkKwp", v), placeholder: "z.B. 10.5", suffix: "kWp", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Speicher", value: data.konkSpeicher || "", onChange: (v) => u("konkSpeicher", v), placeholder: "z.B. 10", suffix: "kWh", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Gesamtpreis", value: data.konkPreis || "", onChange: (v) => u("konkPreis", v), placeholder: "z.B. 28000", suffix: "\u20AC", half: true, type: "number" }), /* @__PURE__ */ React.createElement(Input, { label: "Garantie", value: data.konkGarantie || "", onChange: (v) => u("konkGarantie", v), placeholder: "z.B. 25", suffix: "Jahre", half: true, type: "number" })), data.konkKwp && data.konkPreis && (() => {
    const kKwp = parseFloat(data.konkKwp) || 0;
    const kPreis = parseFloat(data.konkPreis) || 0;
    const kSpeicher = parseFloat(data.konkSpeicher) || 0;
    const kGarantie = parseInt(data.konkGarantie) || 0;
    const bKwp = kwpAnlage;
    const bPreis = gesamtPreis;
    const bSpeicher = speicherKwh;
    const bPreisKwp = bKwp > 0 ? Math.round(bPreis / bKwp) : 0;
    const kPreisKwp = kKwp > 0 ? Math.round(kPreis / kKwp) : 0;
    const rows = [
      { l: "Leistung", b: `${bKwp.toFixed(1)} kWp`, k: `${kKwp.toFixed(1)} kWp`, win: bKwp >= kKwp ? "b" : "k" },
      { l: "Speicher", b: `${bSpeicher.toFixed(1)} kWh`, k: `${kSpeicher.toFixed(1)} kWh`, win: bSpeicher >= kSpeicher ? "b" : "k" },
      { l: "Gesamtpreis", b: `${bPreis.toLocaleString("de")} \u20AC`, k: `${kPreis.toLocaleString("de")} \u20AC`, win: bPreis <= kPreis ? "b" : "k" },
      { l: "Preis/kWp", b: `${bPreisKwp.toLocaleString("de")} \u20AC`, k: `${kPreisKwp.toLocaleString("de")} \u20AC`, win: bPreisKwp <= kPreisKwp ? "b" : "k" },
      { l: "Garantie", b: "30 Jahre", k: kGarantie > 0 ? `${kGarantie} Jahre` : "\u2013", win: kGarantie > 0 ? 30 >= kGarantie ? "b" : "k" : "b" }
    ];
    const bWins = rows.filter((r) => r.win === "b").length;
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "2fr 3fr 3fr", gap: 0, borderRadius: 10, overflow: "hidden", border: `1px solid ${T.border}` } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: T.border, fontSize: 9, fontWeight: 700, color: T.textDim } }), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: `${T.green}10`, fontSize: 10, fontWeight: 700, color: T.green, textAlign: "center" } }, "\u{1F41D} bee-doo"), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 10px", background: `${T.red}08`, fontSize: 10, fontWeight: 700, color: T.red, textAlign: "center" } }, data.konkAnbieter || "Konkurrenz"), rows.map((r, i) => /* @__PURE__ */ React.createElement(React.Fragment, { key: i }, /* @__PURE__ */ React.createElement("div", { style: { padding: "6px 10px", background: T.surface, fontSize: 10, color: T.textDim, borderTop: `1px solid ${T.border}` } }, r.l), /* @__PURE__ */ React.createElement("div", { style: { padding: "6px 10px", background: r.win === "b" ? `${T.green}08` : T.surface, fontSize: 11, fontWeight: r.win === "b" ? 700 : 400, color: r.win === "b" ? T.green : T.text, textAlign: "center", borderTop: `1px solid ${T.border}` } }, r.win === "b" ? "\u2713 " : "", r.b), /* @__PURE__ */ React.createElement("div", { style: { padding: "6px 10px", background: r.win === "k" ? `${T.red}08` : T.surface, fontSize: 11, fontWeight: r.win === "k" ? 700 : 400, color: r.win === "k" ? T.red : T.text, textAlign: "center", borderTop: `1px solid ${T.border}` } }, r.win === "k" ? "\u2713 " : "", r.k)))), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, textAlign: "center", padding: "8px", background: bWins >= 3 ? `${T.green}10` : `${BRAND.yellow}10`, borderRadius: 8 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: bWins >= 3 ? T.green : BRAND.yellow } }, bWins >= 4 ? "\u{1F3C6} bee-doo gewinnt klar!" : bWins >= 3 ? "\u2705 bee-doo hat die Nase vorn" : "\u2696\uFE0F Vergleichbar \u2013 auf Service & Qualit\xE4t hinweisen")));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "F\xF6rderungs-Check", icon: "\u{1F3DB}\uFE0F", accent: T.green }, (() => {
    const foerderungen = [
      { id: "kfw270", l: "KfW 270 \u2013 Erneuerbare Energien", desc: "G\xFCnstiger Kredit f\xFCr PV, Speicher, Wallbox", betrag: "bis 150.000 \u20AC, ab 4,75% eff.", bedingung: "Netzeinspeise-PV", aktiv: true },
      { id: "beg", l: "BEG \u2013 W\xE4rmepumpen-F\xF6rderung", desc: "Zuschuss f\xFCr Heizungstausch (Gas/\xD6l \u2192 WP)", betrag: "30\u201370% der Kosten", bedingung: "Heizungstausch, Energieberater", aktiv: !!data.wantWP },
      { id: "wallbox", l: "KfW 442 \u2013 Wallbox + PV + Speicher", desc: "Zuschuss f\xFCr Solar-Ladekombi", betrag: "bis 10.200 \u20AC", bedingung: "PV + Speicher + Wallbox + E-Auto", aktiv: !!data.wantWallbox || !!data.evModell },
      { id: "regional", l: "Regionale / Kommunale F\xF6rderung", desc: "Stadtwerke, Landesf\xF6rderung, Gemeinde", betrag: "variabel (500\u20135.000 \u20AC)", bedingung: "PLZ-abh\xE4ngig \u2013 im Einzelfall pr\xFCfen", aktiv: true }
    ];
    return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 8 } }, foerderungen.map((f) => /* @__PURE__ */ React.createElement("div", { key: f.id, onClick: () => u(`foerd_${f.id}`, !data[`foerd_${f.id}`]), style: {
      padding: "10px 14px",
      borderRadius: 10,
      cursor: "pointer",
      background: data[`foerd_${f.id}`] ? `${T.green}08` : T.surface,
      border: `1.5px solid ${data[`foerd_${f.id}`] ? T.green : T.border}`,
      opacity: f.aktiv ? 1 : 0.5
    } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: data[`foerd_${f.id}`] ? T.green : T.text } }, data[`foerd_${f.id}`] ? "\u2705" : "\u2610", " ", f.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginTop: 2 } }, f.desc)), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.green, textAlign: "right" } }, f.betrag)), data[`foerd_${f.id}`] && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 4, paddingTop: 4, borderTop: `1px solid ${T.border}` } }, "\u{1F4CB} Bedingung: ", f.bedingung))), /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 12px", background: `${BRAND.yellow}08`, borderRadius: 8, border: `1px solid ${BRAND.yellow}20` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: BRAND.yellow, fontWeight: 600 } }, "\u{1F4A1} Tipp: F\xF6rderung IMMER vor Vertragsabschluss beantragen!")));
  })()), gesamt > 0 && modulAnz > 0 && /* @__PURE__ */ React.createElement(Section, { title: "Einwandbehandlung", icon: "\u{1F4AC}", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "H\xE4ufige Kundeneinw\xE4nde \u2013 antippen f\xFCr Berater-Antwort:"), (() => {
    const faqs = [
      { q: "Das ist mir zu teuer!", a: `Verst\xE4ndlich. Aber schauen wir auf die Zahlen: Sie zahlen aktuell ${Math.round(stromkostenMonat)} \u20AC/Monat an den Versorger \u2013 Tendenz steigend (${(stromSteigerung * 100).toFixed(0)}% p.a.). Mit PV zahlen Sie ${restZukaufMonat} \u20AC/Monat Reststrom und sparen \xFCber 25 Jahre ${Math.round(ersparnis25).toLocaleString("de")} \u20AC. Die Anlage ist nach ${amortJahreDyn} Jahren bezahlt \u2013 danach produzieren Sie quasi kostenlosen Strom.`, icon: "\u{1F4B0}" },
      { q: "Muss ich mit meinem Partner besprechen", a: `Absolut! Ich habe Ihnen alles per WhatsApp geschickt \u2013 so k\xF6nnen Sie gemeinsam in Ruhe die Zahlen anschauen. Darf ich Sie in ${data.nachfassTage || "3"} Tagen nochmal anrufen? Die aktuellen Konditionen gelten noch 14 Tage.`, icon: "\u{1F46B}" },
      { q: "Lohnt sich das bei meinem Dach?", a: `Ihr Dach produziert ca. ${pvErzeugung.toLocaleString("de")} kWh/Jahr \u2013 das sind ${Math.round(autarkiegrad * 100)}% Autarkie! ${verschattungsFaktor < 0.9 ? `Auch mit der Teilverschattung (${Math.round(verschattungsFaktor * 100)}% Ertrag)` : "Selbst bei nicht perfekter Ausrichtung"} rechnet sich die Anlage nach ${amortJahreDyn} Jahren.`, icon: "\u{1F3E0}" },
      { q: "Kann ich nicht besser mieten?", a: `Miete klingt erstmal g\xFCnstig, aber: Sie zahlen 20 Jahre Miete und die Anlage geh\xF6rt Ihnen nie. Bei uns: Nach ${parseInt(data.finanzJahre) || 15} Jahren geh\xF6rt die Anlage Ihnen \u2013 dann ${Math.max(0, restZukaufMonat - einspeisungsErloesMtl)} \u20AC/Monat statt ${Math.round(stromkostenMonat)} \u20AC. Miete kostet \xFCber 20 Jahre oft 30-40% mehr als Kauf.`, icon: "\u{1F3F7}\uFE0F" },
      { q: "Was wenn ich das Haus verkaufe?", a: "Eine PV-Anlage steigert den Immobilienwert um ca. 3-6%! Das Energielabel verbessert sich, der K\xE4ufer \xFCbernimmt eine fertige Anlage. Sie verkaufen also nicht mit Verlust \u2013 sondern mit Gewinn.", icon: "\u{1F3E1}" },
      { q: "Wie lange h\xE4lt so eine Anlage?", a: "Aiko Module haben 30 Jahre Garantie mit min. 87,4% Leistung. Real laufen Module 35-40 Jahre. Der Wechselrichter wird nach 15-20 Jahren einmal getauscht (~1.500 \u20AC). \xDCber die Lebensdauer ist PV die g\xFCnstigste Energiequelle \xFCberhaupt.", icon: "\u23F1\uFE0F" },
      { q: "Was passiert bei Stromausfall?", a: `${speicherKwh > 0 ? `Mit Ihrem ${speicherKwh.toLocaleString("de")} kWh Speicher haben Sie bei normalem Grundverbrauch ca. ${Math.round(speicherKwh * 0.9 * 1e3 / 400 * 10) / 10} Stunden Notstrom. Tags\xFCber l\xE4dt die PV nach \u2013 Sie sind praktisch unabh\xE4ngig.` : "Mit einem Speicher haben Sie auch bei Netzausfall Strom. Tags\xFCber l\xE4dt die PV den Speicher nach."}`, icon: "\u{1F526}" },
      { q: "Ich warte lieber auf bessere Technik", a: `Jeder Tag ohne PV kostet Sie ${Math.round(stromkostenMonat / 30)} \u20AC an den Versorger. Bei ${(stromSteigerung * 100).toFixed(0)}% Steigerung p.a. wird Warten immer teurer. Aktuelle Module (Aiko N-Type) sind bereits bei 23,6% Effizienz \u2013 der Sprung wird immer kleiner, die Strompreise steigen weiter.`, icon: "\u{1F52C}" },
      { q: "Brauche ich wirklich einen Speicher?", a: `Ohne Speicher nutzen Sie nur ${Math.round(eigenverbrauchDirekt / gesamt * 100)}% selbst. ${speicherKwh > 0 ? `Mit ${speicherKwh.toLocaleString("de")} kWh Speicher steigt das auf ${Math.round(autarkiegrad * 100)}%.` : "Ein Speicher bringt Sie auf 60-80% Eigenverbrauch."} Speicher = nachts eigenen Strom nutzen statt teuren Netzstrom kaufen.`, icon: "\u{1F50B}" },
      { q: "Was kostet die Wartung?", a: "PV-Anlagen sind praktisch wartungsfrei. Kein \xD6lwechsel, keine beweglichen Teile. Regen reinigt die Module. Optional alle 2-3 Jahre eine Sichtpr\xFCfung. Kosten: minimal bis null.", icon: "\u{1F527}" }
    ];
    return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 6 } }, faqs.map((f, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { borderRadius: 10, overflow: "hidden", border: `1px solid ${openFaq === i ? T.blue : T.border}` } }, /* @__PURE__ */ React.createElement("div", { onClick: () => setOpenFaq(openFaq === i ? null : i), style: {
      display: "flex",
      alignItems: "center",
      gap: 8,
      padding: "10px 14px",
      cursor: "pointer",
      background: openFaq === i ? `${T.blue}08` : T.surface
    } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 16 } }, f.icon), /* @__PURE__ */ React.createElement("div", { style: { flex: 1, fontSize: 12, fontWeight: 600, color: openFaq === i ? T.blue : T.text } }, '"', f.q, '"'), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: T.textDim, transition: "transform 0.2s", transform: openFaq === i ? "rotate(180deg)" : "none" } }, "\u25BC")), openFaq === i && /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: `${T.blue}04`, borderTop: `1px solid ${T.blue}15` } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textSec, lineHeight: 1.6 } }, f.a), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.blue, fontWeight: 600, marginTop: 6 } }, "\u{1F4A1} Zahlen sind personalisiert aus der aktuellen Berechnung")))));
  })()), gesamt > 0 && modulAnz > 0 && /* @__PURE__ */ React.createElement(Section, { title: "Angebot senden", icon: "\u{1F4E4}", accent: T.green }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "Zusammenfassung direkt an den Kunden senden:"), (() => {
    const kundenName = `${data.vorname || ""} ${data.nachname || ""}`.trim() || "Kunde";
    const addr = `${data.strasse || ""} ${data.hausnr || ""}, ${data.plz || ""} ${data.ort || ""}`.trim();
    const selJ = parseInt(data.finanzJahre) || 15;
    const isBarkauf2 = data.preismodell === "Kauf";
    const laufKosten = restZukaufMonat - einspeisungsErloesMtl - par14ErstattungMtl;
    const msg = [
      `\u2600\uFE0F *Ihr bee-doo PV-Angebot*`,
      ``,
      `\u{1F464} ${kundenName}`,
      addr ? `\u{1F4CD} ${addr}` : null,
      ``,
      `\u{1F4E6} *Anlage:*`,
      `\u2022 ${modulAnz} Module \xB7 ${kwpAnlage.toFixed(1)} kWp`,
      `\u2022 Speicher: ${speicherKwh.toLocaleString("de-DE")} kWh`,
      `\u2022 Wechselrichter: ${wrTyp}`,
      ``,
      `\u{1F4B0} *Preis:* ${gesamtPreis.toLocaleString("de-DE")} \u20AC`,
      isBarkauf2 ? `\u2022 Barkauf \xB7 laufende Kosten: ${Math.max(0, laufKosten)} \u20AC/Monat` : `\u2022 Finanzierung ${selJ}J \xB7 Rate ab ${Math.round(finanzOptionen.find((o) => o.j === selJ)?.rateM || 0)} \u20AC/Monat`,
      ``,
      `\u{1F4CA} *Ihre Ersparnis:*`,
      `\u2022 Autarkiegrad: ${Math.round(autarkiegrad * 100)}%`,
      `\u2022 VORHER: ${Math.round(stromkostenMonat)} \u20AC/Monat Strom`,
      `\u2022 NACHHER: nur ${Math.max(0, laufKosten)} \u20AC/Monat laufend`,
      `\u2022 25-Jahres-Ersparnis: ${Math.round(ersparnis25).toLocaleString("de")} \u20AC`,
      `\u2022 Amortisation: ${amortJahreDyn} Jahre`,
      ``,
      `\u{1F41D} bee-doo \xB7 Solarenergie f\xFCr Dich`
    ].filter(Boolean).join("\n");
    const waUrl = `https://wa.me/${(data.mobilnr || "").replace(/\D/g, "").replace(/^0/, "49")}?text=${encodeURIComponent(msg)}`;
    return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, marginBottom: 10, maxHeight: 200, overflowY: "auto" } }, /* @__PURE__ */ React.createElement("pre", { style: { fontSize: 10, color: T.textSec, whiteSpace: "pre-wrap", margin: 0, fontFamily: font, lineHeight: 1.5 } }, msg)), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement("button", { onClick: () => {
      if (navigator.share) navigator.share({ text: msg });
      else window.open(waUrl, "_blank");
    }, style: {
      flex: 1,
      padding: "12px 16px",
      borderRadius: 10,
      border: "none",
      cursor: "pointer",
      background: "#25D366",
      color: "#fff",
      fontSize: 14,
      fontWeight: 700,
      fontFamily: font
    } }, "\u{1F4F1} WhatsApp senden"), /* @__PURE__ */ React.createElement("button", { onClick: () => navigator.clipboard?.writeText(msg), style: {
      padding: "12px 16px",
      borderRadius: 10,
      border: `1px solid ${T.border}`,
      cursor: "pointer",
      background: T.surface,
      color: T.text,
      fontSize: 14,
      fontFamily: font
    } }, "\u{1F4CB}")));
  })()), gesamtPreis > 0 && /* @__PURE__ */ React.createElement(Section, { title: "Angebots-G\xFCltigkeit", icon: "\u23F3", accent: T.red }, (() => {
    const tage = parseInt(gueltigTage) || 14;
    const ablauf = /* @__PURE__ */ new Date();
    ablauf.setDate(ablauf.getDate() + tage);
    const ablaufStr = ablauf.toLocaleDateString("de-DE", { weekday: "long", day: "numeric", month: "long", year: "numeric" });
    return /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8, marginBottom: 10 } }, [7, 14, 21, 30].map((d) => /* @__PURE__ */ React.createElement("div", { key: d, onClick: () => {
      setGueltigTage(String(d));
      u("angebotTage", String(d));
    }, style: {
      flex: 1,
      padding: "10px 8px",
      borderRadius: 10,
      cursor: "pointer",
      textAlign: "center",
      background: tage === d ? `${T.red}10` : T.surface,
      border: `2px solid ${tage === d ? T.red : T.border}`
    } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: tage === d ? T.red : T.text, fontFamily: fontMono } }, d), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Tage")))), /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: `${T.red}06`, borderRadius: 12, border: `2px solid ${T.red}20`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.red, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5 } }, "\u23F3 Dieses Angebot gilt bis"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 900, color: T.red, marginTop: 4 } }, ablaufStr), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 6, lineHeight: 1.4 } }, "Preise f\xFCr Module, Speicher & Wechselrichter unterliegen Marktschwankungen. Aktuelle Konditionen (", gesamtPreis.toLocaleString("de-DE"), " \u20AC netto) sind bis zum genannten Datum garantiert.")));
  })()), data.vorname && gesamtPreis > 0 && /* @__PURE__ */ React.createElement(Section, { title: "Stromversorger-K\xFCndigung", icon: "\u2702\uFE0F", accent: T.red }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "K\xFCndigungstext generieren \u2013 Kunde wechselt nach PV-Installation zum dynamischen Tarif:"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 12, marginBottom: 10 } }, /* @__PURE__ */ React.createElement(Input, { label: "Aktueller Versorger", value: data.versorger || "", onChange: (v) => u("versorger", v), placeholder: "z.B. E.ON, Stadtwerke\u2026", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Kundennummer", value: data.versorgerKnr || "", onChange: (v) => u("versorgerKnr", v), placeholder: "optional", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Vertragslaufzeit bis", value: data.versorgerBis || "", onChange: (v) => u("versorgerBis", v), placeholder: "z.B. 31.12.2026", half: true })), data.versorger && (() => {
    const kundenName = `${data.vorname || ""} ${data.nachname || ""}`.trim();
    const addr = `${data.strasse || ""} ${data.hausnr || ""}
${data.plz || ""} ${data.ort || ""}`;
    const kuendigungsTxt = [
      `${kundenName}`,
      addr,
      ``,
      `An: ${data.versorger}`,
      ``,
      `Betreff: K\xFCndigung meines Stromvertrags${data.versorgerKnr ? ` (Kd.-Nr. ${data.versorgerKnr})` : ""}`,
      ``,
      `Sehr geehrte Damen und Herren,`,
      ``,
      `hiermit k\xFCndige ich meinen bestehenden Stromvertrag fristgerecht zum n\xE4chstm\xF6glichen Termin${data.versorgerBis ? ` (Laufzeit bis ${data.versorgerBis})` : ""}.`,
      ``,
      `Bitte senden Sie mir eine schriftliche Best\xE4tigung der K\xFCndigung.`,
      ``,
      `Mit freundlichen Gr\xFC\xDFen`,
      kundenName
    ].join("\n");
    return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, marginBottom: 10, maxHeight: 180, overflowY: "auto" } }, /* @__PURE__ */ React.createElement("pre", { style: { fontSize: 10, color: T.textSec, whiteSpace: "pre-wrap", margin: 0, fontFamily: font, lineHeight: 1.5 } }, kuendigungsTxt)), /* @__PURE__ */ React.createElement("button", { onClick: () => navigator.clipboard?.writeText(kuendigungsTxt), style: {
      width: "100%",
      padding: "10px",
      borderRadius: 10,
      border: "none",
      cursor: "pointer",
      background: T.red,
      color: "#fff",
      fontSize: 12,
      fontWeight: 600,
      fontFamily: font
    } }, "\u{1F4CB} K\xFCndigungstext kopieren"));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "\xDCbergabe-Protokoll", icon: "\u{1F4E6}", accent: T.green }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "Was bekommt der Kunde nach der Installation?"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: 4 } }, [
    { k: "ueAnmeldung", l: "Netzanmeldung beim Netzbetreiber", desc: "bee-doo meldet die Anlage beim zust\xE4ndigen Netzbetreiber an" },
    { k: "ueMarktstamm", l: "Marktstammdatenregister (MaStR)", desc: "Registrierung der Anlage im Bundesnetzagentur-Register" },
    { k: "ueZaehler", l: "Zweirichtungsz\xE4hler bestellt", desc: "Netzbetreiber tauscht alten Z\xE4hler gegen Zweirichtungsz\xE4hler" },
    { k: "ueApp", l: "Monitoring-App eingerichtet", desc: "Kunden-App f\xFCr Echtzeit-\xDCberwachung der PV-Anlage" },
    { k: "ueEinweisung", l: "Einweisung Wechselrichter & App", desc: "Berater erkl\xE4rt dem Kunden die Bedienung vor Ort" },
    { k: "ueDoku", l: "Anlagendokumentation \xFCbergeben", desc: "Datenbl\xE4tter Module, WR, Speicher + Schaltplan" },
    { k: "ueVersicherung", l: "Versicherungshinweis gegeben", desc: "Kunde informiert: WGV melden, ggf. PV-Versicherung" },
    { k: "ueEinspeise", l: "Einspeiseverg\xFCtung beantragt", desc: "EEG-Verg\xFCtung beim Netzbetreiber beantragt" }
  ].map((item, i) => /* @__PURE__ */ React.createElement("div", { key: i, onClick: () => u(item.k, !data[item.k]), style: {
    display: "flex",
    alignItems: "center",
    gap: 8,
    padding: "8px 12px",
    cursor: "pointer",
    background: data[item.k] ? `${T.green}06` : T.surface,
    borderRadius: 8,
    border: `1px solid ${data[item.k] ? T.green : T.border}`
  } }, /* @__PURE__ */ React.createElement("div", { style: { width: 20, height: 20, borderRadius: 5, border: `2px solid ${data[item.k] ? T.green : T.border}`, background: data[item.k] ? T.green : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data[item.k] && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 11, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: data[item.k] ? 600 : 400, color: data[item.k] ? T.green : T.text } }, item.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, item.desc))))), (() => {
    const total = ["ueAnmeldung", "ueMarktstamm", "ueZaehler", "ueApp", "ueEinweisung", "ueDoku", "ueVersicherung", "ueEinspeise"].filter((k) => data[k]).length;
    return total > 0 && /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8, padding: "8px 12px", background: `${T.green}08`, borderRadius: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.green, fontWeight: 600 } }, total, "/8 Punkte erledigt"));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Notizen bee-doo", icon: "\u{1F4DD}" }, (() => {
    const startMic = () => {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        alert("Spracherkennung nicht unterst\xFCtzt");
        return;
      }
      const rec = new SR();
      rec.lang = "de-DE";
      rec.continuous = true;
      rec.interimResults = false;
      rec.onresult = (e) => {
        const txt = Array.from(e.results).map((r) => r[0].transcript).join(" ");
        u("notizenBeedoo", (data.notizenBeedoo || "") + (data.notizenBeedoo ? " " : "") + txt);
      };
      rec.onend = () => setMic(false);
      rec.onerror = () => setMic(false);
      rec.start();
      setMic(true);
      setTimeout(() => {
        try {
          rec.stop();
        } catch (e) {
        }
      }, 3e4);
    };
    return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "flex-end", marginBottom: 6 } }, /* @__PURE__ */ React.createElement("button", { onClick: mic ? () => setMic(false) : startMic, style: {
      padding: "3px 10px",
      borderRadius: 8,
      border: `1px solid ${mic ? T.red : T.border}`,
      background: mic ? `${T.red}15` : "transparent",
      cursor: "pointer",
      fontSize: 11,
      color: mic ? T.red : T.textDim,
      fontFamily: font
    } }, mic ? "\u{1F534} Aufnahme..." : "\u{1F399}\uFE0F Diktieren")), /* @__PURE__ */ React.createElement(
      "textarea",
      {
        value: data.notizenBeedoo || "",
        onChange: (e) => u("notizenBeedoo", e.target.value),
        placeholder: "Zus\xE4tzliche Anmerkungen zum Angebot...",
        style: { width: "100%", minHeight: 80, padding: 14, background: T.surface, border: `1.5px solid ${mic ? T.red : T.border}`, borderRadius: 10, color: T.text, fontSize: 14, fontFamily: font, resize: "vertical", outline: "none", boxSizing: "border-box" }
      }
    ));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Team-Schnellwahl", icon: "\u{1F4DE}", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: 6 } }, [
    { icon: "\u{1F454}", l: "Teamleiter", nr: data._tlNr || "", color: T.blue, k: "tl" },
    { icon: "\u{1F3E2}", l: "Backoffice", nr: data._boNr || "", color: BRAND.yellow, k: "bo" },
    { icon: "\u{1F527}", l: "DC-Team", nr: data._dcNr || "", color: T.green, k: "dc" },
    { icon: "\u26A1", l: "AC-Team", nr: data._acNr || "", color: T.red, k: "ac" },
    { icon: "\u{1F4CB}", l: "Disposition", nr: data._dispoNr || "", color: T.text, k: "dispo" }
  ].map((t, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { display: "flex", flexDirection: "column", gap: 4 } }, /* @__PURE__ */ React.createElement(
    "input",
    {
      type: "tel",
      value: t.nr,
      onChange: (e) => u(`_${t.k}Nr`, e.target.value),
      placeholder: `${t.l}-Nr.`,
      style: { width: "100%", padding: "6px 8px", background: T.surface, border: `1px solid ${T.border}`, borderRadius: 6, color: T.text, fontSize: 10, fontFamily: fontMono, outline: "none", boxSizing: "border-box", WebkitAppearance: "none" }
    }
  ), /* @__PURE__ */ React.createElement("a", { href: t.nr ? `tel:${t.nr}` : "#", onClick: (e) => {
    if (!t.nr) e.preventDefault();
  }, style: {
    padding: "10px",
    borderRadius: 8,
    textDecoration: "none",
    textAlign: "center",
    background: t.nr ? `${t.color}10` : T.surface,
    border: `1.5px solid ${t.nr ? `${t.color}30` : T.border}`,
    color: t.nr ? t.color : T.textDim,
    fontSize: 11,
    fontWeight: 600,
    fontFamily: font,
    opacity: t.nr ? 1 : 0.5
  } }, t.icon, " ", t.l))))), /* @__PURE__ */ React.createElement(Section, { title: "Nachbar-Lead", icon: "\u{1F3D8}\uFE0F", accent: BRAND.yellow }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "\u{1F41D} Bauengel-Programm: Kennt der Kunde jemanden in der Nachbarschaft?"), [0, 1, 2].map((idx) => {
    const pfx = `nachbar${idx}`;
    const filled = data[`${pfx}Name`] || data[`${pfx}Tel`];
    return /* @__PURE__ */ React.createElement("div", { key: idx, style: { padding: filled ? "10px 14px" : "8px 14px", background: filled ? `${BRAND.yellow}06` : T.surface, borderRadius: 10, border: `1px solid ${filled ? `${BRAND.yellow}30` : T.border}`, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: filled ? BRAND.yellow : T.textDim, marginBottom: filled ? 8 : 0 } }, filled ? `\u2705 Lead ${idx + 1}` : `Lead ${idx + 1} (optional)`), (filled || idx === 0 || data[`nachbar${idx - 1}Name`]) && /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 8 } }, /* @__PURE__ */ React.createElement(Input, { label: "Name", value: data[`${pfx}Name`] || "", onChange: (v) => u(`${pfx}Name`, v), placeholder: "Max M\xFCller", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Adresse / Hausnr.", value: data[`${pfx}Addr`] || "", onChange: (v) => u(`${pfx}Addr`, v), placeholder: "Musterstr. 5", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Telefon", value: data[`${pfx}Tel`] || "", onChange: (v) => u(`${pfx}Tel`, v), placeholder: "0171 1234567", half: true, type: "tel" }), /* @__PURE__ */ React.createElement(Input, { label: "Notiz", value: data[`${pfx}Notiz`] || "", onChange: (v) => u(`${pfx}Notiz`, v), placeholder: "Hat auch S\xFCddach\u2026", half: true })));
  }), (data.nachbar0Name || data.nachbar1Name || data.nachbar2Name) && (() => {
    const leads = [0, 1, 2].filter((i) => data[`nachbar${i}Name`]).map((i) => ({
      name: data[`nachbar${i}Name`],
      addr: data[`nachbar${i}Addr`] || "",
      tel: data[`nachbar${i}Tel`] || "",
      notiz: data[`nachbar${i}Notiz`] || ""
    }));
    const kundenName = `${data.vorname || ""} ${data.nachname || ""}`.trim();
    const msg = [
      `\u{1F3D8}\uFE0F *NACHBAR-LEADS*`,
      kundenName ? `Empfohlen von: ${kundenName}` : "",
      `\u{1F4CD} ${data.strasse || ""} ${data.hausnr || ""}, ${data.plz || ""} ${data.ort || ""}`,
      "",
      ...leads.map((l, i) => [`\u{1F464} ${l.name}`, l.addr ? `\u{1F4CD} ${l.addr}` : null, l.tel ? `\u{1F4DE} ${l.tel}` : null, l.notiz ? `\u{1F4AC} ${l.notiz}` : null, ""].filter(Boolean)).flat()
    ].filter(Boolean).join("\n");
    const waUrl = `https://wa.me/?text=${encodeURIComponent(msg)}`;
    return /* @__PURE__ */ React.createElement("button", { onClick: () => {
      if (navigator.share) navigator.share({ text: msg });
      else window.open(waUrl, "_blank");
    }, style: {
      width: "100%",
      padding: "12px 16px",
      borderRadius: 10,
      border: "none",
      cursor: "pointer",
      background: `linear-gradient(135deg, ${BRAND.yellow}, ${BRAND.yellow}CC)`,
      color: "#000",
      fontSize: 13,
      fontWeight: 700,
      fontFamily: font
    } }, "\u{1F4E4} ", leads.length, " Lead", leads.length > 1 ? "s" : "", " ans Backoffice senden");
  })()), /* @__PURE__ */ React.createElement(Section, { title: "DC vor Ort Termin", icon: "\u{1F3D7}\uFE0F", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { onClick: () => u("dcTerminNoetig", data.dcTerminNoetig === "Ja" ? "" : "Ja"), style: {
    display: "flex",
    alignItems: "center",
    gap: 12,
    padding: "12px 16px",
    marginBottom: 12,
    background: data.dcTerminNoetig === "Ja" ? `${T.blue}10` : T.surface,
    borderRadius: 12,
    border: `2px solid ${data.dcTerminNoetig === "Ja" ? T.blue : T.border}`,
    cursor: "pointer",
    transition: "all 0.15s ease"
  } }, /* @__PURE__ */ React.createElement("div", { style: {
    width: 26,
    height: 26,
    borderRadius: 7,
    flexShrink: 0,
    border: `2px solid ${data.dcTerminNoetig === "Ja" ? T.blue : T.border}`,
    background: data.dcTerminNoetig === "Ja" ? T.blue : "transparent",
    display: "flex",
    alignItems: "center",
    justifyContent: "center"
  } }, data.dcTerminNoetig === "Ja" && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 14, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: data.dcTerminNoetig === "Ja" ? T.blue : T.text } }, "DC vor Ort Termin ben\xF6tigt"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim } }, "Dachcheck, Elektrik-Pr\xFCfung, Statik oder besondere Gegebenheiten"))), data.dcTerminNoetig === "Ja" && /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: `${T.blue}06`, borderRadius: 12, border: `1.5px solid ${T.blue}20` } }, /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 14 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 10, color: T.blue, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 6 } }, "Grund f\xFCr DC-Termin (Mehrfachauswahl)"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 6 } }, [
    { k: "dcGrundDach", l: "\u{1F3E0} Dachsubstanz" },
    { k: "dcGrundStatik", l: "\u2696\uFE0F Statik" },
    { k: "dcGrundElektrik", l: "\u26A1 Elektrik" },
    { k: "dcGrundAsbest", l: "\u26A0\uFE0F Asbest-Verdacht" },
    { k: "dcGrundFlachdach", l: "\u{1F4D0} Flachdach" },
    { k: "dcGrundDenkmal", l: "\u{1F3DB}\uFE0F Denkmalschutz" },
    { k: "dcGrundKomplex", l: "\u{1F527} Komplexe Installation" },
    { k: "dcGrundSonstig", l: "\u{1F4CB} Sonstiges" }
  ].map((c) => /* @__PURE__ */ React.createElement("button", { key: c.k, onClick: () => u(c.k, !data[c.k]), style: {
    padding: "6px 12px",
    borderRadius: 8,
    cursor: "pointer",
    fontFamily: font,
    border: `1.5px solid ${data[c.k] ? T.blue : T.border}`,
    background: data[c.k] ? `${T.blue}12` : T.surface,
    color: data[c.k] ? T.blue : T.text,
    fontSize: 11,
    fontWeight: data[c.k] ? 600 : 400
  } }, c.l)))), /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 14 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 10, color: T.blue, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 6 } }, "\u{1F4C5} Kunde hat Zeit am"), (() => {
    const today = /* @__PURE__ */ new Date();
    const dates = [];
    for (let i = 1; i <= 14; i++) {
      const d = new Date(today);
      d.setDate(d.getDate() + i);
      if (d.getDay() === 0) continue;
      dates.push(d);
    }
    const dayNames = ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"];
    const monthNames = ["Jan", "Feb", "M\xE4r", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez"];
    return /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "repeat(6, 1fr)", gap: 4 } }, dates.slice(0, 12).map((d, i) => {
      const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
      const isSel = data.dcDatum === key;
      const isSat = d.getDay() === 6;
      return /* @__PURE__ */ React.createElement("button", { key: i, onClick: () => u("dcDatum", key), style: {
        padding: "8px 4px",
        borderRadius: 10,
        cursor: "pointer",
        fontFamily: font,
        textAlign: "center",
        border: `2px solid ${isSel ? T.blue : T.border}`,
        background: isSel ? T.blue : isSat ? `${BRAND.yellow}08` : T.surface,
        transition: "all 0.12s ease"
      } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, fontWeight: 600, color: isSel ? "#fff" : isSat ? BRAND.yellow : T.textDim } }, dayNames[d.getDay()]), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 16, fontWeight: 800, color: isSel ? "#fff" : T.text, fontFamily: fontMono, lineHeight: 1.3 } }, d.getDate()), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 8, color: isSel ? "rgba(255,255,255,0.7)" : T.textDim } }, monthNames[d.getMonth()]));
    }));
  })(), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 8 } }, /* @__PURE__ */ React.createElement(Input, { label: "Oder anderes Datum", value: data.dcDatumAlt || "", onChange: (v) => {
    u("dcDatumAlt", v);
    if (v) u("dcDatum", "");
  }, placeholder: "z.B. ab M\xE4rz, nach Ostern\u2026", half: true }))), /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 14 } }, /* @__PURE__ */ React.createElement("label", { style: { display: "block", fontSize: 10, color: T.blue, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 6 } }, "\u{1F550} Bevorzugte Uhrzeit"), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 6, marginBottom: 8 } }, [
    { k: "morgens", l: "\u{1F305} Morgens", sub: "08:00 \u2013 11:00" },
    { k: "mittags", l: "\u2600\uFE0F Mittags", sub: "11:00 \u2013 14:00" },
    { k: "nachmittags", l: "\u{1F307} Nachmittag", sub: "14:00 \u2013 17:00" }
  ].map((slot) => {
    const isSel = data.dcZeitSlot === slot.k;
    return /* @__PURE__ */ React.createElement("button", { key: slot.k, onClick: () => u("dcZeitSlot", slot.k), style: {
      padding: "10px 6px",
      borderRadius: 10,
      cursor: "pointer",
      fontFamily: font,
      textAlign: "center",
      border: `2px solid ${isSel ? T.blue : T.border}`,
      background: isSel ? `${T.blue}12` : T.surface,
      transition: "all 0.12s ease"
    } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: isSel ? T.blue : T.text } }, slot.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: isSel ? T.blue : T.textDim, marginTop: 2 } }, slot.sub));
  })), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 12 } }, /* @__PURE__ */ React.createElement(Input, { label: "Exakte Uhrzeit (optional)", value: data.dcUhrzeit || "", onChange: (v) => u("dcUhrzeit", v), placeholder: "z.B. 10:30", half: true }), /* @__PURE__ */ React.createElement(Input, { label: "Dauer (ca.)", value: data.dcDauer || "", onChange: (v) => u("dcDauer", v), placeholder: "60", suffix: "Min.", half: true, type: "number" }))), /* @__PURE__ */ React.createElement("div", { style: { marginBottom: 14 } }, /* @__PURE__ */ React.createElement(Input, { label: "Besondere Hinweise f\xFCr DC-Team", value: data.dcHinweise || "", onChange: (v) => u("dcHinweise", v), placeholder: "z.B. Hund im Garten, Leiter n\xF6tig, Schl\xFCssel beim Nachbarn\u2026" })), (data.dcDatum || data.dcDatumAlt) && /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: T.surface, borderRadius: 12, border: `1.5px solid ${T.blue}30`, marginBottom: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.blue, fontWeight: 600, textTransform: "uppercase", letterSpacing: 0.5, marginBottom: 8 } }, "\u{1F4CB} Termin-Zusammenfassung"), /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "auto 1fr", gap: "4px 12px" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "Kunde:"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 600, color: T.text } }, `${data.anrede || ""} ${data.vorname || ""} ${data.nachname || ""}`.trim() || "\u2013"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "Adresse:"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 600, color: T.text } }, data.strasse ? `${data.strasse} ${data.hausnummer || ""}, ${data.plz || ""} ${data.ort || ""}` : "\u2013"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "Telefon:"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 600, color: T.text } }, data.telefon || "\u2013"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "Datum:"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: T.blue } }, data.dcDatum ? (() => {
    const p = data.dcDatum.split("-");
    const d = new Date(p[0], p[1] - 1, p[2]);
    const dn = ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"];
    return `${dn[d.getDay()]}, ${p[2]}.${p[1]}.${p[0]}`;
  })() : data.dcDatumAlt || "\u2013"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "Uhrzeit:"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: T.blue } }, data.dcUhrzeit || (data.dcZeitSlot === "morgens" ? "08:00 \u2013 11:00" : data.dcZeitSlot === "mittags" ? "11:00 \u2013 14:00" : data.dcZeitSlot === "nachmittags" ? "14:00 \u2013 17:00" : "\u2013")), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "Grund:"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: T.text } }, [
    data.dcGrundDach && "Dachsubstanz",
    data.dcGrundStatik && "Statik",
    data.dcGrundElektrik && "Elektrik",
    data.dcGrundAsbest && "Asbest-Verdacht",
    data.dcGrundFlachdach && "Flachdach",
    data.dcGrundDenkmal && "Denkmalschutz",
    data.dcGrundKomplex && "Komplexe Installation",
    data.dcGrundSonstig && "Sonstiges"
  ].filter(Boolean).join(", ") || "\u2013"), data.dcHinweise && /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "Hinweise:"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, color: T.text } }, data.dcHinweise)))), !data._dcTerminGesendet ? /* @__PURE__ */ React.createElement("button", { onClick: () => {
    const kunde = `${data.anrede || ""} ${data.vorname || ""} ${data.nachname || ""}`.trim();
    const adresse = data.strasse ? `${data.strasse} ${data.hausnummer || ""}, ${data.plz || ""} ${data.ort || ""}` : "\u2013";
    const telefon = data.telefon || "\u2013";
    const datumStr = data.dcDatum ? (() => {
      const p = data.dcDatum.split("-");
      const d = new Date(p[0], p[1] - 1, p[2]);
      const dn = ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"];
      return `${dn[d.getDay()]} ${p[2]}.${p[1]}.${p[0]}`;
    })() : data.dcDatumAlt || "\u2013";
    const zeitStr = data.dcUhrzeit || (data.dcZeitSlot === "morgens" ? "08\u201311 Uhr" : data.dcZeitSlot === "mittags" ? "11\u201314 Uhr" : data.dcZeitSlot === "nachmittags" ? "14\u201317 Uhr" : "\u2013");
    const gruende = [
      data.dcGrundDach && "Dach",
      data.dcGrundStatik && "Statik",
      data.dcGrundElektrik && "Elektrik",
      data.dcGrundAsbest && "Asbest",
      data.dcGrundFlachdach && "Flachdach",
      data.dcGrundDenkmal && "Denkmal",
      data.dcGrundKomplex && "Komplex",
      data.dcGrundSonstig && "Sonstiges"
    ].filter(Boolean).join(", ");
    const modulInfo = modulAnz > 0 ? `${modulAnz} Module (${(modulAnz * 0.47).toFixed(1)} kWp)` : "";
    const msg = [
      `\u{1F3D7}\uFE0F DC VOR-ORT TERMIN`,
      ``,
      `\u{1F464} ${kunde}`,
      `\u{1F4CD} ${adresse}`,
      `\u{1F4DE} ${telefon}`,
      ``,
      `\u{1F4C5} ${datumStr}`,
      `\u{1F550} ${zeitStr}`,
      ``,
      `\u{1F4CB} Grund: ${gruende || "\u2013"}`,
      modulInfo && `\u2600\uFE0F Anlage: ${modulInfo}`,
      data.dcHinweise && `\u{1F4AC} Hinweis: ${data.dcHinweise}`,
      ``,
      `Gesendet von bee-doo FIELD`
    ].filter(Boolean).join("\n");
    if (navigator.share) {
      navigator.share({ title: "DC Termin bee-doo", text: msg }).then(() => {
        u("_dcTerminGesendet", true);
        u("_dcTerminZeit", (/* @__PURE__ */ new Date()).toISOString());
      }).catch(() => {
      });
    } else {
      window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, "_blank");
      u("_dcTerminGesendet", true);
      u("_dcTerminZeit", (/* @__PURE__ */ new Date()).toISOString());
    }
  }, style: {
    width: "100%",
    padding: "14px",
    borderRadius: 12,
    border: "none",
    cursor: "pointer",
    background: `linear-gradient(135deg, ${T.blue}, ${T.blue}CC)`,
    color: "#fff",
    fontSize: 14,
    fontWeight: 700,
    fontFamily: font,
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    gap: 10,
    boxShadow: `0 4px 16px ${T.blue}40`
  } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18 } }, "\u{1F4F2}"), " DC-Termin an Team senden") : /* @__PURE__ */ React.createElement("div", { style: { padding: "14px 16px", background: `${T.green}10`, borderRadius: 12, border: `1.5px solid ${T.green}30` } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10 } }, /* @__PURE__ */ React.createElement(Buddy, { emoji: "\u{1F41D}", size: 20 }), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 700, color: T.green } }, "DC-Termin wurde gesendet!"), data._dcTerminZeit && /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginTop: 2 } }, "Gesendet: ", new Date(data._dcTerminZeit).toLocaleString("de-DE")))), /* @__PURE__ */ React.createElement("button", { onClick: () => {
    u("_dcTerminGesendet", false);
    u("_dcTerminZeit", "");
  }, style: {
    marginTop: 8,
    padding: "8px 14px",
    borderRadius: 8,
    border: `1px solid ${T.border}`,
    background: T.surface,
    cursor: "pointer",
    fontSize: 11,
    color: T.textDim,
    fontFamily: font
  } }, "\u{1F504} Erneut senden")))), /* @__PURE__ */ React.createElement(Section, { title: "Nachfass-Erinnerung", icon: "\u23F0", accent: BRAND.yellow }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "Kunde will noch \xFCberlegen? Follow-Up planen:"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", flexWrap: "wrap", gap: 8, marginBottom: 10 } }, [{ d: 1, l: "Morgen" }, { d: 2, l: "2 Tage" }, { d: 3, l: "3 Tage" }, { d: 5, l: "5 Tage" }, { d: 7, l: "1 Woche" }].map((opt) => {
    const sel = data.nachfassTage === String(opt.d);
    return /* @__PURE__ */ React.createElement("div", { key: opt.d, onClick: () => u("nachfassTage", sel ? "" : String(opt.d)), style: {
      padding: "10px 16px",
      borderRadius: 10,
      cursor: "pointer",
      flex: "1 1 auto",
      textAlign: "center",
      background: sel ? `${BRAND.yellow}15` : T.surface,
      border: `2px solid ${sel ? BRAND.yellow : T.border}`
    } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 800, color: sel ? BRAND.yellow : T.text, fontFamily: fontMono } }, opt.d), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: sel ? BRAND.yellow : T.textDim } }, opt.l));
  })), /* @__PURE__ */ React.createElement(Input, { label: "Grund / Notiz", value: data.nachfassNotiz || "", onChange: (v) => u("nachfassNotiz", v), placeholder: "z.B. will mit Frau sprechen, Urlaub bis\u2026" }), data.nachfassTage && (() => {
    const tage = parseInt(data.nachfassTage) || 3;
    const datum = /* @__PURE__ */ new Date();
    datum.setDate(datum.getDate() + tage);
    const datumStr = datum.toLocaleDateString("de-DE", { weekday: "long", day: "numeric", month: "long" });
    const kundenName = `${data.vorname || ""} ${data.nachname || ""}`.trim() || "Kunde";
    const msg = [
      `\u23F0 *NACHFASS-ERINNERUNG*`,
      `\u{1F4C5} ${datumStr}`,
      `\u{1F464} ${kundenName}`,
      `\u{1F4DE} ${data.mobilnr || data.telefon || "\u2013"}`,
      data.nachfassNotiz ? `\u{1F4AC} ${data.nachfassNotiz}` : null,
      ``,
      `\u2600\uFE0F ${modulAnz} Module \xB7 ${kwpAnlage.toFixed(1)} kWp \xB7 ${gesamtPreis.toLocaleString("de-DE")} \u20AC`
    ].filter(Boolean).join("\n");
    const waUrl = `https://wa.me/?text=${encodeURIComponent(msg)}`;
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10 } }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: `${BRAND.yellow}08`, borderRadius: 10, border: `1px solid ${BRAND.yellow}20`, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: BRAND.yellow, fontWeight: 600 } }, "\u{1F4C5} Nachfassen am: ", datumStr), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 2 } }, kundenName, " \xB7 ", data.mobilnr || data.telefon || "\u2013")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement("button", { onClick: () => {
      if (navigator.share) navigator.share({ text: msg });
      else window.open(waUrl, "_blank");
    }, style: {
      flex: 1,
      padding: "12px 16px",
      borderRadius: 10,
      border: "none",
      cursor: "pointer",
      background: BRAND.yellow,
      color: "#000",
      fontSize: 13,
      fontWeight: 700,
      fontFamily: font
    } }, "\u{1F4E4} Erinnerung senden"), /* @__PURE__ */ React.createElement("button", { onClick: () => {
      const cal = [`BEGIN:VCALENDAR`, `BEGIN:VEVENT`, `DTSTART:${datum.toISOString().replace(/[-:]/g, "").split(".")[0]}`, `SUMMARY:Nachfass: ${kundenName}`, `DESCRIPTION:${data.nachfassNotiz || "PV-Angebot Nachfass"}`, `END:VEVENT`, `END:VCALENDAR`].join("\n");
      const blob = new Blob([cal], { type: "text/calendar" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = `nachfass-${kundenName.replace(/\s/g, "-")}.ics`;
      a.click();
    }, style: {
      padding: "12px 16px",
      borderRadius: 10,
      border: `1px solid ${T.border}`,
      cursor: "pointer",
      background: T.surface,
      color: T.text,
      fontSize: 13,
      fontFamily: font
    } }, "\u{1F4C5} .ics")));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Ihr Weg zur Solaranlage", icon: "\u{1F5D3}\uFE0F", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 10 } }, "Von der Unterschrift bis zur ersten kWh \u2013 so geht's weiter:"), (() => {
    const steps = [
      { icon: "\u270D\uFE0F", l: "Heute: Auftragserteilung", desc: "Vertrag unterschreiben, Finanzierung einreichen", dauer: "Tag 1", done: !!data.signatureImage },
      { icon: "\u{1F4CB}", l: "Netzanmeldung", desc: "bee-doo meldet die Anlage beim Netzbetreiber an", dauer: "1\u20132 Wochen", done: false },
      { icon: "\u{1F4D0}", l: "Technische Planung", desc: "Dachplanung, Belegungsplan, Statik-Pr\xFCfung", dauer: "1\u20132 Wochen", done: false },
      { icon: "\u{1F4E6}", l: "Material-Bestellung", desc: "Module, WR, Speicher bei Aiko/Hersteller bestellt", dauer: "2\u20134 Wochen", done: false },
      { icon: "\u{1F3D7}\uFE0F", l: "Montage-Termin", desc: "1\u20132 Tage Installation auf Ihrem Dach", dauer: "1\u20132 Tage", done: false },
      { icon: "\u26A1", l: "Elektriker & Inbetriebnahme", desc: "AC-Anschluss, Z\xE4hlerumbau, Speicher-Konfiguration", dauer: "1 Tag", done: false },
      { icon: "\u2705", l: "Z\xE4hlertausch & Netzfreigabe", desc: "Zweirichtungsz\xE4hler vom Netzbetreiber", dauer: "1\u20134 Wochen", done: false },
      { icon: "\u2600\uFE0F", l: "Ihre Anlage produziert!", desc: "Ab jetzt eigenen Strom erzeugen und Geld sparen", dauer: "\u{1F389}", done: false }
    ];
    return /* @__PURE__ */ React.createElement("div", { style: { position: "relative", paddingLeft: 24 } }, /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", left: 10, top: 8, bottom: 8, width: 2, background: `linear-gradient(180deg, ${T.green}, ${T.blue}, ${BRAND.yellow})` } }), steps.map((s, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { display: "flex", alignItems: "flex-start", gap: 10, marginBottom: i < steps.length - 1 ? 12 : 0, position: "relative" } }, /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", left: -18, top: 4, width: 12, height: 12, borderRadius: 6, background: s.done ? T.green : i === steps.length - 1 ? BRAND.yellow : T.surface, border: `2px solid ${s.done ? T.green : i === 0 ? T.blue : T.border}`, zIndex: 1 } }, s.done && /* @__PURE__ */ React.createElement("div", { style: { width: 6, height: 6, background: "#fff", borderRadius: 3, margin: "1px auto" } })), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", justifyContent: "space-between", alignItems: "baseline" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: s.done ? T.green : T.text } }, s.icon, " ", s.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, fontWeight: 600, color: s.done ? T.green : T.textDim, fontFamily: fontMono } }, s.dauer)), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginTop: 1 } }, s.desc)))));
  })(), /* @__PURE__ */ React.createElement("div", { style: { marginTop: 12, padding: "10px 14px", background: `${T.green}08`, borderRadius: 10, border: `1px solid ${T.green}20`, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 700, color: T.green } }, "\u23F1\uFE0F Gesamtdauer: ca. 6\u201310 Wochen"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textSec, marginTop: 2 } }, "Von Unterschrift bis erste kWh vom eigenen Dach"))), /* @__PURE__ */ React.createElement(Section, { title: "Checkliste", icon: "\u2705", accent: T.green }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginBottom: 10 } }, "Vor Unterschrift pr\xFCfen \u2013 nichts vergessen!"), [
    { k: "chkZaehler", l: "Z\xE4hlerkasten fotografiert", icon: "\u{1F4F8}" },
    { k: "chkDach", l: "Dachziegel-Typ dokumentiert", icon: "\u{1F3E0}" },
    { k: "chkKabel", l: "Kabelweg besprochen (HAK \u2192 ZS \u2192 WR)", icon: "\u{1F50C}" },
    { k: "chkInternet", l: "Internet/WLAN am WR-Standort vorhanden", icon: "\u{1F4F6}" },
    { k: "chkUnterlage", l: "Dach-Unterlage gepr\xFCft (Bitumen/Folie)", icon: "\u{1F50D}" },
    { k: "chkVerschattung", l: "Verschattung gepr\xFCft (B\xE4ume, Kamine, Gauben)", icon: "\u{1F333}" },
    { k: "chkSpeicherOrt", l: "Speicher-Aufstellort festgelegt (frostfrei, bel\xFCftet)", icon: "\u{1F50B}" },
    { k: "chkBauseitig", l: "Bauseitige Leistungen besprochen", icon: "\u{1F528}" },
    { k: "chkErdung", l: "Erdung / Potentialausgleich vorhanden", icon: "\u26A1" },
    { k: "chkSLS", l: "SLS / Z\xE4hlerfeld-Typ gepr\xFCft", icon: "\u{1F50C}" },
    { k: "chkUeberspannung", l: "\xDCberspannungsschutz gepr\xFCft", icon: "\u26A1" },
    { k: "chkMontageZugang", l: "Zugang f\xFCr Montage-Team gekl\xE4rt", icon: "\u{1F69B}" }
  ].map((c) => /* @__PURE__ */ React.createElement("div", { key: c.k, onClick: () => u(c.k, !data[c.k]), style: {
    display: "flex",
    alignItems: "center",
    gap: 12,
    padding: "10px 14px",
    marginBottom: 4,
    background: data[c.k] ? `${T.green}08` : T.surface,
    borderRadius: 10,
    border: `1px solid ${data[c.k] ? `${T.green}30` : T.border}`,
    cursor: "pointer",
    transition: "all 0.15s ease"
  } }, /* @__PURE__ */ React.createElement("div", { style: {
    width: 24,
    height: 24,
    borderRadius: 7,
    flexShrink: 0,
    border: `2px solid ${data[c.k] ? T.green : T.border}`,
    background: data[c.k] ? T.green : "transparent",
    display: "flex",
    alignItems: "center",
    justifyContent: "center"
  } }, data[c.k] && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 13, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 15 } }, c.icon), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, color: data[c.k] ? T.green : T.text, fontWeight: data[c.k] ? 600 : 400, textDecoration: data[c.k] ? "line-through" : "none" } }, c.l))), (() => {
    const chkKeys = ["chkZaehler", "chkDach", "chkKabel", "chkInternet", "chkUnterlage", "chkVerschattung", "chkSpeicherOrt", "chkBauseitig", "chkErdung", "chkSLS", "chkUeberspannung", "chkMontageZugang"];
    const done = chkKeys.filter((k) => data[k]).length;
    const total = chkKeys.length;
    return /* @__PURE__ */ React.createElement("div", { style: { marginTop: 10, padding: "10px 14px", borderRadius: 8, background: done === total ? `${T.green}10` : `${BRAND.yellow}08`, border: `1px solid ${done === total ? `${T.green}25` : `${BRAND.yellow}25`}`, display: "flex", alignItems: "center", justifyContent: "center", gap: 10 } }, done === total && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 22 } }, "\u{1F41D}"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, fontWeight: 700, color: done === total ? T.green : BRAND.yellow } }, done === total ? "Alle Punkte gepr\xFCft \u2013 bereit zur Unterschrift! \u{1F36F}" : `${done}/${total} erledigt`), done === 10 && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 22 } }, "\u{1F389}"));
  })()), data._startZeit && (() => {
    const start = new Date(data._startZeit);
    const diffMs = terminNow - start;
    const mins = Math.floor(diffMs / 6e4);
    const hrs = Math.floor(mins / 60);
    const restMin = mins % 60;
    const dauerStr = hrs > 0 ? `${hrs}h ${restMin}min` : `${restMin} min`;
    const startStr = start.toLocaleTimeString("de-DE", { hour: "2-digit", minute: "2-digit" });
    const nowStr = terminNow.toLocaleTimeString("de-DE", { hour: "2-digit", minute: "2-digit" });
    return /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: `${T.blue}06`, borderRadius: 12, border: `1px solid ${T.blue}20`, marginBottom: 14, display: "flex", justifyContent: "space-between", alignItems: "center" } }, /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.blue, fontWeight: 600, textTransform: "uppercase" } }, "\u23F1\uFE0F Termindauer"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginTop: 1 } }, "Start: ", startStr, " \xB7 Jetzt: ", nowStr)), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 22, fontWeight: 900, color: T.blue, fontFamily: fontMono } }, dauerStr));
  })(), /* @__PURE__ */ React.createElement(Section, { title: "Zusammenfassung", icon: "\u{1F464}" }, /* @__PURE__ */ React.createElement("div", { style: { display: "grid", gridTemplateColumns: "1fr 1fr", gap: "8px 20px" } }, [
    ["Name", `${data.anrede || ""} ${data.vorname || ""} ${data.nachname || ""}`.trim() || "\u2013"],
    ["Adresse", data.strasse ? `${data.strasse} ${data.hausnummer || ""}, ${data.plz || ""} ${data.ort || ""}` : "\u2013"],
    ["Telefon", data.telefon || "\u2013"],
    ["E-Mail", data.email || "\u2013"],
    ["Verbrauch", gesamt > 0 ? `${gesamt.toLocaleString("de")} kWh/a` : "\u2013"],
    ["Strompreis", data.strompreis ? `${data.strompreis} ct/kWh` : "\u2013"],
    ["Geb\xE4ude", data.gebaeudetyp || "\u2013"],
    ["Dachfl\xE4che", data._solarData ? `${data._solarData.maxArea} m\xB2 nutzbar` : "\u2013"],
    ["Solar-Potenzial", data._solarData ? `${data._solarData.maxPanels} Module \xB7 ${data._solarData.yearlyEnergy.toLocaleString("de")} kWh/a` : "\u2013"],
    ["Sonnenstunden", `${solarReg.sonne} h/a \xB7 ${solarReg.ertrag} kWh/kWp (${solarReg.name})`],
    ["PV-Erzeugung", pvErzeugung > 0 ? `${pvErzeugung.toLocaleString("de")} kWh/a` : "\u2013"],
    ["Module", modulAnz > 0 ? `${modulAnz}\xD7 Aiko 3S` : "\u2013"],
    ["Speicher", speicherKwh > 0 ? `${speicherKwh.toLocaleString("de-DE")} kWh (empfohlen: ${empfohlenerAkku.toFixed(1)} kWh)` : "\u2013"],
    ["Autarkiegrad", `${Math.round(autarkiegrad * 100)}% (ohne Akku: ${Math.round(autarkieOhneAkku * 100)}%)`],
    ["Wechselrichter", wrTyp || "\u2013"],
    ["Systempreis", systemPreis > 0 ? `${systemPreis.toLocaleString("de-DE")} \u20AC` : "\u2013"],
    ["Gesamtpreis", gesamtPreis > 0 ? `${gesamtPreis.toLocaleString("de-DE")} \u20AC` : "\u2013"],
    ["\xA735a Steuerbonus", steuerbonus > 0 ? `\u2212${steuerbonus.toLocaleString("de-DE")} \u20AC` : "\u2013"],
    ["Restzukauf Strom \xD8", restZukaufMonat > 0 ? `${restZukaufMonat} \u20AC/Monat${dynTarifAktiv2 ? ` (dyn. ${dynAP2} ct)` : ""}` : "\u2013"],
    ["Einspeisung Erl\xF6s", einspeisungsErloes > 0 ? `${einspeisungsErloes} \u20AC/Jahr` : "\u2013"],
    ["Dyn. Stromtarif", dynTarifAktiv2 ? `Ja \xB7 ${dynAP2} ct/kWh (statt ${ap2} ct)` : "\u2013"],
    ["\xA714a EnWG", par14Aktiv ? `Modul 1 \xB7 ${par14ErstattungJahr} \u20AC/Jahr Erstattung` : "\u2013"],
    ["Preissteigerung", `${(stromSteigerung * 100).toFixed(0)}% p.a.`],
    ["25J-Ersparnis", `${Math.round(ersparnis25).toLocaleString("de")} \u20AC`],
    ["Amortisation", `${amortJahreDyn} Jahre`],
    ["SLS", data.slsVorhanden || "\u2013"],
    ["Netzform", data.netzform || "\u2013"],
    ["Schneelast", data.schneelastzone || getSnowZone(data.plz) || "\u2013"],
    ["Windzone", data.windzone || getWindZone(data.plz) || "\u2013"],
    ["Aufstellort WR", data.aufstellortWR || "\u2013"]
  ].map(([k, v]) => /* @__PURE__ */ React.createElement("div", { key: k, style: { padding: "6px 0" } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim, textTransform: "uppercase", letterSpacing: 0.5 } }, k), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, color: T.text, marginTop: 2 } }, v))))), /* @__PURE__ */ React.createElement(Section, { title: "Am Montagetag", icon: "\u{1F527}", accent: BRAND.yellow }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "Was passiert am Tag der Installation? Dem Kunden zeigen:"), [
    { zeit: "07:30", icon: "\u{1F69B}", l: "Ankunft Montage-Team", desc: "2\u20134 Monteure + Materiallieferung. Bitte Parkplatz / Zufahrt freihalten." },
    { zeit: "08:00", icon: "\u{1F3D7}\uFE0F", l: "Ger\xFCstaufbau & Vorbereitung", desc: "Ger\xFCst aufstellen (falls n\xF6tig), Dach-Absicherung, Material sortieren." },
    { zeit: "08:30", icon: "\u{1F529}", l: "Unterkonstruktion montieren", desc: "Dachhaken / Schienen auf den Sparren befestigen. Ziegel werden tempor\xE4r entfernt." },
    { zeit: "10:00", icon: "\u2600\uFE0F", l: "Module auflegen", desc: "Aiko Module auf die Schienen clippen. Verkabelung DC-seitig (Steckverbinder)." },
    { zeit: "13:00", icon: "\u{1F355}", l: "Mittagspause", desc: "Monteure machen Pause. Kein Zugang zum Dach in dieser Zeit." },
    { zeit: "13:30", icon: "\u26A1", l: "Elektro-Installation", desc: "DC-Kabel zum Wechselrichter, AC-Anschluss, Speicher anschlie\xDFen." },
    { zeit: "15:00", icon: "\u{1F4F1}", l: "Konfiguration & Test", desc: "WR konfigurieren, App einrichten, Monitoring aktivieren, Testlauf." },
    { zeit: "16:00", icon: "\u2705", l: "Abnahme & \xDCbergabe", desc: "Gemeinsame Begehung, Dokumentation, App-Einweisung, \xDCbergabeprotokoll." }
  ].map((s, i) => /* @__PURE__ */ React.createElement("div", { key: i, style: { display: "flex", gap: 10, marginBottom: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { width: 40, textAlign: "right", flexShrink: 0 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 700, color: T.blue, fontFamily: fontMono } }, s.zeit)), /* @__PURE__ */ React.createElement("div", { style: { width: 2, background: BRAND.yellow, borderRadius: 1, flexShrink: 0, position: "relative" } }, /* @__PURE__ */ React.createElement("div", { style: { position: "absolute", top: 2, left: -3, width: 8, height: 8, borderRadius: 4, background: BRAND.yellow } })), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: T.text } }, s.icon, " ", s.l), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, s.desc)))), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: `${T.green}08`, borderRadius: 10, border: `1px solid ${T.green}20`, marginTop: 8 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, fontWeight: 600, color: T.green } }, "\u2705 Kunde muss nur anwesend sein f\xFCr: Einlass morgens, Abnahme nachmittags"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim, marginTop: 2 } }, "Strom: Kurze Unterbrechung (~30 Min.) beim Z\xE4hlerumbau. WLAN muss aktiv sein f\xFCr WR-Setup."))), /* @__PURE__ */ React.createElement(Section, { title: "Datenschutz (DSGVO)", icon: "\u{1F510}", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, marginBottom: 8, maxHeight: 160, overflowY: "auto" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textSec, lineHeight: 1.6 } }, "Ich willige ein, dass die bee-doo GmbH, Bielefeld, meine personenbezogenen Daten (Name, Adresse, Kontaktdaten, Verbrauchsdaten, Fotos des Geb\xE4udes) zum Zweck der Angebotserstellung, Auftragsabwicklung und Netzanmeldung erhebt, verarbeitet und an beteiligte Dritte (Netzbetreiber, Finanzierungspartner, Montageteam) weitergibt. Die Einwilligung kann jederzeit widerrufen werden. Rechtsgrundlage: Art. 6 Abs. 1 lit. a/b DSGVO. Detaillierte Datenschutzhinweise unter www.bee-doo.de/datenschutz.")), /* @__PURE__ */ React.createElement("div", { onClick: () => u("dsgvoOk", !data.dsgvoOk), style: {
    display: "flex",
    alignItems: "center",
    gap: 10,
    padding: "12px 14px",
    cursor: "pointer",
    background: data.dsgvoOk ? `${T.green}08` : T.surface,
    borderRadius: 10,
    border: `2px solid ${data.dsgvoOk ? T.green : T.red}`
  } }, /* @__PURE__ */ React.createElement("div", { style: { width: 24, height: 24, borderRadius: 6, border: `2px solid ${data.dsgvoOk ? T.green : T.red}`, background: data.dsgvoOk ? T.green : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data.dsgvoOk && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 14, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: data.dsgvoOk ? T.green : T.text } }, "Einwilligung Datenschutz"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Kunde stimmt der Datenverarbeitung gem\xE4\xDF DSGVO zu")))), /* @__PURE__ */ React.createElement(Section, { title: "Widerrufsbelehrung", icon: "\u{1F4DC}", accent: T.red }, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, marginBottom: 8, maxHeight: 160, overflowY: "auto" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textSec, lineHeight: 1.6 } }, /* @__PURE__ */ React.createElement("strong", null, "Widerrufsrecht:"), " Sie haben das Recht, binnen 14 Tagen ohne Angabe von Gr\xFCnden diesen Vertrag zu widerrufen. Die Widerrufsfrist betr\xE4gt 14 Tage ab dem Tag des Vertragsschlusses. Um Ihr Widerrufsrecht auszu\xFCben, m\xFCssen Sie uns (bee-doo GmbH, J\xF6llenbecker Str. 401, 33739 Bielefeld, info@bee-doo.de) mittels einer eindeutigen Erkl\xE4rung (z.B. Brief, E-Mail) \xFCber Ihren Entschluss informieren. Zur Wahrung der Frist gen\xFCgt die rechtzeitige Absendung des Widerrufs.", "\n\n", /* @__PURE__ */ React.createElement("strong", null, "Folgen des Widerrufs:"), " Wenn Sie diesen Vertrag widerrufen, haben wir Ihnen alle Zahlungen, die wir von Ihnen erhalten haben, unverz\xFCglich und sp\xE4testens binnen 14 Tagen zur\xFCckzuzahlen. F\xFCr diese R\xFCckzahlung verwenden wir dasselbe Zahlungsmittel, das Sie bei der urspr\xFCnglichen Transaktion eingesetzt haben.")), (() => {
    const ablaufDatum = /* @__PURE__ */ new Date();
    ablaufDatum.setDate(ablaufDatum.getDate() + 14);
    const ablaufStr = ablaufDatum.toLocaleDateString("de-DE", { day: "numeric", month: "long", year: "numeric" });
    return /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 12px", background: `${T.red}06`, borderRadius: 8, border: `1px solid ${T.red}15`, marginBottom: 8, textAlign: "center" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.red, fontWeight: 600 } }, "\u23F0 Widerruf m\xF6glich bis: ", ablaufStr)), /* @__PURE__ */ React.createElement("div", { onClick: () => u("widerrufOk", !data.widerrufOk), style: {
      display: "flex",
      alignItems: "center",
      gap: 10,
      padding: "12px 14px",
      cursor: "pointer",
      background: data.widerrufOk ? `${T.green}08` : T.surface,
      borderRadius: 10,
      border: `2px solid ${data.widerrufOk ? T.green : T.red}`
    } }, /* @__PURE__ */ React.createElement("div", { style: { width: 24, height: 24, borderRadius: 6, border: `2px solid ${data.widerrufOk ? T.green : T.red}`, background: data.widerrufOk ? T.green : "transparent", display: "flex", alignItems: "center", justifyContent: "center", flexShrink: 0 } }, data.widerrufOk && /* @__PURE__ */ React.createElement("span", { style: { color: "#fff", fontSize: 14, fontWeight: 700 } }, "\u2713")), /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, fontWeight: 600, color: data.widerrufOk ? T.green : T.text } }, "Widerrufsbelehrung zur Kenntnis genommen"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 9, color: T.textDim } }, "Kunde best\xE4tigt Erhalt der Widerrufsbelehrung"))));
  })()), /* @__PURE__ */ React.createElement(Section, { title: "Unterschrift Kunde", icon: "\u270D\uFE0F", accent: BRAND.yellow }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: T.textSec, marginBottom: 8 } }, "Mit der Unterschrift best\xE4tigt der Kunde die Richtigkeit der aufgenommenen Daten und das SEPA-Lastschriftmandat."), !data._signatureData ? /* @__PURE__ */ React.createElement("div", { style: { position: "relative" } }, /* @__PURE__ */ React.createElement(
    "canvas",
    {
      id: "sigCanvas",
      width: 360,
      height: 160,
      style: {
        width: "100%",
        height: 160,
        background: "#fff",
        borderRadius: 12,
        border: `2px dashed ${T.border}`,
        cursor: "crosshair",
        touchAction: "none"
      },
      onPointerDown: (e) => {
        const canvas = e.currentTarget;
        const ctx = canvas.getContext("2d");
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        ctx.strokeStyle = "#1a1a1a";
        ctx.lineWidth = 2.5;
        ctx.lineCap = "round";
        ctx.lineJoin = "round";
        ctx.beginPath();
        ctx.moveTo((e.clientX - rect.left) * scaleX, (e.clientY - rect.top) * scaleY);
        canvas.setPointerCapture(e.pointerId);
        u("_sigDrawing", true);
      },
      onPointerMove: (e) => {
        if (!data._sigDrawing) return;
        const canvas = e.currentTarget;
        const ctx = canvas.getContext("2d");
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        ctx.lineTo((e.clientX - rect.left) * scaleX, (e.clientY - rect.top) * scaleY);
        ctx.stroke();
      },
      onPointerUp: (e) => {
        u("_sigDrawing", false);
        u("_sigHasContent", true);
      }
    }
  ), !data._sigHasContent && /* @__PURE__ */ React.createElement("div", { style: {
    position: "absolute",
    top: "50%",
    left: "50%",
    transform: "translate(-50%, -50%)",
    color: "#ccc",
    fontSize: 14,
    pointerEvents: "none",
    textAlign: "center"
  } }, "\u270D\uFE0F Hier unterschreiben"), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8, marginTop: 8 } }, /* @__PURE__ */ React.createElement("button", { onClick: () => {
    const canvas = document.getElementById("sigCanvas");
    if (canvas) {
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
    u("_sigHasContent", false);
  }, style: {
    flex: 1,
    padding: "10px",
    borderRadius: 10,
    border: `1px solid ${T.border}`,
    background: "transparent",
    color: T.textSec,
    fontSize: 13,
    fontFamily: font,
    cursor: "pointer"
  } }, "\u{1F5D1}\uFE0F L\xF6schen"), /* @__PURE__ */ React.createElement("button", { onClick: () => {
    const canvas = document.getElementById("sigCanvas");
    if (canvas) u("_signatureData", canvas.toDataURL("image/png"));
  }, style: {
    flex: 2,
    padding: "10px",
    borderRadius: 10,
    border: "none",
    cursor: "pointer",
    background: data._sigHasContent ? `linear-gradient(135deg, ${T.green}, #059669)` : T.surface,
    color: data._sigHasContent ? "#fff" : T.textDim,
    fontSize: 13,
    fontWeight: 700,
    fontFamily: font
  } }, "\u2705 Unterschrift best\xE4tigen"))) : /* @__PURE__ */ React.createElement("div", null, /* @__PURE__ */ React.createElement("div", { style: {
    background: "#fff",
    borderRadius: 12,
    padding: 8,
    marginBottom: 8,
    border: `2px solid ${T.green}`,
    position: "relative"
  } }, /* @__PURE__ */ React.createElement("img", { src: data._signatureData, alt: "Unterschrift", style: { width: "100%", height: 120, objectFit: "contain" } }), /* @__PURE__ */ React.createElement("div", { style: {
    position: "absolute",
    top: 6,
    right: 6,
    padding: "2px 8px",
    borderRadius: 6,
    background: T.green,
    color: "#fff",
    fontSize: 10,
    fontWeight: 700
  } }, "\u2713 Best\xE4tigt")), /* @__PURE__ */ React.createElement("button", { onClick: () => {
    u("_signatureData", null);
    u("_sigHasContent", false);
  }, style: {
    width: "100%",
    padding: "8px",
    borderRadius: 8,
    border: `1px solid ${T.border}`,
    background: "transparent",
    color: T.textDim,
    fontSize: 12,
    fontFamily: font,
    cursor: "pointer"
  } }, "Unterschrift zur\xFCcksetzen"))), data._startZeit && /* @__PURE__ */ React.createElement("div", { style: {
    padding: "12px 16px",
    background: T.surface,
    borderRadius: 12,
    border: `1px solid ${T.border}`,
    marginBottom: 16,
    display: "flex",
    justifyContent: "space-between",
    alignItems: "center"
  } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim } }, /* @__PURE__ */ React.createElement("div", null, "\u{1F550} Start: ", new Date(data._startZeit).toLocaleTimeString("de-DE", { hour: "2-digit", minute: "2-digit" }), " Uhr"), /* @__PURE__ */ React.createElement("div", null, "\u{1F550} Jetzt: ", (/* @__PURE__ */ new Date()).toLocaleTimeString("de-DE", { hour: "2-digit", minute: "2-digit" }), " Uhr")), /* @__PURE__ */ React.createElement("div", { style: { textAlign: "right" } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 18, fontWeight: 800, color: BRAND.yellow, fontFamily: fontMono } }, Math.floor((Date.now() - new Date(data._startZeit).getTime()) / 6e4), " min"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim } }, "Aufnahmedauer"))), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 10 } }, /* @__PURE__ */ React.createElement("button", { onClick: () => {
    u("_endZeit", (/* @__PURE__ */ new Date()).toISOString());
    alert("PDF wird generiert...\n\nIn der PWA-Version wird hier ein PDF mit allen Daten, Fotos und Unterschrift erzeugt.");
  }, style: {
    flex: 1,
    padding: "16px",
    borderRadius: 14,
    border: `2px solid ${BRAND.yellow}`,
    background: "transparent",
    color: BRAND.yellow,
    fontSize: 15,
    fontWeight: 700,
    fontFamily: font,
    cursor: "pointer"
  } }, "\u{1F4C4} PDF Export"), /* @__PURE__ */ React.createElement("button", { onClick: () => {
    u("_endZeit", (/* @__PURE__ */ new Date()).toISOString());
    alert("Aufnahme wird an Leveto gesendet...\n\nIn der PWA-Version werden alle Daten an die Leveto-API \xFCbertragen.");
  }, style: {
    flex: 1,
    padding: "16px",
    borderRadius: 14,
    border: "none",
    cursor: "pointer",
    background: data._signatureData ? `linear-gradient(135deg, ${T.green}, #059669)` : T.surface,
    color: data._signatureData ? "#fff" : T.textDim,
    fontSize: 15,
    fontWeight: 700,
    fontFamily: font,
    boxShadow: data._signatureData ? `0 0 30px rgba(52,211,153,0.2)` : "none"
  } }, data._signatureData ? "\u2705 Abschlie\xDFen" : "\u26A0\uFE0F Erst unterschreiben")), gesamtPreis > 0 && /* @__PURE__ */ React.createElement(Section, { title: "Teamleiter-Report", icon: "\u{1F4CA}", accent: T.blue }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 10, color: T.textDim, marginBottom: 8 } }, "Kompakter Termin-Report f\xFCr den Teamleiter:"), (() => {
    const kundenName = `${data.anrede || ""} ${data.vorname || ""} ${data.nachname || ""}`.trim() || "\u2013";
    const addr = `${data.strasse || ""} ${data.hausnr || ""}, ${data.plz || ""} ${data.ort || ""}`.trim();
    const isBarkauf2 = data.preismodell === "Kauf";
    const selJ = parseInt(data.finanzJahre) || 15;
    const types = [data.typSparer && "Sparer", data.typOeko && "\xD6ko", data.typTech && "Technik", data.typSicher && "Sicherheit"].filter(Boolean);
    const motive = [data.motKosten && "Kosten", data.motUmwelt && "Umwelt", data.motAutarkie && "Autarkie", data.motWert && "Wert", data.motEAuto && "E-Auto", data.motFoerderung && "F\xF6rderung"].filter(Boolean);
    const report = [
      `\u{1F4CA} *TERMIN-REPORT bee-doo*`,
      ``,
      `\u{1F464} ${kundenName}`,
      addr ? `\u{1F4CD} ${addr}` : null,
      `\u{1F4DE} ${data.mobilnr || data.telefon || "\u2013"}`,
      ``,
      `\u{1F3E0} *Geb\xE4ude:*`,
      `\u2022 ${data.gebaeudetyp || "EFH"} \xB7 Bj. ${data.baujahr || "\u2013"} \xB7 ${data.dachform || "\u2013"}`,
      `\u2022 ${data.erwachsene || "?"} Erw. + ${data.kinder || "0"} Kinder`,
      ``,
      `\u26A1 *Verbrauch & Strom:*`,
      `\u2022 ${gesamt.toLocaleString("de")} kWh/a \xB7 ${ap2} ct/kWh \xB7 ${Math.round(stromkostenMonat)} \u20AC/Monat`,
      data.evModell ? `\u2022 E-Auto: ${data.evModell}` : null,
      ``,
      `\u2600\uFE0F *Anlage:*`,
      `\u2022 ${modulAnz} Module \xB7 ${kwpAnlage.toFixed(1)} kWp \xB7 Aiko 3S+`,
      `\u2022 Speicher: ${speicherKwh > 0 ? speicherKwh.toLocaleString("de") + " kWh" : "\u2013"}`,
      `\u2022 WR: ${wrTyp || "\u2013"}`,
      `\u2022 Gesamtpreis: ${gesamtPreis.toLocaleString("de-DE")} \u20AC netto`,
      ``,
      `\u{1F4B0} *Wirtschaftlichkeit:*`,
      `\u2022 ${isBarkauf2 ? "Barkauf" : `Finanzierung ${selJ}J \xB7 ${zinsAktuell}%`}`,
      `\u2022 Autarkiegrad: ${Math.round(autarkiegrad * 100)}%`,
      `\u2022 25J-Ersparnis: ${Math.round(ersparnis25).toLocaleString("de")} \u20AC`,
      `\u2022 Amortisation: ${amortJahreDyn} Jahre`,
      ``,
      types.length > 0 ? `\u{1F3AF} Kundentyp: ${types.join(", ")}` : null,
      motive.length > 0 ? `\u{1F4A1} Motivation: ${motive.join(", ")}` : null,
      data.konkAnbieter ? `\u2694\uFE0F Konkurrenz: ${data.konkAnbieter}` : null,
      data.nachfassTage ? `\u23F0 Nachfass: in ${data.nachfassTage} Tagen` : null,
      data.notizenBeedoo ? `\u{1F4DD} Notiz: ${data.notizenBeedoo.substring(0, 100)}` : null,
      data.dcTerminNoetig === "Ja" ? `\u{1F3D7}\uFE0F DC vor Ort n\xF6tig!` : null,
      ``,
      data._signatureData ? `\u2705 *UNTERSCHRIEBEN*` : `\u23F3 *Noch nicht unterschrieben*`,
      ``,
      `Gesendet von bee-doo FIELD \xB7 ${(/* @__PURE__ */ new Date()).toLocaleDateString("de-DE")}`
    ].filter(Boolean).join("\n");
    const waUrl = `https://wa.me/?text=${encodeURIComponent(report)}`;
    return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", background: T.surface, borderRadius: 10, border: `1px solid ${T.border}`, marginBottom: 10, maxHeight: 200, overflowY: "auto" } }, /* @__PURE__ */ React.createElement("pre", { style: { fontSize: 9, color: T.textSec, whiteSpace: "pre-wrap", margin: 0, fontFamily: font, lineHeight: 1.4 } }, report)), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 8 } }, /* @__PURE__ */ React.createElement("button", { onClick: () => {
      if (navigator.share) navigator.share({ text: report });
      else window.open(waUrl, "_blank");
    }, style: {
      flex: 1,
      padding: "12px 16px",
      borderRadius: 10,
      border: "none",
      cursor: "pointer",
      background: T.blue,
      color: "#fff",
      fontSize: 13,
      fontWeight: 700,
      fontFamily: font
    } }, "\u{1F4E4} Report an Teamleiter senden"), /* @__PURE__ */ React.createElement("button", { onClick: () => navigator.clipboard?.writeText(report), style: {
      padding: "12px 16px",
      borderRadius: 10,
      border: `1px solid ${T.border}`,
      cursor: "pointer",
      background: T.surface,
      color: T.text,
      fontSize: 13,
      fontFamily: font
    } }, "\u{1F4CB}")));
  })()));
}
function BeedooField() {
  const [showDashboard, setShowDashboard] = useState(true);
  const [showAlert, setShowAlert] = useState(true);
  const [showStart, setShowStart] = useState(true);
  const [step, setStep] = useState(0);
  const [data, setData] = useState({ anrede: "Herr", preismodell: "Finanzierung", finanzDienstleister: "EFS", efsTarif: "Basic", zins: "5.99", finanzJahre: "15", dynStromtarif: true, par14: true, dynStrompreis: "26", par14Erstattung: "160", stromSteigerung: "4", _startZeit: (/* @__PURE__ */ new Date()).toISOString() });
  const [clock, setClock] = useState(/* @__PURE__ */ new Date());
  const [isWide, setIsWide] = useState(() => typeof window !== "undefined" && window.innerWidth >= 768);
  const [saveStatus, setSaveStatus] = useState(null);
  const [restorePrompt, setRestorePrompt] = useState(null);
  const [rueckkehrer, setRueckkehrer] = useState([
    { id: "rk1", name: "Krause, Detmold", plz: "32756", ort: "Detmold", typ: "PV 11.4 kWp", grund: "Zählerschrank zu klein", tage: 3, aufgabe: "Kunde muss Elektriker beauftragen für Zählerschrank-Umbau (63A). Angebot einholen und Termin bestätigen. Dann DC-Montage neu einplanen.", notiz: "Kunde weiß Bescheid, wartet auf Elektriker-Angebot von Fa. Meier", erstelltVon: "Kevin M. (DC-Montage)", erstelltAm: "20.02.2026", deadline: "26.02.2026" },
    { id: "rk2", name: "Yilmaz, Bielefeld", plz: "33602", ort: "Bielefeld", typ: "PV+WP 14.7 kWp", grund: "Dachsanierung nötig", tage: 7, aufgabe: "Dachdecker-Freigabe fehlt. Kunde hat Termin am 28.02. — danach Rückmeldung ob Dach tragfähig. Erst dann AC-Montage möglich.", notiz: "WP-Stellplatz schon vorbereitet", erstelltVon: "Olaf S. (Projektleitung)", erstelltAm: "16.02.2026", deadline: "01.03.2026" },
    { id: "rk3", name: "Hofmann, Herford", plz: "32049", ort: "Herford", typ: "PV 9.5 kWp", grund: "Netzanmeldung abgelehnt", tage: 12, aufgabe: "Westnetz hat Netzanmeldung abgelehnt wegen fehlender Unterlagen (Lageplan + Anlagenzertifikat). Unterlagen nachreichen und erneut einreichen.", notiz: null, erstelltVon: "Patrick G. (Netzanmeldung)", erstelltAm: "11.02.2026", deadline: "23.02.2026" }
  ]);
  useEffect(() => {
    const t = setInterval(() => setClock(/* @__PURE__ */ new Date()), 3e4);
    return () => clearInterval(t);
  }, []);
  useEffect(() => {
    const onResize = () => setIsWide(window.innerWidth >= 768);
    window.addEventListener("resize", onResize);
    return () => window.removeEventListener("resize", onResize);
  }, []);
  // Alert timer handled by AlertScreen internally
  useEffect(() => {
    (async () => {
      try {
        const saved = await window.storage.get("beedoo-field-autosave");
        if (saved && saved.value) {
          const parsed = JSON.parse(saved.value);
          if (parsed.data && parsed.data._aufnahmeTyp) {
            setRestorePrompt(parsed);
          }
        }
      } catch (e) {
      }
    })();
  }, []);
  useEffect(() => {
    try {
      const params = new URLSearchParams(window.location.search);
      const scouterData = params.get("scouter");
      if (scouterData) {
        const decoded = JSON.parse(atob(scouterData));
        if (decoded && typeof decoded === "object") {
          setData((d) => ({ ...d, ...decoded, _scouterImport: true }));
          setShowStart(false);
        }
      }
      const fieldMap = ["vorname", "nachname", "strasse", "hausnr", "plz", "ort", "email", "telefon", "mobil", "stromverbrauch", "strompreis", "grundpreis", "dachform", "dachneigung", "himmelsrichtung", "heizung", "baujahr", "anzahlPersonen", "immobilienwert"];
      const fromParams = {};
      fieldMap.forEach((k) => {
        const v = params.get(k);
        if (v) fromParams[k] = v;
      });
      if (Object.keys(fromParams).length > 0) {
        if (fromParams.heizung) {
          fromParams[`heiz_${fromParams.heizung}`] = true;
          delete fromParams.heizung;
        }
        setData((d) => ({ ...d, ...fromParams, _scouterImport: true }));
      }
    } catch (e) {
      console.warn("[Scouter-Import] URL parse error:", e);
    }
    const handleMessage = (e) => {
      try {
        const msg = typeof e.data === "string" ? JSON.parse(e.data) : e.data;
        if (msg && msg.type === "scouter-data" && msg.payload) {
          setData((d) => ({ ...d, ...msg.payload, _scouterImport: true }));
          setShowStart(false);
        }
      } catch (e2) {
      }
    };
    window.addEventListener("message", handleMessage);
    return () => window.removeEventListener("message", handleMessage);
  }, []);
  useEffect(() => {
    if (showStart || !data._aufnahmeTyp) return;
    const t = setInterval(async () => {
      try {
        setSaveStatus("saving");
        const savePayload = {};
        Object.keys(data).forEach((k) => {
          if (!k.startsWith("_compass") && !k.startsWith("_sig") && !k.endsWith("Scanning") && !k.endsWith("Photo") && !k.endsWith("_gd") && k !== "_geoLoading" && k !== "_solarLoading" && k !== "_addrSuggestions") {
            savePayload[k] = data[k];
          }
        });
        await window.storage.set("beedoo-field-autosave", JSON.stringify({ data: savePayload, step, ts: (/* @__PURE__ */ new Date()).toISOString() }));
        setSaveStatus("saved");
        setTimeout(() => setSaveStatus(null), 2e3);
      } catch (e) {
        setSaveStatus(null);
      }
    }, 3e4);
    return () => clearInterval(t);
  }, [showStart, data, step]);
  const aufnahmeTyp = data._aufnahmeTyp || null;
  const hasPV = aufnahmeTyp === "PV" || aufnahmeTyp === "PV+WP";
  const hasWP = aufnahmeTyp === "WP" || aufnahmeTyp === "PV+WP";
  const kundeName = [data.vorname, data.nachname].filter(Boolean).join(" ");
  const stepViews = [
    /* @__PURE__ */ React.createElement(StepKunde, { data, setData }),
    /* @__PURE__ */ React.createElement(StepEinstieg, { data, setData, hasPV, hasWP }),
    /* @__PURE__ */ React.createElement(StepTechnik, { data, setData, hasPV, hasWP }),
    /* @__PURE__ */ React.createElement(StepFotos, { data, setData, hasPV, hasWP }),
    /* @__PURE__ */ React.createElement(StepAngebot, { data, setData, hasPV, hasWP })
  ];
  return /* @__PURE__ */ React.createElement("div", { style: { background: T.bg, minHeight: "100vh", fontFamily: font, color: T.text } }, /* @__PURE__ */ React.createElement("style", null, `
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: ${T.border}; border-radius: 3px; }
        input::placeholder, textarea::placeholder { color: ${T.textDim}; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeInUp { from { transform: translateY(12px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes pulseRed { 0%,100% { box-shadow: 0 0 0px rgba(239,68,68,0); } 50% { box-shadow: 0 0 16px rgba(239,68,68,0.4); } }
        @keyframes pulseGreen { 0%,100% { box-shadow: 0 0 0px rgba(52,211,153,0); } 50% { box-shadow: 0 0 12px rgba(52,211,153,0.3); } }
        @keyframes minionBounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        @keyframes minionWobble { 0%,100% { transform: rotate(0deg); } 25% { transform: rotate(2deg); } 75% { transform: rotate(-2deg); } }
        @keyframes podiumRise { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes crownBounce { 0%,100% { transform: translateY(0) rotate(-3deg); } 50% { transform: translateY(-5px) rotate(3deg); } }
        @keyframes shimmerGold { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes barGrow { from { width: 0; } to { width: var(--bw); } }
        @keyframes streakPop { 0% { transform: scale(0.8); opacity: 0; } 50% { transform: scale(1.1); } 100% { transform: scale(1); opacity: 1; } }
      `), showDashboard && showAlert && React.createElement(AlertScreen, { stornos: [{id:"st1",name:"Petersen, Lemgo",typ:"PV 10.2 kWp",grund:"Preis zu hoch",restStunden:26},{id:"st2",name:"Klein, Herford",typ:"PV+WP 13.5 kWp",grund:"Finanzierung abgelehnt",restStunden:44}], rueckkehrer: rueckkehrer, onDismiss: function() { setShowAlert(false); } }), showDashboard && !showAlert && React.createElement(DashboardScreen, { onNewAufnahme: function() { setShowDashboard(false); }, onTerminClick: function(termin) {
        var typMap = { "PV": "PV", "WP": "WP", "PV+WP": "PV+WP" };
        var aufTyp = typMap[termin.typ] || "PV";
        var kd = termin.kunde || {};
        setData(function(d) { return Object.assign({}, d, kd, { _aufnahmeTyp: aufTyp, _startZeit: new Date().toISOString(), _terminImport: true }); });
        setShowDashboard(false);
        setShowStart(false);
        setStep(0);
      }, rueckkehrer: rueckkehrer, onRueckkehrerErledigt: function(id) { setRueckkehrer(function(prev) { return prev.filter(function(r) { return r.id !== id; }); }); } }), !showDashboard && showStart && /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(StartScreen, { onStart: (typ) => {
    setData((d) => ({ ...d, _aufnahmeTyp: typ, _startZeit: (/* @__PURE__ */ new Date()).toISOString() }));
    setShowStart(false);
    setRestorePrompt(null);
  } }), restorePrompt && /* @__PURE__ */ React.createElement("div", { style: {
    position: "fixed",
    bottom: 0,
    left: 0,
    right: 0,
    zIndex: 1e3,
    padding: "20px 16px",
    background: T.card,
    borderTop: `2px solid ${BRAND.yellow}`,
    borderRadius: "20px 20px 0 0",
    boxShadow: "0 -10px 40px rgba(0,0,0,0.5)"
  } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8, fontSize: 15, fontWeight: 700, color: T.text, marginBottom: 6 } }, /* @__PURE__ */ React.createElement(Buddy, { emoji: "\u{1F41D}", size: 18 }), "\u{1F4CB} Letzte Aufnahme fortsetzen?"), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 12, color: T.textDim, marginBottom: 4 } }, restorePrompt.data.vorname || "", " ", restorePrompt.data.nachname || "", " ", restorePrompt.data.ort ? `\xB7 ${restorePrompt.data.ort}` : ""), /* @__PURE__ */ React.createElement("div", { style: { fontSize: 11, color: T.textDim, marginBottom: 14 } }, restorePrompt.data._aufnahmeTyp === "PV" ? "\u2600\uFE0F PV" : restorePrompt.data._aufnahmeTyp === "WP" ? "\u2668\uFE0F WP" : "\u26A1 PV+WP", " \xB7 Gespeichert ", new Date(restorePrompt.ts).toLocaleString("de-DE")), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", gap: 10 } }, /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: async () => {
        setRestorePrompt(null);
        try {
          await window.storage.delete("beedoo-field-autosave");
        } catch (e) {
        }
      },
      style: { flex: 1, padding: "12px", borderRadius: 10, border: `1px solid ${T.border}`, background: "transparent", color: T.textSec, fontSize: 14, fontFamily: font, cursor: "pointer" }
    },
    "Verwerfen"
  ), /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => {
        setData(restorePrompt.data);
        setStep(restorePrompt.step || 0);
        setShowStart(false);
        setRestorePrompt(null);
      },
      style: { flex: 2, padding: "12px", borderRadius: 10, border: "none", background: `linear-gradient(135deg, ${BRAND.yellow}, ${BRAND.yellowDark})`, color: "#1a1a1a", fontSize: 14, fontWeight: 700, fontFamily: font, cursor: "pointer" }
    },
    "\u25B6 Fortsetzen"
  )))), !showStart && /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { style: {
    position: "sticky",
    top: 0,
    zIndex: 100,
    padding: "8px 16px",
    background: `${T.bg}ee`,
    backdropFilter: "blur(16px)",
    borderBottom: `1px solid ${T.border}`,
    animation: "fadeInUp 0.5s ease"
  } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", justifyContent: "space-between" } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } }, /* @__PURE__ */ React.createElement("button", { onClick: () => { setShowDashboard(true); setShowStart(true); }, style: { padding: "4px 10px", borderRadius: 8, border: `1px solid ${T.border}`, background: `${T.surface}`, color: T.textSec, fontSize: 10, fontWeight: 600, fontFamily: font, cursor: "pointer", display: "flex", alignItems: "center", gap: 4, transition: "all .2s" } }, "\u2190 Dashboard"), /* @__PURE__ */ React.createElement(BeedooLogoSmall, { height: 28 })), /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } }, aufnahmeTyp && /* @__PURE__ */ React.createElement("button", { onClick: () => setShowStart(true), style: {
    padding: "3px 10px",
    borderRadius: 6,
    border: `1px solid ${aufnahmeTyp === "PV" ? `${BRAND.yellow}50` : aufnahmeTyp === "WP" ? `${T.blue}50` : `${T.green}50`}`,
    background: aufnahmeTyp === "PV" ? `${BRAND.yellow}12` : aufnahmeTyp === "WP" ? `${T.blue}12` : `${T.green}12`,
    color: aufnahmeTyp === "PV" ? BRAND.yellow : aufnahmeTyp === "WP" ? T.blue : T.green,
    fontSize: 10,
    fontWeight: 700,
    fontFamily: font,
    cursor: "pointer",
    letterSpacing: 0.5
  } }, aufnahmeTyp === "PV" ? "\u2600\uFE0F PV" : aufnahmeTyp === "WP" ? "\u2668\uFE0F WP" : "\u26A1 PV+WP"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textSec, fontFamily: fontMono } }, clock.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" }), " \xB7 ", clock.toLocaleTimeString("de-DE", { hour: "2-digit", minute: "2-digit" })), saveStatus && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: saveStatus === "saved" ? T.green : T.textDim, fontFamily: fontMono } }, saveStatus === "saving" ? "\u{1F4BE}..." : "\u2713"))), kundeName && /* @__PURE__ */ React.createElement("div", { style: {
    display: "flex",
    alignItems: "center",
    justifyContent: "space-between",
    marginTop: 6,
    padding: "5px 12px",
    borderRadius: 8,
    background: T.surface,
    border: `1px solid ${T.border}`
  } }, /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 8 } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13 } }, "\u{1F464}"), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 13, fontWeight: 600, color: T.text } }, data.anrede, " ", kundeName), data.ort && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim } }, "\xB7 ", data.plz, " ", data.ort)), data.mobil && /* @__PURE__ */ React.createElement("a", { href: `tel:${data.mobil.replace(/\s/g, "")}`, style: {
    fontSize: 11,
    color: T.green,
    textDecoration: "none",
    fontFamily: fontMono
  } }, "\u{1F4DE} ", data.mobil)), (() => {
    const motPV = [
      { key: "motKosten", label: "\u{1F4B8} Stromkosten" },
      { key: "motUmwelt", label: "\u{1F33F} Umwelt" },
      { key: "motAutarkie", label: "\u{1F50B} Autarkie" },
      { key: "motWert", label: "\u{1F3E0} Wert" },
      { key: "motEAuto", label: "\u{1F697} E-Auto" },
      { key: "motFoerderung", label: "\u{1F4B6} F\xF6rderung" },
      { key: "motEinspeise", label: "\u26A1 Einspeisung" },
      { key: "motNachbar", label: "\u{1F44B} Nachbar" },
      { key: "motSonstiges", label: "\u{1F4CB} Sonstiges" }
    ];
    const motWP = [
      { key: "motHeizung", label: "\u{1F527} Heizung raus" },
      { key: "motFoerderung", label: "\u{1F4B6} BEG" },
      { key: "motKosten", label: "\u{1F4B8} Heizkosten" },
      { key: "motUmwelt", label: "\u{1F33F} CO\u2082" },
      { key: "motGEG", label: "\u{1F4DC} GEG" },
      { key: "motKomfort", label: "\u{1F321}\uFE0F Komfort" },
      { key: "motKuehlung", label: "\u2744\uFE0F K\xFChlung" },
      { key: "motSonstiges", label: "\u{1F4CB} Sonstiges" }
    ];
    const all = [...motPV, ...motWP];
    const selected = all.filter((m) => data[m.key]);
    const seen = /* @__PURE__ */ new Set();
    const unique = selected.filter((m) => {
      if (seen.has(m.key)) return false;
      seen.add(m.key);
      return true;
    });
    if (unique.length === 0) return null;
    return /* @__PURE__ */ React.createElement("div", { style: {
      display: "flex",
      flexWrap: "wrap",
      gap: 4,
      marginTop: 4,
      padding: "4px 12px"
    } }, unique.map((m) => {
      const isMaster = data._motMaster === m.key;
      return /* @__PURE__ */ React.createElement("span", { key: m.key, style: {
        fontSize: 10,
        padding: isMaster ? "2px 10px" : "2px 8px",
        borderRadius: 6,
        background: isMaster ? T.green : `${T.green}12`,
        border: `1px solid ${isMaster ? T.green : `${T.green}25`}`,
        color: isMaster ? "#fff" : T.green,
        fontWeight: isMaster ? 700 : 600,
        whiteSpace: "nowrap",
        boxShadow: isMaster ? `0 0 8px ${T.green}35` : "none"
      } }, isMaster ? "\u2B50 " : "", m.label);
    }));
  })()), (() => {
    const pflichtFelder = [
      !!data.anrede,
      !!data.vorname?.trim(),
      !!data.nachname?.trim(),
      !!data.mobil?.trim(),
      !!data.email?.trim() && !validateEmail(data.email),
      !!data.geburtsdatum?.trim(),
      !!data.strasse?.trim(),
      !!data.plz?.trim(),
      !!data.ort?.trim(),
      !!data.iban?.trim(),
      !!data.kontoinhaber?.trim(),
      !!data.stromverbrauch?.trim(),
      !!data.zusatzVerbrauch?.trim(),
      !!data.strompreis?.trim(),
      !!data.grundpreis?.trim()
    ];
    const pflichtFotos = [
      "fotoZaehler",
      "fotoHAK",
      "fotoPotential",
      "fotoNeuerZS",
      "fotoKabelwegInnen",
      "fotoKabelwegWRZS",
      "fotoKabelwegHAKZS",
      "fotoKabelwegAussen",
      "fotoAufstellortWR",
      "fotoZSgeschlossen",
      "fotoZSgeoeffnet",
      "fotoDachboden"
    ].filter((k) => data[k]);
    const total = pflichtFelder.length + 12;
    const done = pflichtFelder.filter(Boolean).length + pflichtFotos.length;
    const pct = Math.round(done / total * 100);
    const startTime = data._startZeit ? new Date(data._startZeit) : null;
    const elapsed = startTime ? Math.floor((Date.now() - startTime.getTime()) / 6e4) : 0;
    return /* @__PURE__ */ React.createElement("div", { style: { padding: "8px 20px 0", display: "flex", alignItems: "center", gap: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { width: "100%", height: 6, background: T.surface, borderRadius: 3, overflow: "hidden" } }, /* @__PURE__ */ React.createElement("div", { style: {
      width: `${pct}%`,
      height: "100%",
      borderRadius: 3,
      background: pct === 100 ? T.green : `linear-gradient(90deg, ${BRAND.yellow}, ${BRAND.yellowDark})`,
      transition: "width 0.4s ease"
    } }))), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 12, fontWeight: 700, color: pct === 100 ? T.green : BRAND.yellow, fontFamily: fontMono, flexShrink: 0 } }, pct, "%"), startTime && /* @__PURE__ */ React.createElement("span", { style: { fontSize: 10, color: T.textDim, fontFamily: fontMono, flexShrink: 0 } }, "\u{1F550} ", elapsed < 60 ? `${elapsed}m` : `${Math.floor(elapsed / 60)}h ${elapsed % 60}m`));
  })(), isWide && /* @__PURE__ */ React.createElement("div", { style: {
    position: "fixed",
    top: 0,
    left: 0,
    bottom: 0,
    width: 220,
    zIndex: 90,
    background: T.card,
    borderRight: `1px solid ${T.border}`,
    display: "flex",
    flexDirection: "column",
    paddingTop: 80
  } }, /* @__PURE__ */ React.createElement("div", { style: { flex: 1, padding: "12px 10px", overflowY: "auto" } }, STEPS.map((s, i) => {
    const active = i === step;
    const completed = i < step;
    return /* @__PURE__ */ React.createElement("button", { key: s.id, onClick: () => setStep(i), style: {
      width: "100%",
      padding: "12px 14px",
      borderRadius: 10,
      marginBottom: 4,
      border: "none",
      cursor: "pointer",
      fontFamily: font,
      textAlign: "left",
      background: active ? `${BRAND.yellow}12` : "transparent",
      borderLeft: active ? `3px solid ${BRAND.yellow}` : "3px solid transparent",
      display: "flex",
      alignItems: "center",
      gap: 10,
      transition: "all 0.15s ease"
    } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18, width: 28, textAlign: "center" } }, completed ? "\u2705" : s.icon), /* @__PURE__ */ React.createElement("span", { style: {
      fontSize: 13,
      fontWeight: active ? 700 : 400,
      color: active ? BRAND.yellow : completed ? T.green : T.textSec
    } }, s.label));
  })), kundeName && /* @__PURE__ */ React.createElement("div", { style: { padding: "12px 14px", borderTop: `1px solid ${T.border}`, fontSize: 12 } }, /* @__PURE__ */ React.createElement("div", { style: { color: T.textDim, marginBottom: 4 } }, "Aktueller Kunde"), /* @__PURE__ */ React.createElement("div", { style: { color: T.text, fontWeight: 600 } }, "\u{1F464} ", kundeName), data.ort && /* @__PURE__ */ React.createElement("div", { style: { color: T.textDim, marginTop: 2 } }, data.plz, " ", data.ort), data.mobil && /* @__PURE__ */ React.createElement("a", { href: `tel:${data.mobil.replace(/\s/g, "")}`, style: { color: T.green, textDecoration: "none", marginTop: 4, display: "block" } }, "\u{1F4DE} ", data.mobil)), /* @__PURE__ */ React.createElement("div", { style: { padding: "10px 14px", borderTop: `1px solid ${T.border}`, fontSize: 10, color: T.textDim } }, "v1.2 \xB7 bee-doo FIELD")), !isWide && /* @__PURE__ */ React.createElement("div", { style: {
    display: "flex",
    gap: 2,
    padding: "12px 16px 0",
    overflowX: "auto",
    WebkitOverflowScrolling: "touch"
  } }, STEPS.map((s, i) => {
    const active = i === step;
    const completed = i < step;
    return /* @__PURE__ */ React.createElement("button", { key: s.id, onClick: () => setStep(i), style: {
      flex: "1 0 auto",
      padding: "10px 14px",
      borderRadius: "10px 10px 0 0",
      border: "none",
      cursor: "pointer",
      fontFamily: font,
      background: active ? T.card : "transparent",
      borderBottom: active ? `3px solid ${BRAND.yellow}` : "3px solid transparent",
      display: "flex",
      flexDirection: "column",
      alignItems: "center",
      gap: 4,
      transition: "all 0.2s ease",
      minWidth: 64
    } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18 } }, completed ? "\u2705" : s.icon), /* @__PURE__ */ React.createElement("span", { style: {
      fontSize: 10,
      fontWeight: active ? 700 : 400,
      letterSpacing: 0.5,
      color: active ? BRAND.yellow : completed ? T.green : T.textDim,
      textTransform: "uppercase"
    } }, s.label));
  })), /* @__PURE__ */ React.createElement("div", { key: step, style: {
    padding: isWide ? "16px 24px 100px" : "16px 16px 100px",
    maxWidth: 800,
    margin: "0 auto",
    animation: "fadeInUp 0.35s ease",
    marginLeft: isWide ? 220 : 0
  } }, (() => {
    const tipKey = ["kunde", "einstieg", "technik", "angebot"][step] || "kunde";
    const tips = BUDDY_TIPS[tipKey];
    const tipIdx = Math.floor(Date.now() / 6e4) % tips.length;
    const tip = tips[tipIdx];
    return /* @__PURE__ */ React.createElement("div", { style: { display: "flex", alignItems: "center", gap: 10, marginBottom: 12, padding: "8px 14px", borderRadius: 10, background: `${BRAND.yellow}06`, border: `1px solid ${BRAND.yellow}10` } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 18 } }, tip.e), /* @__PURE__ */ React.createElement("span", { style: { fontSize: 11, color: T.textDim, fontStyle: "italic", flex: 1 } }, tip.t));
  })(), stepViews[step]), data._validationError && /* @__PURE__ */ React.createElement("div", { style: {
    position: "fixed",
    bottom: isWide ? 20 : 80,
    left: isWide ? 236 : 16,
    right: 16,
    zIndex: 200,
    padding: "14px 18px",
    borderRadius: 14,
    maxWidth: 800,
    margin: "0 auto",
    background: `${T.red}18`,
    border: `1.5px solid ${T.red}40`,
    backdropFilter: "blur(12px)",
    display: "flex",
    alignItems: "center",
    gap: 12,
    animation: "slideUp 0.3s ease"
  } }, /* @__PURE__ */ React.createElement("span", { style: { fontSize: 20 } }, "\u26A0\uFE0F"), /* @__PURE__ */ React.createElement("div", { style: { flex: 1 } }, /* @__PURE__ */ React.createElement("div", { style: { fontSize: 14, fontWeight: 600, color: T.red } }, data._validationError)), /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => setData((d) => ({ ...d, _validationError: null })),
      style: { background: "none", border: "none", color: T.textDim, fontSize: 18, cursor: "pointer", padding: 4 }
    },
    "\u2715"
  )), /* @__PURE__ */ React.createElement("div", { style: {
    position: "fixed",
    bottom: 0,
    left: isWide ? 220 : 0,
    right: 0,
    zIndex: 100,
    padding: "12px 16px",
    background: `${T.bg}f0`,
    backdropFilter: "blur(16px)",
    borderTop: `1px solid ${T.border}`,
    display: "flex",
    gap: 12,
    maxWidth: isWide ? "none" : 800,
    margin: "0 auto"
  } }, /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => setStep(Math.max(0, step - 1)),
      disabled: step === 0,
      style: {
        flex: 1,
        padding: "14px",
        borderRadius: 12,
        border: `1.5px solid ${T.border}`,
        background: "transparent",
        color: step === 0 ? T.textDim : T.textSec,
        fontSize: 15,
        fontWeight: 600,
        cursor: step === 0 ? "default" : "pointer",
        fontFamily: font,
        opacity: step === 0 ? 0.4 : 1
      }
    },
    "\u2190 Zur\xFCck"
  ), /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: () => {
        if (step === 0) {
          const missing = [];
          if (!data.anrede) missing.push("Anrede");
          if (!data.vorname?.trim()) missing.push("Vorname");
          if (!data.nachname?.trim()) missing.push("Nachname");
          if (!data.mobil?.trim()) missing.push("Mobil");
          if (!data.email?.trim()) missing.push("E-Mail");
          if (!data.geburtsdatum?.trim()) missing.push("Geburtsdatum");
          if (data.email && validateEmail(data.email)) missing.push("E-Mail (ung\xFCltig)");
          if (!data.stromverbrauch?.trim()) missing.push("Stromverbrauch");
          if (!data.zusatzVerbrauch?.trim()) missing.push("Zus\xE4tzlicher Verbrauch");
          if (!data.strompreis?.trim()) missing.push("Strompreis");
          if (!data.grundpreis?.trim()) missing.push("Grundpreis");
          if (missing.length > 0) {
            setData((d) => ({ ...d, _validationError: `Pflichtfelder ausf\xFCllen: ${missing.join(", ")}` }));
            setTimeout(() => setData((d) => ({ ...d, _validationError: null })), 5e3);
            return;
          }
        }
        setData((d) => ({ ...d, _validationError: null }));
        setStep(Math.min(STEPS.length - 1, step + 1));
      },
      disabled: step === STEPS.length - 1,
      style: {
        flex: 2,
        padding: "14px",
        borderRadius: 12,
        border: "none",
        background: step === STEPS.length - 1 ? T.green : `linear-gradient(135deg, ${BRAND.yellow}, ${BRAND.yellowDark})`,
        color: step === STEPS.length - 1 ? "#fff" : "#1a1a1a",
        fontSize: 15,
        fontWeight: 700,
        cursor: step === STEPS.length - 1 ? "default" : "pointer",
        fontFamily: font,
        boxShadow: `0 4px 16px ${step === STEPS.length - 1 ? "rgba(52,211,153,0.2)" : "rgba(232,212,77,0.15)"}`,
        opacity: step === STEPS.length - 1 ? 0.5 : 1
      }
    },
    step === STEPS.length - 1 ? "\u{1F34C} Fertig!" : `Weiter \u2192 ${STEPS[step + 1]?.label}`
  ))));
}
const container = document.getElementById("root");
const root = ReactDOM.createRoot(container);
root.render(React.createElement(BeedooField));
</script>
</body>
</html>
